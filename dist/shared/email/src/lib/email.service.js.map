{"version":3,"sources":["../../../../../shared/email/src/lib/email.service.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport * as nodemailer from 'nodemailer';\r\nimport type { Transporter } from 'nodemailer';\r\nimport {\r\n  getInvitationEmailHtml,\r\n  getInvitationEmailText,\r\n} from './templates/invitation.template';\r\nimport {\r\n  getRemovalEmailHtml,\r\n  getRemovalEmailText,\r\n} from './templates/removal.template';\r\nimport {\r\n  getBackupOwnerDesignationEmailHtml,\r\n  getBackupOwnerDesignationEmailText,\r\n} from './templates/backup-owner-designation.template';\r\nimport {\r\n  getRecoveryNotificationEmailHtml,\r\n  getRecoveryNotificationEmailText,\r\n} from './templates/recovery-notification.template';\r\nimport {\r\n  getDataExportCompleteEmailHtml,\r\n  getDataExportCompleteEmailText,\r\n} from './templates/data-export-complete.template';\r\nimport {\r\n  getTenantDeletionInitiatedEmailHtml,\r\n  getTenantDeletionInitiatedEmailText,\r\n} from './templates/tenant-deletion-initiated.template';\r\nimport {\r\n  getTenantDeletionCancelledEmailHtml,\r\n  getTenantDeletionCancelledEmailText,\r\n} from './templates/tenant-deletion-cancelled.template';\r\nimport {\r\n  getTenantDeletionCompleteEmailHtml,\r\n  getTenantDeletionCompleteEmailText,\r\n} from './templates/tenant-deletion-complete.template';\r\n\r\nexport interface SendEmailResult {\r\n  success: boolean;\r\n  messageId?: string;\r\n}\r\n\r\nexport interface InvitationEmailParams {\r\n  to: string;\r\n  inviterName: string;\r\n  tenantName: string;\r\n  inviteLink: string;\r\n  department: string;\r\n}\r\n\r\nexport interface RemovalNotificationParams {\r\n  to: string;\r\n  memberName: string;\r\n  tenantName: string;\r\n  strategy: 'REASSIGN' | 'ARCHIVE';\r\n  contactEmail?: string;\r\n}\r\n\r\nexport interface BackupOwnerDesignationEmailParams {\r\n  to: string;\r\n  tenantName: string;\r\n  designatedBy: string;\r\n  designatedName: string;\r\n}\r\n\r\nexport interface RecoveryNotificationEmailParams {\r\n  to: string;\r\n  ownerName: string;\r\n  tenantName: string;\r\n  backupOwnerName: string;\r\n  recoveryTimestamp: Date;\r\n  ipAddress: string;\r\n}\r\n\r\nexport interface DataExportCompleteEmailParams {\r\n  to: string;\r\n  userName: string;\r\n  format: string;\r\n  fileSize: string;\r\n  downloadUrl: string;\r\n  expiresAt: string;\r\n}\r\n\r\nexport interface TenantDeletionInitiatedEmailParams {\r\n  to: string;\r\n  userName: string;\r\n  tenantName: string;\r\n  requestedByName: string;\r\n  requestedByEmail: string;\r\n  gracePeriodEndsAt: string;\r\n}\r\n\r\nexport interface TenantDeletionCancelledEmailParams {\r\n  to: string;\r\n  userName: string;\r\n  tenantName: string;\r\n}\r\n\r\nexport interface TenantDeletionCompleteEmailParams {\r\n  to: string;\r\n  userName: string;\r\n  tenantName: string;\r\n  certificateReference: string;\r\n}\r\n\r\n@Injectable()\r\nexport class EmailService {\r\n  private readonly logger = new Logger(EmailService.name);\r\n  private transporter: Transporter;\r\n  private readonly fromAddress: string;\r\n\r\n  constructor(private readonly configService: ConfigService) {\r\n    const host = this.configService.get<string>('SMTP_HOST', 'localhost');\r\n    const port = this.configService.get<number>('SMTP_PORT', 587);\r\n    const user = this.configService.get<string>('SMTP_USER', '');\r\n    const pass = this.configService.get<string>('SMTP_PASS', '');\r\n    this.fromAddress = this.configService.get<string>(\r\n      'EMAIL_FROM',\r\n      'noreply@mentor-ai.com'\r\n    );\r\n\r\n    this.transporter = nodemailer.createTransport({\r\n      host,\r\n      port,\r\n      secure: port === 465,\r\n      auth: user ? { user, pass } : undefined,\r\n    });\r\n  }\r\n\r\n  async sendInvitationEmail(\r\n    params: InvitationEmailParams\r\n  ): Promise<SendEmailResult> {\r\n    const { to, inviterName, tenantName, inviteLink, department } = params;\r\n\r\n    const html = getInvitationEmailHtml({\r\n      inviterName,\r\n      tenantName,\r\n      inviteLink,\r\n      department,\r\n      expiresInDays: 7,\r\n    });\r\n\r\n    const text = getInvitationEmailText({\r\n      inviterName,\r\n      tenantName,\r\n      inviteLink,\r\n      department,\r\n      expiresInDays: 7,\r\n    });\r\n\r\n    try {\r\n      const info = await this.transporter.sendMail({\r\n        from: this.fromAddress,\r\n        to,\r\n        subject: `You're invited to join ${tenantName} on Mentor AI`,\r\n        html,\r\n        text,\r\n      });\r\n\r\n      return { success: true, messageId: info.messageId };\r\n    } catch (error) {\r\n      this.logger.error(\r\n        `Failed to send email to ${to}: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      );\r\n      return { success: false };\r\n    }\r\n  }\r\n\r\n  async sendRemovalNotificationEmail(\r\n    params: RemovalNotificationParams\r\n  ): Promise<SendEmailResult> {\r\n    const { to, memberName, tenantName, strategy, contactEmail } = params;\r\n\r\n    const html = getRemovalEmailHtml({\r\n      memberName,\r\n      tenantName,\r\n      strategy,\r\n      contactEmail,\r\n    });\r\n\r\n    const text = getRemovalEmailText({\r\n      memberName,\r\n      tenantName,\r\n      strategy,\r\n      contactEmail,\r\n    });\r\n\r\n    try {\r\n      const info = await this.transporter.sendMail({\r\n        from: this.fromAddress,\r\n        to,\r\n        subject: `Your access to ${tenantName} has been updated`,\r\n        html,\r\n        text,\r\n      });\r\n\r\n      return { success: true, messageId: info.messageId };\r\n    } catch (error) {\r\n      this.logger.error(\r\n        `Failed to send removal notification to ${to}: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      );\r\n      return { success: false };\r\n    }\r\n  }\r\n\r\n  async sendBackupOwnerDesignationEmail(\r\n    params: BackupOwnerDesignationEmailParams\r\n  ): Promise<SendEmailResult> {\r\n    const { to, tenantName, designatedBy, designatedName } = params;\r\n\r\n    const html = getBackupOwnerDesignationEmailHtml({\r\n      designatedName,\r\n      tenantName,\r\n      designatedBy,\r\n    });\r\n\r\n    const text = getBackupOwnerDesignationEmailText({\r\n      designatedName,\r\n      tenantName,\r\n      designatedBy,\r\n    });\r\n\r\n    try {\r\n      const info = await this.transporter.sendMail({\r\n        from: this.fromAddress,\r\n        to,\r\n        subject: `You've been designated as Backup Owner for ${tenantName}`,\r\n        html,\r\n        text,\r\n      });\r\n\r\n      return { success: true, messageId: info.messageId };\r\n    } catch (error) {\r\n      this.logger.error(\r\n        `Failed to send backup owner designation email to ${to}: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      );\r\n      return { success: false };\r\n    }\r\n  }\r\n\r\n  async sendRecoveryNotificationEmail(\r\n    params: RecoveryNotificationEmailParams\r\n  ): Promise<SendEmailResult> {\r\n    const { to, ownerName, tenantName, backupOwnerName, recoveryTimestamp, ipAddress } = params;\r\n\r\n    const html = getRecoveryNotificationEmailHtml({\r\n      ownerName,\r\n      tenantName,\r\n      backupOwnerName,\r\n      recoveryTimestamp: recoveryTimestamp.toISOString(),\r\n      ipAddress,\r\n    });\r\n\r\n    const text = getRecoveryNotificationEmailText({\r\n      ownerName,\r\n      tenantName,\r\n      backupOwnerName,\r\n      recoveryTimestamp: recoveryTimestamp.toISOString(),\r\n      ipAddress,\r\n    });\r\n\r\n    try {\r\n      const info = await this.transporter.sendMail({\r\n        from: this.fromAddress,\r\n        to,\r\n        subject: `Account Recovery Action - ${tenantName}`,\r\n        html,\r\n        text,\r\n      });\r\n\r\n      return { success: true, messageId: info.messageId };\r\n    } catch (error) {\r\n      this.logger.error(\r\n        `Failed to send recovery notification to ${to}: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      );\r\n      return { success: false };\r\n    }\r\n  }\r\n\r\n  async sendDataExportCompleteEmail(\r\n    params: DataExportCompleteEmailParams\r\n  ): Promise<SendEmailResult> {\r\n    const { to, userName, format, fileSize, downloadUrl, expiresAt } = params;\r\n\r\n    const html = getDataExportCompleteEmailHtml({\r\n      userName,\r\n      format,\r\n      fileSize,\r\n      downloadUrl,\r\n      expiresAt,\r\n    });\r\n\r\n    const text = getDataExportCompleteEmailText({\r\n      userName,\r\n      format,\r\n      fileSize,\r\n      downloadUrl,\r\n      expiresAt,\r\n    });\r\n\r\n    try {\r\n      const info = await this.transporter.sendMail({\r\n        from: this.fromAddress,\r\n        to,\r\n        subject: `Your data export is ready — Mentor AI`,\r\n        html,\r\n        text,\r\n      });\r\n\r\n      return { success: true, messageId: info.messageId };\r\n    } catch (error) {\r\n      this.logger.error(\r\n        `Failed to send data export email to ${to}: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      );\r\n      return { success: false };\r\n    }\r\n  }\r\n\r\n  async sendTenantDeletionInitiatedEmail(\r\n    params: TenantDeletionInitiatedEmailParams\r\n  ): Promise<SendEmailResult> {\r\n    const { to, userName, tenantName, requestedByName, requestedByEmail, gracePeriodEndsAt } = params;\r\n\r\n    const html = getTenantDeletionInitiatedEmailHtml({\r\n      userName,\r\n      tenantName,\r\n      requestedByName,\r\n      requestedByEmail,\r\n      gracePeriodEndsAt,\r\n    });\r\n\r\n    const text = getTenantDeletionInitiatedEmailText({\r\n      userName,\r\n      tenantName,\r\n      requestedByName,\r\n      requestedByEmail,\r\n      gracePeriodEndsAt,\r\n    });\r\n\r\n    try {\r\n      const info = await this.transporter.sendMail({\r\n        from: this.fromAddress,\r\n        to,\r\n        subject: `Important: ${tenantName} scheduled for deletion — Mentor AI`,\r\n        html,\r\n        text,\r\n      });\r\n\r\n      return { success: true, messageId: info.messageId };\r\n    } catch (error) {\r\n      this.logger.error(\r\n        `Failed to send tenant deletion initiated email to ${to}: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      );\r\n      return { success: false };\r\n    }\r\n  }\r\n\r\n  async sendTenantDeletionCancelledEmail(\r\n    params: TenantDeletionCancelledEmailParams\r\n  ): Promise<SendEmailResult> {\r\n    const { to, userName, tenantName } = params;\r\n\r\n    const html = getTenantDeletionCancelledEmailHtml({\r\n      userName,\r\n      tenantName,\r\n    });\r\n\r\n    const text = getTenantDeletionCancelledEmailText({\r\n      userName,\r\n      tenantName,\r\n    });\r\n\r\n    try {\r\n      const info = await this.transporter.sendMail({\r\n        from: this.fromAddress,\r\n        to,\r\n        subject: `${tenantName} deletion cancelled — Mentor AI`,\r\n        html,\r\n        text,\r\n      });\r\n\r\n      return { success: true, messageId: info.messageId };\r\n    } catch (error) {\r\n      this.logger.error(\r\n        `Failed to send tenant deletion cancelled email to ${to}: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      );\r\n      return { success: false };\r\n    }\r\n  }\r\n\r\n  async sendTenantDeletionCompleteEmail(\r\n    params: TenantDeletionCompleteEmailParams\r\n  ): Promise<SendEmailResult> {\r\n    const { to, userName, tenantName, certificateReference } = params;\r\n\r\n    const html = getTenantDeletionCompleteEmailHtml({\r\n      userName,\r\n      tenantName,\r\n      certificateReference,\r\n    });\r\n\r\n    const text = getTenantDeletionCompleteEmailText({\r\n      userName,\r\n      tenantName,\r\n      certificateReference,\r\n    });\r\n\r\n    try {\r\n      const info = await this.transporter.sendMail({\r\n        from: this.fromAddress,\r\n        to,\r\n        subject: `Your workspace has been deleted — Mentor AI`,\r\n        html,\r\n        text,\r\n      });\r\n\r\n      return { success: true, messageId: info.messageId };\r\n    } catch (error) {\r\n      this.logger.error(\r\n        `Failed to send tenant deletion complete email to ${to}: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      );\r\n      return { success: false };\r\n    }\r\n  }\r\n}\r\n"],"names":["EmailService","sendInvitationEmail","params","to","inviterName","tenantName","inviteLink","department","html","getInvitationEmailHtml","expiresInDays","text","getInvitationEmailText","info","transporter","sendMail","from","fromAddress","subject","success","messageId","error","logger","Error","message","sendRemovalNotificationEmail","memberName","strategy","contactEmail","getRemovalEmailHtml","getRemovalEmailText","sendBackupOwnerDesignationEmail","designatedBy","designatedName","getBackupOwnerDesignationEmailHtml","getBackupOwnerDesignationEmailText","sendRecoveryNotificationEmail","ownerName","backupOwnerName","recoveryTimestamp","ipAddress","getRecoveryNotificationEmailHtml","toISOString","getRecoveryNotificationEmailText","sendDataExportCompleteEmail","userName","format","fileSize","downloadUrl","expiresAt","getDataExportCompleteEmailHtml","getDataExportCompleteEmailText","sendTenantDeletionInitiatedEmail","requestedByName","requestedByEmail","gracePeriodEndsAt","getTenantDeletionInitiatedEmailHtml","getTenantDeletionInitiatedEmailText","sendTenantDeletionCancelledEmail","getTenantDeletionCancelledEmailHtml","getTenantDeletionCancelledEmailText","sendTenantDeletionCompleteEmail","certificateReference","getTenantDeletionCompleteEmailHtml","getTenantDeletionCompleteEmailText","constructor","configService","Logger","name","host","get","port","user","pass","nodemailer","createTransport","secure","auth","undefined","Injectable"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}