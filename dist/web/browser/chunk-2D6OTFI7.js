import{d as Cn,e as Mt,f as Gi,g as qi}from"./chunk-R4LDHEAD.js";import{a as Yi,c as xn,e as bn,g as vn,n as Ki,r as Ct}from"./chunk-BJPJ353G.js";import{a as et,b as _n}from"./chunk-X5FYGGBF.js";import{a as vo}from"./chunk-QLHVQZLH.js";import{$a as ie,A as J,Aa as Vi,Ba as Y,C as x,Ca as N,D as b,Da as _t,E as S,Ea as c,F as j,Fa as I,Ga as $,H as Ai,Ha as me,Ia as mn,Ja as hn,K as v,Ka as gn,L as dn,La as fn,M as Di,Ma as Bi,N as Ri,Na as Je,Oa as Le,Pa as Fe,R as Se,Ra as X,S as bo,T as zi,U as Li,Ua as K,V as r,Va as R,Z as oe,a as F,aa as Fi,b as te,c as kr,db as Ee,ea as ue,fa as _,ga as C,ha as qe,hb as ji,i as Z,ia as pn,ib as Wi,ja as G,k as $i,ka as q,kb as Hi,la as V,lb as Ui,ma as p,na as u,oa as T,pa as m,q as Oi,qa as g,ra as M,sa as E,ta as B,ua as O,va as P,w as Ni,wa as s,x as ze,xa as un,ya as Ze,za as Xe}from"./chunk-GC2SN3QZ.js";var xt=class o{http=J(Ee);baseUrl=`${et.apiUrl}/api/v1/conversations`;isCreating$=v(!1);async createConversation(t,e,n,i){this.isCreating$.set(!0);try{return(await Z(this.http.post(this.baseUrl,{title:t,personaType:e,conceptId:n,curriculumId:i}))).data}finally{this.isCreating$.set(!1)}}async updatePersona(t,e){return(await Z(this.http.patch(`${this.baseUrl}/${t}/persona`,{personaType:e}))).data}async getConversations(){return(await Z(this.http.get(this.baseUrl))).data}async getConversation(t){return(await Z(this.http.get(`${this.baseUrl}/${t}`))).data}async deleteConversation(t){await Z(this.http.delete(`${this.baseUrl}/${t}`))}async getGroupedConversations(){return(await Z(this.http.get(`${this.baseUrl}/grouped`))).data}async getBrainTree(){return(await Z(this.http.get(`${this.baseUrl}/brain-tree`))).data}static \u0275fac=function(e){return new(e||o)};static \u0275prov=ze({token:o,factory:o.\u0275fac,providedIn:"root"})};var $e=Object.create(null);$e.open="0";$e.close="1";$e.ping="2";$e.pong="3";$e.message="4";$e.upgrade="5";$e.noop="6";var It=Object.create(null);Object.keys($e).forEach(o=>{It[$e[o]]=o});var $t={type:"error",data:"parser error"};var Xi=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Ji=typeof ArrayBuffer=="function",ea=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer,Ot=({type:o,data:t},e,n)=>Xi&&t instanceof Blob?e?n(t):Qi(t,n):Ji&&(t instanceof ArrayBuffer||ea(t))?e?n(t):Qi(new Blob([t]),n):n($e[o]+(t||"")),Qi=(o,t)=>{let e=new FileReader;return e.onload=function(){let n=e.result.split(",")[1];t("b"+(n||""))},e.readAsDataURL(o)};function Zi(o){return o instanceof Uint8Array?o:o instanceof ArrayBuffer?new Uint8Array(o):new Uint8Array(o.buffer,o.byteOffset,o.byteLength)}var ko;function ta(o,t){if(Xi&&o.data instanceof Blob)return o.data.arrayBuffer().then(Zi).then(t);if(Ji&&(o.data instanceof ArrayBuffer||ea(o.data)))return t(Zi(o.data));Ot(o,!1,e=>{ko||(ko=new TextEncoder),t(ko.encode(e))})}var na="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Nt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let o=0;o<na.length;o++)Nt[na.charCodeAt(o)]=o;var oa=o=>{let t=o.length*.75,e=o.length,n,i=0,a,l,h,d;o[o.length-1]==="="&&(t--,o[o.length-2]==="="&&t--);let k=new ArrayBuffer(t),y=new Uint8Array(k);for(n=0;n<e;n+=4)a=Nt[o.charCodeAt(n)],l=Nt[o.charCodeAt(n+1)],h=Nt[o.charCodeAt(n+2)],d=Nt[o.charCodeAt(n+3)],y[i++]=a<<2|l>>4,y[i++]=(l&15)<<4|h>>2,y[i++]=(h&3)<<6|d&63;return k};var yr=typeof ArrayBuffer=="function",At=(o,t)=>{if(typeof o!="string")return{type:"message",data:ia(o,t)};let e=o.charAt(0);return e==="b"?{type:"message",data:wr(o.substring(1),t)}:It[e]?o.length>1?{type:It[e],data:o.substring(1)}:{type:It[e]}:$t},wr=(o,t)=>{if(yr){let e=oa(o);return ia(e,t)}else return{base64:!0,data:o}},ia=(o,t)=>t==="blob"?o instanceof Blob?o:new Blob([o]):o instanceof ArrayBuffer?o:o.buffer;var aa="",ra=(o,t)=>{let e=o.length,n=new Array(e),i=0;o.forEach((a,l)=>{Ot(a,!1,h=>{n[l]=h,++i===e&&t(n.join(aa))})})},sa=(o,t)=>{let e=o.split(aa),n=[];for(let i=0;i<e.length;i++){let a=At(e[i],t);if(n.push(a),a.type==="error")break}return n};function la(){return new TransformStream({transform(o,t){ta(o,e=>{let n=e.length,i;if(n<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,n);else if(n<65536){i=new Uint8Array(3);let a=new DataView(i.buffer);a.setUint8(0,126),a.setUint16(1,n)}else{i=new Uint8Array(9);let a=new DataView(i.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(n))}o.data&&typeof o.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(e)})}})}var yo;function kn(o){return o.reduce((t,e)=>t+e.length,0)}function yn(o,t){if(o[0].length===t)return o.shift();let e=new Uint8Array(t),n=0;for(let i=0;i<t;i++)e[i]=o[0][n++],n===o[0].length&&(o.shift(),n=0);return o.length&&n<o[0].length&&(o[0]=o[0].slice(n)),e}function ca(o,t){yo||(yo=new TextDecoder);let e=[],n=0,i=-1,a=!1;return new TransformStream({transform(l,h){for(e.push(l);;){if(n===0){if(kn(e)<1)break;let d=yn(e,1);a=(d[0]&128)===128,i=d[0]&127,i<126?n=3:i===126?n=1:n=2}else if(n===1){if(kn(e)<2)break;let d=yn(e,2);i=new DataView(d.buffer,d.byteOffset,d.length).getUint16(0),n=3}else if(n===2){if(kn(e)<8)break;let d=yn(e,8),k=new DataView(d.buffer,d.byteOffset,d.length),y=k.getUint32(0);if(y>Math.pow(2,21)-1){h.enqueue($t);break}i=y*Math.pow(2,32)+k.getUint32(4),n=3}else{if(kn(e)<i)break;let d=yn(e,i);h.enqueue(At(a?d:yo.decode(d),t)),n=0}if(i===0||i>o){h.enqueue($t);break}}}})}var wo=4;function ae(o){if(o)return Sr(o)}function Sr(o){for(var t in ae.prototype)o[t]=ae.prototype[t];return o}ae.prototype.on=ae.prototype.addEventListener=function(o,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+o]=this._callbacks["$"+o]||[]).push(t),this};ae.prototype.once=function(o,t){function e(){this.off(o,e),t.apply(this,arguments)}return e.fn=t,this.on(o,e),this};ae.prototype.off=ae.prototype.removeListener=ae.prototype.removeAllListeners=ae.prototype.removeEventListener=function(o,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var e=this._callbacks["$"+o];if(!e)return this;if(arguments.length==1)return delete this._callbacks["$"+o],this;for(var n,i=0;i<e.length;i++)if(n=e[i],n===t||n.fn===t){e.splice(i,1);break}return e.length===0&&delete this._callbacks["$"+o],this};ae.prototype.emit=function(o){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),e=this._callbacks["$"+o],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e){e=e.slice(0);for(var n=0,i=e.length;n<i;++n)e[n].apply(this,t)}return this};ae.prototype.emitReserved=ae.prototype.emit;ae.prototype.listeners=function(o){return this._callbacks=this._callbacks||{},this._callbacks["$"+o]||[]};ae.prototype.hasListeners=function(o){return!!this.listeners(o).length};var Ye=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,e)=>e(t,0),xe=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),da="arraybuffer";function wn(o,...t){return t.reduce((e,n)=>(o.hasOwnProperty(n)&&(e[n]=o[n]),e),{})}var Er=xe.setTimeout,Tr=xe.clearTimeout;function Ke(o,t){t.useNativeTimers?(o.setTimeoutFn=Er.bind(xe),o.clearTimeoutFn=Tr.bind(xe)):(o.setTimeoutFn=xe.setTimeout.bind(xe),o.clearTimeoutFn=xe.clearTimeout.bind(xe))}var Pr=1.33;function pa(o){return typeof o=="string"?Mr(o):Math.ceil((o.byteLength||o.size)*Pr)}function Mr(o){let t=0,e=0;for(let n=0,i=o.length;n<i;n++)t=o.charCodeAt(n),t<128?e+=1:t<2048?e+=2:t<55296||t>=57344?e+=3:(n++,e+=4);return e}function Sn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function ua(o){let t="";for(let e in o)o.hasOwnProperty(e)&&(t.length&&(t+="&"),t+=encodeURIComponent(e)+"="+encodeURIComponent(o[e]));return t}function ma(o){let t={},e=o.split("&");for(let n=0,i=e.length;n<i;n++){let a=e[n].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}var En=class extends Error{constructor(t,e,n){super(t),this.description=e,this.context=n,this.type="TransportError"}},Qe=class extends ae{constructor(t){super(),this.writable=!1,Ke(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,e,n){return super.emitReserved("error",new En(t,e,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){let e=At(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){let t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){let e=ua(t);return e.length?"?"+e:""}};var Dt=class extends Qe{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";let e=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||e()})),this.writable||(n++,this.once("drain",function(){--n||e()}))}else e()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){let e=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};sa(t,this.socket.binaryType).forEach(e),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){let t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,ra(t,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.opts.secure?"https":"http",e=this.query||{};return this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Sn()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.createUri(t,e)}};var ha=!1;try{ha=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var ga=ha;function Ir(){}var So=class extends Dt{constructor(t){if(super(t),typeof location<"u"){let e=location.protocol==="https:",n=location.port;n||(n=e?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||n!==t.port}}doWrite(t,e){let n=this.request({method:"POST",data:t});n.on("success",e),n.on("error",(i,a)=>{this.onError("xhr post error",i,a)})}doPoll(){let t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(e,n)=>{this.onError("xhr poll error",e,n)}),this.pollXhr=t}},Tn=(()=>{class o extends ae{constructor(e,n,i){super(),this.createRequest=e,Ke(this,i),this._opts=i,this._method=i.method||"GET",this._uri=n,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var e;let n=wn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;let i=this._xhr=this.createRequest(n);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let a in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(a)&&i.setRequestHeader(a,this._opts.extraHeaders[a])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var a;i.readyState===3&&((a=this._opts.cookieJar)===null||a===void 0||a.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(a){this.setTimeoutFn(()=>{this._onError(a)},0);return}typeof document<"u"&&(this._index=o.requestsCount++,o.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Ir,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete o.requests[this._index],this._xhr=null}}_onLoad(){let e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}return o.requestsCount=0,o.requests={},o})();if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",fa);else if(typeof addEventListener=="function"){let o="onpagehide"in xe?"pagehide":"unload";addEventListener(o,fa,!1)}}function fa(){for(let o in Tn.requests)Tn.requests.hasOwnProperty(o)&&Tn.requests[o].abort()}var $r=(function(){let o=_a({xdomain:!1});return o&&o.responseType!==null})(),tt=class extends So{constructor(t){super(t);let e=t&&t.forceBase64;this.supportsBinary=$r&&!e}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new Tn(_a,this.uri(),t)}};function _a(o){let t=o.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||ga))return new XMLHttpRequest}catch{}if(!t)try{return new xe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}var Ca=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",To=class extends Qe{get name(){return"websocket"}doOpen(){let t=this.uri(),e=this.opts.protocols,n=Ca?{}:wn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,e,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){let n=t[e],i=e===t.length-1;Ot(n,this.supportsBinary,a=>{try{this.doWrite(n,a)}catch{}i&&Ye(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){let t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=Sn()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}},Eo=xe.WebSocket||xe.MozWebSocket,nt=class extends To{createSocket(t,e,n){return Ca?new Eo(t,e,n):e?new Eo(t,e):new Eo(t)}doWrite(t,e){this.ws.send(e)}};var bt=class extends Qe{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{let e=ca(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=t.readable.pipeThrough(e).getReader(),i=la();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();let a=()=>{n.read().then(({done:h,value:d})=>{h||(this.onPacket(d),a())}).catch(h=>{})};a();let l={type:"open"};this.query.sid&&(l.data=`{"sid":"${this.query.sid}"}`),this._writer.write(l).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let e=0;e<t.length;e++){let n=t[e],i=e===t.length-1;this._writer.write(n).then(()=>{i&&Ye(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}};var Po={websocket:nt,webtransport:bt,polling:tt};var Or=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Nr=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function vt(o){if(o.length>8e3)throw"URI too long";let t=o,e=o.indexOf("["),n=o.indexOf("]");e!=-1&&n!=-1&&(o=o.substring(0,e)+o.substring(e,n).replace(/:/g,";")+o.substring(n,o.length));let i=Or.exec(o||""),a={},l=14;for(;l--;)a[Nr[l]]=i[l]||"";return e!=-1&&n!=-1&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=Ar(a,a.path),a.queryKey=Dr(a,a.query),a}function Ar(o,t){let e=/\/{2,9}/g,n=t.replace(e,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&n.splice(0,1),t.slice(-1)=="/"&&n.splice(n.length-1,1),n}function Dr(o,t){let e={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,a){i&&(e[i]=a)}),e}var Mo=typeof addEventListener=="function"&&typeof removeEventListener=="function",Pn=[];Mo&&addEventListener("offline",()=>{Pn.forEach(o=>o())},!1);var Mn=(()=>{class o extends ae{constructor(e,n){if(super(),this.binaryType=da,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(n=e,e=null),e){let i=vt(e);n.hostname=i.host,n.secure=i.protocol==="https"||i.protocol==="wss",n.port=i.port,i.query&&(n.query=i.query)}else n.host&&(n.hostname=vt(n.host).host);Ke(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(i=>{let a=i.prototype.name;this.transports.push(a),this._transportsByName[a]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=ma(this.opts.query)),Mo&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Pn.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){let n=Object.assign({},this.opts.query);n.EIO=wo,n.transport=e,this.id&&(n.sid=this.id);let i=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}let e=this.opts.rememberUpgrade&&o.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";let n=this.createTransport(e);n.open(),this.setTransport(n)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",o.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":let n=new Error("server error");n.code=e.data,this._onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let i=0;i<this.writeBuffer.length;i++){let a=this.writeBuffer[i].data;if(a&&(n+=pa(a)),i>0&&n>this._maxPayload)return this.writeBuffer.slice(0,i);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Ye(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,n,i){return this._sendPacket("message",e,n,i),this}send(e,n,i){return this._sendPacket("message",e,n,i),this}_sendPacket(e,n,i,a){if(typeof n=="function"&&(a=n,n=void 0),typeof i=="function"&&(a=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;let l={type:e,data:n,options:i};this.emitReserved("packetCreate",l),this.writeBuffer.push(l),a&&this.once("flush",a),this.flush()}close(){let e=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},i=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}_onError(e){if(o.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Mo&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){let i=Pn.indexOf(this._offlineEventListener);i!==-1&&Pn.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this._prevBufferLen=0}}}return o.protocol=wo,o})(),In=class extends Mn{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let e=this.createTransport(t),n=!1;Mn.priorWebsocketSuccess=!1;let i=()=>{n||(e.send([{type:"ping",data:"probe"}]),e.once("packet",z=>{if(!n)if(z.type==="pong"&&z.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;Mn.priorWebsocketSuccess=e.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(y(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())})}else{let D=new Error("probe error");D.transport=e.name,this.emitReserved("upgradeError",D)}}))};function a(){n||(n=!0,y(),e.close(),e=null)}let l=z=>{let D=new Error("probe error: "+z);D.transport=e.name,a(),this.emitReserved("upgradeError",D)};function h(){l("transport closed")}function d(){l("socket closed")}function k(z){e&&z.name!==e.name&&a()}let y=()=>{e.removeListener("open",i),e.removeListener("error",l),e.removeListener("close",h),this.off("close",d),this.off("upgrading",k)};e.once("open",i),e.once("error",l),e.once("close",h),this.once("close",d),this.once("upgrading",k),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{n||e.open()},200):e.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){let e=[];for(let n=0;n<t.length;n++)~this.transports.indexOf(t[n])&&e.push(t[n]);return e}},kt=class extends In{constructor(t,e={}){let n=typeof t=="object"?t:e;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(i=>Po[i]).filter(i=>!!i)),super(t,n)}};var x0=kt.protocol;function xa(o,t="",e){let n=o;e=e||typeof location<"u"&&location,o==null&&(o=e.protocol+"//"+e.host),typeof o=="string"&&(o.charAt(0)==="/"&&(o.charAt(1)==="/"?o=e.protocol+o:o=e.host+o),/^(https?|wss?):\/\//.test(o)||(typeof e<"u"?o=e.protocol+"//"+o:o="https://"+o),n=vt(o)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";let a=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+a+":"+n.port+t,n.href=n.protocol+"://"+a+(e&&e.port===n.port?"":":"+n.port),n}var Do={};kr(Do,{Decoder:()=>No,Encoder:()=>Oo,PacketType:()=>W,isPacketValid:()=>Ur,protocol:()=>wa});var zr=typeof ArrayBuffer=="function",Lr=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o.buffer instanceof ArrayBuffer,ba=Object.prototype.toString,Fr=typeof Blob=="function"||typeof Blob<"u"&&ba.call(Blob)==="[object BlobConstructor]",Vr=typeof File=="function"||typeof File<"u"&&ba.call(File)==="[object FileConstructor]";function zt(o){return zr&&(o instanceof ArrayBuffer||Lr(o))||Fr&&o instanceof Blob||Vr&&o instanceof File}function Rt(o,t){if(!o||typeof o!="object")return!1;if(Array.isArray(o)){for(let e=0,n=o.length;e<n;e++)if(Rt(o[e]))return!0;return!1}if(zt(o))return!0;if(o.toJSON&&typeof o.toJSON=="function"&&arguments.length===1)return Rt(o.toJSON(),!0);for(let e in o)if(Object.prototype.hasOwnProperty.call(o,e)&&Rt(o[e]))return!0;return!1}function va(o){let t=[],e=o.data,n=o;return n.data=Io(e,t),n.attachments=t.length,{packet:n,buffers:t}}function Io(o,t){if(!o)return o;if(zt(o)){let e={_placeholder:!0,num:t.length};return t.push(o),e}else if(Array.isArray(o)){let e=new Array(o.length);for(let n=0;n<o.length;n++)e[n]=Io(o[n],t);return e}else if(typeof o=="object"&&!(o instanceof Date)){let e={};for(let n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=Io(o[n],t));return e}return o}function ka(o,t){return o.data=$o(o.data,t),delete o.attachments,o}function $o(o,t){if(!o)return o;if(o&&o._placeholder===!0){if(typeof o.num=="number"&&o.num>=0&&o.num<t.length)return t[o.num];throw new Error("illegal attachments")}else if(Array.isArray(o))for(let e=0;e<o.length;e++)o[e]=$o(o[e],t);else if(typeof o=="object")for(let e in o)Object.prototype.hasOwnProperty.call(o,e)&&(o[e]=$o(o[e],t));return o}var ya=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],wa=5,W=(function(o){return o[o.CONNECT=0]="CONNECT",o[o.DISCONNECT=1]="DISCONNECT",o[o.EVENT=2]="EVENT",o[o.ACK=3]="ACK",o[o.CONNECT_ERROR=4]="CONNECT_ERROR",o[o.BINARY_EVENT=5]="BINARY_EVENT",o[o.BINARY_ACK=6]="BINARY_ACK",o})(W||{}),Oo=class{constructor(t){this.replacer=t}encode(t){return(t.type===W.EVENT||t.type===W.ACK)&&Rt(t)?this.encodeAsBinary({type:t.type===W.EVENT?W.BINARY_EVENT:W.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let e=""+t.type;return(t.type===W.BINARY_EVENT||t.type===W.BINARY_ACK)&&(e+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(e+=t.nsp+","),t.id!=null&&(e+=t.id),t.data!=null&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){let e=va(t),n=this.encodeAsString(e.packet),i=e.buffers;return i.unshift(n),i}},No=class o extends ae{constructor(t){super(),this.reviver=t}add(t){let e;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);let n=e.type===W.BINARY_EVENT;n||e.type===W.BINARY_ACK?(e.type=n?W.EVENT:W.ACK,this.reconstructor=new Ao(e),e.attachments===0&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(zt(t)||t.base64)if(this.reconstructor)e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let e=0,n={type:Number(t.charAt(0))};if(W[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===W.BINARY_EVENT||n.type===W.BINARY_ACK){let a=e+1;for(;t.charAt(++e)!=="-"&&e!=t.length;);let l=t.substring(a,e);if(l!=Number(l)||t.charAt(e)!=="-")throw new Error("Illegal attachments");n.attachments=Number(l)}if(t.charAt(e+1)==="/"){let a=e+1;for(;++e&&!(t.charAt(e)===","||e===t.length););n.nsp=t.substring(a,e)}else n.nsp="/";let i=t.charAt(e+1);if(i!==""&&Number(i)==i){let a=e+1;for(;++e;){let l=t.charAt(e);if(l==null||Number(l)!=l){--e;break}if(e===t.length)break}n.id=Number(t.substring(a,e+1))}if(t.charAt(++e)){let a=this.tryParse(t.substr(e));if(o.isPayloadValid(n.type,a))n.data=a;else throw new Error("invalid payload")}return n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,e){switch(t){case W.CONNECT:return $n(e);case W.DISCONNECT:return e===void 0;case W.CONNECT_ERROR:return typeof e=="string"||$n(e);case W.EVENT:case W.BINARY_EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&ya.indexOf(e[0])===-1);case W.ACK:case W.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},Ao=class{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){let e=ka(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function Br(o){return typeof o=="string"}var jr=Number.isInteger||function(o){return typeof o=="number"&&isFinite(o)&&Math.floor(o)===o};function Wr(o){return o===void 0||jr(o)}function $n(o){return Object.prototype.toString.call(o)==="[object Object]"}function Hr(o,t){switch(o){case W.CONNECT:return t===void 0||$n(t);case W.DISCONNECT:return t===void 0;case W.EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&ya.indexOf(t[0])===-1);case W.ACK:return Array.isArray(t);case W.CONNECT_ERROR:return typeof t=="string"||$n(t);default:return!1}}function Ur(o){return Br(o.nsp)&&Wr(o.id)&&Hr(o.type,o.data)}function Te(o,t,e){return o.on(t,e),function(){o.off(t,e)}}var Gr=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),yt=class extends ae{constructor(t,e,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let t=this.io;this.subs=[Te(t,"open",this.onopen.bind(this)),Te(t,"packet",this.onpacket.bind(this)),Te(t,"error",this.onerror.bind(this)),Te(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){var n,i,a;if(Gr.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;let l={type:W.EVENT,data:e};if(l.options={},l.options.compress=this.flags.compress!==!1,typeof e[e.length-1]=="function"){let y=this.ids++,z=e.pop();this._registerAckCallback(y,z),l.id=y}let h=(i=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||i===void 0?void 0:i.writable,d=this.connected&&!(!((a=this.io.engine)===null||a===void 0)&&a._hasPingExpired());return this.flags.volatile&&!h||(d?(this.notifyOutgoingListeners(l),this.packet(l)):this.sendBuffer.push(l)),this.flags={},this}_registerAckCallback(t,e){var n;let i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[t]=e;return}let a=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let h=0;h<this.sendBuffer.length;h++)this.sendBuffer[h].id===t&&this.sendBuffer.splice(h,1);e.call(this,new Error("operation has timed out"))},i),l=(...h)=>{this.io.clearTimeoutFn(a),e.apply(this,h)};l.withError=!0,this.acks[t]=l}emitWithAck(t,...e){return new Promise((n,i)=>{let a=(l,h)=>l?i(l):n(h);a.withError=!0,e.push(a),this.emit(t,...e)})}_addToQueue(t){let e;typeof t[t.length-1]=="function"&&(e=t.pop());let n={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...a)=>(this._queue[0],i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(i)):(this._queue.shift(),e&&e(null,...a)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;let e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:W.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(n=>String(n.id)===t)){let n=this.acks[t];delete this.acks[t],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case W.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case W.EVENT:case W.BINARY_EVENT:this.onevent(t);break;case W.ACK:case W.BINARY_ACK:this.onack(t);break;case W.DISCONNECT:this.ondisconnect();break;case W.CONNECT_ERROR:this.destroy();let n=new Error(t.data.message);n.data=t.data.data,this.emitReserved("connect_error",n);break}}onevent(t){let e=t.data||[];t.id!=null&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){let e=this._anyListeners.slice();for(let n of e)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){let e=this,n=!1;return function(...i){n||(n=!0,e.packet({type:W.ACK,id:t,data:i}))}}onack(t){let e=this.acks[t.id];typeof e=="function"&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:W.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){let e=this._anyListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){let e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let e=this._anyOutgoingListeners.slice();for(let n of e)n.apply(this,t.data)}}};function at(o){o=o||{},this.ms=o.min||100,this.max=o.max||1e4,this.factor=o.factor||2,this.jitter=o.jitter>0&&o.jitter<=1?o.jitter:0,this.attempts=0}at.prototype.duration=function(){var o=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),e=Math.floor(t*this.jitter*o);o=(Math.floor(t*10)&1)==0?o-e:o+e}return Math.min(o,this.max)|0};at.prototype.reset=function(){this.attempts=0};at.prototype.setMin=function(o){this.ms=o};at.prototype.setMax=function(o){this.max=o};at.prototype.setJitter=function(o){this.jitter=o};var wt=class extends ae{constructor(t,e){var n;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.opts=e,Ke(this,e),this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor((n=e.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new at({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(e.timeout==null?2e4:e.timeout),this._readyState="closed",this.uri=t;let i=e.parser||Do;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=e.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(e=this.backoff)===null||e===void 0||e.setMin(t),this)}randomizationFactor(t){var e;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(e=this.backoff)===null||e===void 0||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(e=this.backoff)===null||e===void 0||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new kt(this.uri,this.opts);let e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;let i=Te(e,"open",function(){n.onopen(),t&&t()}),a=h=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",h),t?t(h):this.maybeReconnectOnOpen()},l=Te(e,"error",a);if(this._timeout!==!1){let h=this._timeout,d=this.setTimeoutFn(()=>{i(),a(new Error("timeout")),e.close()},h);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}return this.subs.push(i),this.subs.push(l),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let t=this.engine;this.subs.push(Te(t,"ping",this.onping.bind(this)),Te(t,"data",this.ondata.bind(this)),Te(t,"error",this.onerror.bind(this)),Te(t,"close",this.onclose.bind(this)),Te(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){Ye(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new yt(this,t,e),this.nsps[t]=n),n}_destroy(t){let e=Object.keys(this.nsps);for(let n of e)if(this.nsps[n].active)return;this._close()}_packet(t){let e=this.encoder.encode(t);for(let n=0;n<e.length;n++)this.engine.write(e[n],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,e){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let e=this.backoff.duration();this._reconnecting=!0;let n=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},e);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){let t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}};var Lt={};function Ft(o,t){typeof o=="object"&&(t=o,o=void 0),t=t||{};let e=xa(o,t.path||"/socket.io"),n=e.source,i=e.id,a=e.path,l=Lt[i]&&a in Lt[i].nsps,h=t.forceNew||t["force new connection"]||t.multiplex===!1||l,d;return h?d=new wt(n,t):(Lt[i]||(Lt[i]=new wt(n,t)),d=Lt[i]),e.query&&!t.query&&(t.query=e.queryKey),d.socket(e.path,t)}Object.assign(Ft,{Manager:wt,Socket:yt,io:Ft,connect:Ft});var On=class o{socket=null;authService=J(_n);connectionState$=v("disconnected");wasWorkflowActive$=v(!1);lastEmitError$=v(null);_isWorkflowRunning=!1;setWorkflowRunning(t){this._isWorkflowRunning=t}checkConnected(t){return this.socket?.connected?!0:(this.lastEmitError$.set(`Nije mogu\u0107e: ${t} \u2014 veza nije aktivna`),!1)}messageReceivedCallbacks=[];messageChunkCallbacks=[];completeCallbacks=[];errorCallbacks=[];notesUpdatedCallbacks=[];conceptDetectedCallbacks=[];planReadyCallbacks=[];stepProgressCallbacks=[];workflowCompleteCallbacks=[];workflowErrorCallbacks=[];conversationsCreatedCallbacks=[];stepConfirmationCallbacks=[];stepAwaitingInputCallbacks=[];stepMessageCallbacks=[];navigateToConversationCallbacks=[];tasksCreatedForExecutionCallbacks=[];yoloProgressCallbacks=[];yoloCompleteCallbacks=[];discoveryChunkCallbacks=[];discoveryCompleteCallbacks=[];discoveryErrorCallbacks=[];tasksDiscoveredCallbacks=[];taskAiStartCallbacks=[];taskAiChunkCallbacks=[];taskAiCompleteCallbacks=[];taskAiErrorCallbacks=[];taskResultStartCallbacks=[];taskResultChunkCallbacks=[];taskResultCompleteCallbacks=[];taskResultErrorCallbacks=[];researchPhaseCallbacks=[];autoPopuniStartCallbacks=[];autoPopuniCompleteCallbacks=[];autoPopuniTaskErrorCallbacks=[];executionActiveStateCallbacks=[];parallelPopuniStartCallbacks=[];parallelPopuniProgressCallbacks=[];parallelPopuniTaskDoneCallbacks=[];parallelPopuniBatchDoneCallbacks=[];async connect(){if(this.socket?.connected)return;this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect(),this.socket=null),this.clearCallbacks();let t=this.authService.getAccessToken();if(!t)return;let e=et.apiUrl.replace(/^http/,"ws");this.socket=Ft(`${e}/ws/chat`,{auth:{token:t},query:{token:t},transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3}),this.socket.on("auth:session-expired",()=>{localStorage.removeItem("mentor_ai_token"),localStorage.removeItem("mentor_ai_user"),localStorage.removeItem("mentor_ai_google_user"),window.location.href="/login"}),this.socket.on("connect",()=>{this.connectionState$.set("connected")}),this.socket.on("disconnect",n=>{this.connectionState$.set("disconnected"),this._isWorkflowRunning&&this.wasWorkflowActive$.set(!0)}),this.socket.io.on("reconnect_attempt",()=>{this.connectionState$.set("reconnecting")}),this.socket.io.on("reconnect",()=>{this.connectionState$.set("connected")}),this.socket.io.on("reconnect_failed",()=>{this.connectionState$.set("disconnected")}),this.socket.on("chat:message-received",n=>{this.messageReceivedCallbacks.forEach(i=>i(n))}),this.socket.on("chat:message-chunk",n=>{this.messageChunkCallbacks.forEach(i=>i(n))}),this.socket.on("chat:complete",n=>{this.completeCallbacks.forEach(i=>i(n))}),this.socket.on("chat:research-phase",n=>{this.researchPhaseCallbacks.forEach(i=>i(n))}),this.socket.on("chat:error",n=>{this.errorCallbacks.forEach(i=>i(n))}),this.socket.on("chat:notes-updated",n=>{this.notesUpdatedCallbacks.forEach(i=>i(n))}),this.socket.on("chat:concept-detected",n=>{this.conceptDetectedCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:plan-ready",n=>{this.planReadyCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:step-progress",n=>{this.stepProgressCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:complete",n=>{this.workflowCompleteCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:error",n=>{this.workflowErrorCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:conversations-created",n=>{this.conversationsCreatedCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:step-awaiting-confirmation",n=>{this.stepConfirmationCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:step-awaiting-input",n=>{this.stepAwaitingInputCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:step-message",n=>{this.stepMessageCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:navigate-to-conversation",n=>{this.navigateToConversationCallbacks.forEach(i=>i(n))}),this.socket.on("chat:tasks-created-for-execution",n=>{this.tasksCreatedForExecutionCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:yolo-progress",n=>{this.yoloProgressCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:yolo-complete",n=>{this.yoloCompleteCallbacks.forEach(i=>i(n))}),this.socket.on("tree:tasks-discovered",n=>{this.tasksDiscoveredCallbacks.forEach(i=>i(n))}),this.socket.on("discovery:message-chunk",n=>{this.discoveryChunkCallbacks.forEach(i=>i(n))}),this.socket.on("discovery:message-complete",n=>{this.discoveryCompleteCallbacks.forEach(i=>i(n))}),this.socket.on("discovery:error",n=>{this.discoveryErrorCallbacks.forEach(i=>i(n))}),this.socket.on("task:ai-start",n=>{this.taskAiStartCallbacks.forEach(i=>i(n))}),this.socket.on("task:ai-chunk",n=>{this.taskAiChunkCallbacks.forEach(i=>i(n))}),this.socket.on("task:ai-complete",n=>{this.taskAiCompleteCallbacks.forEach(i=>i(n))}),this.socket.on("task:ai-error",n=>{this.taskAiErrorCallbacks.forEach(i=>i(n))}),this.socket.on("task:result-start",n=>{this.taskResultStartCallbacks.forEach(i=>i(n))}),this.socket.on("task:result-chunk",n=>{this.taskResultChunkCallbacks.forEach(i=>i(n))}),this.socket.on("task:result-complete",n=>{this.taskResultCompleteCallbacks.forEach(i=>i(n))}),this.socket.on("task:result-error",n=>{this.taskResultErrorCallbacks.forEach(i=>i(n))}),this.socket.on("auto-popuni:start",n=>{this.autoPopuniStartCallbacks.forEach(i=>i(n))}),this.socket.on("auto-popuni:complete",n=>{this.autoPopuniCompleteCallbacks.forEach(i=>i(n))}),this.socket.on("auto-popuni:task-error",n=>{this.autoPopuniTaskErrorCallbacks.forEach(i=>i(n))}),this.socket.on("parallel-popuni:start",n=>{this.parallelPopuniStartCallbacks.forEach(i=>i(n))}),this.socket.on("parallel-popuni:task-progress",n=>{this.parallelPopuniProgressCallbacks.forEach(i=>i(n))}),this.socket.on("parallel-popuni:task-done",n=>{this.parallelPopuniTaskDoneCallbacks.forEach(i=>i(n))}),this.socket.on("parallel-popuni:batch-done",n=>{this.parallelPopuniBatchDoneCallbacks.forEach(i=>i(n))}),this.socket.on("execution:active-state",n=>{this.executionActiveStateCallbacks.forEach(i=>i(n))})}waitForConnection(t=1e4){return new Promise((e,n)=>{if(this.socket?.connected){e();return}let i=setTimeout(()=>{n(new Error("WebSocket connection timeout"))},t),a=()=>{this.socket?.connected?(clearTimeout(i),e()):setTimeout(a,100)};a()})}disconnect(){this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect(),this.socket=null),this.clearCallbacks()}sendMessage(t,e,n){if(!this.checkConnected("slanje poruke"))return!1;let i={conversationId:t,content:e};return n&&n.length>0&&(i.attachmentIds=n),this.socket.emit("chat:message-send",i),!0}emitRunAgents(t,e){this.checkConnected("pokretanje agenata")&&this.socket.emit("workflow:run-agents",{taskIds:t,conversationId:e})}emitParallelPopuni(t,e,n){this.checkConnected("paralelno izvr\u0161avanje")&&this.socket.emit("workflow:parallel-popuni",{taskIds:t,conversationId:e,autoPopuni:n})}emitParallelPopuniCancel(t){this.checkConnected("otkazivanje")&&this.socket.emit("parallel-popuni:cancel",{batchId:t})}emitGetPlan(t,e){this.checkConnected("u\u010Ditavanje plana")&&this.socket.emit("workflow:get-plan",{planId:t,conversationId:e})}emitWorkflowApproval(t,e,n){this.checkConnected("odobravanje plana")&&this.socket.emit("workflow:approve",{planId:t,approved:e,conversationId:n})}emitWorkflowCancel(t,e){this.checkConnected("otkazivanje")&&this.socket.emit("workflow:cancel",{planId:t,conversationId:e})}emitStepContinue(t,e,n){this.checkConnected("nastavak koraka")&&this.socket.emit("workflow:step-continue",{planId:t,conversationId:e,userInput:n})}emitStartYolo(t){this.checkConnected("pokretanje YOLO re\u017Eima")&&this.socket.emit("workflow:start-yolo",{conversationId:t})}emitStartDomainYolo(t,e){this.checkConnected("pokretanje YOLO re\u017Eima")&&this.socket.emit("yolo:start-domain",{conversationId:t,category:e})}emitDiscoveryMessage(t){this.checkConnected("slanje poruke")&&this.socket.emit("discovery:send-message",{content:t})}emitExecuteTaskAi(t,e){this.checkConnected("izvr\u0161avanje zadatka")&&this.socket.emit("task:execute-ai",{taskId:t,conversationId:e})}emitSubmitTaskResult(t){this.checkConnected("slanje rezultata")&&this.socket.emit("task:submit-result",{taskId:t})}getActiveExecutions(){this.checkConnected("provera aktivnih izvr\u0161avanja")&&this.socket.emit("execution:get-active")}replayEvents(t,e){this.checkConnected("replay doga\u0111aja")&&this.socket.emit("execution:replay-events",{executionId:t,since:e})}onMessageReceived(t){return this.messageReceivedCallbacks.push(t),()=>{let e=this.messageReceivedCallbacks.indexOf(t);e>-1&&this.messageReceivedCallbacks.splice(e,1)}}onMessageChunk(t){return this.messageChunkCallbacks.push(t),()=>{let e=this.messageChunkCallbacks.indexOf(t);e>-1&&this.messageChunkCallbacks.splice(e,1)}}onComplete(t){return this.completeCallbacks.push(t),()=>{let e=this.completeCallbacks.indexOf(t);e>-1&&this.completeCallbacks.splice(e,1)}}onResearchPhase(t){return this.researchPhaseCallbacks.push(t),()=>{let e=this.researchPhaseCallbacks.indexOf(t);e>-1&&this.researchPhaseCallbacks.splice(e,1)}}onError(t){return this.errorCallbacks.push(t),()=>{let e=this.errorCallbacks.indexOf(t);e>-1&&this.errorCallbacks.splice(e,1)}}onNotesUpdated(t){return this.notesUpdatedCallbacks.push(t),()=>{let e=this.notesUpdatedCallbacks.indexOf(t);e>-1&&this.notesUpdatedCallbacks.splice(e,1)}}onTasksCreatedForExecution(t){return this.tasksCreatedForExecutionCallbacks.push(t),()=>{let e=this.tasksCreatedForExecutionCallbacks.indexOf(t);e>-1&&this.tasksCreatedForExecutionCallbacks.splice(e,1)}}onConceptDetected(t){return this.conceptDetectedCallbacks.push(t),()=>{let e=this.conceptDetectedCallbacks.indexOf(t);e>-1&&this.conceptDetectedCallbacks.splice(e,1)}}onPlanReady(t){return this.planReadyCallbacks.push(t),()=>{let e=this.planReadyCallbacks.indexOf(t);e>-1&&this.planReadyCallbacks.splice(e,1)}}onStepProgress(t){return this.stepProgressCallbacks.push(t),()=>{let e=this.stepProgressCallbacks.indexOf(t);e>-1&&this.stepProgressCallbacks.splice(e,1)}}onWorkflowComplete(t){return this.workflowCompleteCallbacks.push(t),()=>{let e=this.workflowCompleteCallbacks.indexOf(t);e>-1&&this.workflowCompleteCallbacks.splice(e,1)}}onWorkflowError(t){return this.workflowErrorCallbacks.push(t),()=>{let e=this.workflowErrorCallbacks.indexOf(t);e>-1&&this.workflowErrorCallbacks.splice(e,1)}}onConversationsCreated(t){return this.conversationsCreatedCallbacks.push(t),()=>{let e=this.conversationsCreatedCallbacks.indexOf(t);e>-1&&this.conversationsCreatedCallbacks.splice(e,1)}}onStepAwaitingConfirmation(t){return this.stepConfirmationCallbacks.push(t),()=>{let e=this.stepConfirmationCallbacks.indexOf(t);e>-1&&this.stepConfirmationCallbacks.splice(e,1)}}onStepAwaitingInput(t){return this.stepAwaitingInputCallbacks.push(t),()=>{let e=this.stepAwaitingInputCallbacks.indexOf(t);e>-1&&this.stepAwaitingInputCallbacks.splice(e,1)}}onStepMessage(t){return this.stepMessageCallbacks.push(t),()=>{let e=this.stepMessageCallbacks.indexOf(t);e>-1&&this.stepMessageCallbacks.splice(e,1)}}onNavigateToConversation(t){return this.navigateToConversationCallbacks.push(t),()=>{let e=this.navigateToConversationCallbacks.indexOf(t);e>-1&&this.navigateToConversationCallbacks.splice(e,1)}}onYoloProgress(t){return this.yoloProgressCallbacks.push(t),()=>{let e=this.yoloProgressCallbacks.indexOf(t);e>-1&&this.yoloProgressCallbacks.splice(e,1)}}onYoloComplete(t){return this.yoloCompleteCallbacks.push(t),()=>{let e=this.yoloCompleteCallbacks.indexOf(t);e>-1&&this.yoloCompleteCallbacks.splice(e,1)}}onDiscoveryChunk(t){return this.discoveryChunkCallbacks.push(t),()=>{let e=this.discoveryChunkCallbacks.indexOf(t);e>-1&&this.discoveryChunkCallbacks.splice(e,1)}}onDiscoveryComplete(t){return this.discoveryCompleteCallbacks.push(t),()=>{let e=this.discoveryCompleteCallbacks.indexOf(t);e>-1&&this.discoveryCompleteCallbacks.splice(e,1)}}onDiscoveryError(t){return this.discoveryErrorCallbacks.push(t),()=>{let e=this.discoveryErrorCallbacks.indexOf(t);e>-1&&this.discoveryErrorCallbacks.splice(e,1)}}onTasksDiscovered(t){return this.tasksDiscoveredCallbacks.push(t),()=>{let e=this.tasksDiscoveredCallbacks.indexOf(t);e>-1&&this.tasksDiscoveredCallbacks.splice(e,1)}}onTaskAiStart(t){return this.taskAiStartCallbacks.push(t),()=>{let e=this.taskAiStartCallbacks.indexOf(t);e>-1&&this.taskAiStartCallbacks.splice(e,1)}}onTaskAiChunk(t){return this.taskAiChunkCallbacks.push(t),()=>{let e=this.taskAiChunkCallbacks.indexOf(t);e>-1&&this.taskAiChunkCallbacks.splice(e,1)}}onTaskAiComplete(t){return this.taskAiCompleteCallbacks.push(t),()=>{let e=this.taskAiCompleteCallbacks.indexOf(t);e>-1&&this.taskAiCompleteCallbacks.splice(e,1)}}onTaskAiError(t){return this.taskAiErrorCallbacks.push(t),()=>{let e=this.taskAiErrorCallbacks.indexOf(t);e>-1&&this.taskAiErrorCallbacks.splice(e,1)}}onTaskResultStart(t){return this.taskResultStartCallbacks.push(t),()=>{let e=this.taskResultStartCallbacks.indexOf(t);e>-1&&this.taskResultStartCallbacks.splice(e,1)}}onTaskResultChunk(t){return this.taskResultChunkCallbacks.push(t),()=>{let e=this.taskResultChunkCallbacks.indexOf(t);e>-1&&this.taskResultChunkCallbacks.splice(e,1)}}onTaskResultComplete(t){return this.taskResultCompleteCallbacks.push(t),()=>{let e=this.taskResultCompleteCallbacks.indexOf(t);e>-1&&this.taskResultCompleteCallbacks.splice(e,1)}}onTaskResultError(t){return this.taskResultErrorCallbacks.push(t),()=>{let e=this.taskResultErrorCallbacks.indexOf(t);e>-1&&this.taskResultErrorCallbacks.splice(e,1)}}onAutoPopuniStart(t){return this.autoPopuniStartCallbacks.push(t),()=>{let e=this.autoPopuniStartCallbacks.indexOf(t);e>-1&&this.autoPopuniStartCallbacks.splice(e,1)}}onAutoPopuniComplete(t){return this.autoPopuniCompleteCallbacks.push(t),()=>{let e=this.autoPopuniCompleteCallbacks.indexOf(t);e>-1&&this.autoPopuniCompleteCallbacks.splice(e,1)}}onAutoPopuniTaskError(t){return this.autoPopuniTaskErrorCallbacks.push(t),()=>{let e=this.autoPopuniTaskErrorCallbacks.indexOf(t);e>-1&&this.autoPopuniTaskErrorCallbacks.splice(e,1)}}onExecutionActiveState(t){return this.executionActiveStateCallbacks.push(t),()=>{let e=this.executionActiveStateCallbacks.indexOf(t);e>-1&&this.executionActiveStateCallbacks.splice(e,1)}}onParallelPopuniStart(t){return this.parallelPopuniStartCallbacks.push(t),()=>{let e=this.parallelPopuniStartCallbacks.indexOf(t);e>-1&&this.parallelPopuniStartCallbacks.splice(e,1)}}onParallelPopuniProgress(t){return this.parallelPopuniProgressCallbacks.push(t),()=>{let e=this.parallelPopuniProgressCallbacks.indexOf(t);e>-1&&this.parallelPopuniProgressCallbacks.splice(e,1)}}onParallelPopuniTaskDone(t){return this.parallelPopuniTaskDoneCallbacks.push(t),()=>{let e=this.parallelPopuniTaskDoneCallbacks.indexOf(t);e>-1&&this.parallelPopuniTaskDoneCallbacks.splice(e,1)}}onParallelPopuniBatchDone(t){return this.parallelPopuniBatchDoneCallbacks.push(t),()=>{let e=this.parallelPopuniBatchDoneCallbacks.indexOf(t);e>-1&&this.parallelPopuniBatchDoneCallbacks.splice(e,1)}}clearCallbacks(){this.messageReceivedCallbacks=[],this.messageChunkCallbacks=[],this.completeCallbacks=[],this.errorCallbacks=[],this.notesUpdatedCallbacks=[],this.conceptDetectedCallbacks=[],this.planReadyCallbacks=[],this.stepProgressCallbacks=[],this.workflowCompleteCallbacks=[],this.workflowErrorCallbacks=[],this.conversationsCreatedCallbacks=[],this.stepConfirmationCallbacks=[],this.stepAwaitingInputCallbacks=[],this.stepMessageCallbacks=[],this.navigateToConversationCallbacks=[],this.tasksCreatedForExecutionCallbacks=[],this.yoloProgressCallbacks=[],this.yoloCompleteCallbacks=[],this.discoveryChunkCallbacks=[],this.discoveryCompleteCallbacks=[],this.discoveryErrorCallbacks=[],this.tasksDiscoveredCallbacks=[],this.taskAiStartCallbacks=[],this.taskAiChunkCallbacks=[],this.taskAiCompleteCallbacks=[],this.taskAiErrorCallbacks=[],this.taskResultStartCallbacks=[],this.taskResultChunkCallbacks=[],this.taskResultCompleteCallbacks=[],this.taskResultErrorCallbacks=[],this.researchPhaseCallbacks=[],this.autoPopuniStartCallbacks=[],this.autoPopuniCompleteCallbacks=[],this.autoPopuniTaskErrorCallbacks=[],this.executionActiveStateCallbacks=[],this.parallelPopuniStartCallbacks=[],this.parallelPopuniProgressCallbacks=[],this.parallelPopuniTaskDoneCallbacks=[],this.parallelPopuniBatchDoneCallbacks=[]}static \u0275fac=function(e){return new(e||o)};static \u0275prov=ze({token:o,factory:o.\u0275fac,providedIn:"root"})};var St=class o{http=J(Ee);baseUrl=`${et.apiUrl}/api/v1/notes`;lastError$=v(null);async getByConversation(t){return(await Z(this.http.get(`${this.baseUrl}/conversation/${t}`))).data}async getByConcept(t){return(await Z(this.http.get(`${this.baseUrl}/concept/${t}`))).data}async getByConceptIds(t){let e=0,n=await Promise.all(t.map(i=>this.getByConcept(i).catch(()=>(e++,[]))));return e>0&&this.lastError$.set(`Gre\u0161ka pri u\u010Ditavanju bele\u0161ki (${e} od ${t.length})`),n.flat()}async getByConversationIds(t){let e=0,n=await Promise.all(t.map(i=>this.getByConversation(i).catch(()=>(e++,[]))));return e>0&&this.lastError$.set(`Gre\u0161ka pri u\u010Ditavanju bele\u0161ki (${e} od ${t.length})`),n.flat()}async createNote(t){return(await Z(this.http.post(this.baseUrl,t))).data}async updateStatus(t,e){return(await Z(this.http.patch(`${this.baseUrl}/${t}/status`,{status:e}))).data}async updateNote(t,e,n){return(await Z(this.http.patch(`${this.baseUrl}/${t}`,{title:e,content:n}))).data}async submitReport(t,e){return(await Z(this.http.post(`${this.baseUrl}/${t}/report`,{report:e}))).data}async generateReport(t){return(await Z(this.http.post(`${this.baseUrl}/${t}/generate-report`,{}))).data.report}async scoreReport(t){return(await Z(this.http.post(`${this.baseUrl}/${t}/score`,{}))).data}async deleteNote(t){await Z(this.http.delete(`${this.baseUrl}/${t}`))}async getComments(t,e=1,n=50){return(await Z(this.http.get(`${this.baseUrl}/${t}/comments?page=${e}&limit=${n}`))).data}async createComment(t,e){return(await Z(this.http.post(`${this.baseUrl}/${t}/comments`,{content:e}))).data}async updateComment(t,e){return(await Z(this.http.patch(`${this.baseUrl}/${t}/comment`,{content:e}))).data}async deleteComment(t){await Z(this.http.delete(`${this.baseUrl}/${t}/comment`))}static \u0275fac=function(e){return new(e||o)};static \u0275prov=ze({token:o,factory:o.\u0275fac,providedIn:"root"})};function Fo(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var lt=Fo();function $a(o){lt=o}var rt={exec:()=>null};function Q(o,t=""){let e=typeof o=="string"?o:o.source,n={replace:(i,a)=>{let l=typeof a=="string"?a:a.source;return l=l.replace(be.caret,"$1"),e=e.replace(i,l),n},getRegex:()=>new RegExp(e,t)};return n}var qr=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),be={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:o=>new RegExp(`^( {0,3}${o})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}#`),htmlBeginRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}>`)},Yr=/^(?:[ \t]*(?:\n|$))+/,Kr=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Qr=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Wt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Zr=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Vo=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,Oa=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Na=Q(Oa).replace(/bull/g,Vo).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Xr=Q(Oa).replace(/bull/g,Vo).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Bo=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Jr=/^[^\n]+/,jo=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,es=Q(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",jo).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),ts=Q(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Vo).getRegex(),zn="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Wo=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,ns=Q("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Wo).replace("tag",zn).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Aa=Q(Bo).replace("hr",Wt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",zn).getRegex(),os=Q(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Aa).getRegex(),Ho={blockquote:os,code:Kr,def:es,fences:Qr,heading:Zr,hr:Wt,html:ns,lheading:Na,list:ts,newline:Yr,paragraph:Aa,table:rt,text:Jr},Sa=Q("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Wt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",zn).getRegex(),is=te(F({},Ho),{lheading:Xr,table:Sa,paragraph:Q(Bo).replace("hr",Wt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Sa).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",zn).getRegex()}),as=te(F({},Ho),{html:Q(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Wo).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:rt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Q(Bo).replace("hr",Wt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Na).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()}),rs=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,ss=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Da=/^( {2,}|\\)\n(?!\s*$)/,ls=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ln=/[\p{P}\p{S}]/u,Uo=/[\s\p{P}\p{S}]/u,Ra=/[^\s\p{P}\p{S}]/u,cs=Q(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Uo).getRegex(),za=/(?!~)[\p{P}\p{S}]/u,ds=/(?!~)[\s\p{P}\p{S}]/u,ps=/(?:[^\s\p{P}\p{S}]|~)/u,La=/(?![*_])[\p{P}\p{S}]/u,us=/(?![*_])[\s\p{P}\p{S}]/u,ms=/(?:[^\s\p{P}\p{S}]|[*_])/u,hs=Q(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",qr?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Fa=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,gs=Q(Fa,"u").replace(/punct/g,Ln).getRegex(),fs=Q(Fa,"u").replace(/punct/g,za).getRegex(),Va="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",_s=Q(Va,"gu").replace(/notPunctSpace/g,Ra).replace(/punctSpace/g,Uo).replace(/punct/g,Ln).getRegex(),Cs=Q(Va,"gu").replace(/notPunctSpace/g,ps).replace(/punctSpace/g,ds).replace(/punct/g,za).getRegex(),xs=Q("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Ra).replace(/punctSpace/g,Uo).replace(/punct/g,Ln).getRegex(),bs=Q(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,La).getRegex(),vs="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",ks=Q(vs,"gu").replace(/notPunctSpace/g,ms).replace(/punctSpace/g,us).replace(/punct/g,La).getRegex(),ys=Q(/\\(punct)/,"gu").replace(/punct/g,Ln).getRegex(),ws=Q(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ss=Q(Wo).replace("(?:-->|$)","-->").getRegex(),Es=Q("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ss).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),An=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Ts=Q(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",An).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ba=Q(/^!?\[(label)\]\[(ref)\]/).replace("label",An).replace("ref",jo).getRegex(),ja=Q(/^!?\[(ref)\](?:\[\])?/).replace("ref",jo).getRegex(),Ps=Q("reflink|nolink(?!\\()","g").replace("reflink",Ba).replace("nolink",ja).getRegex(),Ea=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Go={_backpedal:rt,anyPunctuation:ys,autolink:ws,blockSkip:hs,br:Da,code:ss,del:rt,delLDelim:rt,delRDelim:rt,emStrongLDelim:gs,emStrongRDelimAst:_s,emStrongRDelimUnd:xs,escape:rs,link:Ts,nolink:ja,punctuation:cs,reflink:Ba,reflinkSearch:Ps,tag:Es,text:ls,url:rt},Ms=te(F({},Go),{link:Q(/^!?\[(label)\]\((.*?)\)/).replace("label",An).getRegex(),reflink:Q(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",An).getRegex()}),Ro=te(F({},Go),{emStrongRDelimAst:Cs,emStrongLDelim:fs,delLDelim:bs,delRDelim:ks,url:Q(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Ea).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:Q(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Ea).getRegex()}),Is=te(F({},Ro),{br:Q(Da).replace("{2,}","*").getRegex(),text:Q(Ro.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()}),Nn={normal:Ho,gfm:is,pedantic:as},Vt={normal:Go,gfm:Ro,breaks:Is,pedantic:Ms},$s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ta=o=>$s[o];function Ve(o,t){if(t){if(be.escapeTest.test(o))return o.replace(be.escapeReplace,Ta)}else if(be.escapeTestNoEncode.test(o))return o.replace(be.escapeReplaceNoEncode,Ta);return o}function Pa(o){try{o=encodeURI(o).replace(be.percentDecode,"%")}catch{return null}return o}function Ma(o,t){let e=o.replace(be.findPipe,(a,l,h)=>{let d=!1,k=l;for(;--k>=0&&h[k]==="\\";)d=!d;return d?"|":" |"}),n=e.split(be.splitPipe),i=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(be.slashPipe,"|");return n}function Bt(o,t,e){let n=o.length;if(n===0)return"";let i=0;for(;i<n;){let a=o.charAt(n-i-1);if(a===t&&!e)i++;else if(a!==t&&e)i++;else break}return o.slice(0,n-i)}function Os(o,t){if(o.indexOf(t[1])===-1)return-1;let e=0;for(let n=0;n<o.length;n++)if(o[n]==="\\")n++;else if(o[n]===t[0])e++;else if(o[n]===t[1]&&(e--,e<0))return n;return e>0?-2:-1}function Ns(o,t=0){let e=t,n="";for(let i of o)if(i==="	"){let a=4-e%4;n+=" ".repeat(a),e+=a}else n+=i,e++;return n}function Ia(o,t,e,n,i){let a=t.href,l=t.title||null,h=o[1].replace(i.other.outputLinkReplace,"$1");n.state.inLink=!0;let d={type:o[0].charAt(0)==="!"?"image":"link",raw:e,href:a,title:l,text:h,tokens:n.inlineTokens(h)};return n.state.inLink=!1,d}function As(o,t,e){let n=o.match(e.other.indentCodeCompensation);if(n===null)return t;let i=n[1];return t.split(`
`).map(a=>{let l=a.match(e.other.beginningSpace);if(l===null)return a;let[h]=l;return h.length>=i.length?a.slice(i.length):a}).join(`
`)}var Dn=class{options;rules;lexer;constructor(o){this.options=o||lt}space(o){let t=this.rules.block.newline.exec(o);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(o){let t=this.rules.block.code.exec(o);if(t){let e=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:Bt(e,`
`)}}}fences(o){let t=this.rules.block.fences.exec(o);if(t){let e=t[0],n=As(e,t[3]||"",this.rules);return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(o){let t=this.rules.block.heading.exec(o);if(t){let e=t[2].trim();if(this.rules.other.endingHash.test(e)){let n=Bt(e,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(e=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(o){let t=this.rules.block.hr.exec(o);if(t)return{type:"hr",raw:Bt(t[0],`
`)}}blockquote(o){let t=this.rules.block.blockquote.exec(o);if(t){let e=Bt(t[0],`
`).split(`
`),n="",i="",a=[];for(;e.length>0;){let l=!1,h=[],d;for(d=0;d<e.length;d++)if(this.rules.other.blockquoteStart.test(e[d]))h.push(e[d]),l=!0;else if(!l)h.push(e[d]);else break;e=e.slice(d);let k=h.join(`
`),y=k.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${k}`:k,i=i?`${i}
${y}`:y;let z=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(y,a,!0),this.lexer.state.top=z,e.length===0)break;let D=a.at(-1);if(D?.type==="code")break;if(D?.type==="blockquote"){let ne=D,ee=ne.raw+`
`+e.join(`
`),Ie=this.blockquote(ee);a[a.length-1]=Ie,n=n.substring(0,n.length-ne.raw.length)+Ie.raw,i=i.substring(0,i.length-ne.text.length)+Ie.text;break}else if(D?.type==="list"){let ne=D,ee=ne.raw+`
`+e.join(`
`),Ie=this.list(ee);a[a.length-1]=Ie,n=n.substring(0,n.length-D.raw.length)+Ie.raw,i=i.substring(0,i.length-ne.raw.length)+Ie.raw,e=ee.substring(a.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:a,text:i}}}list(o){let t=this.rules.block.list.exec(o);if(t){let e=t[1].trim(),n=e.length>1,i={type:"list",raw:"",ordered:n,start:n?+e.slice(0,-1):"",loose:!1,items:[]};e=n?`\\d{1,9}\\${e.slice(-1)}`:`\\${e}`,this.options.pedantic&&(e=n?e:"[*+-]");let a=this.rules.other.listItemRegex(e),l=!1;for(;o;){let d=!1,k="",y="";if(!(t=a.exec(o))||this.rules.block.hr.test(o))break;k=t[0],o=o.substring(k.length);let z=Ns(t[2].split(`
`,1)[0],t[1].length),D=o.split(`
`,1)[0],ne=!z.trim(),ee=0;if(this.options.pedantic?(ee=2,y=z.trimStart()):ne?ee=t[1].length+1:(ee=z.search(this.rules.other.nonSpaceChar),ee=ee>4?1:ee,y=z.slice(ee),ee+=t[1].length),ne&&this.rules.other.blankLine.test(D)&&(k+=D+`
`,o=o.substring(D.length+1),d=!0),!d){let Ie=this.rules.other.nextBulletRegex(ee),Jt=this.rules.other.hrRegex(ee),en=this.rules.other.fencesBeginRegex(ee),tn=this.rules.other.headingBeginRegex(ee),ct=this.rules.other.htmlBeginRegex(ee),he=this.rules.other.blockquoteBeginRegex(ee);for(;o;){let je=o.split(`
`,1)[0],We;if(D=je,this.options.pedantic?(D=D.replace(this.rules.other.listReplaceNesting,"  "),We=D):We=D.replace(this.rules.other.tabCharGlobal,"    "),en.test(D)||tn.test(D)||ct.test(D)||he.test(D)||Ie.test(D)||Jt.test(D))break;if(We.search(this.rules.other.nonSpaceChar)>=ee||!D.trim())y+=`
`+We.slice(ee);else{if(ne||z.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||en.test(z)||tn.test(z)||Jt.test(z))break;y+=`
`+D}ne=!D.trim(),k+=je+`
`,o=o.substring(je.length+1),z=We.slice(ee)}}i.loose||(l?i.loose=!0:this.rules.other.doubleBlankLine.test(k)&&(l=!0)),i.items.push({type:"list_item",raw:k,task:!!this.options.gfm&&this.rules.other.listIsTask.test(y),loose:!1,text:y,tokens:[]}),i.raw+=k}let h=i.items.at(-1);if(h)h.raw=h.raw.trimEnd(),h.text=h.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let d of i.items){if(this.lexer.state.top=!1,d.tokens=this.lexer.blockTokens(d.text,[]),d.task){if(d.text=d.text.replace(this.rules.other.listReplaceTask,""),d.tokens[0]?.type==="text"||d.tokens[0]?.type==="paragraph"){d.tokens[0].raw=d.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),d.tokens[0].text=d.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let y=this.lexer.inlineQueue.length-1;y>=0;y--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[y].src)){this.lexer.inlineQueue[y].src=this.lexer.inlineQueue[y].src.replace(this.rules.other.listReplaceTask,"");break}}let k=this.rules.other.listTaskCheckbox.exec(d.raw);if(k){let y={type:"checkbox",raw:k[0]+" ",checked:k[0]!=="[ ]"};d.checked=y.checked,i.loose?d.tokens[0]&&["paragraph","text"].includes(d.tokens[0].type)&&"tokens"in d.tokens[0]&&d.tokens[0].tokens?(d.tokens[0].raw=y.raw+d.tokens[0].raw,d.tokens[0].text=y.raw+d.tokens[0].text,d.tokens[0].tokens.unshift(y)):d.tokens.unshift({type:"paragraph",raw:y.raw,text:y.raw,tokens:[y]}):d.tokens.unshift(y)}}if(!i.loose){let k=d.tokens.filter(z=>z.type==="space"),y=k.length>0&&k.some(z=>this.rules.other.anyLine.test(z.raw));i.loose=y}}if(i.loose)for(let d of i.items){d.loose=!0;for(let k of d.tokens)k.type==="text"&&(k.type="paragraph")}return i}}html(o){let t=this.rules.block.html.exec(o);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(o){let t=this.rules.block.def.exec(o);if(t){let e=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:n,title:i}}}table(o){let t=this.rules.block.table.exec(o);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let e=Ma(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(e.length===n.length){for(let l of n)this.rules.other.tableAlignRight.test(l)?a.align.push("right"):this.rules.other.tableAlignCenter.test(l)?a.align.push("center"):this.rules.other.tableAlignLeft.test(l)?a.align.push("left"):a.align.push(null);for(let l=0;l<e.length;l++)a.header.push({text:e[l],tokens:this.lexer.inline(e[l]),header:!0,align:a.align[l]});for(let l of i)a.rows.push(Ma(l,a.header.length).map((h,d)=>({text:h,tokens:this.lexer.inline(h),header:!1,align:a.align[d]})));return a}}lheading(o){let t=this.rules.block.lheading.exec(o);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(o){let t=this.rules.block.paragraph.exec(o);if(t){let e=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(o){let t=this.rules.block.text.exec(o);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(o){let t=this.rules.inline.escape.exec(o);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(o){let t=this.rules.inline.tag.exec(o);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(o){let t=this.rules.inline.link.exec(o);if(t){let e=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(e)){if(!this.rules.other.endAngleBracket.test(e))return;let a=Bt(e.slice(0,-1),"\\");if((e.length-a.length)%2===0)return}else{let a=Os(t[2],"()");if(a===-2)return;if(a>-1){let l=(t[0].indexOf("!")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let n=t[2],i="";if(this.options.pedantic){let a=this.rules.other.pedanticHrefTitle.exec(n);a&&(n=a[1],i=a[3])}else i=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(e)?n=n.slice(1):n=n.slice(1,-1)),Ia(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(o,t){let e;if((e=this.rules.inline.reflink.exec(o))||(e=this.rules.inline.nolink.exec(o))){let n=(e[2]||e[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=t[n.toLowerCase()];if(!i){let a=e[0].charAt(0);return{type:"text",raw:a,text:a}}return Ia(e,i,e[0],this.lexer,this.rules)}}emStrong(o,t,e=""){let n=this.rules.inline.emStrongLDelim.exec(o);if(!(!n||n[3]&&e.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!e||this.rules.inline.punctuation.exec(e))){let i=[...n[0]].length-1,a,l,h=i,d=0,k=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(k.lastIndex=0,t=t.slice(-1*o.length+i);(n=k.exec(t))!=null;){if(a=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!a)continue;if(l=[...a].length,n[3]||n[4]){h+=l;continue}else if((n[5]||n[6])&&i%3&&!((i+l)%3)){d+=l;continue}if(h-=l,h>0)continue;l=Math.min(l,l+h+d);let y=[...n[0]][0].length,z=o.slice(0,i+n.index+y+l);if(Math.min(i,l)%2){let ne=z.slice(1,-1);return{type:"em",raw:z,text:ne,tokens:this.lexer.inlineTokens(ne)}}let D=z.slice(2,-2);return{type:"strong",raw:z,text:D,tokens:this.lexer.inlineTokens(D)}}}}codespan(o){let t=this.rules.inline.code.exec(o);if(t){let e=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(e),i=this.rules.other.startingSpaceChar.test(e)&&this.rules.other.endingSpaceChar.test(e);return n&&i&&(e=e.substring(1,e.length-1)),{type:"codespan",raw:t[0],text:e}}}br(o){let t=this.rules.inline.br.exec(o);if(t)return{type:"br",raw:t[0]}}del(o,t,e=""){let n=this.rules.inline.delLDelim.exec(o);if(n&&(!n[1]||!e||this.rules.inline.punctuation.exec(e))){let i=[...n[0]].length-1,a,l,h=i,d=this.rules.inline.delRDelim;for(d.lastIndex=0,t=t.slice(-1*o.length+i);(n=d.exec(t))!=null;){if(a=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!a||(l=[...a].length,l!==i))continue;if(n[3]||n[4]){h+=l;continue}if(h-=l,h>0)continue;l=Math.min(l,l+h);let k=[...n[0]][0].length,y=o.slice(0,i+n.index+k+l),z=y.slice(i,-i);return{type:"del",raw:y,text:z,tokens:this.lexer.inlineTokens(z)}}}}autolink(o){let t=this.rules.inline.autolink.exec(o);if(t){let e,n;return t[2]==="@"?(e=t[1],n="mailto:"+e):(e=t[1],n=e),{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}url(o){let t;if(t=this.rules.inline.url.exec(o)){let e,n;if(t[2]==="@")e=t[0],n="mailto:"+e;else{let i;do i=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(i!==t[0]);e=t[0],t[1]==="www."?n="http://"+t[0]:n=t[0]}return{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(o){let t=this.rules.inline.text.exec(o);if(t){let e=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:e}}}},Oe=class zo{tokens;options;state;inlineQueue;tokenizer;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||lt,this.options.tokenizer=this.options.tokenizer||new Dn,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let e={other:be,block:Nn.normal,inline:Vt.normal};this.options.pedantic?(e.block=Nn.pedantic,e.inline=Vt.pedantic):this.options.gfm&&(e.block=Nn.gfm,this.options.breaks?e.inline=Vt.breaks:e.inline=Vt.gfm),this.tokenizer.rules=e}static get rules(){return{block:Nn,inline:Vt}}static lex(t,e){return new zo(e).lex(t)}static lexInline(t,e){return new zo(e).inlineTokens(t)}lex(t){t=t.replace(be.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){let n=this.inlineQueue[e];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,e=[],n=!1){for(this.options.pedantic&&(t=t.replace(be.tabCharGlobal,"    ").replace(be.spaceLine,""));t;){let i;if(this.options.extensions?.block?.some(l=>(i=l.call({lexer:this},t,e))?(t=t.substring(i.raw.length),e.push(i),!0):!1))continue;if(i=this.tokenizer.space(t)){t=t.substring(i.raw.length);let l=e.at(-1);i.raw.length===1&&l!==void 0?l.raw+=`
`:e.push(i);continue}if(i=this.tokenizer.code(t)){t=t.substring(i.raw.length);let l=e.at(-1);l?.type==="paragraph"||l?.type==="text"?(l.raw+=(l.raw.endsWith(`
`)?"":`
`)+i.raw,l.text+=`
`+i.text,this.inlineQueue.at(-1).src=l.text):e.push(i);continue}if(i=this.tokenizer.fences(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.heading(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.hr(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.blockquote(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.list(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.html(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.def(t)){t=t.substring(i.raw.length);let l=e.at(-1);l?.type==="paragraph"||l?.type==="text"?(l.raw+=(l.raw.endsWith(`
`)?"":`
`)+i.raw,l.text+=`
`+i.raw,this.inlineQueue.at(-1).src=l.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},e.push(i));continue}if(i=this.tokenizer.table(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.lheading(t)){t=t.substring(i.raw.length),e.push(i);continue}let a=t;if(this.options.extensions?.startBlock){let l=1/0,h=t.slice(1),d;this.options.extensions.startBlock.forEach(k=>{d=k.call({lexer:this},h),typeof d=="number"&&d>=0&&(l=Math.min(l,d))}),l<1/0&&l>=0&&(a=t.substring(0,l+1))}if(this.state.top&&(i=this.tokenizer.paragraph(a))){let l=e.at(-1);n&&l?.type==="paragraph"?(l.raw+=(l.raw.endsWith(`
`)?"":`
`)+i.raw,l.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=l.text):e.push(i),n=a.length!==t.length,t=t.substring(i.raw.length);continue}if(i=this.tokenizer.text(t)){t=t.substring(i.raw.length);let l=e.at(-1);l?.type==="text"?(l.raw+=(l.raw.endsWith(`
`)?"":`
`)+i.raw,l.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=l.text):e.push(i);continue}if(t){let l="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return this.state.top=!0,e}inline(t,e=[]){return this.inlineQueue.push({src:t,tokens:e}),e}inlineTokens(t,e=[]){let n=t,i=null;if(this.tokens.links){let d=Object.keys(this.tokens.links);if(d.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)d.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,i.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let a;for(;(i=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)a=i[2]?i[2].length:0,n=n.slice(0,i.index+a)+"["+"a".repeat(i[0].length-a-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);n=this.options.hooks?.emStrongMask?.call({lexer:this},n)??n;let l=!1,h="";for(;t;){l||(h=""),l=!1;let d;if(this.options.extensions?.inline?.some(y=>(d=y.call({lexer:this},t,e))?(t=t.substring(d.raw.length),e.push(d),!0):!1))continue;if(d=this.tokenizer.escape(t)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.tag(t)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.link(t)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(d.raw.length);let y=e.at(-1);d.type==="text"&&y?.type==="text"?(y.raw+=d.raw,y.text+=d.text):e.push(d);continue}if(d=this.tokenizer.emStrong(t,n,h)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.codespan(t)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.br(t)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.del(t,n,h)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.autolink(t)){t=t.substring(d.raw.length),e.push(d);continue}if(!this.state.inLink&&(d=this.tokenizer.url(t))){t=t.substring(d.raw.length),e.push(d);continue}let k=t;if(this.options.extensions?.startInline){let y=1/0,z=t.slice(1),D;this.options.extensions.startInline.forEach(ne=>{D=ne.call({lexer:this},z),typeof D=="number"&&D>=0&&(y=Math.min(y,D))}),y<1/0&&y>=0&&(k=t.substring(0,y+1))}if(d=this.tokenizer.inlineText(k)){t=t.substring(d.raw.length),d.raw.slice(-1)!=="_"&&(h=d.raw.slice(-1)),l=!0;let y=e.at(-1);y?.type==="text"?(y.raw+=d.raw,y.text+=d.text):e.push(d);continue}if(t){let y="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(y);break}else throw new Error(y)}}return e}},Rn=class{options;parser;constructor(o){this.options=o||lt}space(o){return""}code({text:o,lang:t,escaped:e}){let n=(t||"").match(be.notSpaceStart)?.[0],i=o.replace(be.endingNewline,"")+`
`;return n?'<pre><code class="language-'+Ve(n)+'">'+(e?i:Ve(i,!0))+`</code></pre>
`:"<pre><code>"+(e?i:Ve(i,!0))+`</code></pre>
`}blockquote({tokens:o}){return`<blockquote>
${this.parser.parse(o)}</blockquote>
`}html({text:o}){return o}def(o){return""}heading({tokens:o,depth:t}){return`<h${t}>${this.parser.parseInline(o)}</h${t}>
`}hr(o){return`<hr>
`}list(o){let t=o.ordered,e=o.start,n="";for(let l=0;l<o.items.length;l++){let h=o.items[l];n+=this.listitem(h)}let i=t?"ol":"ul",a=t&&e!==1?' start="'+e+'"':"";return"<"+i+a+`>
`+n+"</"+i+`>
`}listitem(o){return`<li>${this.parser.parse(o.tokens)}</li>
`}checkbox({checked:o}){return"<input "+(o?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:o}){return`<p>${this.parser.parseInline(o)}</p>
`}table(o){let t="",e="";for(let i=0;i<o.header.length;i++)e+=this.tablecell(o.header[i]);t+=this.tablerow({text:e});let n="";for(let i=0;i<o.rows.length;i++){let a=o.rows[i];e="";for(let l=0;l<a.length;l++)e+=this.tablecell(a[l]);n+=this.tablerow({text:e})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:o}){return`<tr>
${o}</tr>
`}tablecell(o){let t=this.parser.parseInline(o.tokens),e=o.header?"th":"td";return(o.align?`<${e} align="${o.align}">`:`<${e}>`)+t+`</${e}>
`}strong({tokens:o}){return`<strong>${this.parser.parseInline(o)}</strong>`}em({tokens:o}){return`<em>${this.parser.parseInline(o)}</em>`}codespan({text:o}){return`<code>${Ve(o,!0)}</code>`}br(o){return"<br>"}del({tokens:o}){return`<del>${this.parser.parseInline(o)}</del>`}link({href:o,title:t,tokens:e}){let n=this.parser.parseInline(e),i=Pa(o);if(i===null)return n;o=i;let a='<a href="'+o+'"';return t&&(a+=' title="'+Ve(t)+'"'),a+=">"+n+"</a>",a}image({href:o,title:t,text:e,tokens:n}){n&&(e=this.parser.parseInline(n,this.parser.textRenderer));let i=Pa(o);if(i===null)return Ve(e);o=i;let a=`<img src="${o}" alt="${Ve(e)}"`;return t&&(a+=` title="${Ve(t)}"`),a+=">",a}text(o){return"tokens"in o&&o.tokens?this.parser.parseInline(o.tokens):"escaped"in o&&o.escaped?o.text:Ve(o.text)}},qo=class{strong({text:o}){return o}em({text:o}){return o}codespan({text:o}){return o}del({text:o}){return o}html({text:o}){return o}text({text:o}){return o}link({text:o}){return""+o}image({text:o}){return""+o}br(){return""}checkbox({raw:o}){return o}},Ne=class Lo{options;renderer;textRenderer;constructor(t){this.options=t||lt,this.options.renderer=this.options.renderer||new Rn,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new qo}static parse(t,e){return new Lo(e).parse(t)}static parseInline(t,e){return new Lo(e).parseInline(t)}parse(t){let e="";for(let n=0;n<t.length;n++){let i=t[n];if(this.options.extensions?.renderers?.[i.type]){let l=i,h=this.options.extensions.renderers[l.type].call({parser:this},l);if(h!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(l.type)){e+=h||"";continue}}let a=i;switch(a.type){case"space":{e+=this.renderer.space(a);break}case"hr":{e+=this.renderer.hr(a);break}case"heading":{e+=this.renderer.heading(a);break}case"code":{e+=this.renderer.code(a);break}case"table":{e+=this.renderer.table(a);break}case"blockquote":{e+=this.renderer.blockquote(a);break}case"list":{e+=this.renderer.list(a);break}case"checkbox":{e+=this.renderer.checkbox(a);break}case"html":{e+=this.renderer.html(a);break}case"def":{e+=this.renderer.def(a);break}case"paragraph":{e+=this.renderer.paragraph(a);break}case"text":{e+=this.renderer.text(a);break}default:{let l='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return e}parseInline(t,e=this.renderer){let n="";for(let i=0;i<t.length;i++){let a=t[i];if(this.options.extensions?.renderers?.[a.type]){let h=this.options.extensions.renderers[a.type].call({parser:this},a);if(h!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(a.type)){n+=h||"";continue}}let l=a;switch(l.type){case"escape":{n+=e.text(l);break}case"html":{n+=e.html(l);break}case"link":{n+=e.link(l);break}case"image":{n+=e.image(l);break}case"checkbox":{n+=e.checkbox(l);break}case"strong":{n+=e.strong(l);break}case"em":{n+=e.em(l);break}case"codespan":{n+=e.codespan(l);break}case"br":{n+=e.br(l);break}case"del":{n+=e.del(l);break}case"text":{n+=e.text(l);break}default:{let h='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(h),"";throw new Error(h)}}}return n}},jt=class{options;block;constructor(o){this.options=o||lt}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(o){return o}postprocess(o){return o}processAllTokens(o){return o}emStrongMask(o){return o}provideLexer(){return this.block?Oe.lex:Oe.lexInline}provideParser(){return this.block?Ne.parse:Ne.parseInline}},Ds=class{defaults=Fo();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Ne;Renderer=Rn;TextRenderer=qo;Lexer=Oe;Tokenizer=Dn;Hooks=jt;constructor(...o){this.use(...o)}walkTokens(o,t){let e=[];for(let n of o)switch(e=e.concat(t.call(this,n)),n.type){case"table":{let i=n;for(let a of i.header)e=e.concat(this.walkTokens(a.tokens,t));for(let a of i.rows)for(let l of a)e=e.concat(this.walkTokens(l.tokens,t));break}case"list":{let i=n;e=e.concat(this.walkTokens(i.items,t));break}default:{let i=n;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(a=>{let l=i[a].flat(1/0);e=e.concat(this.walkTokens(l,t))}):i.tokens&&(e=e.concat(this.walkTokens(i.tokens,t)))}}return e}use(...o){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return o.forEach(e=>{let n=F({},e);if(n.async=this.defaults.async||n.async||!1,e.extensions&&(e.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let a=t.renderers[i.name];a?t.renderers[i.name]=function(...l){let h=i.renderer.apply(this,l);return h===!1&&(h=a.apply(this,l)),h}:t.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let a=t[i.level];a?a.unshift(i.tokenizer):t[i.level]=[i.tokenizer],i.start&&(i.level==="block"?t.startBlock?t.startBlock.push(i.start):t.startBlock=[i.start]:i.level==="inline"&&(t.startInline?t.startInline.push(i.start):t.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(t.childTokens[i.name]=i.childTokens)}),n.extensions=t),e.renderer){let i=this.defaults.renderer||new Rn(this.defaults);for(let a in e.renderer){if(!(a in i))throw new Error(`renderer '${a}' does not exist`);if(["options","parser"].includes(a))continue;let l=a,h=e.renderer[l],d=i[l];i[l]=(...k)=>{let y=h.apply(i,k);return y===!1&&(y=d.apply(i,k)),y||""}}n.renderer=i}if(e.tokenizer){let i=this.defaults.tokenizer||new Dn(this.defaults);for(let a in e.tokenizer){if(!(a in i))throw new Error(`tokenizer '${a}' does not exist`);if(["options","rules","lexer"].includes(a))continue;let l=a,h=e.tokenizer[l],d=i[l];i[l]=(...k)=>{let y=h.apply(i,k);return y===!1&&(y=d.apply(i,k)),y}}n.tokenizer=i}if(e.hooks){let i=this.defaults.hooks||new jt;for(let a in e.hooks){if(!(a in i))throw new Error(`hook '${a}' does not exist`);if(["options","block"].includes(a))continue;let l=a,h=e.hooks[l],d=i[l];jt.passThroughHooks.has(a)?i[l]=k=>{if(this.defaults.async&&jt.passThroughHooksRespectAsync.has(a))return(async()=>{let z=await h.call(i,k);return d.call(i,z)})();let y=h.call(i,k);return d.call(i,y)}:i[l]=(...k)=>{if(this.defaults.async)return(async()=>{let z=await h.apply(i,k);return z===!1&&(z=await d.apply(i,k)),z})();let y=h.apply(i,k);return y===!1&&(y=d.apply(i,k)),y}}n.hooks=i}if(e.walkTokens){let i=this.defaults.walkTokens,a=e.walkTokens;n.walkTokens=function(l){let h=[];return h.push(a.call(this,l)),i&&(h=h.concat(i.call(this,l))),h}}this.defaults=F(F({},this.defaults),n)}),this}setOptions(o){return this.defaults=F(F({},this.defaults),o),this}lexer(o,t){return Oe.lex(o,t??this.defaults)}parser(o,t){return Ne.parse(o,t??this.defaults)}parseMarkdown(o){return(t,e)=>{let n=F({},e),i=F(F({},this.defaults),n),a=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&n.async===!1)return a(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(i.hooks&&(i.hooks.options=i,i.hooks.block=o),i.async)return(async()=>{let l=i.hooks?await i.hooks.preprocess(t):t,h=await(i.hooks?await i.hooks.provideLexer():o?Oe.lex:Oe.lexInline)(l,i),d=i.hooks?await i.hooks.processAllTokens(h):h;i.walkTokens&&await Promise.all(this.walkTokens(d,i.walkTokens));let k=await(i.hooks?await i.hooks.provideParser():o?Ne.parse:Ne.parseInline)(d,i);return i.hooks?await i.hooks.postprocess(k):k})().catch(a);try{i.hooks&&(t=i.hooks.preprocess(t));let l=(i.hooks?i.hooks.provideLexer():o?Oe.lex:Oe.lexInline)(t,i);i.hooks&&(l=i.hooks.processAllTokens(l)),i.walkTokens&&this.walkTokens(l,i.walkTokens);let h=(i.hooks?i.hooks.provideParser():o?Ne.parse:Ne.parseInline)(l,i);return i.hooks&&(h=i.hooks.postprocess(h)),h}catch(l){return a(l)}}}onError(o,t){return e=>{if(e.message+=`
Please report this to https://github.com/markedjs/marked.`,o){let n="<p>An error occurred:</p><pre>"+Ve(e.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(e);throw e}}},st=new Ds;function H(o,t){return st.parse(o,t)}H.options=H.setOptions=function(o){return st.setOptions(o),H.defaults=st.defaults,$a(H.defaults),H};H.getDefaults=Fo;H.defaults=lt;H.use=function(...o){return st.use(...o),H.defaults=st.defaults,$a(H.defaults),H};H.walkTokens=function(o,t){return st.walkTokens(o,t)};H.parseInline=st.parseInline;H.Parser=Ne;H.parser=Ne.parse;H.Renderer=Rn;H.TextRenderer=qo;H.Lexer=Oe;H.lexer=Oe.lex;H.Tokenizer=Dn;H.Hooks=jt;H.parse=H;var Ch=H.options,xh=H.setOptions,bh=H.use,vh=H.walkTokens,kh=H.parseInline;var yh=Ne.parse,wh=Oe.lex;var{entries:Za,setPrototypeOf:Wa,isFrozen:Rs,getPrototypeOf:zs,getOwnPropertyDescriptor:Ls}=Object,{freeze:ke,seal:Me,create:ei}=Object,{apply:ti,construct:ni}=typeof Reflect<"u"&&Reflect;ke||(ke=function(t){return t});Me||(Me=function(t){return t});ti||(ti=function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];return t.apply(e,i)});ni||(ni=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return new t(...n)});var Fn=ye(Array.prototype.forEach),Fs=ye(Array.prototype.lastIndexOf),Ha=ye(Array.prototype.pop),Ht=ye(Array.prototype.push),Vs=ye(Array.prototype.splice),Bn=ye(String.prototype.toLowerCase),Yo=ye(String.prototype.toString),Ko=ye(String.prototype.match),Ut=ye(String.prototype.replace),Bs=ye(String.prototype.indexOf),js=ye(String.prototype.trim),Ae=ye(Object.prototype.hasOwnProperty),ve=ye(RegExp.prototype.test),Gt=Ws(TypeError);function ye(o){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return ti(o,t,n)}}function Ws(o){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return ni(o,e)}}function U(o,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Bn;Wa&&Wa(o,null);let n=t.length;for(;n--;){let i=t[n];if(typeof i=="string"){let a=e(i);a!==i&&(Rs(t)||(t[n]=a),i=a)}o[i]=!0}return o}function Hs(o){for(let t=0;t<o.length;t++)Ae(o,t)||(o[t]=null);return o}function Be(o){let t=ei(null);for(let[e,n]of Za(o))Ae(o,e)&&(Array.isArray(n)?t[e]=Hs(n):n&&typeof n=="object"&&n.constructor===Object?t[e]=Be(n):t[e]=n);return t}function qt(o,t){for(;o!==null;){let n=Ls(o,t);if(n){if(n.get)return ye(n.get);if(typeof n.value=="function")return ye(n.value)}o=zs(o)}function e(){return null}return e}var Ua=ke(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Qo=ke(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Zo=ke(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Us=ke(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Xo=ke(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Gs=ke(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ga=ke(["#text"]),qa=ke(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Jo=ke(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ya=ke(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Vn=ke(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),qs=Me(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Ys=Me(/<%[\w\W]*|[\w\W]*%>/gm),Ks=Me(/\$\{[\w\W]*/gm),Qs=Me(/^data-[\-\w.\u00B7-\uFFFF]+$/),Zs=Me(/^aria-[\-\w]+$/),Xa=Me(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Xs=Me(/^(?:\w+script|data):/i),Js=Me(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ja=Me(/^html$/i),el=Me(/^[a-z][.\w]*(-[.\w]+)+$/i),Ka=Object.freeze({__proto__:null,ARIA_ATTR:Zs,ATTR_WHITESPACE:Js,CUSTOM_ELEMENT:el,DATA_ATTR:Qs,DOCTYPE_NAME:Ja,ERB_EXPR:Ys,IS_ALLOWED_URI:Xa,IS_SCRIPT_OR_DATA:Xs,MUSTACHE_EXPR:qs,TMPLIT_EXPR:Ks}),Yt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},tl=function(){return typeof window>"u"?null:window},nl=function(t,e){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let n=null,i="data-tt-policy-suffix";e&&e.hasAttribute(i)&&(n=e.getAttribute(i));let a="dompurify"+(n?"#"+n:"");try{return t.createPolicy(a,{createHTML(l){return l},createScriptURL(l){return l}})}catch{return console.warn("TrustedTypes policy "+a+" could not be created."),null}},Qa=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function er(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:tl(),t=L=>er(L);if(t.version="3.3.1",t.removed=[],!o||!o.document||o.document.nodeType!==Yt.document||!o.Element)return t.isSupported=!1,t;let{document:e}=o,n=e,i=n.currentScript,{DocumentFragment:a,HTMLTemplateElement:l,Node:h,Element:d,NodeFilter:k,NamedNodeMap:y=o.NamedNodeMap||o.MozNamedAttrMap,HTMLFormElement:z,DOMParser:D,trustedTypes:ne}=o,ee=d.prototype,Ie=qt(ee,"cloneNode"),Jt=qt(ee,"remove"),en=qt(ee,"nextSibling"),tn=qt(ee,"childNodes"),ct=qt(ee,"parentNode");if(typeof l=="function"){let L=e.createElement("template");L.content&&L.content.ownerDocument&&(e=L.content.ownerDocument)}let he,je="",{implementation:We,createNodeIterator:rr,createDocumentFragment:sr,getElementsByTagName:lr}=e,{importNode:cr}=n,Ce=Qa();t.isSupported=typeof Za=="function"&&typeof ct=="function"&&We&&We.createHTMLDocument!==void 0;let{MUSTACHE_EXPR:io,ERB_EXPR:ao,TMPLIT_EXPR:ro,DATA_ATTR:dr,ARIA_ATTR:pr,IS_SCRIPT_OR_DATA:ur,ATTR_WHITESPACE:si,CUSTOM_ELEMENT:mr}=Ka,{IS_ALLOWED_URI:li}=Ka,pe=null,ci=U({},[...Ua,...Qo,...Zo,...Xo,...Ga]),ge=null,di=U({},[...qa,...Jo,...Ya,...Vn]),se=Object.seal(ei(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Et=null,so=null,dt=Object.seal(ei(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}})),pi=!0,lo=!0,ui=!1,mi=!0,pt=!1,nn=!0,ot=!1,co=!1,po=!1,ut=!1,on=!1,an=!1,hi=!0,gi=!1,hr="user-content-",uo=!0,Tt=!1,mt={},De=null,mo=U({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),fi=null,_i=U({},["audio","video","img","source","image","track"]),ho=null,Ci=U({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),rn="http://www.w3.org/1998/Math/MathML",sn="http://www.w3.org/2000/svg",He="http://www.w3.org/1999/xhtml",ht=He,go=!1,fo=null,gr=U({},[rn,sn,He],Yo),ln=U({},["mi","mo","mn","ms","mtext"]),cn=U({},["annotation-xml"]),fr=U({},["title","style","font","a","script"]),Pt=null,_r=["application/xhtml+xml","text/html"],Cr="text/html",ce=null,gt=null,xr=e.createElement("form"),xi=function(f){return f instanceof RegExp||f instanceof Function},_o=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(gt&&gt===f)){if((!f||typeof f!="object")&&(f={}),f=Be(f),Pt=_r.indexOf(f.PARSER_MEDIA_TYPE)===-1?Cr:f.PARSER_MEDIA_TYPE,ce=Pt==="application/xhtml+xml"?Yo:Bn,pe=Ae(f,"ALLOWED_TAGS")?U({},f.ALLOWED_TAGS,ce):ci,ge=Ae(f,"ALLOWED_ATTR")?U({},f.ALLOWED_ATTR,ce):di,fo=Ae(f,"ALLOWED_NAMESPACES")?U({},f.ALLOWED_NAMESPACES,Yo):gr,ho=Ae(f,"ADD_URI_SAFE_ATTR")?U(Be(Ci),f.ADD_URI_SAFE_ATTR,ce):Ci,fi=Ae(f,"ADD_DATA_URI_TAGS")?U(Be(_i),f.ADD_DATA_URI_TAGS,ce):_i,De=Ae(f,"FORBID_CONTENTS")?U({},f.FORBID_CONTENTS,ce):mo,Et=Ae(f,"FORBID_TAGS")?U({},f.FORBID_TAGS,ce):Be({}),so=Ae(f,"FORBID_ATTR")?U({},f.FORBID_ATTR,ce):Be({}),mt=Ae(f,"USE_PROFILES")?f.USE_PROFILES:!1,pi=f.ALLOW_ARIA_ATTR!==!1,lo=f.ALLOW_DATA_ATTR!==!1,ui=f.ALLOW_UNKNOWN_PROTOCOLS||!1,mi=f.ALLOW_SELF_CLOSE_IN_ATTR!==!1,pt=f.SAFE_FOR_TEMPLATES||!1,nn=f.SAFE_FOR_XML!==!1,ot=f.WHOLE_DOCUMENT||!1,ut=f.RETURN_DOM||!1,on=f.RETURN_DOM_FRAGMENT||!1,an=f.RETURN_TRUSTED_TYPE||!1,po=f.FORCE_BODY||!1,hi=f.SANITIZE_DOM!==!1,gi=f.SANITIZE_NAMED_PROPS||!1,uo=f.KEEP_CONTENT!==!1,Tt=f.IN_PLACE||!1,li=f.ALLOWED_URI_REGEXP||Xa,ht=f.NAMESPACE||He,ln=f.MATHML_TEXT_INTEGRATION_POINTS||ln,cn=f.HTML_INTEGRATION_POINTS||cn,se=f.CUSTOM_ELEMENT_HANDLING||{},f.CUSTOM_ELEMENT_HANDLING&&xi(f.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(se.tagNameCheck=f.CUSTOM_ELEMENT_HANDLING.tagNameCheck),f.CUSTOM_ELEMENT_HANDLING&&xi(f.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(se.attributeNameCheck=f.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),f.CUSTOM_ELEMENT_HANDLING&&typeof f.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(se.allowCustomizedBuiltInElements=f.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),pt&&(lo=!1),on&&(ut=!0),mt&&(pe=U({},Ga),ge=[],mt.html===!0&&(U(pe,Ua),U(ge,qa)),mt.svg===!0&&(U(pe,Qo),U(ge,Jo),U(ge,Vn)),mt.svgFilters===!0&&(U(pe,Zo),U(ge,Jo),U(ge,Vn)),mt.mathMl===!0&&(U(pe,Xo),U(ge,Ya),U(ge,Vn))),f.ADD_TAGS&&(typeof f.ADD_TAGS=="function"?dt.tagCheck=f.ADD_TAGS:(pe===ci&&(pe=Be(pe)),U(pe,f.ADD_TAGS,ce))),f.ADD_ATTR&&(typeof f.ADD_ATTR=="function"?dt.attributeCheck=f.ADD_ATTR:(ge===di&&(ge=Be(ge)),U(ge,f.ADD_ATTR,ce))),f.ADD_URI_SAFE_ATTR&&U(ho,f.ADD_URI_SAFE_ATTR,ce),f.FORBID_CONTENTS&&(De===mo&&(De=Be(De)),U(De,f.FORBID_CONTENTS,ce)),f.ADD_FORBID_CONTENTS&&(De===mo&&(De=Be(De)),U(De,f.ADD_FORBID_CONTENTS,ce)),uo&&(pe["#text"]=!0),ot&&U(pe,["html","head","body"]),pe.table&&(U(pe,["tbody"]),delete Et.tbody),f.TRUSTED_TYPES_POLICY){if(typeof f.TRUSTED_TYPES_POLICY.createHTML!="function")throw Gt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof f.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Gt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');he=f.TRUSTED_TYPES_POLICY,je=he.createHTML("")}else he===void 0&&(he=nl(ne,i)),he!==null&&typeof je=="string"&&(je=he.createHTML(""));ke&&ke(f),gt=f}},bi=U({},[...Qo,...Zo,...Us]),vi=U({},[...Xo,...Gs]),br=function(f){let w=ct(f);(!w||!w.tagName)&&(w={namespaceURI:ht,tagName:"template"});let A=Bn(f.tagName),re=Bn(w.tagName);return fo[f.namespaceURI]?f.namespaceURI===sn?w.namespaceURI===He?A==="svg":w.namespaceURI===rn?A==="svg"&&(re==="annotation-xml"||ln[re]):!!bi[A]:f.namespaceURI===rn?w.namespaceURI===He?A==="math":w.namespaceURI===sn?A==="math"&&cn[re]:!!vi[A]:f.namespaceURI===He?w.namespaceURI===sn&&!cn[re]||w.namespaceURI===rn&&!ln[re]?!1:!vi[A]&&(fr[A]||!bi[A]):!!(Pt==="application/xhtml+xml"&&fo[f.namespaceURI]):!1},Re=function(f){Ht(t.removed,{element:f});try{ct(f).removeChild(f)}catch{Jt(f)}},it=function(f,w){try{Ht(t.removed,{attribute:w.getAttributeNode(f),from:w})}catch{Ht(t.removed,{attribute:null,from:w})}if(w.removeAttribute(f),f==="is")if(ut||on)try{Re(w)}catch{}else try{w.setAttribute(f,"")}catch{}},ki=function(f){let w=null,A=null;if(po)f="<remove></remove>"+f;else{let le=Ko(f,/^[\r\n\t ]+/);A=le&&le[0]}Pt==="application/xhtml+xml"&&ht===He&&(f='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+f+"</body></html>");let re=he?he.createHTML(f):f;if(ht===He)try{w=new D().parseFromString(re,Pt)}catch{}if(!w||!w.documentElement){w=We.createDocument(ht,"template",null);try{w.documentElement.innerHTML=go?je:re}catch{}}let _e=w.body||w.documentElement;return f&&A&&_e.insertBefore(e.createTextNode(A),_e.childNodes[0]||null),ht===He?lr.call(w,ot?"html":"body")[0]:ot?w.documentElement:_e},yi=function(f){return rr.call(f.ownerDocument||f,f,k.SHOW_ELEMENT|k.SHOW_COMMENT|k.SHOW_TEXT|k.SHOW_PROCESSING_INSTRUCTION|k.SHOW_CDATA_SECTION,null)},Co=function(f){return f instanceof z&&(typeof f.nodeName!="string"||typeof f.textContent!="string"||typeof f.removeChild!="function"||!(f.attributes instanceof y)||typeof f.removeAttribute!="function"||typeof f.setAttribute!="function"||typeof f.namespaceURI!="string"||typeof f.insertBefore!="function"||typeof f.hasChildNodes!="function")},wi=function(f){return typeof h=="function"&&f instanceof h};function Ue(L,f,w){Fn(L,A=>{A.call(t,f,w,gt)})}let Si=function(f){let w=null;if(Ue(Ce.beforeSanitizeElements,f,null),Co(f))return Re(f),!0;let A=ce(f.nodeName);if(Ue(Ce.uponSanitizeElement,f,{tagName:A,allowedTags:pe}),nn&&f.hasChildNodes()&&!wi(f.firstElementChild)&&ve(/<[/\w!]/g,f.innerHTML)&&ve(/<[/\w!]/g,f.textContent)||f.nodeType===Yt.progressingInstruction||nn&&f.nodeType===Yt.comment&&ve(/<[/\w]/g,f.data))return Re(f),!0;if(!(dt.tagCheck instanceof Function&&dt.tagCheck(A))&&(!pe[A]||Et[A])){if(!Et[A]&&Ti(A)&&(se.tagNameCheck instanceof RegExp&&ve(se.tagNameCheck,A)||se.tagNameCheck instanceof Function&&se.tagNameCheck(A)))return!1;if(uo&&!De[A]){let re=ct(f)||f.parentNode,_e=tn(f)||f.childNodes;if(_e&&re){let le=_e.length;for(let we=le-1;we>=0;--we){let Ge=Ie(_e[we],!0);Ge.__removalCount=(f.__removalCount||0)+1,re.insertBefore(Ge,en(f))}}}return Re(f),!0}return f instanceof d&&!br(f)||(A==="noscript"||A==="noembed"||A==="noframes")&&ve(/<\/no(script|embed|frames)/i,f.innerHTML)?(Re(f),!0):(pt&&f.nodeType===Yt.text&&(w=f.textContent,Fn([io,ao,ro],re=>{w=Ut(w,re," ")}),f.textContent!==w&&(Ht(t.removed,{element:f.cloneNode()}),f.textContent=w)),Ue(Ce.afterSanitizeElements,f,null),!1)},Ei=function(f,w,A){if(hi&&(w==="id"||w==="name")&&(A in e||A in xr))return!1;if(!(lo&&!so[w]&&ve(dr,w))){if(!(pi&&ve(pr,w))){if(!(dt.attributeCheck instanceof Function&&dt.attributeCheck(w,f))){if(!ge[w]||so[w]){if(!(Ti(f)&&(se.tagNameCheck instanceof RegExp&&ve(se.tagNameCheck,f)||se.tagNameCheck instanceof Function&&se.tagNameCheck(f))&&(se.attributeNameCheck instanceof RegExp&&ve(se.attributeNameCheck,w)||se.attributeNameCheck instanceof Function&&se.attributeNameCheck(w,f))||w==="is"&&se.allowCustomizedBuiltInElements&&(se.tagNameCheck instanceof RegExp&&ve(se.tagNameCheck,A)||se.tagNameCheck instanceof Function&&se.tagNameCheck(A))))return!1}else if(!ho[w]){if(!ve(li,Ut(A,si,""))){if(!((w==="src"||w==="xlink:href"||w==="href")&&f!=="script"&&Bs(A,"data:")===0&&fi[f])){if(!(ui&&!ve(ur,Ut(A,si,"")))){if(A)return!1}}}}}}}return!0},Ti=function(f){return f!=="annotation-xml"&&Ko(f,mr)},Pi=function(f){Ue(Ce.beforeSanitizeAttributes,f,null);let{attributes:w}=f;if(!w||Co(f))return;let A={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ge,forceKeepAttr:void 0},re=w.length;for(;re--;){let _e=w[re],{name:le,namespaceURI:we,value:Ge}=_e,ft=ce(le),xo=Ge,fe=le==="value"?xo:js(xo);if(A.attrName=ft,A.attrValue=fe,A.keepAttr=!0,A.forceKeepAttr=void 0,Ue(Ce.uponSanitizeAttribute,f,A),fe=A.attrValue,gi&&(ft==="id"||ft==="name")&&(it(le,f),fe=hr+fe),nn&&ve(/((--!?|])>)|<\/(style|title|textarea)/i,fe)){it(le,f);continue}if(ft==="attributename"&&Ko(fe,"href")){it(le,f);continue}if(A.forceKeepAttr)continue;if(!A.keepAttr){it(le,f);continue}if(!mi&&ve(/\/>/i,fe)){it(le,f);continue}pt&&Fn([io,ao,ro],Ii=>{fe=Ut(fe,Ii," ")});let Mi=ce(f.nodeName);if(!Ei(Mi,ft,fe)){it(le,f);continue}if(he&&typeof ne=="object"&&typeof ne.getAttributeType=="function"&&!we)switch(ne.getAttributeType(Mi,ft)){case"TrustedHTML":{fe=he.createHTML(fe);break}case"TrustedScriptURL":{fe=he.createScriptURL(fe);break}}if(fe!==xo)try{we?f.setAttributeNS(we,le,fe):f.setAttribute(le,fe),Co(f)?Re(f):Ha(t.removed)}catch{it(le,f)}}Ue(Ce.afterSanitizeAttributes,f,null)},vr=function L(f){let w=null,A=yi(f);for(Ue(Ce.beforeSanitizeShadowDOM,f,null);w=A.nextNode();)Ue(Ce.uponSanitizeShadowNode,w,null),Si(w),Pi(w),w.content instanceof a&&L(w.content);Ue(Ce.afterSanitizeShadowDOM,f,null)};return t.sanitize=function(L){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},w=null,A=null,re=null,_e=null;if(go=!L,go&&(L="<!-->"),typeof L!="string"&&!wi(L))if(typeof L.toString=="function"){if(L=L.toString(),typeof L!="string")throw Gt("dirty is not a string, aborting")}else throw Gt("toString is not a function");if(!t.isSupported)return L;if(co||_o(f),t.removed=[],typeof L=="string"&&(Tt=!1),Tt){if(L.nodeName){let Ge=ce(L.nodeName);if(!pe[Ge]||Et[Ge])throw Gt("root node is forbidden and cannot be sanitized in-place")}}else if(L instanceof h)w=ki("<!---->"),A=w.ownerDocument.importNode(L,!0),A.nodeType===Yt.element&&A.nodeName==="BODY"||A.nodeName==="HTML"?w=A:w.appendChild(A);else{if(!ut&&!pt&&!ot&&L.indexOf("<")===-1)return he&&an?he.createHTML(L):L;if(w=ki(L),!w)return ut?null:an?je:""}w&&po&&Re(w.firstChild);let le=yi(Tt?L:w);for(;re=le.nextNode();)Si(re),Pi(re),re.content instanceof a&&vr(re.content);if(Tt)return L;if(ut){if(on)for(_e=sr.call(w.ownerDocument);w.firstChild;)_e.appendChild(w.firstChild);else _e=w;return(ge.shadowroot||ge.shadowrootmode)&&(_e=cr.call(n,_e,!0)),_e}let we=ot?w.outerHTML:w.innerHTML;return ot&&pe["!doctype"]&&w.ownerDocument&&w.ownerDocument.doctype&&w.ownerDocument.doctype.name&&ve(Ja,w.ownerDocument.doctype.name)&&(we="<!DOCTYPE "+w.ownerDocument.doctype.name+`>
`+we),pt&&Fn([io,ao,ro],Ge=>{we=Ut(we,Ge," ")}),he&&an?he.createHTML(we):we},t.setConfig=function(){let L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_o(L),co=!0},t.clearConfig=function(){gt=null,co=!1},t.isValidAttribute=function(L,f,w){gt||_o({});let A=ce(L),re=ce(f);return Ei(A,re,w)},t.addHook=function(L,f){typeof f=="function"&&Ht(Ce[L],f)},t.removeHook=function(L,f){if(f!==void 0){let w=Fs(Ce[L],f);return w===-1?void 0:Vs(Ce[L],w,1)[0]}return Ha(Ce[L])},t.removeHooks=function(L){Ce[L]=[]},t.removeAllHooks=function(){Ce=Qa()},t}var jn=er();function ol(o,t){if(o&1&&M(0,"div",1),o&2){let e=s().$implicit;B("innerHTML",e.content,Se)}}function il(o,t){if(o&1){let e=E();m(0,"button",3),P("click",function(){x(e);let i=s().$implicit,a=s();return b(a.emitCitation(i))})("keydown.enter",function(){x(e);let i=s().$implicit,a=s();return b(a.emitCitation(i))})("keydown.space",function(){x(e);let i=s().$implicit,a=s();return b(a.emitCitation(i))}),c(1),g()}if(o&2){let e=s().$implicit,n=s();N("finance",n.getCategoryClass(e.citation==null?null:e.citation.conceptCategory)==="finance")("marketing",n.getCategoryClass(e.citation==null?null:e.citation.conceptCategory)==="marketing")("technology",n.getCategoryClass(e.citation==null?null:e.citation.conceptCategory)==="technology")("operations",n.getCategoryClass(e.citation==null?null:e.citation.conceptCategory)==="operations")("legal",n.getCategoryClass(e.citation==null?null:e.citation.conceptCategory)==="legal")("creative",n.getCategoryClass(e.citation==null?null:e.citation.conceptCategory)==="creative"),ue("aria-label","Koncept: "+e.content+". Kliknite za detalje."),r(),$(" ",e.content," ")}}function al(o,t){if(o&1&&_(0,ol,1,1,"div",1)(1,il,2,14,"button",2),o&2){let e=t.$implicit;C(e.type==="text"?0:1)}}var Wn=new H.Renderer,rl=Wn.link.bind(Wn);Wn.link=o=>rl(o).replace("<a ",'<a target="_blank" rel="noopener noreferrer" ');H.setOptions({gfm:!0,breaks:!0,renderer:Wn});var sl={ADD_ATTR:["target","rel","class"],ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","strong","em","del","s","ul","ol","li","a","code","pre","blockquote","table","thead","tbody","tr","th","td","span","div","img"]},Hn=class o{content=R.required();citations=R([]);citationClick=K();segments$=X(()=>this.parseContent(this.content(),this.citations()));parseContent(t,e){let n=new Map;for(let D of e)n.set(D.conceptName.toLowerCase(),D);let i=new Map,a=0,l=t.replace(/\[\[([^\]]+)\]\]/g,(D,ne)=>{let ee=`%%CITE_${a++}%%`;return i.set(ee,{name:ne,citation:n.get(ne.toLowerCase())}),ee}),d=H.parse(l,{async:!1}).replace(/<blockquote>\s*<p>\s*<strong>Kljuni uvid:?<\/strong>/gi,'<blockquote class="callout callout-insight"><p><strong>Klju\u010Dni uvid:</strong>').replace(/<blockquote>\s*<p>\s*<strong>Upozorenje:?<\/strong>/gi,'<blockquote class="callout callout-warning"><p><strong>Upozorenje:</strong>').replace(/<blockquote>\s*<p>\s*<strong>Metrika:?<\/strong>/gi,'<blockquote class="callout callout-metric"><p><strong>Metrika:</strong>').replace(/<blockquote>\s*<p>\s*<strong>Rezime:?<\/strong>/gi,'<blockquote class="callout callout-summary"><p><strong>Rezime:</strong>'),k=jn.sanitize(d,sl);if(i.size===0)return[{type:"text",content:k}];let y=[],z=k.split(/(%%CITE_\d+%%)/);for(let D of z){let ne=i.get(D);ne?y.push({type:"citation",content:ne.name,citation:ne.citation}):D.length>0&&y.push({type:"text",content:D})}return y}getCategoryClass(t){return t?t.toLowerCase():""}emitCitation(t){t.citation?this.citationClick.emit(t.citation):this.citationClick.emit(t.content)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-concept-citation"]],inputs:{content:[1,"content"],citations:[1,"citations"]},outputs:{citationClick:"citationClick"},decls:3,vars:0,consts:[[1,"content-with-citations"],[1,"markdown-segment",3,"innerHTML"],["type","button","tabindex","0",1,"citation-badge",3,"finance","marketing","technology","operations","legal","creative"],["type","button","tabindex","0",1,"citation-badge",3,"click","keydown.enter","keydown.space"]],template:function(e,n){e&1&&(m(0,"div",0),G(1,al,2,1,null,null,qe),g()),e&2&&(r(),q(n.segments$()))},dependencies:[ie],styles:[`.content-with-citations{display:block;line-height:1.75}.markdown-segment{display:contents}.citation-badge{display:inline-flex;align-items:center;gap:4px;padding:1px 8px;margin:0 2px;font-size:.8rem;font-weight:500;font-family:inherit;border-radius:4px;background:#3b82f614;border:1px solid rgba(59,130,246,.2);color:#60a5fa;cursor:pointer;transition:all .15s ease;vertical-align:baseline;text-decoration:none;line-height:1.4}.citation-badge:hover,.citation-badge:focus{background-color:#262626;border-color:#525252;color:#e5e5e5;outline:none}.citation-badge:focus-visible{box-shadow:0 0 0 2px #3b82f6}.citation-badge.finance{border-color:#10b98133;color:#10b981}.citation-badge.finance:hover{background-color:#10b98120;border-color:#10b981}.citation-badge.marketing{border-color:#f59e0b33;color:#f59e0b}.citation-badge.marketing:hover{background-color:#f59e0b20;border-color:#f59e0b}.citation-badge.technology{border-color:#3b82f633;color:#3b82f6}.citation-badge.technology:hover{background-color:#3b82f620;border-color:#3b82f6}.citation-badge.operations{border-color:#8b5cf633;color:#8b5cf6}.citation-badge.operations:hover{background-color:#8b5cf620;border-color:#8b5cf6}.citation-badge.legal{border-color:#6b728033;color:#6b7280}.citation-badge.legal:hover{background-color:#6b728020;border-color:#6b7280}.citation-badge.creative{border-color:#ec489933;color:#ec4899}.citation-badge.creative:hover{background-color:#ec489920;border-color:#ec4899}.content-with-citations>:first-child{margin-top:0!important}.content-with-citations>:last-child{margin-bottom:0!important}.content-with-citations h1{font-size:1.5em;font-weight:700;color:#fafafa;margin:24px 0 8px;padding-bottom:6px;border-bottom:1px solid #2a2a2a}.content-with-citations h2{font-size:1.3em;font-weight:600;color:#fafafa;margin:20px 0 6px;padding-bottom:4px;border-bottom:1px solid rgba(42,42,42,.5)}.content-with-citations h3{font-size:1.15em;font-weight:600;color:#f0f0f0;margin:18px 0 6px}.content-with-citations h4,.content-with-citations h5,.content-with-citations h6{font-size:1em;font-weight:600;color:#e5e5e5;margin:16px 0 4px}.content-with-citations p{margin:10px 0;line-height:1.7}.content-with-citations strong{color:#fafafa;font-weight:600}.content-with-citations em{color:#d4d4d4;font-style:italic}.content-with-citations ul,.content-with-citations ol{margin:8px 0;padding-left:1.5em;list-style-position:outside}.content-with-citations ul{list-style-type:disc}.content-with-citations ol{list-style-type:decimal}.content-with-citations li{margin:4px 0;line-height:1.7;color:#e0e0e0}.content-with-citations li::marker{color:#9e9e9e}.content-with-citations li>ul,.content-with-citations li>ol{margin:4px 0}.content-with-citations li>p{margin:4px 0}.content-with-citations ul ul{list-style-type:circle}.content-with-citations ul ul ul{list-style-type:square}.content-with-citations table{width:100%;border-collapse:collapse;margin:16px 0;font-size:.9em;border-radius:6px;overflow:hidden;border:1px solid #2a2a2a}.content-with-citations thead th{background:#1a1a1a;color:#fafafa;font-weight:600;text-align:left;padding:10px 14px;border-bottom:2px solid #333}.content-with-citations tbody td{padding:9px 14px;border-bottom:1px solid #1e1e1e;color:#d4d4d4}.content-with-citations tbody tr:hover{background:#3b82f60a}.content-with-citations tbody tr:last-child td{border-bottom:none}.content-with-citations code{background:#ffffff0f;color:#e5e5e5;padding:.15em .4em;border-radius:4px;font-family:JetBrains Mono,Fira Code,Consolas,monospace;font-size:.875em}.content-with-citations pre{background:#111;border:1px solid #2a2a2a;border-radius:8px;padding:14px 18px;overflow-x:auto;margin:16px 0}.content-with-citations pre code{background:none;padding:0;border-radius:0;font-size:.85em;line-height:1.6}.content-with-citations blockquote{border-left:3px solid #3b82f6;margin:16px 0;padding:8px 16px;color:#b0b0b0;background:#3b82f60a;border-radius:0 6px 6px 0}.content-with-citations blockquote p{margin:4px 0}.content-with-citations blockquote.callout{padding:12px 16px;border-radius:0 8px 8px 0}.content-with-citations .callout-insight{border-left-color:#3b82f6;background:#3b82f60f}.content-with-citations .callout-insight strong{color:#60a5fa}.content-with-citations .callout-warning{border-left-color:#f59e0b;background:#f59e0b0f}.content-with-citations .callout-warning strong{color:#fbbf24}.content-with-citations .callout-metric{border-left-color:#10b981;background:#10b9810f}.content-with-citations .callout-metric strong{color:#34d399}.content-with-citations .callout-summary{border-left-color:#8b5cf6;background:#8b5cf60f}.content-with-citations .callout-summary strong{color:#a78bfa}.content-with-citations a{color:#60a5fa;text-decoration:none}.content-with-citations a:hover{color:#93c5fd;text-decoration:underline}.content-with-citations hr{border:none;border-top:1px solid #2a2a2a;margin:20px 0}.content-with-citations del{color:#9e9e9e;text-decoration:line-through}
`],encapsulation:2,changeDetection:0})};var ll=(o,t)=>t.memoryId;function cl(o,t){if(o&1&&(m(0,"span",5),c(1),g()),o&2){let e=s(2);r(),$(" (+",e.additionalCount$()," more) ")}}function dl(o,t){if(o&1){let e=E();m(0,"div",9)(1,"div",10)(2,"span",11),c(3),g(),m(4,"span",12),c(5),g()(),m(6,"p",13),c(7),g(),m(8,"div",14)(9,"button",15),P("click",function(){let i=x(e).$implicit,a=s(3);return b(a.onViewDetails(i))}),c(10," View details "),g(),m(11,"button",16),P("click",function(){let i=x(e).$implicit,a=s(3);return b(a.onMarkOutdated(i))}),c(12," This is outdated "),g()()()}if(o&2){let e=t.$implicit,n=s(3);_t(n.getTypeClass(e.type)),r(2),Y("background-color",n.getTypeColor(e.type)+"20")("color",n.getTypeColor(e.type)),r(),$(" ",n.getTypeLabel(e.type)," "),r(2),I(e.subject),r(2),I(e.summary)}}function pl(o,t){if(o&1&&(m(0,"div",7),G(1,dl,13,9,"div",8,ll),g()),o&2){let e=s(2);r(),q(e.attributions())}}function ul(o,t){if(o&1){let e=E();m(0,"div",0)(1,"div",1)(2,"button",2),P("click",function(){x(e);let i=s();return b(i.toggleExpand())}),m(3,"span",3),c(4,"\u{1F4AD}"),g(),m(5,"span",4),c(6," Based on our previous discussion about "),m(7,"strong"),c(8),g(),_(9,cl,2,1,"span",5),g(),m(10,"span",6),c(11," \u25BC "),g()()(),_(12,pl,3,0,"div",7),g()}if(o&2){let e=s();r(2),ue("aria-expanded",e.isExpanded$()),r(6),I(e.primarySubject$()),r(),C(e.additionalCount$()>0?9:-1),r(),N("expanded",e.isExpanded$()),r(2),C(e.isExpanded$()?12:-1)}}var Un=class o{attributions=R([]);attributionClick=K();outdatedClick=K();isExpanded$=v(!1);primarySubject$=v("");additionalCount$=v(0);ngOnChanges(){this.updatePrimarySubject()}ngOnInit(){this.updatePrimarySubject()}updatePrimarySubject(){let t=this.attributions();t.length>0&&(this.primarySubject$.set(t[0]?.subject??"previous context"),this.additionalCount$.set(Math.max(0,t.length-1)))}toggleExpand(){this.isExpanded$.update(t=>!t)}getTypeClass(t){return t.toLowerCase().replace("_","-")}getTypeColor(t){return Gi[t]??"#6b7280"}getTypeLabel(t){return qi[t]??"Note"}onViewDetails(t){this.attributionClick.emit(t)}onMarkOutdated(t){this.outdatedClick.emit(t)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-memory-attribution"]],inputs:{attributions:[1,"attributions"]},outputs:{attributionClick:"attributionClick",outdatedClick:"outdatedClick"},features:[Ri],decls:1,vars:1,consts:[[1,"memory-attribution-container"],[1,"attribution-header"],["type","button","aria-controls","attribution-details",1,"attribution-toggle",3,"click"],["aria-hidden","true",1,"memory-icon"],[1,"attribution-text"],[1,"additional-count"],[1,"expand-icon"],["id","attribution-details","role","region","aria-label","Memory attribution details",1,"attribution-details"],[1,"attribution-item",3,"class"],[1,"attribution-item"],[1,"item-header"],[1,"type-badge"],[1,"subject"],[1,"summary"],[1,"item-actions"],["type","button","aria-label","View full memory details",1,"action-btn","view-btn",3,"click"],["type","button","aria-label","Mark this memory as outdated",1,"action-btn","outdated-btn",3,"click"]],template:function(e,n){e&1&&_(0,ul,13,6,"div",0),e&2&&C(n.attributions().length>0?0:-1)},dependencies:[ie],styles:[".memory-attribution-container[_ngcontent-%COMP%]{margin:.5rem 0;border-radius:.5rem;background-color:#1a1a1a;border:1px solid #333;overflow:hidden}.attribution-header[_ngcontent-%COMP%]{padding:0}.attribution-toggle[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:transparent;border:none;color:#a3a3a3;cursor:pointer;font-size:.875rem;text-align:left;transition:background-color .15s ease}.attribution-toggle[_ngcontent-%COMP%]:hover{background-color:#262626}.attribution-toggle[_ngcontent-%COMP%]:focus{outline:none}.attribution-toggle[_ngcontent-%COMP%]:focus-visible{box-shadow:inset 0 0 0 2px #3b82f6}.memory-icon[_ngcontent-%COMP%]{font-size:1rem}.attribution-text[_ngcontent-%COMP%]{flex:1;font-style:italic}.attribution-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#e5e5e5;font-weight:600}.additional-count[_ngcontent-%COMP%]{color:#737373;font-size:.75rem;margin-left:.25rem}.expand-icon[_ngcontent-%COMP%]{font-size:.625rem;transition:transform .2s ease;color:#737373}.expand-icon.expanded[_ngcontent-%COMP%]{transform:rotate(180deg)}.attribution-details[_ngcontent-%COMP%]{padding:0 1rem 1rem;border-top:1px solid #333}.attribution-item[_ngcontent-%COMP%]{padding:.75rem;margin-top:.75rem;border-radius:.375rem;background-color:#0d0d0d;border:1px solid #262626}.item-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem}.type-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:.125rem .5rem;font-size:.75rem;font-weight:500;border-radius:.25rem;text-transform:uppercase;letter-spacing:.025em}.subject[_ngcontent-%COMP%]{font-weight:600;color:#e5e5e5;font-size:.875rem}.summary[_ngcontent-%COMP%]{margin:0 0 .75rem;color:#a3a3a3;font-size:.875rem;line-height:1.5}.item-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.action-btn[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.75rem;font-weight:500;border-radius:.25rem;border:1px solid #333;background-color:transparent;color:#a3a3a3;cursor:pointer;transition:all .15s ease}.action-btn[_ngcontent-%COMP%]:hover{background-color:#262626;color:#e5e5e5}.action-btn[_ngcontent-%COMP%]:focus{outline:none}.action-btn[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 2px #3b82f6}.view-btn[_ngcontent-%COMP%]:hover{border-color:#3b82f6;color:#3b82f6}.outdated-btn[_ngcontent-%COMP%]{color:#f59e0b;border-color:#f59e0b33}.outdated-btn[_ngcontent-%COMP%]:hover{background-color:#f59e0b20;border-color:#f59e0b;color:#f59e0b}"],changeDetection:0})};var oi=()=>[],ml=(o,t)=>t.id;function hl(o,t){if(o&1&&(p(0,"a",6),T(1,"img",8),u()),o&2){let e=s().$implicit,n=s(3);V("href",n.getAttachmentUrl(e.id),bo),r(),V("src",n.getAttachmentUrl(e.id),bo)("alt",e.originalName)}}function gl(o,t){if(o&1&&(p(0,"div",7)(1,"span",9),c(2),u(),p(3,"span",10),c(4),u(),p(5,"span",11),c(6),u()()),o&2){let e=s().$implicit,n=s(3);r(2),I(n.getFileIcon(e.mimeType)),r(2),I(e.originalName),r(2),I(n.formatFileSize(e.size))}}function fl(o,t){if(o&1&&_(0,hl,2,3,"a",6)(1,gl,7,3,"div",7),o&2){let e=t.$implicit,n=s(3);C(n.isImage(e.mimeType)?0:1)}}function _l(o,t){if(o&1&&(p(0,"div",3),G(1,fl,2,1,null,null,ml),u()),o&2){let e=s(2);r(),q(e.message().attachments)}}function Cl(o,t){if(o&1&&(p(0,"p",5),c(1),u()),o&2){let e=s(2);r(),I(e.formatTime(e.message().createdAt))}}function xl(o,t){if(o&1&&(p(0,"div",0)(1,"div",2),_(2,_l,3,0,"div",3),p(3,"div",4),c(4),u(),_(5,Cl,2,1,"p",5),u()()),o&2){let e,n=s();r(2),C((e=n.message().attachments)!=null&&e.length?2:-1),r(2),I(n.message().content),r(),C(n.message().createdAt?5:-1)}}function bl(o,t){o&1&&(S(),T(0,"path",25))}function vl(o,t){o&1&&(S(),T(0,"path",26))}function kl(o,t){o&1&&(S(),T(0,"path",27))}function yl(o,t){if(o&1&&(p(0,"div",23),S(),p(1,"svg",24),_(2,bl,1,0,":svg:path",25)(3,vl,1,0,":svg:path",26)(4,kl,1,0,":svg:path",27),u(),c(5),u()),o&2){let e=s(2);N("confidence-high",e.confidenceLevel$()==="HIGH")("confidence-medium",e.confidenceLevel$()==="MEDIUM")("confidence-low",e.confidenceLevel$()==="LOW"),r(2),C(e.confidenceLevel$()==="HIGH"?2:e.confidenceLevel$()==="MEDIUM"?3:4),r(3),$(" ",(e.message().confidenceScore*100).toFixed(0),"% pouzdanost ")}}function wl(o,t){if(o&1){let e=E();p(0,"div",18)(1,"app-memory-attribution",28),O("attributionClick",function(i){x(e);let a=s(2);return b(a.onAttributionClick(i))})("outdatedClick",function(i){x(e);let a=s(2);return b(a.onOutdatedClick(i))}),u()()}if(o&2){let e=s(2);r(),V("attributions",e.message().memoryAttributions??Je(1,oi))}}function Sl(o,t){o&1&&(p(0,"span",20),c(1,"\xA0"),u())}function El(o,t){o&1&&(S(),p(0,"svg",32),T(1,"path",33),u())}function Tl(o,t){o&1&&(S(),p(0,"svg",32),T(1,"path",34),u())}function Pl(o,t){o&1&&(S(),p(0,"svg",32),T(1,"path",35),u())}function Ml(o,t){o&1&&(S(),p(0,"svg",32),T(1,"path",36),u())}function Il(o,t){o&1&&(S(),p(0,"svg",32),T(1,"path",34),u())}function $l(o,t){o&1&&(S(),p(0,"svg",32),T(1,"path",37),u())}function Ol(o,t){o&1&&(S(),p(0,"svg",32),T(1,"path",38),u())}function Nl(o,t){o&1&&(S(),p(0,"svg",32),T(1,"path",39),u())}function Al(o,t){o&1&&(S(),p(0,"svg",32),T(1,"path",40),u())}function Dl(o,t){if(o&1){let e=E();p(0,"button",31),O("click",function(){let i=x(e).$implicit,a=s(3);return b(a.onActionClick(i))}),_(1,El,2,0,":svg:svg",32)(2,Tl,2,0,":svg:svg",32)(3,Pl,2,0,":svg:svg",32)(4,Ml,2,0,":svg:svg",32)(5,Il,2,0,":svg:svg",32)(6,$l,2,0,":svg:svg",32)(7,Ol,2,0,":svg:svg",32)(8,Nl,2,0,":svg:svg",32)(9,Al,2,0,":svg:svg",32),c(10),u()}if(o&2){let e,n=t.$implicit;r(),C((e=n.icon)==="tasks"?1:e==="explore"?2:e==="arrow"?3:e==="workflow"?4:e==="search"?5:e==="score"?6:e==="note"?7:e==="web"?8:9),r(9),$(" ",n.label," ")}}function Rl(o,t){if(o&1&&(p(0,"div",21)(1,"div",29),c(2,"Preporu\u010Deni slede\u0107i koraci"),u(),G(3,Dl,11,2,"button",30,qe),u()),o&2){let e=s(2);r(3),q(e.message().suggestedActions??Je(0,oi))}}function zl(o,t){if(o&1&&(p(0,"div",45)(1,"span",46),c(2),u(),p(3,"div",47),T(4,"div",48),u(),p(5,"span",49),c(6),u()()),o&2){let e=t.$implicit,n=t.$index,i=s(4);r(),V("title",e.label),r(),I(e.label),r(2),Y("width",e.percent,"%")("background-color",i.chartColors[n%i.chartColors.length]),r(2),I(e.displayValue)}}function Ll(o,t){if(o&1&&(p(0,"div",44),G(1,zl,7,7,"div",45,qe),u()),o&2){let e=s(3);r(),q(e.chartData$())}}function Fl(o,t){if(o&1){let e=E();p(0,"div",41)(1,"button",42),O("click",function(){x(e);let i=s(2);return b(i.showChart$.set(!i.showChart$()))}),S(),p(2,"svg",32),T(3,"path",43),u(),c(4),u()(),_(5,Ll,3,0,"div",44)}if(o&2){let e=s(2);r(4),$(" ",e.showChart$()?"Sakrij grafikon":"Prika\u017Ei grafikon"," "),r(),C(e.showChart$()?5:-1)}}function Vl(o,t){if(o&1&&(p(0,"div",50),S(),p(1,"svg",24),T(2,"path",52),u(),j(),p(3,"p",53)(4,"span",54),c(5,"Za pobolj\u0161anje:"),u(),c(6),u()()),o&2){let e=s(3);r(6),$(" ",e.improvementSuggestion()," ")}}function Bl(o,t){if(o&1&&(p(0,"p",51),c(1),u()),o&2){let e=s(3);r(),I(e.formatTime(e.message().createdAt))}}function jl(o,t){if(o&1&&(p(0,"div",22),_(1,Vl,7,1,"div",50),_(2,Bl,2,1,"p",51),u()),o&2){let e=s(2);r(),C(e.showImprovementSuggestion$()?1:-1),r(),C(e.message().createdAt?2:-1)}}function Wl(o,t){if(o&1){let e=E();p(0,"div",1)(1,"div",12)(2,"div",13)(3,"div",14),c(4),u(),p(5,"span",15),c(6),u()(),_(7,yl,6,8,"div",16),u(),p(8,"div",17),_(9,wl,2,2,"div",18),p(10,"app-concept-citation",19),O("citationClick",function(i){x(e);let a=s();return b(a.onCitationClick(i))}),u(),_(11,Sl,2,0,"span",20),u(),_(12,Rl,5,1,"div",21),_(13,Fl,6,2),_(14,jl,3,2,"div",22),u()}if(o&2){let e=s();r(3),Y("background-color",e.getPersonaColor()),r(),$(" ",e.getPersonaInitial()," "),r(),Y("color",e.personaType()?e.getPersonaColor():"#FAFAFA"),r(),$(" ",e.getPersonaLabel()," "),r(),C(!e.isStreaming()&&e.hasConfidence$()?7:-1),r(2),C(!e.isStreaming()&&e.hasMemoryAttributions$()?9:-1),r(),V("content",e.message().content)("citations",e.message().citations??Je(14,oi)),r(),C(e.isStreaming()?11:-1),r(),C(!e.isStreaming()&&e.hasSuggestedActions$()?12:-1),r(),C(!e.isStreaming()&&e.chartData$().length>0?13:-1),r(),C(e.isStreaming()?-1:14)}}var Gn=class o{get hostId(){return`msg-${this.message().id}`}message=R.required();isStreaming=R(!1);personaType=R(null);improvementSuggestion=R(null);citationClick=K();attributionClick=K();outdatedClick=K();actionClick=K();onCitationClick(t){this.citationClick.emit(t)}onActionClick(t){this.actionClick.emit(t)}onAttributionClick(t){this.attributionClick.emit(t)}onOutdatedClick(t){this.outdatedClick.emit(t)}previousScore=R(null);improvementDelta=R(null);showChart$=v(!1);chartColors=["#3B82F6","#10B981","#F59E0B","#8B5CF6","#EC4899","#EF4444","#06B6D4","#84CC16"];chartData$=X(()=>{let t=this.message().content;if(!t||this.message().role!=="ASSISTANT")return[];let e=t.match(/\|(.+)\|\r?\n\|[\s\-:|]+\|\r?\n((?:\|.+\|\r?\n?)+)/);if(!e||!e[1]||!e[2])return[];let n=e[1].split("|").map(d=>d.trim()).filter(Boolean),i=e[2].trim().split(/\r?\n/).map(d=>d.split("|").map(k=>k.trim()).filter(Boolean));if(n.length<2||i.length<2)return[];let a=-1;for(let d=1;d<n.length;d++)if(i.every(y=>{let z=y[d]?.replace(/[$%,.\s+KkMm]/g,"");return z&&!isNaN(Number(z))})){a=d;break}if(a===-1)return[];let l=i.map(d=>{let k=d[a]?.replace(/[$%,.\s+KkMm]/g,"")??"0";return{label:d[0]??"",value:Math.abs(Number(k)||0),displayValue:d[a]??""}}).filter(d=>d.label),h=Math.max(...l.map(d=>d.value),1);return l.map(d=>te(F({},d),{percent:d.value/h*100}))});hasConfidence$=X(()=>{let t=this.message().confidenceScore;return t!=null});hasMemoryAttributions$=X(()=>{let t=this.message().memoryAttributions;return t!=null&&t.length>0});hasSuggestedActions$=X(()=>{let t=this.message().suggestedActions;return t!=null&&t.length>0});confidenceLevel$=X(()=>{let t=this.message().confidenceScore;return t==null?"MEDIUM":t>=.85?"HIGH":t>=.5?"MEDIUM":"LOW"});showImprovementSuggestion$=X(()=>{let t=this.improvementSuggestion(),e=this.confidenceLevel$();return t!=null&&(e==="LOW"||e==="MEDIUM")});formatTime(t){return t?new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""}getPersonaColor(){let t=this.personaType();return t?Cn[t]??"#3B82F6":"#3B82F6"}getPersonaInitial(){let t=this.personaType();return t?(Mt[t]??"AI").charAt(0):"AI"}getPersonaLabel(){let t=this.personaType();return t?Mt[t]??"AI Asistent":"AI Asistent"}isImage(t){return t.startsWith("image/")}getAttachmentUrl(t){return`/api/v1/attachments/${t}/file`}getFileIcon(t){return t==="application/pdf"?"\u{1F4C4}":t.includes("spreadsheet")||t==="text/csv"?"\u{1F4CA}":t.includes("wordprocessing")?"\u{1F4DD}":"\u{1F4CE}"}formatFileSize(t){return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(0)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-chat-message"]],hostVars:1,hostBindings:function(e,n){e&2&&ue("id",n.hostId)},inputs:{message:[1,"message"],isStreaming:[1,"isStreaming"],personaType:[1,"personaType"],improvementSuggestion:[1,"improvementSuggestion"],previousScore:[1,"previousScore"],improvementDelta:[1,"improvementDelta"]},outputs:{citationClick:"citationClick",attributionClick:"attributionClick",outdatedClick:"outdatedClick",actionClick:"actionClick"},decls:2,vars:2,consts:[[1,"msg-user-row"],[1,"ai-card"],[1,"msg-user"],[1,"message-attachments"],[1,"msg-user-text"],[1,"msg-user-time"],["target","_blank",1,"attachment-image",3,"href"],[1,"attachment-file"],[3,"src","alt"],[1,"attachment-icon"],[1,"attachment-name"],[1,"attachment-size"],[1,"ai-header"],[1,"ai-header-left"],[1,"persona-avatar"],[1,"persona-name"],[1,"confidence-badge",3,"confidence-high","confidence-medium","confidence-low"],[1,"ai-content"],[1,"memory-section"],[3,"citationClick","content","citations"],[1,"cursor-blink"],[1,"actions-section"],[1,"ai-footer"],[1,"confidence-badge"],["fill","currentColor","viewBox","0 0 20 20"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule","evenodd"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[3,"attributionClick","outdatedClick","attributions"],[1,"actions-label"],[1,"action-pill"],[1,"action-pill",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 7l5 5m0 0l-5 5m5-5H6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 10V3L4 14h7v7l9-11h-7z"],[1,"chart-toggle-row"],[1,"chart-toggle-btn",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"chart-container"],[1,"chart-bar-row"],[1,"chart-bar-label",3,"title"],[1,"chart-bar-track"],[1,"chart-bar-fill"],[1,"chart-bar-value"],[1,"improvement-row"],[1,"ai-time"],["d","M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"],[1,"improvement-text"],[1,"improvement-label"]],template:function(e,n){e&1&&(_(0,xl,6,3,"div",0),_(1,Wl,15,15,"div",1)),e&2&&(C(n.message().role==="USER"?0:-1),r(),C(n.message().role==="ASSISTANT"?1:-1))},dependencies:[ie,Hn,Un],styles:["[_nghost-%COMP%]{display:block;animation:_ngcontent-%COMP%_msgFadeIn .3s ease-out}@keyframes _ngcontent-%COMP%_msgFadeIn{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.msg-user-row[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.msg-user[_ngcontent-%COMP%]{max-width:70%;background:#3b82f6;color:#fff;border-radius:16px 16px 4px;padding:12px 16px}.msg-user-text[_ngcontent-%COMP%]{font-size:15px;line-height:1.6;white-space:pre-wrap;word-break:break-word}.msg-user-time[_ngcontent-%COMP%]{font-size:11px;color:#fff9;margin-top:8px;text-align:right}.ai-card[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:12px;border:1px solid #2a2a2a;overflow:hidden}.ai-header[_ngcontent-%COMP%]{padding:12px 16px;border-bottom:1px solid #2a2a2a;display:flex;align-items:center;justify-content:space-between}.ai-header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.persona-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:13px;font-weight:600}.persona-name[_ngcontent-%COMP%]{font-size:13px;font-weight:500}.confidence-badge[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:500}.confidence-badge[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.confidence-high[_ngcontent-%COMP%]{color:#22c55e;background:#22c55e1a}.confidence-medium[_ngcontent-%COMP%]{color:#eab308;background:#eab3081a}.confidence-low[_ngcontent-%COMP%]{color:#ef4444;background:#ef44441a}.ai-content[_ngcontent-%COMP%]{padding:20px;font-size:15px;line-height:1.75;color:#e0e0e0;word-break:break-word}.ai-content[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child{margin-top:0!important}.ai-content[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:last-child{margin-bottom:0!important}.ai-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.6em;font-weight:700;color:#fafafa;margin:28px 0 12px;letter-spacing:-.01em}.ai-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.35em;font-weight:600;color:#fafafa;margin:24px 0 10px;letter-spacing:-.01em}.ai-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.15em;font-weight:600;color:#fafafa;margin:22px 0 8px}.ai-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .ai-content[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%], .ai-content[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:1em;font-weight:600;color:#e5e5e5;margin:20px 0 6px}.ai-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:16px 0}.ai-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#fafafa;font-weight:600}.ai-content[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{color:#d4d4d4;font-style:italic}.ai-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .ai-content[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:16px 0;padding-left:1.75em;list-style-position:outside}.ai-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:disc}.ai-content[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{list-style-type:decimal}.ai-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:.4em 0;line-height:1.75;color:#e0e0e0}.ai-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]::marker{color:#9e9e9e}.ai-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] > ul[_ngcontent-%COMP%], .ai-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] > ol[_ngcontent-%COMP%]{margin:.3em 0}.ai-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{margin:.4em 0}.ai-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:circle}.ai-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:square}.ai-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin:20px 0;font-size:.9em}.ai-content[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#262626;color:#fafafa;font-weight:600;text-align:left;padding:10px 14px;border:1px solid #333}.ai-content[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 14px;border:1px solid #2a2a2a;color:#d4d4d4}.ai-content[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background:#1a1a1a}.ai-content[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background:#0d0d0d}.ai-content[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#262626}.ai-content[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:#262626;color:#e5e5e5;padding:.15em .4em;border-radius:4px;font-family:JetBrains Mono,Fira Code,Consolas,monospace;font-size:.875em}.ai-content[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{background:#0d0d0d;border:1px solid #2a2a2a;border-radius:8px;padding:14px 18px;overflow-x:auto;margin:20px 0}.ai-content[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:none;padding:0;border-radius:0;font-size:.85em;line-height:1.5}.ai-content[_ngcontent-%COMP%]   blockquote[_ngcontent-%COMP%]{border-left:3px solid #3b82f6;margin:20px 0;padding:.75em 1.25em;color:#a1a1a1;background:#3b82f60d;border-radius:0 6px 6px 0}.ai-content[_ngcontent-%COMP%]   blockquote[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.4em 0}.ai-content[_ngcontent-%COMP%]   blockquote.callout[_ngcontent-%COMP%]{padding:12px 16px;border-radius:8px}.ai-content[_ngcontent-%COMP%]   blockquote.callout[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]:first-child{display:block;margin-bottom:4px;font-size:12px;text-transform:uppercase;letter-spacing:.5px}.ai-content[_ngcontent-%COMP%]   .callout-insight[_ngcontent-%COMP%]{border-left-color:#3b82f6;background:#3b82f614}.ai-content[_ngcontent-%COMP%]   .callout-insight[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#60a5fa}.ai-content[_ngcontent-%COMP%]   .callout-warning[_ngcontent-%COMP%]{border-left-color:#f59e0b;background:#f59e0b14}.ai-content[_ngcontent-%COMP%]   .callout-warning[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#fbbf24}.ai-content[_ngcontent-%COMP%]   .callout-metric[_ngcontent-%COMP%]{border-left-color:#10b981;background:#10b98114}.ai-content[_ngcontent-%COMP%]   .callout-metric[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#34d399}.ai-content[_ngcontent-%COMP%]   .callout-summary[_ngcontent-%COMP%]{border-left-color:#8b5cf6;background:#8b5cf614}.ai-content[_ngcontent-%COMP%]   .callout-summary[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#a78bfa}.ai-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#60a5fa;text-decoration:underline;text-underline-offset:2px}.ai-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#93c5fd}.ai-content[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{border:none;border-top:1px solid #2a2a2a;margin:24px 0}.ai-content[_ngcontent-%COMP%]   del[_ngcontent-%COMP%]{color:#9e9e9e;text-decoration:line-through}.ai-footer[_ngcontent-%COMP%]{padding:12px 16px;border-top:1px solid #2a2a2a}.ai-time[_ngcontent-%COMP%]{font-size:11px;color:#9e9e9e}.improvement-row[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;margin-bottom:8px}.improvement-row[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px;color:#eab308;flex-shrink:0;margin-top:2px}.improvement-text[_ngcontent-%COMP%]{font-size:13px;color:#a1a1a1;line-height:1.5}.improvement-label[_ngcontent-%COMP%]{color:#eab308;font-weight:500}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.cursor-blink[_ngcontent-%COMP%]{display:inline-block;width:6px;height:20px;background:#3b82f6;border-radius:2px;margin-left:2px;animation:_ngcontent-%COMP%_pulse 1s ease-in-out infinite;vertical-align:text-bottom}.memory-section[_ngcontent-%COMP%]{margin-bottom:12px}.actions-section[_ngcontent-%COMP%]{padding:10px 20px 14px;border-top:1px solid #2a2a2a;display:flex;flex-wrap:wrap;gap:8px}.actions-label[_ngcontent-%COMP%]{font-size:10px;color:#707070;width:100%;margin-bottom:2px}.action-pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;background:#0d0d0d;border:1px solid #2a2a2a;border-radius:20px;font-size:12px;font-weight:500;color:#a1a1a1;cursor:pointer;font-family:inherit;transition:all .15s}.action-pill[_ngcontent-%COMP%]:hover{background:#1a1a1a;border-color:#3b82f6;color:#fafafa}.action-pill[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px;flex-shrink:0}.chart-toggle-row[_ngcontent-%COMP%]{padding:8px 16px;border-top:1px solid #242424}.chart-toggle-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border:1px solid #2a2a2a;border-radius:6px;background:transparent;color:#9e9e9e;font-size:12px;cursor:pointer;transition:all .15s ease}.chart-toggle-btn[_ngcontent-%COMP%]:hover{color:#fafafa;border-color:#3b82f6;background:#3b82f60d}.chart-toggle-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.chart-container[_ngcontent-%COMP%]{padding:16px;border-top:1px solid #242424}.chart-bar-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:6px}.chart-bar-label[_ngcontent-%COMP%]{width:100px;font-size:11px;color:#9e9e9e;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:0}.chart-bar-track[_ngcontent-%COMP%]{flex:1;height:20px;background:#242424;border-radius:4px;overflow:hidden}.chart-bar-fill[_ngcontent-%COMP%]{height:100%;border-radius:4px;transition:width .3s ease;min-width:2px}.chart-bar-value[_ngcontent-%COMP%]{width:70px;font-size:11px;color:#fafafa;font-weight:500;flex-shrink:0}.message-attachments[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px}.attachment-image[_ngcontent-%COMP%]{display:block;border-radius:8px;overflow:hidden;cursor:pointer}.attachment-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:300px;max-height:200px;display:block;border-radius:8px;object-fit:cover}.attachment-file[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:6px 10px;background:#ffffff0f;border:1px solid #2a2a2a;border-radius:6px;font-size:12px;color:#e0e0e0}.attachment-icon[_ngcontent-%COMP%]{font-size:16px;flex-shrink:0}.attachment-name[_ngcontent-%COMP%]{max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.attachment-size[_ngcontent-%COMP%]{color:#9e9e9e;font-size:11px;flex-shrink:0}"]})};var qn=class o{http=J(Ee);upload(t){let e=new FormData;return e.append("file",t),this.http.post("/api/v1/attachments/upload",e)}getFileUrl(t){return`/api/v1/attachments/${t}/file`}static \u0275fac=function(e){return new(e||o)};static \u0275prov=ze({token:o,factory:o.\u0275fac,providedIn:"root"})};var Ul=["inputRef"],Gl=(o,t)=>t.name;function ql(o,t){if(o&1){let e=E();p(0,"div",16)(1,"span",17),c(2),u(),p(3,"span",18),c(4),u(),p(5,"span",19),c(6),u(),p(7,"button",20),O("click",function(){let i=x(e).$index,a=s(2);return b(a.removeFile(i))}),c(8," \u2715 "),u()()}if(o&2){let e=t.$implicit,n=t.$index,i=s(2);N("file-chip-uploading",!i.uploadedIds()[n]),r(2),I(i.getFileIcon(e.type)),r(2),I(e.name),r(2),I(i.formatSize(e.size))}}function Yl(o,t){if(o&1&&(p(0,"div",4),G(1,ql,9,5,"div",15,Gl),u()),o&2){let e=s();r(),q(e.attachedFiles())}}function Kl(o,t){o&1&&(S(),p(0,"svg",13),T(1,"circle",21)(2,"path",22),u())}function Ql(o,t){o&1&&(S(),p(0,"svg",7),T(1,"path",23),u())}var Yn=class o{disabled=R(!1);messageSent=K();inputRef;attachmentService=J(qn);inputValue="";attachedFiles=v([]);uploadedIds=v([]);isUploading=v(!1);acceptedTypes=["application/pdf","text/plain","text/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png"].join(",");canSend(){return this.inputValue.trim().length>0||this.attachedFiles().length>0}handleKeydown(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.send())}send(){let t=this.inputValue.trim();if(!t&&this.attachedFiles().length===0||this.disabled()||this.isUploading())return;let e=this.uploadedIds().filter(n=>n!==null);this.messageSent.emit({content:t||"(fajl prilo\u017Een)",attachmentIds:e}),this.inputValue="",this.attachedFiles.set([]),this.uploadedIds.set([]),this.inputRef?.nativeElement&&(this.inputRef.nativeElement.style.height="auto")}onFileSelected(t){let e=t.target;if(!e.files)return;let n=Array.from(e.files),i=this.attachedFiles().length,a=5;i+n.length>a&&n.splice(a-i);for(let l of n){if(l.size>10*1024*1024)continue;let h=this.attachedFiles().length;this.attachedFiles.update(d=>[...d,l]),this.uploadedIds.update(d=>[...d,null]),this.isUploading.set(!0),this.attachmentService.upload(l).subscribe({next:d=>{this.uploadedIds.update(k=>{let y=[...k];return y[h]=d.id,y}),this.uploadedIds().every(k=>k!==null)&&this.isUploading.set(!1)},error:()=>{this.removeFile(h),(this.uploadedIds().every(d=>d!==null)||this.attachedFiles().length===0)&&this.isUploading.set(!1)}})}e.value=""}removeFile(t){this.attachedFiles.update(e=>e.filter((n,i)=>i!==t)),this.uploadedIds.update(e=>e.filter((n,i)=>i!==t)),this.attachedFiles().length===0&&this.isUploading.set(!1)}getFileIcon(t){return t.startsWith("image/")?"\u{1F5BC}":t==="application/pdf"?"\u{1F4C4}":t.includes("spreadsheet")||t==="text/csv"?"\u{1F4CA}":t.includes("wordprocessing")?"\u{1F4DD}":"\u{1F4CE}"}formatSize(t){return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(0)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`}autoResize(){let t=this.inputRef?.nativeElement;t&&(t.style.height="auto",t.style.height=`${Math.min(t.scrollHeight,200)}px`)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-chat-input"]],viewQuery:function(e,n){if(e&1&&un(Ul,5),e&2){let i;Ze(i=Xe())&&(n.inputRef=i.first)}},inputs:{disabled:[1,"disabled"]},outputs:{messageSent:"messageSent"},decls:23,vars:7,consts:[["fileInput",""],["inputRef",""],[1,"input-wrapper"],[1,"input-inner"],[1,"file-chips"],[1,"input-row"],["title","Prilo\u017Ei fajl",1,"attach-btn",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"],["type","file","multiple","",2,"display","none",3,"change","accept"],[1,"textarea-wrap"],["placeholder","Pitajte Mentor AI bilo \u0161ta...","rows","1",3,"ngModelChange","keydown","input","ngModel","disabled"],["title","Po\u0161alji poruku",1,"send-btn",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"spin"],[1,"hint"],[1,"file-chip",3,"file-chip-uploading"],[1,"file-chip"],[1,"file-chip-icon"],[1,"file-chip-name"],[1,"file-chip-size"],["title","Ukloni",1,"file-chip-remove",3,"click"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",2,"opacity","0.25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",2,"opacity","0.75"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 19l9 2-9-18-9 18 9-2zm0 0v-8"]],template:function(e,n){if(e&1){let i=E();p(0,"div",2)(1,"div",3),_(2,Yl,3,0,"div",4),p(3,"div",5)(4,"button",6),O("click",function(){x(i);let l=Vi(8);return b(l.click())}),S(),p(5,"svg",7),T(6,"path",8),u()(),j(),p(7,"input",9,0),O("change",function(l){return x(i),b(n.onFileSelected(l))}),u(),p(9,"div",10)(10,"textarea",11,1),fn("ngModelChange",function(l){return x(i),gn(n.inputValue,l)||(n.inputValue=l),b(l)}),O("keydown",function(l){return x(i),b(n.handleKeydown(l))})("input",function(){return x(i),b(n.autoResize())}),u()(),p(12,"button",12),O("click",function(){return x(i),b(n.send())}),_(13,Kl,3,0,":svg:svg",13)(14,Ql,2,0,":svg:svg",7),u()(),p(15,"p",14),c(16," Pritisnite "),p(17,"kbd"),c(18,"Enter"),u(),c(19," za slanje, "),p(20,"kbd"),c(21,"Shift+Enter"),u(),c(22," za novi red "),u()()()}e&2&&(r(2),C(n.attachedFiles().length>0?2:-1),r(2),V("disabled",n.disabled()||n.isUploading()),r(3),V("accept",n.acceptedTypes),r(3),hn("ngModel",n.inputValue),V("disabled",n.disabled()),r(2),V("disabled",n.disabled()||n.isUploading()||!n.canSend()),r(),C(n.disabled()?13:14))},dependencies:[ie,Ct,xn,bn,vn],styles:["[_nghost-%COMP%]{display:block}.input-wrapper[_ngcontent-%COMP%]{border-top:1px solid #2a2a2a;padding:16px;background:#0d0d0d}.input-inner[_ngcontent-%COMP%]{max-width:768px;margin:0 auto}.file-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px}.file-chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:4px 10px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;font-size:12px;color:#e0e0e0}.file-chip-uploading[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.file-chip-icon[_ngcontent-%COMP%]{font-size:14px;flex-shrink:0}.file-chip-name[_ngcontent-%COMP%]{max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.file-chip-size[_ngcontent-%COMP%]{color:#9e9e9e;font-size:11px;flex-shrink:0}.file-chip-remove[_ngcontent-%COMP%]{background:none;border:none;color:#9e9e9e;cursor:pointer;font-size:14px;padding:0 2px;line-height:1}.file-chip-remove[_ngcontent-%COMP%]:hover{color:#ef4444}.input-row[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:8px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:8px;transition:border-color .2s}.input-row[_ngcontent-%COMP%]:focus-within{border-color:#3b82f6}.attach-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:36px;height:36px;min-width:36px;background:none;border:none;color:#9e9e9e;cursor:pointer;border-radius:6px;transition:color .15s,background .15s}.attach-btn[_ngcontent-%COMP%]:hover{color:#fafafa;background:#ffffff0f}.attach-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.attach-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.textarea-wrap[_ngcontent-%COMP%]{flex:1}textarea[_ngcontent-%COMP%]{width:100%;resize:none;background:transparent;border:none;outline:none;color:#fafafa;font-size:15px;font-family:inherit;line-height:1.5;padding:6px 8px;max-height:200px}textarea[_ngcontent-%COMP%]::placeholder{color:#9e9e9e}textarea[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.send-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;min-width:40px;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;transition:opacity .15s}.send-btn[_ngcontent-%COMP%]:hover:not(:disabled){opacity:.9}.send-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.send-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.hint[_ngcontent-%COMP%]{font-size:11px;color:#9e9e9e;text-align:center;margin-top:8px}.hint[_ngcontent-%COMP%]   kbd[_ngcontent-%COMP%]{display:inline-block;padding:1px 6px;background:#242424;border-radius:3px;font-size:10px;font-family:monospace}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}"]})};var Kn=class o{personaType=R(null);phase=R("thinking");personaColors={CFO:"#3B82F6",CMO:"#8B5CF6",CTO:"#10B981",OPERATIONS:"#F59E0B",LEGAL:"#EF4444",CREATIVE:"#EC4899"};personaLabels={CFO:"CFO",CMO:"CMO",CTO:"CTO",OPERATIONS:"Operations",LEGAL:"Legal",CREATIVE:"Creative"};getPersonaColor(){let t=this.personaType();return t?this.personaColors[t]??"#3B82F6":"#3B82F6"}getPersonaInitial(){let t=this.personaType();if(!t)return"AI";let e=this.personaLabels[t];return e?e.charAt(0):"AI"}getPersonaLabel(){let t=this.personaType();return t?this.personaLabels[t]??"AI Assistant":"AI Assistant"}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-typing-indicator"]],inputs:{personaType:[1,"personaType"],phase:[1,"phase"]},decls:14,vars:13,consts:[[1,"typing-card"],[1,"typing-header"],[1,"typing-avatar"],[1,"typing-label"],[1,"typing-name"],[1,"typing-status"],[1,"typing-content"],[1,"typing-dots"],[1,"typing-dot"]],template:function(e,n){e&1&&(m(0,"div",0)(1,"div",1)(2,"div",2),c(3),g(),m(4,"div",3)(5,"span",4),c(6),g(),m(7,"span",5),c(8),g()()(),m(9,"div",6)(10,"div",7),M(11,"span",8)(12,"span",8)(13,"span",8),g()()()),e&2&&(r(2),Y("background-color",n.getPersonaColor()),r(),$(" ",n.getPersonaInitial()," "),r(2),Y("color",n.getPersonaColor()),r(),$(" ",n.getPersonaLabel()," "),r(2),I(n.phase()==="researching"?"istra\u017Euje...":"razmi\u0161lja..."),r(3),Y("background-color",n.getPersonaColor()),r(),Y("background-color",n.getPersonaColor()),r(),Y("background-color",n.getPersonaColor()))},dependencies:[ie],styles:[".typing-card[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:8px;border:1px solid #2a2a2a;overflow:hidden}.typing-header[_ngcontent-%COMP%]{padding:12px 16px;border-bottom:1px solid #2a2a2a;display:flex;align-items:center;gap:12px}.typing-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:13px;font-weight:600}.typing-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.typing-name[_ngcontent-%COMP%]{font-size:13px;font-weight:500}.typing-status[_ngcontent-%COMP%]{font-size:11px;color:#9e9e9e}.typing-content[_ngcontent-%COMP%]{padding:16px}.typing-dots[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.typing-dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;animation:_ngcontent-%COMP%_bounce 1s ease-in-out infinite}.typing-dot[_ngcontent-%COMP%]:nth-child(2){animation-delay:.15s}.typing-dot[_ngcontent-%COMP%]:nth-child(3){animation-delay:.3s}@keyframes _ngcontent-%COMP%_bounce{0%,to{transform:translateY(0)}50%{transform:translateY(-4px)}}"]})};var Qn=class o{http=J(Ee);baseUrl="/api/v1/personas";async getPersonas(){return(await Z(this.http.get(this.baseUrl))).data}async getPersonaByType(t){return(await Z(this.http.get(`${this.baseUrl}/${t}`))).data}static \u0275fac=function(e){return new(e||o)};static \u0275prov=ze({token:o,factory:o.\u0275fac,providedIn:"root"})};var Zl=()=>[1,2,3,4,5,6],Xl=(o,t)=>t.id;function Jl(o,t){o&1&&M(0,"div",3)}function ec(o,t){o&1&&(m(0,"div",1),G(1,Jl,1,0,"div",3,pn),g()),o&2&&(r(),q(Je(0,Zl)))}function tc(o,t){if(o&1&&(m(0,"div",2),S(),m(1,"svg",4),M(2,"path",5),g(),c(3),g()),o&2){let e=s();r(3),$(" ",e.errorMessage$()," ")}}function nc(o,t){if(o&1){let e=E();m(0,"button",8),P("click",function(){let i=x(e).$implicit,a=s(2);return b(a.selectPersona(i))}),m(1,"div",9),c(2),g(),m(3,"span",10),c(4),g(),m(5,"span",11),c(6),g()()}if(o&2){let e,n,i,a,l=t.$implicit,h=s(2);Y("border-color",((e=h.selectedPersona$())==null?null:e.id)===l.id?l.color:"transparent")("background-color",((n=h.selectedPersona$())==null?null:n.id)===l.id?l.color+"15":""),N("selected",((i=h.selectedPersona$())==null?null:i.id)===l.id),r(),Y("background-color",l.color),r(),$(" ",l.shortName.charAt(0)," "),r(),Y("color",((a=h.selectedPersona$())==null?null:a.id)===l.id?l.color:"#FAFAFA"),r(),$(" ",l.shortName," "),r(2),$(" ",h.getShortDescription(l.description)," ")}}function oc(o,t){if(o&1){let e=E();m(0,"button",12),P("click",function(){x(e);let i=s(2);return b(i.clearSelection())}),S(),m(1,"svg",13),M(2,"path",14),g(),c(3),g()}if(o&2){let e=s(2);N("active",!e.selectedPersona$()),r(3),$(" ",e.selectedPersona$()?"Poni\u0161ti izbor":"Persona nije izabrana"," ")}}function ic(o,t){if(o&1&&(m(0,"div",1),G(1,nc,7,13,"button",6,Xl),g(),_(3,oc,4,3,"button",7)),o&2){let e=s();r(),q(e.personas$()),r(2),C(e.allowNone()?3:-1)}}var Zn=class o{personasService=J(Qn);selectedType=R(null);allowNone=R(!0);personaSelected=K();personas$=v([]);selectedPersona$=v(null);isLoading$=v(!0);errorMessage$=v(null);async ngOnInit(){await this.loadPersonas();let t=this.selectedType();if(t){let e=this.personas$().find(n=>n.type===t);e&&this.selectedPersona$.set(e)}}async loadPersonas(){this.isLoading$.set(!0),this.errorMessage$.set(null);try{let t=await this.personasService.getPersonas();this.personas$.set(t)}catch{this.errorMessage$.set("U\u010Ditavanje persona nije uspelo")}finally{this.isLoading$.set(!1)}}selectPersona(t){this.selectedPersona$.set(t),this.personaSelected.emit(t)}clearSelection(){this.selectedPersona$.set(null),this.personaSelected.emit(null)}getShortDescription(t){return t.length<=50?t:t.substring(0,47)+"..."}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-persona-selector"]],inputs:{selectedType:[1,"selectedType"],allowNone:[1,"allowNone"]},outputs:{personaSelected:"personaSelected"},decls:4,vars:1,consts:[[1,"persona-selector"],[1,"persona-grid"],[1,"error-box"],[1,"skeleton-card"],["fill","currentColor","viewBox","0 0 20 20",2,"width","16px","height","16px","flex-shrink","0"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"persona-card",3,"selected","borderColor","backgroundColor"],[1,"clear-btn",3,"active"],[1,"persona-card",3,"click"],[1,"persona-avatar"],[1,"persona-name"],[1,"persona-desc"],[1,"clear-btn",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","16px","height","16px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"]],template:function(e,n){e&1&&(m(0,"div",0),_(1,ec,3,1,"div",1)(2,tc,4,1,"div",2)(3,ic,4,1),g()),e&2&&(r(),C(n.isLoading$()?1:n.errorMessage$()?2:3))},dependencies:[ie],styles:[".persona-selector[_ngcontent-%COMP%]{width:100%}.persona-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}@media(max-width:1024px){.persona-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media(max-width:640px){.persona-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}.skeleton-card[_ngcontent-%COMP%]{height:96px;border-radius:12px;background:#242424;animation:_ngcontent-%COMP%_shimmer 1.5s linear infinite;background-image:linear-gradient(90deg,#242424 25%,#2a2a2a,#242424 75%);background-size:200% 100%}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:200% 0}to{background-position:-200% 0}}.error-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#ef4444;font-size:13px;padding:12px;background:#242424;border-radius:8px}.persona-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:12px;border-radius:12px;border:2px solid transparent;background:#242424;cursor:pointer;transition:all .2s;min-height:96px}.persona-card[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.persona-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:13px;margin-bottom:8px;box-shadow:0 4px 6px #0000004d}.persona-name[_ngcontent-%COMP%]{font-size:13px;font-weight:500;text-align:center;color:#fafafa}.persona-desc[_ngcontent-%COMP%]{font-size:11px;color:#9e9e9e;text-align:center;margin-top:4px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}@media(max-width:640px){.persona-desc[_ngcontent-%COMP%]{display:none}}.clear-btn[_ngcontent-%COMP%]{margin-top:12px;font-size:13px;color:#9e9e9e;background:none;border:none;cursor:pointer;display:flex;align-items:center;gap:6px;transition:color .15s}.clear-btn[_ngcontent-%COMP%]:hover, .clear-btn.active[_ngcontent-%COMP%]{color:#fafafa}"]})};function ac(o,t){if(o&1&&(m(0,"span",1),c(1),g()),o&2){let e=s();Y("background-color",e.getColor()+"30")("color",e.getColor())("border-color",e.getColor()),r(),$(" ",e.getName()," ")}}var Xn=class o{personaType=R(null);getColor(){let t=this.personaType();return t&&Cn[t]||"#6B7280"}getName(){let t=this.personaType();return t?Mt[t]||t:""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-persona-badge"]],inputs:{personaType:[1,"personaType"]},decls:1,vars:1,consts:[[1,"inline-flex","items-center","px-2","py-0.5","rounded-full","text-xs","font-medium",2,"border-width","1px",3,"backgroundColor","color","borderColor"],[1,"inline-flex","items-center","px-2","py-0.5","rounded-full","text-xs","font-medium",2,"border-width","1px"]],template:function(e,n){e&1&&_(0,ac,2,7,"span",0),e&2&&C(n.personaType()?0:-1)},dependencies:[ie],encapsulation:2})};var rc=(o,t)=>t.id;function sc(o,t){if(o&1&&(m(0,"span",15),c(1),g(),m(2,"h2",16),c(3),g()),o&2){let e=s(2);_t(e.getCategoryClass(e.concept$().category)),r(),$(" ",e.concept$().category," "),r(2),I(e.concept$().name)}}function lc(o,t){o&1&&M(0,"div",17)(1,"div",18)}function cc(o,t){if(o&1){let e=E();m(0,"div",9)(1,"p"),c(2),g(),m(3,"button",19),P("click",function(){x(e);let i=s(2);return b(i.loadConcept())}),c(4," Retry "),g()()}if(o&2){let e=s(2);r(2),I(e.error$())}}function dc(o,t){o&1&&M(0,"div",20)(1,"div",21)}function pc(o,t){if(o&1&&(m(0,"div",23)(1,"h3",25),c(2,"Detalji"),g(),M(3,"div",26),g()),o&2){let e=s(3);r(3),B("innerHTML",e.renderMarkdown(e.concept$().extendedDescription),Se)}}function uc(o,t){if(o&1){let e=E();m(0,"button",29),P("click",function(){let i=x(e).$implicit,a=s(4);return b(a.onConceptClicked(i.id))}),c(1),g()}if(o&2){let e=t.$implicit;r(),$(" ",e.name," ")}}function mc(o,t){if(o&1&&(m(0,"div",24)(1,"h3",25),c(2,"Related Concepts"),g(),m(3,"div",27),G(4,uc,2,1,"button",28,rc),g()()),o&2){let e=s(3);r(4),q(e.concept$().relatedConcepts)}}function hc(o,t){if(o&1&&(m(0,"p",22),c(1),g(),_(2,pc,4,1,"div",23),_(3,mc,6,0,"div",24)),o&2){let e=s(2);r(),I(e.concept$().definition),r(),C(e.concept$().extendedDescription?2:-1),r(),C(e.concept$().relatedConcepts.length>0?3:-1)}}function gc(o,t){if(o&1){let e=E();m(0,"div",0),P("click",function(){x(e);let i=s();return b(i.onClose())}),g(),m(1,"div",1)(2,"div",2)(3,"div",3),_(4,sc,4,4)(5,lc,2,0),g(),m(6,"button",4),P("click",function(){x(e);let i=s();return b(i.onClose())}),S(),m(7,"svg",5),M(8,"line",6)(9,"line",7),g()()(),j(),m(10,"div",8),_(11,cc,5,1,"div",9)(12,dc,2,0)(13,hc,4,3),g(),m(14,"div",10)(15,"button",11),P("click",function(){x(e);let i=s();return b(i.onLearnMore())}),c(16," Learn More "),S(),m(17,"svg",12),M(18,"line",13)(19,"polyline",14),g()()()()}if(o&2){let e,n=s();r(),ue("aria-label",(e=n.concept$())!=null&&e.name?"Concept: "+((e=n.concept$())==null?null:e.name):"Loading concept"),r(3),C(n.concept$()?4:n.isLoading$()?5:-1),r(7),C(n.error$()?11:n.isLoading$()?12:n.concept$()?13:-1),r(4),B("disabled",!n.concept$())}}var Jn=class o{http=J(Ee);sanitizer=J(ji);conceptId=R(null);isOpen=R(!1);close=K();conceptClick=K();learnMore=K();concept$=v(null);isLoading$=v(!1);error$=v(null);constructor(){dn(()=>{this.conceptId()&&this.isOpen()&&this.loadConcept()})}async loadConcept(){let t=this.conceptId();if(t){this.isLoading$.set(!0),this.error$.set(null);try{let e=await Z(this.http.get(`/api/v1/knowledge/concepts/${t}/summary`));e?.data&&this.concept$.set(e.data)}catch(e){let n=e instanceof Error?e.message:"Unknown error";this.error$.set(`Failed to load concept details: ${n}`)}finally{this.isLoading$.set(!1)}}}getCategoryClass(t){return t?t.toLowerCase():""}onClose(){this.close.emit()}onConceptClicked(t){this.conceptClick.emit(t)}renderMarkdown(t){let e=H.parse(t,{async:!1});return this.sanitizer.bypassSecurityTrustHtml(e)}onLearnMore(){let t=this.concept$();t&&this.learnMore.emit(t.id)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-concept-panel"]],inputs:{conceptId:[1,"conceptId"],isOpen:[1,"isOpen"]},outputs:{close:"close",conceptClick:"conceptClick",learnMore:"learnMore"},decls:1,vars:1,consts:[["role","presentation",1,"panel-backdrop",3,"click"],["role","dialog","aria-modal","true",1,"concept-panel"],[1,"panel-header"],[1,"header-content"],["type","button","aria-label","Close panel",1,"close-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"panel-content"],[1,"error-message"],[1,"panel-footer"],["type","button",1,"learn-more-button",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","5","y1","12","x2","19","y2","12"],["points","12 5 19 12 12 19"],[1,"category-badge"],[1,"concept-name"],[1,"skeleton","skeleton-badge"],[1,"skeleton","skeleton-title"],["type","button",1,"retry-button",3,"click"],[1,"skeleton","skeleton-text"],[1,"skeleton","skeleton-text","short"],[1,"definition"],[1,"extended-section"],[1,"related-section"],[1,"section-title"],[1,"extended-text",3,"innerHTML"],[1,"related-chips"],["type","button",1,"related-chip"],["type","button",1,"related-chip",3,"click"]],template:function(e,n){e&1&&_(0,gc,20,4),e&2&&C(n.isOpen()?0:-1)},dependencies:[ie],styles:[".panel-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:40}.concept-panel[_ngcontent-%COMP%]{position:fixed;top:0;right:0;height:100vh;width:320px;max-width:90vw;background:#0a0a0a;border-left:1px solid #262626;display:flex;flex-direction:column;z-index:50;animation:_ngcontent-%COMP%_slideIn .2s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%)}to{transform:translate(0)}}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;padding:1rem;border-bottom:1px solid #262626}.header-content[_ngcontent-%COMP%]{flex:1;min-width:0}.category-badge[_ngcontent-%COMP%]{display:inline-block;padding:.125rem .5rem;font-size:.75rem;font-weight:500;border-radius:9999px;background:#1a1a1a;color:#a3a3a3;margin-bottom:.5rem}.category-badge.finance[_ngcontent-%COMP%]{background:#10b98120;color:#10b981}.category-badge.marketing[_ngcontent-%COMP%]{background:#f59e0b20;color:#f59e0b}.category-badge.technology[_ngcontent-%COMP%]{background:#3b82f620;color:#3b82f6}.category-badge.operations[_ngcontent-%COMP%]{background:#8b5cf620;color:#8b5cf6}.category-badge.legal[_ngcontent-%COMP%]{background:#6b728020;color:#6b7280}.category-badge.creative[_ngcontent-%COMP%]{background:#ec489920;color:#ec4899}.concept-name[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#f5f5f5;margin:0;line-height:1.4}.close-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:transparent;border:none;color:#737373;cursor:pointer;border-radius:.375rem;transition:all .15s ease;flex-shrink:0;margin-left:.5rem}.close-button[_ngcontent-%COMP%]:hover{background:#262626;color:#e5e5e5}.panel-content[_ngcontent-%COMP%]{flex:1;padding:1rem;overflow-y:auto}.definition[_ngcontent-%COMP%]{color:#d4d4d4;line-height:1.6;margin:0 0 1.5rem}.extended-section[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1rem;border-top:1px solid #262626}.extended-text[_ngcontent-%COMP%]{color:#b0b0b0;font-size:.875rem;line-height:1.7}.extended-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:10px 0}.extended-text[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .extended-text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .extended-text[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#e0e0e0;margin:16px 0 8px}.extended-text[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .extended-text[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{padding-left:1.5em;margin:8px 0}.extended-text[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:4px 0}.extended-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#e5e5e5}.related-section[_ngcontent-%COMP%]{margin-top:1.5rem}.section-title[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#737373;margin:0 0 .75rem;text-transform:uppercase;letter-spacing:.05em}.related-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.related-chip[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.875rem;background:#1a1a1a;border:1px solid #333;color:#a3a3a3;border-radius:9999px;cursor:pointer;transition:all .15s ease}.related-chip[_ngcontent-%COMP%]:hover{background:#262626;border-color:#525252;color:#e5e5e5}.panel-footer[_ngcontent-%COMP%]{padding:1rem;border-top:1px solid #262626}.learn-more-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;width:100%;padding:.75rem;font-size:.875rem;font-weight:500;background:#262626;border:1px solid #333;color:#e5e5e5;border-radius:.5rem;cursor:pointer;transition:all .15s ease}.learn-more-button[_ngcontent-%COMP%]:hover:not(:disabled){background:#333;border-color:#525252}.learn-more-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.error-message[_ngcontent-%COMP%]{text-align:center;color:#ef4444;padding:2rem}.retry-button[_ngcontent-%COMP%]{margin-top:1rem;padding:.5rem 1rem;background:#262626;border:1px solid #333;color:#e5e5e5;border-radius:.375rem;cursor:pointer}.skeleton[_ngcontent-%COMP%]{background:linear-gradient(90deg,#1a1a1a 25%,#262626,#1a1a1a 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite;border-radius:.25rem}.skeleton-badge[_ngcontent-%COMP%]{width:80px;height:20px;margin-bottom:.5rem}.skeleton-title[_ngcontent-%COMP%]{width:180px;height:24px}.skeleton-text[_ngcontent-%COMP%]{width:100%;height:16px;margin-bottom:.75rem}.skeleton-text.short[_ngcontent-%COMP%]{width:75%}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:200% 0}to{background-position:-200% 0}}"],changeDetection:0})};var fc=()=>[1,2,3];function _c(o,t){return this.trackRow(t)}var Cc=(o,t)=>t.id;function xc(o,t){if(o&1){let e=E();m(0,"button",8),P("click",function(){x(e);let i=s();return b(i.clearSearch())}),S(),m(1,"svg",9),M(2,"path",10),g()()}}function bc(o,t){o&1&&(m(0,"div",11),M(1,"div",12)(2,"div",13)(3,"div",14),g())}function vc(o,t){o&1&&(m(0,"div",7),G(1,bc,4,0,"div",11,pn),g()),o&2&&(r(),q(Je(0,fc)))}function kc(o,t){if(o&1&&M(0,"span",30),o&2){let e=s(2).$implicit;N("completed",e.node.status==="completed")("pending",e.node.status==="pending"),B("title",e.node.status==="completed"?"Zavr\u0161eno":"Na \u010Dekanju")}}function yc(o,t){o&1&&M(0,"span",25)}function wc(o,t){if(o&1&&(m(0,"span",26),c(1),g()),o&2){let e=s(2).$implicit;B("title",e.node.completedByUserId),r(),I(e.node.completedByUserId)}}function Sc(o,t){if(o&1&&(m(0,"span",27),c(1),g()),o&2){let e=s(2).$implicit;r(),I(e.node.conversationCount)}}function Ec(o,t){if(o&1){let e=E();m(0,"button",31),P("click",function(i){x(e);let a=s(2).$implicit,l=s(2);return b(l.onViewLinkedConversation(i,a.node.linkedConversationId))}),S(),m(1,"svg",32),M(2,"path",33)(3,"path",34),g()()}}function Tc(o,t){if(o&1){let e=E();m(0,"button",31),P("click",function(i){x(e);let a=s(2).$implicit,l=s(2);return b(l.onViewConversation(i,a.node))}),S(),m(1,"svg",32),M(2,"path",33)(3,"path",34),g()()}}function Pc(o,t){if(o&1){let e=E();m(0,"button",35),P("click",function(i){x(e);let a=s(2).$implicit,l=s(2);return b(l.onNewChat(i,a.node.curriculumId,a.node.label))}),S(),m(1,"svg",32),M(2,"path",36),g()()}}function Mc(o,t){if(o&1){let e=E();m(0,"button",20),P("click",function(){x(e);let i=s().$implicit,a=s(2);return b(a.toggleNode(i.node.curriculumId))}),S(),m(1,"svg",21),P("click",function(i){x(e);let a=s().$implicit;return s(2).toggleNode(a.node.curriculumId),b(i.stopPropagation())}),M(2,"path",22),g(),_(3,kc,1,5,"span",23),j(),m(4,"span",24),P("click",function(i){x(e);let a=s().$implicit,l=s(2);return b(l.onNodeClick(i,a.node))}),c(5),g(),_(6,yc,1,0,"span",25),_(7,wc,2,2,"span",26),_(8,Sc,2,1,"span",27),_(9,Ec,4,0,"button",28)(10,Tc,4,0,"button",28),_(11,Pc,3,0,"button",29),g()}if(o&2){let e=s().$implicit,n=s(2);Y("padding-left",12+e.depth*16,"px"),N("root-node",e.depth===0),ue("aria-expanded",n.expandedNodes().has(e.node.curriculumId))("aria-label",e.node.label+(e.node.status==="completed"?" \u2014 zavr\u0161eno":e.node.status==="pending"?" \u2014 na \u010Dekanju":"")),r(),N("expanded",n.expandedNodes().has(e.node.curriculumId)),r(2),C(e.node.status?3:-1),r(2),I(e.node.label),r(),C(n.hasNewConversations(e.node.curriculumId)?6:-1),r(),C(e.node.completedByUserId?7:-1),r(),C(e.node.conversationCount>0?8:-1),r(),C(e.node.linkedConversationId?9:e.node.conversations.length>0?10:-1),r(2),C(e.node.conceptId?11:-1)}}function Ic(o,t){o&1&&M(0,"span",39)}function $c(o,t){o&1&&M(0,"span",25)}function Oc(o,t){if(o&1){let e=E();m(0,"button",37),P("click",function(){x(e);let i=s().$implicit,a=s(2);return b(a.onConversationSelect(i.conversation.id))}),m(1,"div",38),_(2,Ic,1,0,"span",39)(3,$c,1,0,"span",25),m(4,"div",40),c(5),g()(),m(6,"div",41),c(7),g()()}if(o&2){let e=s().$implicit,n=s(2);Y("padding-left",12+e.depth*16,"px"),N("active",n.activeConversationId()===e.conversation.id)("tree-item-loading",n.loadingItemId()===e.conversation.id),r(2),C(n.loadingItemId()===e.conversation.id?2:n.newConversationIds().has(e.conversation.id)?3:-1),r(3),$(" ",e.conversation.title||"Bez naslova"," "),r(2),I(n.formatDate(e.conversation.updatedAt))}}function Nc(o,t){if(o&1&&(_(0,Mc,12,15,"button",18),_(1,Oc,8,9,"button",19)),o&2){let e=t.$implicit;C(e.type==="node"&&e.node?0:-1),r(),C(e.type==="conversation"&&e.conversation?1:-1)}}function Ac(o,t){if(o&1&&(m(0,"div",15),c(1),g()),o&2){let e=s(2);r(),$('Nema rezultata za "',e.searchQuery(),'"')}}function Dc(o,t){if(o&1){let e=E();m(0,"button",45),P("click",function(){let i=x(e).$implicit,a=s(4);return b(a.onConversationSelect(i.id))}),m(1,"div",46),c(2),g(),m(3,"div",41),c(4),g()()}if(o&2){let e=t.$implicit,n=s(4);N("active",n.activeConversationId()===e.id),r(2),I(e.title||"Konverzacija bez naslova"),r(2),I(n.formatDate(e.updatedAt))}}function Rc(o,t){if(o&1&&G(0,Dc,5,4,"button",44,Cc),o&2){let e=s(3);q(e.treeData$().uncategorized)}}function zc(o,t){if(o&1){let e=E();m(0,"div",16)(1,"button",42),P("click",function(){x(e);let i=s(2);return b(i.toggleGeneral())}),S(),m(2,"svg",43),M(3,"path",22),g(),c(4," Op\u0161te "),j(),m(5,"span",27),c(6),g()(),_(7,Rc,2,0),g()}if(o&2){let e=s(2);r(2),N("expanded",e.generalExpanded()),r(4),I(e.treeData$().uncategorized.length),r(),C(e.generalExpanded()?7:-1)}}function Lc(o,t){o&1&&(m(0,"div",17)(1,"div",47),S(),m(2,"svg",48),M(3,"path",49),g()(),j(),m(4,"p",50),c(5,"Jo\u0161 nema konverzacija"),g(),m(6,"p",51),c(7," Zapo\u010Dnite novu konverzaciju iznad "),g()())}function Fc(o,t){if(o&1&&(G(0,Nc,2,2,null,null,_c,!0),_(2,Ac,2,1,"div",15),_(3,zc,8,4,"div",16),_(4,Lc,8,0,"div",17)),o&2){let e=s();q(e.flatRows()),r(2),C(e.searchQuery()&&e.flatRows().length===0?2:-1),r(),C(!e.searchQuery()&&e.treeData$().uncategorized.length>0?3:-1),r(),C(!e.searchQuery()&&e.treeData$().tree.length===0&&e.treeData$().uncategorized.length===0?4:-1)}}var Kt=class o{conversationService=J(xt);activeConversationId=R(null);locked=R(!1);newConversationIds=R(new Set);loadingItemId=R(null);conversationSelected=K();newChatRequested=K();conceptSelected=K();treeData$=v(null);isLoading$=v(!1);expandedNodes=v(new Set);generalExpanded=v(!0);flatRows=v([]);searchQuery=v("");searchTimeout=null;ngOnInit(){this.loadTree()}async loadTree(){this.isLoading$.set(!0);try{let t=await this.conversationService.getBrainTree();this.treeData$.set(t);let e=new Set;this.collectAllIds(t.tree,e),this.expandedNodes.set(e),this.rebuildFlatRows()}catch{}finally{this.isLoading$.set(!1)}}toggleNode(t){this.expandedNodes.update(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n}),this.rebuildFlatRows()}toggleGeneral(){this.generalExpanded.update(t=>!t)}onSearchInput(t){let e=t.target.value;this.searchQuery.set(e),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>this.rebuildFlatRows(),200)}clearSearch(){this.searchQuery.set(""),this.rebuildFlatRows()}onConversationSelect(t){this.conversationSelected.emit(t)}onNewChat(t,e,n){t.stopPropagation(),this.newChatRequested.emit({conceptId:e,conceptName:n})}onViewConversation(t,e){t.stopPropagation();let n=[...e.conversations].sort((i,a)=>new Date(a.updatedAt).getTime()-new Date(i.updatedAt).getTime());n[0]&&this.conversationSelected.emit(n[0].id)}onViewLinkedConversation(t,e){t.stopPropagation(),this.conversationSelected.emit(e)}onNodeClick(t,e){if(t.stopPropagation(),e.conceptId)this.conceptSelected.emit({conceptId:e.conceptId,curriculumId:e.curriculumId,conceptName:e.label,isFolder:!1,descendantConceptIds:[e.conceptId],descendantConversationIds:e.conversations.map(n=>n.id)}),this.expandedNodes().has(e.curriculumId)||this.toggleNode(e.curriculumId);else{let n=this.collectDescendantConceptIds(e),i=this.collectDescendantConversationIds(e);this.conceptSelected.emit({conceptId:null,curriculumId:e.curriculumId,conceptName:e.label,isFolder:!0,descendantConceptIds:n,descendantConversationIds:i}),this.expandedNodes().has(e.curriculumId)||this.toggleNode(e.curriculumId)}}collectDescendantConceptIds(t){let e=[];t.conceptId&&e.push(t.conceptId);for(let n of t.children)e.push(...this.collectDescendantConceptIds(n));return e}collectDescendantConversationIds(t){let e=[];for(let n of t.conversations)e.push(n.id);for(let n of t.children)e.push(...this.collectDescendantConversationIds(n));return e}hasNewConversations(t){let e=this.newConversationIds();if(e.size===0)return!1;let n=this.treeData$();return n?this.checkNodeForNew(n.tree,t,e):!1}checkNodeForNew(t,e,n){for(let i of t){if(i.curriculumId===e)return i.conversations.some(l=>n.has(l.id))||this.anyDescendantHasNew(i.children,n);if(this.checkNodeForNew(i.children,e,n))return!0}return!1}anyDescendantHasNew(t,e){for(let n of t)if(n.conversations.some(i=>e.has(i.id))||this.anyDescendantHasNew(n.children,e))return!0;return!1}trackRow(t){return t.type==="node"&&t.node?`node-${t.node.curriculumId}`:t.type==="conversation"&&t.conversation?`conv-${t.conversation.id}`:`${t.type}-${t.depth}`}formatDate(t){let e=new Date(t),i=new Date().getTime()-e.getTime(),a=Math.floor(i/6e4),l=Math.floor(i/36e5),h=Math.floor(i/864e5);return a<1?"Upravo":a<60?`pre ${a} min`:l<24?`pre ${l} \u010D`:h<7?`pre ${h} d`:e.toLocaleDateString("sr-Latn")}collectAllIds(t,e){for(let n of t)e.add(n.curriculumId),this.collectAllIds(n.children,e)}rebuildFlatRows(){let t=this.treeData$();if(!t){this.flatRows.set([]);return}let e=this.searchQuery().toLowerCase().trim();if(e){let n=[];this.searchTree(t.tree,e,n);for(let i of t.uncategorized)(i.title||"").toLowerCase().includes(e)&&n.push({type:"general-conv",depth:0,conversation:i});this.flatRows.set(n)}else{let n=[],i=this.expandedNodes();this.flattenTree(t.tree,0,n,i),this.flatRows.set(n)}}searchTree(t,e,n){for(let i of t){if(i.label.toLowerCase().includes(e)){n.push({type:"node",depth:0,node:i,curriculumId:i.curriculumId});for(let a of i.conversations)n.push({type:"conversation",depth:1,conversation:a,curriculumId:i.curriculumId})}else for(let a of i.conversations)(a.title||"").toLowerCase().includes(e)&&n.push({type:"conversation",depth:0,conversation:a,curriculumId:i.curriculumId});this.searchTree(i.children,e,n)}}flattenTree(t,e,n,i){for(let a of t)if(n.push({type:"node",depth:e,node:a,curriculumId:a.curriculumId}),i.has(a.curriculumId)){this.flattenTree(a.children,e+1,n,i);for(let l of a.conversations)n.push({type:"conversation",depth:e+1,conversation:l,curriculumId:a.curriculumId})}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-concept-tree"]],inputs:{activeConversationId:[1,"activeConversationId"],locked:[1,"locked"],newConversationIds:[1,"newConversationIds"],loadingItemId:[1,"loadingItemId"]},outputs:{conversationSelected:"conversationSelected",newChatRequested:"newChatRequested",conceptSelected:"conceptSelected"},decls:9,vars:5,consts:[[1,"search-box"],[1,"search-wrapper"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"search-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["placeholder","Pretra\u017Ei koncepte...","role","searchbox","aria-label","Pretra\u017Ei koncepte",1,"search-input",3,"input","value"],["title","Obri\u0161i pretragu",1,"search-clear"],["role","tree","aria-label","Stablo koncepata",1,"tree-container"],[2,"padding","0 12px"],["title","Obri\u0161i pretragu",1,"search-clear",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[2,"padding","6px 0"],[1,"skeleton",2,"width","50%"],[1,"skeleton",2,"width","70%","margin-left","16px"],[1,"skeleton",2,"width","80%","margin-left","32px"],[1,"search-no-results"],[1,"general-section"],[1,"empty-state"],["role","treeitem",1,"tree-node",3,"root-node","padding-left"],[1,"conversation-item",3,"active","tree-item-loading","padding-left"],["role","treeitem",1,"tree-node",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"chevron",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"status-dot",3,"completed","pending","title"],[1,"node-label","clickable",3,"click"],[1,"new-badge"],[1,"attribution",3,"title"],[1,"node-count"],["title","Pogledaj",1,"view-btn"],["title","Istra\u017Ei",1,"add-btn"],[1,"status-dot",3,"title"],["title","Pogledaj",1,"view-btn",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","14px","height","14px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],["title","Istra\u017Ei",1,"add-btn",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"conversation-item",3,"click"],[2,"display","flex","align-items","center","gap","6px"],[1,"tree-item-spinner"],[1,"conv-title",2,"flex","1"],[1,"conv-meta"],[1,"general-header",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"chevron",2,"width","12px","height","12px"],[1,"general-item",3,"active"],[1,"general-item",3,"click"],[1,"conv-title"],[1,"empty-icon"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","24px","height","24px","color","#9e9e9e"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],[2,"font-size","13px","color","#9e9e9e"],[2,"font-size","11px","color","#9e9e9e","margin-top","4px"]],template:function(e,n){e&1&&(m(0,"div",0)(1,"div",1),S(),m(2,"svg",2),M(3,"path",3),g(),j(),m(4,"input",4),P("input",function(a){return n.onSearchInput(a)}),g()(),_(5,xc,3,0,"button",5),g(),m(6,"div",6),_(7,vc,3,1,"div",7)(8,Fc,5,3),g()),e&2&&(r(4),B("value",n.searchQuery()),r(),C(n.searchQuery()?5:-1),r(),N("locked",n.locked()),r(),C(n.isLoading$()?7:n.treeData$()?8:-1))},dependencies:[ie],styles:["[_nghost-%COMP%]{display:block;flex:1;overflow-y:auto}.search-box[_ngcontent-%COMP%]{position:sticky;top:0;z-index:2;padding:8px;background:#0d0d0d;border-bottom:1px solid #2a2a2a;display:flex;align-items:center;gap:8px}.search-wrapper[_ngcontent-%COMP%]{position:relative;flex:1}.search-icon[_ngcontent-%COMP%]{position:absolute;left:8px;top:50%;transform:translateY(-50%);width:14px;height:14px;color:#707070;pointer-events:none}.search-input[_ngcontent-%COMP%]{width:100%;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:6px 8px 6px 28px;color:#fafafa;font-size:12px;font-family:inherit}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.search-input[_ngcontent-%COMP%]::placeholder{color:#707070}.search-clear[_ngcontent-%COMP%]{background:none;border:none;padding:2px;color:#707070;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}.search-clear[_ngcontent-%COMP%]:hover{color:#fafafa}.search-clear[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.search-no-results[_ngcontent-%COMP%]{padding:24px 12px;text-align:center;font-size:12px;color:#9e9e9e}.tree-container[_ngcontent-%COMP%]{padding:4px 0;transition:opacity .2s}.tree-container.locked[_ngcontent-%COMP%]{pointer-events:none;opacity:.5}.tree-node[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:5px 8px;cursor:pointer;font-size:12px;font-weight:500;color:#a1a1a1;border-radius:4px;margin:0 4px;background:none;border:none;width:calc(100% - 8px);text-align:left}.tree-node[_ngcontent-%COMP%]:hover{background:#1a1a1a;color:#fafafa}.tree-node.root-node[_ngcontent-%COMP%]{font-size:11px;font-weight:600;color:#9e9e9e;text-transform:uppercase;letter-spacing:.5px}.chevron[_ngcontent-%COMP%]{width:10px;height:10px;transition:transform .15s;flex-shrink:0}.chevron.expanded[_ngcontent-%COMP%]{transform:rotate(90deg)}.node-label[_ngcontent-%COMP%]{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.node-count[_ngcontent-%COMP%]{margin-left:auto;font-size:10px;color:#707070;flex-shrink:0}.add-btn[_ngcontent-%COMP%], .view-btn[_ngcontent-%COMP%]{width:16px;height:16px;color:#707070;opacity:0;transition:opacity .15s;cursor:pointer;flex-shrink:0;background:none;border:none;padding:0}.tree-node[_ngcontent-%COMP%]:hover   .add-btn[_ngcontent-%COMP%], .tree-node[_ngcontent-%COMP%]:hover   .view-btn[_ngcontent-%COMP%]{opacity:1}.add-btn[_ngcontent-%COMP%]:hover{color:#3b82f6}.view-btn[_ngcontent-%COMP%]:hover{color:#10b981}.conversation-item[_ngcontent-%COMP%]{display:block;width:calc(100% - 8px);padding:6px 12px;margin:0 4px 2px;border-radius:4px;cursor:pointer;background:none;border:none;text-align:left;color:inherit}.conversation-item[_ngcontent-%COMP%]:hover{background:#1a1a1a}.conversation-item.active[_ngcontent-%COMP%]{background:#1a1a1a;border-left:2px solid #3b82f6}.conv-title[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.conversation-item.active[_ngcontent-%COMP%]   .conv-title[_ngcontent-%COMP%]{color:#fafafa}.conv-meta[_ngcontent-%COMP%]{font-size:10px;color:#707070;margin-top:2px}.general-section[_ngcontent-%COMP%]{margin-top:4px;border-top:1px solid #2a2a2a;padding-top:4px}.general-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:6px 12px;cursor:pointer;font-size:11px;font-weight:600;color:#9e9e9e;text-transform:uppercase;letter-spacing:.5px;background:none;border:none;width:100%;text-align:left}.general-header[_ngcontent-%COMP%]:hover{color:#a1a1a1}.general-item[_ngcontent-%COMP%]{display:block;width:calc(100% - 8px);padding:6px 12px 6px 24px;margin:0 4px 2px;border-radius:4px;cursor:pointer;background:none;border:none;text-align:left;color:inherit}.general-item[_ngcontent-%COMP%]:hover{background:#1a1a1a}.general-item.active[_ngcontent-%COMP%]{background:#1a1a1a;border-left:2px solid #3b82f6}.general-item.active[_ngcontent-%COMP%]   .conv-title[_ngcontent-%COMP%]{color:#fafafa}.skeleton[_ngcontent-%COMP%]{background:linear-gradient(90deg,#1a1a1a 25%,#242424,#1a1a1a 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite;height:14px;border-radius:4px;margin-bottom:6px}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:200% 0}to{background-position:-200% 0}}.new-badge[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;background:#3b82f6;flex-shrink:0}.status-dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;flex-shrink:0}.status-dot.completed[_ngcontent-%COMP%]{background:#10b981}.status-dot.pending[_ngcontent-%COMP%]{background:#f59e0b}.attribution[_ngcontent-%COMP%]{font-size:9px;color:#9e9e9e;margin-left:4px;flex-shrink:0;max-width:60px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.node-label.clickable[_ngcontent-%COMP%]{cursor:pointer}.node-label.clickable[_ngcontent-%COMP%]:hover{color:#3b82f6}.tree-item-loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.tree-item-spinner[_ngcontent-%COMP%]{display:inline-block;width:12px;height:12px;border:2px solid #2a2a2a;border-top-color:#3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_shimmer-spin .8s linear infinite;flex-shrink:0}@keyframes _ngcontent-%COMP%_shimmer-spin{to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{padding:32px 12px;text-align:center}.empty-icon[_ngcontent-%COMP%]{width:48px;height:48px;margin:0 auto 12px;background:#1a1a1a;border-radius:50%;display:flex;align-items:center;justify-content:center}"],changeDetection:0})};function Vc(o,t){o&1&&(p(0,"span",9),c(1,"*"),u())}function Bc(o,t){if(o&1&&(p(0,"label",8),c(1),_(2,Vc,2,0,"span",9),u()),o&2){let e=s();N("text-destructive",e.state()==="error"),V("for",e.inputId()),r(),$(" ",e.label()," "),r(),C(e.required()?2:-1)}}function jc(o,t){o&1&&(S(),p(0,"svg",11),T(1,"path",12),u())}function Wc(o,t){o&1&&(S(),p(0,"svg",11),T(1,"path",13)(2,"path",14),u())}function Hc(o,t){if(o&1){let e=E();p(0,"button",10),O("click",function(){x(e);let i=s();return b(i.togglePasswordVisibility())}),_(1,jc,2,0,":svg:svg",11)(2,Wc,3,0,":svg:svg",11),u()}if(o&2){let e=s();ue("aria-label",e.showPassword()?"Hide password":"Show password"),r(),C(e.showPassword()?1:2)}}function Uc(o,t){if(o&1&&(p(0,"p",5),c(1),u()),o&2){let e=s();V("id",e.helperId()),r(),$(" ",e.helperText()," ")}}function Gc(o,t){if(o&1&&(p(0,"p",6),c(1),u()),o&2){let e=s();V("id",e.errorId()),r(),$(" ",e.errorMessage()," ")}}function qc(o,t){if(o&1&&(p(0,"p",7),c(1),u()),o&2){let e=s();V("id",e.successId()),r(),$(" ",e.successMessage()," ")}}var tr=class o{static idCounter=0;type=R("text");label=R("");placeholder=R("");disabled=R(!1);readonly=R(!1);required=R(!1);state=R("default");helperText=R("");errorMessage=R("");successMessage=R("");ariaLabel=R("");autocomplete=R("off");showPassword=v(!1);inputId=v(`ui-input-${++o.idCounter}`);_formDisabled=v(!1);internalValue="";isDisabled=X(()=>this.disabled()||this._formDisabled());valueChange=K();inputFocus=K();inputBlur=K();onChange=()=>{};onTouched=()=>{};helperId=X(()=>`${this.inputId()}-helper`);errorId=X(()=>`${this.inputId()}-error`);successId=X(()=>`${this.inputId()}-success`);describedBy=X(()=>{let t=[];return this.helperText()&&this.state()!=="error"&&t.push(this.helperId()),this.errorMessage()&&this.state()==="error"&&t.push(this.errorId()),this.successMessage()&&this.state()==="success"&&t.push(this.successId()),t.length>0?t.join(" "):null});currentType=X(()=>this.type()==="password"?this.showPassword()?"text":"password":this.type());inputClasses=X(()=>{let t=["flex","h-10","w-full","rounded-lg","border","bg-transparent","px-3","py-2","text-sm","transition-colors","file:border-0","file:bg-transparent","file:text-sm","file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-ring","focus-visible:ring-offset-2","focus-visible:ring-offset-background","disabled:cursor-not-allowed","disabled:opacity-50"].join(" "),e={default:"border-input",error:"border-destructive focus-visible:ring-destructive",success:"border-green-500 focus-visible:ring-green-500"},n=this.type()==="password"?"pr-10":"";return`${t} ${e[this.state()]} ${n}`});togglePasswordVisibility(){this.showPassword.update(t=>!t)}onValueChange(t){this.internalValue=t,this.onChange(t),this.valueChange.emit(t)}onFocus(){this.inputFocus.emit()}writeValue(t){this.internalValue=t??""}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._formDisabled.set(t)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["ui-input"]],inputs:{type:[1,"type"],label:[1,"label"],placeholder:[1,"placeholder"],disabled:[1,"disabled"],readonly:[1,"readonly"],required:[1,"required"],state:[1,"state"],helperText:[1,"helperText"],errorMessage:[1,"errorMessage"],successMessage:[1,"successMessage"],ariaLabel:[1,"ariaLabel"],autocomplete:[1,"autocomplete"]},outputs:{valueChange:"valueChange",inputFocus:"inputFocus",inputBlur:"inputBlur"},features:[Bi([{provide:Yi,useExisting:Ni(()=>o),multi:!0}])],decls:8,vars:18,consts:[[1,"flex","flex-col","gap-1.5"],[1,"text-sm","font-medium","leading-none","peer-disabled:cursor-not-allowed","peer-disabled:opacity-70",3,"for","text-destructive"],[1,"relative"],[3,"ngModelChange","blur","focus","id","type","placeholder","disabled","readonly","required","ngModel"],["type","button",1,"absolute","right-3","top-1/2","-translate-y-1/2","text-muted-foreground","hover:text-foreground"],[1,"text-sm","text-muted-foreground",3,"id"],["role","alert",1,"text-sm","text-destructive",3,"id"],[1,"text-sm","text-green-500",3,"id"],[1,"text-sm","font-medium","leading-none","peer-disabled:cursor-not-allowed","peer-disabled:opacity-70",3,"for"],["aria-hidden","true",1,"text-destructive"],["type","button",1,"absolute","right-3","top-1/2","-translate-y-1/2","text-muted-foreground","hover:text-foreground",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"]],template:function(e,n){e&1&&(p(0,"div",0),_(1,Bc,3,5,"label",1),p(2,"div",2)(3,"input",3),fn("ngModelChange",function(a){return gn(n.internalValue,a)||(n.internalValue=a),a}),O("ngModelChange",function(a){return n.onValueChange(a)})("blur",function(){return n.onTouched()})("focus",function(){return n.onFocus()}),u(),_(4,Hc,3,2,"button",4),u(),_(5,Uc,2,2,"p",5),_(6,Gc,2,2,"p",6),_(7,qc,2,2,"p",7),u()),e&2&&(r(),C(n.label()?1:-1),r(2),_t(n.inputClasses()),V("id",n.inputId())("type",n.currentType())("placeholder",n.placeholder())("disabled",n.isDisabled())("readonly",n.readonly())("required",n.required()),hn("ngModel",n.internalValue),ue("aria-invalid",n.state()==="error")("aria-describedby",n.describedBy())("aria-label",n.ariaLabel()||n.label())("autocomplete",n.autocomplete()),r(),C(n.type()==="password"?4:-1),r(),C(n.helperText()&&n.state()!=="error"?5:-1),r(),C(n.errorMessage()&&n.state()==="error"?6:-1),r(),C(n.successMessage()&&n.state()==="success"?7:-1))},dependencies:[ie,Ct,xn,bn,Ki,vn],styles:["[_nghost-%COMP%]{display:block}"]})};var eo=new H.Renderer,Yc=eo.link.bind(eo);eo.link=o=>Yc(o).replace("<a ",'<a target="_blank" rel="noopener noreferrer" ');var nr={gfm:!0,breaks:!0,renderer:eo},or={ADD_ATTR:["target","rel","class"],ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","strong","em","del","s","ul","ol","li","a","code","pre","blockquote","table","thead","tbody","tr","th","td","span","div","img"]};function ii(){H.setOptions(nr)}function ai(o){let t=H.parse(o,{async:!1});return jn.sanitize(t,or)}ii();var Qt=class o{transform(t){return t?ai(t):""}static \u0275fac=function(e){return new(e||o)};static \u0275pipe=Fi({name:"markdown",type:o,pure:!0})};var Kc=(o,t)=>t.taskId,ri=(o,t)=>t.id;function Qc(o,t){o&1&&(m(0,"span",24),c(1,"\u25CF"),g())}function Zc(o,t){o&1&&M(0,"span",25)}function Xc(o,t){o&1&&M(0,"span",25)}function Jc(o,t){o&1&&M(0,"span",25)}function ed(o,t){o&1&&M(0,"span",25)}function td(o,t){o&1&&(m(0,"span",26),c(1,"\u2713"),g())}function nd(o,t){o&1&&(m(0,"span",27),c(1,"\u2717"),g())}function od(o,t){o&1&&c(0," U redu... ")}function id(o,t){o&1&&c(0," Generisanje plana... ")}function ad(o,t){if(o&1&&c(0),o&2){let e=s().$implicit;me(" Korak ",e.currentStep,"/",e.totalSteps," ")}}function rd(o,t){o&1&&c(0," Sinteza... ")}function sd(o,t){o&1&&c(0," Ocenjivanje... ")}function ld(o,t){if(o&1&&(m(0,"span",32),c(1),g()),o&2){let e=s(2).$implicit;N("score-high",e.score>=80)("score-mid",e.score>=50&&e.score<80)("score-low",e.score<50),r(),$(" ",e.score," ")}}function cd(o,t){o&1&&c(0," Gotovo ")}function dd(o,t){if(o&1&&_(0,ld,2,7,"span",31)(1,cd,1,0),o&2){let e=s().$implicit;C(e.score!=null?0:1)}}function pd(o,t){if(o&1&&(m(0,"span",30),c(1),g()),o&2){let e=s().$implicit;r(),I(e.error??"Gre\u0161ka")}}function ud(o,t){if(o&1&&(m(0,"div",22)(1,"span",23),_(2,Qc,2,0,"span",24)(3,Zc,1,0,"span",25)(4,Xc,1,0,"span",25)(5,Jc,1,0,"span",25)(6,ed,1,0,"span",25)(7,td,2,0,"span",26)(8,nd,2,0,"span",27),g(),m(9,"span",28),c(10),g(),m(11,"span",29),_(12,od,1,0)(13,id,1,0)(14,ad,1,2)(15,rd,1,0)(16,sd,1,0)(17,dd,2,1)(18,pd,2,1,"span",30),g()()),o&2){let e,n,i=t.$implicit;N("mission-task-done",i.status==="completed")("mission-task-failed",i.status==="failed"),r(2),C((e=i.status)==="queued"?2:e==="running-workflow"?3:e==="running-steps"?4:e==="synthesizing"?5:e==="scoring"?6:e==="completed"?7:e==="failed"?8:-1),r(8),I(i.title),r(2),C((n=i.status)==="queued"?12:n==="running-workflow"?13:n==="running-steps"?14:n==="synthesizing"?15:n==="scoring"?16:n==="completed"?17:n==="failed"?18:-1)}}function md(o,t){if(o&1&&(m(0,"div",0)(1,"div",12)(2,"span",13),S(),m(3,"svg",14),M(4,"path",15),g()(),j(),m(5,"span",16),c(6,"Paralelno izvr\u0161avanje"),g(),m(7,"span",17),c(8),g()(),m(9,"div",18),M(10,"div",19),g(),m(11,"div",20),G(12,ud,19,7,"div",21,Kc),g()()),o&2){let e=s();r(8),me(" ",e.parallelCompletedCount(),"/",e.parallelTaskStates().length," zavr\u0161eno "),r(2),Y("width",e.parallelTaskStates().length?e.parallelCompletedCount()/e.parallelTaskStates().length*100:0,"%"),r(2),q(e.parallelTaskStates())}}function hd(o,t){o&1&&(m(0,"div",1),M(1,"span",33),c(2," Generisanje plana... "),g())}function gd(o,t){o&1&&(m(0,"div",1),M(1,"span",33),c(2," Agenti rade... "),g())}function fd(o,t){if(o&1&&(m(0,"div",2),S(),m(1,"svg",34),M(2,"path",35),g(),j(),m(3,"span",36),c(4),g(),m(5,"span",37),c(6),g()()),o&2){let e=s();r(4),I(e.folderName()),r(2),me("",e.notes().length," zadatak",e.notes().length!==1?"a":"")}}function _d(o,t){if(o&1){let e=E();m(0,"div",5)(1,"span"),c(2),g(),m(3,"div",38)(4,"button",39),P("click",function(){x(e);let i=s();return b(i.deselectAll())}),c(5,"Poni\u0161ti izbor"),g(),m(6,"button",40),P("click",function(){x(e);let i=s();return b(i.onRunAgents())}),c(7," Pokreni agente "),g()()()}if(o&2){let e=s();r(2),me("",e.selectedTaskIds().size," zadatak",e.selectedTaskIds().size>1?"a":""," izabrano"),r(4),B("disabled",e.isExecuting()||e.isGeneratingPlan()||e.isParallelExecuting())}}function Cd(o,t){if(o&1){let e=E();m(0,"div",5)(1,"span"),c(2),g(),m(3,"button",39),P("click",function(){x(e);let i=s();return b(i.selectAllPending())}),c(4,"Izaberi sve"),g()()}if(o&2){let e=s();r(2),me("",e.pendingTaskCount()," zadatak",e.pendingTaskCount()>1?"a":""," na \u010Dekanju")}}function xd(o,t){o&1&&(m(0,"div",7),c(1,"U\u010Ditavanje bele\u0161ki..."),g())}function bd(o,t){o&1&&(m(0,"div",8)(1,"p"),c(2,"Jo\u0161 nema bele\u0161ki"),g(),m(3,"p",41),c(4," Bele\u0161ke i zadaci \u0107e se pojaviti ovde tokom razgovora "),g()())}function vd(o,t){if(o&1){let e=E();m(0,"input",54),P("change",function(i){x(e);let a=s().$implicit;return s(2).toggleSelection(a.id),b(i.stopPropagation())})("click",function(i){return x(e),b(i.stopPropagation())}),g()}if(o&2){let e=s().$implicit,n=s(2);B("checked",n.selectedTaskIds().has(e.id))}}function kd(o,t){o&1&&(m(0,"span",47),c(1,"\u267B\uFE0F"),g())}function yd(o,t){if(o&1&&(m(0,"span",55),c(1),g()),o&2){let e=s().$implicit;N("score-high",e.aiScore>=80)("score-medium",e.aiScore>=50&&e.aiScore<80)("score-low",e.aiScore<50),r(),$("",e.aiScore,"/100")}}function wd(o,t){o&1&&M(0,"span",52)}function Sd(o,t){o&1&&(S(),m(0,"svg",53),M(1,"path",56),g())}function Ed(o,t){if(o&1&&(m(0,"div",57)(1,"span",70),M(2,"span",71),m(3,"span",72),c(4,"Kreiran"),g()(),M(5,"span",73),m(6,"span",70),M(7,"span",71),m(8,"span",74),c(9,"Izvr\u0161ava se"),g()(),M(10,"span",73),m(11,"span",70),M(12,"span",71),m(13,"span",74),c(14,"Pregled"),g()(),M(15,"span",73),m(16,"span",70),M(17,"span",71),m(18,"span",74),c(19,"Ocenjen"),g()()()),o&2){let e=s(2).$implicit,n=s(2);r(2),N("done",!0),r(3),N("done",e.status==="COMPLETED"||n.executingTaskId()===e.id),r(2),N("active",n.executingTaskId()===e.id)("done",e.status==="COMPLETED"),r(),N("active",n.executingTaskId()===e.id)("done",e.status==="COMPLETED"),r(2),N("done",e.userReport!==void 0&&e.userReport!==null),r(2),N("active",e.status==="COMPLETED"&&!e.aiScore)("done",e.aiScore!==null&&e.aiScore!==void 0),r(),N("active",e.status==="COMPLETED"&&!e.aiScore)("done",e.aiScore!==null&&e.aiScore!==void 0),r(2),N("done",e.aiScore!==null&&e.aiScore!==void 0),r(2),N("done",e.aiScore!==null&&e.aiScore!==void 0),r(),N("done",e.aiScore!==null&&e.aiScore!==void 0)}}function Td(o,t){if(o&1&&(M(0,"div",59),Le(1,"markdown")),o&2){let e=s(2).$implicit;B("innerHTML",Fe(1,1,e.content),Se)}}function Pd(o,t){if(o&1&&(m(0,"div",60)(1,"div",75),c(2,"O\u010Dekivani ishod"),g(),M(3,"div",76),Le(4,"markdown"),g()),o&2){let e=s(2).$implicit;r(3),B("innerHTML",Fe(4,1,e.expectedOutcome),Se)}}function Md(o,t){o&1&&(M(0,"span",78),c(1," AI radi... "))}function Id(o,t){o&1&&(S(),m(0,"svg",79),M(1,"path",80)(2,"path",81),g(),c(3," Izvr\u0161i "))}function $d(o,t){if(o&1){let e=E();m(0,"button",77),P("click",function(){x(e);let i=s(2).$implicit,a=s(2);return b(a.onExecuteTask(i.id))}),_(1,Md,2,0)(2,Id,4,0),g()}if(o&2){let e=s(2).$implicit,n=s(2);B("disabled",n.executingTaskId()===e.id||n.isExecuting()),r(),C(n.executingTaskId()===e.id?1:2)}}function Od(o,t){if(o&1&&(m(0,"div",62)(1,"div",82),M(2,"span",83),c(3," AI radi na zadatku... "),g(),M(4,"div",84),Le(5,"markdown"),g()),o&2){let e=s(4);r(4),B("innerHTML",Fe(5,1,e.taskExecutionContent()),Se)}}function Nd(o,t){o&1&&(M(0,"span",86),c(1," Ocenjujem... "))}function Ad(o,t){o&1&&(S(),m(0,"svg",79),M(1,"path",87),g(),c(2," Potvrdi rezultat "))}function Dd(o,t){if(o&1){let e=E();m(0,"button",85),P("click",function(){x(e);let i=s(2).$implicit,a=s(2);return b(a.onSubmitTaskResult(i.id))}),_(1,Nd,2,0)(2,Ad,3,0),g()}if(o&2){let e=s(2).$implicit,n=s(2);B("disabled",n.submittingResultId()===e.id),r(),C(n.submittingResultId()===e.id?1:2)}}function Rd(o,t){if(o&1&&(m(0,"div",64)(1,"div",88),M(2,"span",86),c(3," Optimizujem i ocenjujem... "),g(),M(4,"div",89),Le(5,"markdown"),g()),o&2){let e=s(4);r(4),B("innerHTML",Fe(5,1,e.taskResultContent()),Se)}}function zd(o,t){if(o&1){let e=E();m(0,"button",90),P("click",function(){x(e);let i=s(2).$implicit,a=s(2);return b(a.emitViewMessage(i))}),c(1," Pogledaj u razgovoru "),g()}}function Ld(o,t){if(o&1&&(m(0,"span",93),c(1),g()),o&2){let e=s().$implicit;r(),I(e.workflowStepNumber)}}function Fd(o,t){o&1&&(S(),m(0,"svg",94),M(1,"path",97),g())}function Vd(o,t){if(o&1){let e=E();m(0,"div",99)(1,"div",100),c(2,"Va\u0161 izve\u0161taj"),g(),m(3,"textarea",101),P("input",function(i){x(e);let a=s(2).$implicit,l=s(5);return b(l.setReportText(a.id,l.asTextareaValue(i)))}),g(),m(4,"div",102)(5,"button",103),P("click",function(){x(e);let i=s(2).$implicit,a=s(5);return b(a.onGenerateReport(i.id))}),c(6),g(),m(7,"button",104),P("click",function(){x(e);let i=s(2).$implicit,a=s(5);return b(a.submitReport(i.id))}),c(8),g()()()}if(o&2){let e=s(2).$implicit,n=s(5);r(3),B("value",n.getReportText(e.id)),r(2),B("disabled",n.generatingReportId()===e.id),r(),$(" ",n.generatingReportId()===e.id?"AI generi\u0161e...":"AI popuni"," "),r(),B("disabled",!n.getReportText(e.id)||n.submittingInProgress().has(e.id)),r(),$(" ",n.submittingInProgress().has(e.id)?"\u0160aljem...":"Po\u0161alji izve\u0161taj"," ")}}function Bd(o,t){if(o&1&&(M(0,"div",111),Le(1,"markdown")),o&2){let e=s(4).$implicit;B("innerHTML",Fe(1,1,e.aiFeedback),Se)}}function jd(o,t){if(o&1&&(m(0,"div",106)(1,"div",107)(2,"div",108),M(3,"div",109),g(),m(4,"span",110),c(5),g()(),_(6,Bd,2,3,"div",111),g()),o&2){let e=s(3).$implicit;r(3),Y("width",e.aiScore,"%"),N("high",e.aiScore>=80)("medium",e.aiScore>=50&&e.aiScore<80)("low",e.aiScore<50),r(),N("high",e.aiScore>=80)("medium",e.aiScore>=50&&e.aiScore<80)("low",e.aiScore<50),r(),I(e.aiScore),r(),C(e.aiFeedback?6:-1)}}function Wd(o,t){o&1&&(M(0,"span",113),c(1," Ocenjujem... "))}function Hd(o,t){o&1&&c(0," Dobij AI ocenu ")}function Ud(o,t){if(o&1){let e=E();m(0,"div",102)(1,"button",112),P("click",function(){x(e);let i=s(3).$implicit,a=s(5);return b(a.scoreReport(i.id))}),_(2,Wd,2,0)(3,Hd,1,0),g()()}if(o&2){let e=s(3).$implicit,n=s(5);r(),B("disabled",n.scoringInProgress().has(e.id)),r(),C(n.scoringInProgress().has(e.id)?2:3)}}function Gd(o,t){if(o&1&&(m(0,"div",99)(1,"div",100),c(2,"Va\u0161 izve\u0161taj"),g(),M(3,"div",105),Le(4,"markdown"),_(5,jd,7,16,"div",106)(6,Ud,4,2,"div",102),g()),o&2){let e=s(2).$implicit;r(3),B("innerHTML",Fe(4,2,e.userReport),Se),r(2),C(e.aiScore!==null&&e.aiScore!==void 0?5:6)}}function qd(o,t){if(o&1&&(M(0,"div",98),Le(1,"markdown"),_(2,Vd,9,5,"div",99),_(3,Gd,7,4,"div",99)),o&2){let e=s().$implicit;B("innerHTML",Fe(1,3,e.content),Se),r(2),C(e.status==="COMPLETED"&&!e.userReport?2:-1),r(),C(e.userReport?3:-1)}}function Yd(o,t){if(o&1){let e=E();m(0,"div")(1,"div",92),P("click",function(){let i=x(e).$implicit,a=s(5);return b(a.toggleSubtaskExpand(i.id))}),_(2,Ld,2,1,"span",93),_(3,Fd,2,0,":svg:svg",94),m(4,"span",95),c(5),g(),S(),m(6,"svg",96),M(7,"path",50),g()(),_(8,qd,4,5),g()}if(o&2){let e=t.$implicit,n=s(5);r(2),C(e.workflowStepNumber!==null?2:-1),r(),C(e.status==="COMPLETED"?3:-1),r(2),I(e.title),r(),N("expanded",n.expandedSubtasks().has(e.id)),r(2),C(n.expandedSubtasks().has(e.id)?8:-1)}}function Kd(o,t){if(o&1&&(m(0,"div",67)(1,"div",91),c(2),g(),G(3,Yd,9,6,"div",null,ri),g()),o&2){let e=s(2).$implicit;r(2),$(" Rezultat workflow-a (",e.children.length," koraka) "),r(),q(e.children)}}function Qd(o,t){if(o&1){let e=E();m(0,"div",68)(1,"div",100),c(2,"Va\u0161 izve\u0161taj"),g(),m(3,"textarea",101),P("input",function(i){x(e);let a=s(2).$implicit,l=s(2);return b(l.setReportText(a.id,l.asTextareaValue(i)))}),g(),m(4,"div",102)(5,"button",103),P("click",function(){x(e);let i=s(2).$implicit,a=s(2);return b(a.onGenerateReport(i.id))}),c(6),g(),m(7,"button",104),P("click",function(){x(e);let i=s(2).$implicit,a=s(2);return b(a.submitReport(i.id))}),c(8),g()()()}if(o&2){let e=s(2).$implicit,n=s(2);r(3),B("value",n.getReportText(e.id)),r(2),B("disabled",n.generatingReportId()===e.id),r(),$(" ",n.generatingReportId()===e.id?"AI generi\u0161e...":"AI popuni"," "),r(),B("disabled",!n.getReportText(e.id)||n.submittingInProgress().has(e.id)),r(),$(" ",n.submittingInProgress().has(e.id)?"\u0160aljem...":"Po\u0161alji izve\u0161taj"," ")}}function Zd(o,t){if(o&1&&(M(0,"div",111),Le(1,"markdown")),o&2){let e=s(4).$implicit;B("innerHTML",Fe(1,1,e.aiFeedback),Se)}}function Xd(o,t){if(o&1&&(m(0,"div",114)(1,"div",107)(2,"div",108),M(3,"div",109),g(),m(4,"span",110),c(5),g()(),_(6,Zd,2,3,"div",111),g()),o&2){let e=s(3).$implicit;r(3),Y("width",e.aiScore,"%"),N("high",e.aiScore>=80)("medium",e.aiScore>=50&&e.aiScore<80)("low",e.aiScore<50),r(),N("high",e.aiScore>=80)("medium",e.aiScore>=50&&e.aiScore<80)("low",e.aiScore<50),r(),I(e.aiScore),r(),C(e.aiFeedback?6:-1)}}function Jd(o,t){o&1&&(M(0,"span",113),c(1," Ocenjujem... "))}function ep(o,t){o&1&&c(0," Dobij AI ocenu ")}function tp(o,t){if(o&1){let e=E();m(0,"div",102)(1,"button",112),P("click",function(){x(e);let i=s(3).$implicit,a=s(2);return b(a.scoreReport(i.id))}),_(2,Jd,2,0)(3,ep,1,0),g()()}if(o&2){let e=s(3).$implicit,n=s(2);r(),B("disabled",n.scoringInProgress().has(e.id)),r(),C(n.scoringInProgress().has(e.id)?2:3)}}function np(o,t){if(o&1&&(m(0,"div",68)(1,"div",100),c(2,"Va\u0161 izve\u0161taj"),g(),M(3,"div",105),Le(4,"markdown"),_(5,Xd,7,16,"div",114)(6,tp,4,2,"div",102),g()),o&2){let e=s(2).$implicit;r(3),B("innerHTML",Fe(4,2,e.userReport),Se),r(2),C(e.aiScore!==null&&e.aiScore!==void 0?5:6)}}function op(o,t){if(o&1&&c(0),o&2){let e=s(3).$implicit,n=s(2);$(" (",n.getCommentTotal(e.id),") ")}}function ip(o,t){o&1&&(m(0,"div",118),c(1," U\u010Ditavanje komentara... "),g())}function ap(o,t){if(o&1&&(m(0,"span",126),c(1),g()),o&2){let e=s().$implicit;r(),I(e.userRole)}}function rp(o,t){o&1&&(m(0,"span",128),c(1,"(izmenjeno)"),g())}function sp(o,t){if(o&1){let e=E();m(0,"textarea",129),P("input",function(i){x(e);let a=s(8);return b(a.editCommentText.set(a.asTextareaValue(i)))}),g(),m(1,"div",130)(2,"button",131),P("click",function(){x(e);let i=s(8);return b(i.cancelEditComment())}),c(3," Otka\u017Ei "),g(),m(4,"button",132),P("click",function(){x(e);let i=s(6).$implicit,a=s(2);return b(a.saveEditComment(i.id))}),c(5," Sa\u010Duvaj "),g()()}if(o&2){let e=s(8);B("value",e.editCommentText()),r(4),B("disabled",!e.editCommentText())}}function lp(o,t){if(o&1){let e=E();m(0,"div",133),c(1),g(),m(2,"div",134)(3,"button",135),P("click",function(){x(e);let i=s().$implicit,a=s(7);return b(a.startEditComment(i))}),c(4," Izmeni "),g(),m(5,"button",136),P("click",function(){x(e);let i=s().$implicit,a=s(5).$implicit,l=s(2);return b(l.deleteComment(a.id,i.id))}),c(6," Obri\u0161i "),g()()}if(o&2){let e=s().$implicit;r(),I(e.content)}}function cp(o,t){if(o&1&&(m(0,"div",122)(1,"div",124)(2,"span",125),c(3),g(),_(4,ap,2,1,"span",126),m(5,"span",127),c(6),g(),_(7,rp,2,0,"span",128),g(),_(8,sp,6,2)(9,lp,7,1),g()),o&2){let e=t.$implicit,n=s(7);r(3),I(e.userName),r(),C(e.userRole!=="MEMBER"?4:-1),r(2),I(n.formatDate(e.createdAt)),r(),C(e.updatedAt!==e.createdAt?7:-1),r(),C(n.editingCommentId()===e.id?8:9)}}function dp(o,t){if(o&1){let e=E();m(0,"button",137),P("click",function(){x(e);let i=s(5).$implicit,a=s(2);return b(a.loadMoreComments(i.id))}),c(1," U\u010Ditaj jo\u0161... "),g()}}function pp(o,t){if(o&1&&(G(0,cp,10,5,"div",122,ri),_(2,dp,2,0,"button",123)),o&2){let e=s(4).$implicit,n=s(2);q(n.getComments(e.id)),r(2),C(n.hasMoreComments(e.id)?2:-1)}}function up(o,t){if(o&1){let e=E();_(0,ip,2,0,"div",118)(1,pp,3,1),m(2,"div",119)(3,"input",120),P("input",function(i){x(e);let a=s(3).$implicit,l=s(2);return b(l.setCommentInput(a.id,l.asInputValue(i)))})("keydown.enter",function(){x(e);let i=s(3).$implicit,a=s(2);return b(a.submitComment(i.id))}),g(),m(4,"button",121),P("click",function(){x(e);let i=s(3).$implicit,a=s(2);return b(a.submitComment(i.id))}),c(5," Po\u0161alji "),g()()}if(o&2){let e=s(3).$implicit,n=s(2);C(n.loadingComments().has(e.id)?0:1),r(3),B("value",n.getCommentInput(e.id)),r(),B("disabled",!n.getCommentInput(e.id)||n.submittingComment().has(e.id))}}function mp(o,t){if(o&1){let e=E();m(0,"div",69)(1,"div",115),P("click",function(){x(e);let i=s(2).$implicit,a=s(2);return b(a.toggleComments(i.id))}),m(2,"span",116),c(3," Komentari "),_(4,op,1,1),g(),m(5,"button",117),c(6),g()(),_(7,up,6,3),g()}if(o&2){let e=s(2).$implicit,n=s(2);r(4),C(n.getCommentTotal(e.id)>0?4:-1),r(2),$(" ",n.commentsExpanded().has(e.id)?"Sakrij":"Prika\u017Ei"," "),r(),C(n.commentsExpanded().has(e.id)?7:-1)}}function hp(o,t){if(o&1&&(_(0,Ed,20,28,"div",57),m(1,"div",58),_(2,Td,2,3,"div",59),_(3,Pd,5,3,"div",60),_(4,$d,3,2,"button",61),_(5,Od,6,3,"div",62),_(6,Dd,3,2,"button",63),_(7,Rd,6,3,"div",64),m(8,"div",65)(9,"span"),c(10),g(),m(11,"span"),c(12),g(),_(13,zd,2,0,"button",66),g(),_(14,Kd,5,1,"div",67),_(15,Qd,9,5,"div",68),_(16,np,7,4,"div",68),_(17,mp,8,3,"div",69),g()),o&2){let e=s().$implicit,n=s(2);C(e.noteType==="TASK"?0:-1),r(2),C(e.content?2:-1),r(),C(e.expectedOutcome?3:-1),r(),C(e.noteType==="TASK"&&e.status!=="COMPLETED"?4:-1),r(),C(n.executingTaskId()===e.id&&n.taskExecutionContent()?5:-1),r(),C(e.noteType==="TASK"&&e.status==="COMPLETED"&&e.aiScore===null?6:-1),r(),C(n.submittingResultId()===e.id&&n.taskResultContent()?7:-1),r(3),I(e.source),r(2),I(n.formatDate(e.createdAt)),r(),C(e.messageId?13:-1),r(),C(e.children&&e.children.length>0?14:-1),r(),C(e.noteType==="TASK"&&e.status==="COMPLETED"&&!e.userReport?15:-1),r(),C(e.userReport?16:-1),r(),C(e.noteType==="TASK"?17:-1)}}function gp(o,t){if(o&1){let e=E();m(0,"div",42)(1,"div",43),P("click",function(){let i=x(e).$implicit,a=s(2);return b(a.toggleExpand(i.id))}),_(2,vd,1,1,"input",44),m(3,"span",45),c(4),g(),m(5,"span",46),c(6),g(),_(7,kd,2,0,"span",47),_(8,yd,2,7,"span",48),S(),m(9,"svg",49),M(10,"path",50),g(),j(),m(11,"button",51),P("click",function(i){let a=x(e).$implicit;return s(2).deleteNote(a.id),b(i.stopPropagation())}),_(12,wd,1,0,"span",52)(13,Sd,2,0,":svg:svg",53),g()(),_(14,hp,18,14),g()}if(o&2){let e=t.$implicit,n=s(2);r(2),C(e.noteType==="TASK"&&e.status!=="COMPLETED"?2:-1),r(),N("badge-task",e.noteType==="TASK")("badge-note",e.noteType==="NOTE")("badge-summary",e.noteType==="SUMMARY")("badge-review",e.status==="READY_FOR_REVIEW"),r(),I(e.status==="READY_FOR_REVIEW"?"REVIEW":e.noteType),r(),N("completed",e.status==="COMPLETED"),r(),$(" ",e.title," "),r(),C(e.reusedFromNoteId?7:-1),r(),C(e.aiScore!==null&&e.aiScore!==void 0?8:-1),r(),N("expanded",n.expandedNotes().has(e.id)),r(2),B("disabled",n.deletingInProgress().has(e.id)),r(),C(n.deletingInProgress().has(e.id)?12:13),r(2),C(n.expandedNotes().has(e.id)?14:-1)}}function fp(o,t){if(o&1&&G(0,gp,15,20,"div",42,ri),o&2){let e=s();q(e.filteredNotes())}}function _p(o,t){if(o&1){let e=E();m(0,"div",10)(1,"input",138),P("input",function(i){x(e);let a=s();return b(a.newTitle.set(a.asInputValue(i)))}),g(),m(2,"textarea",139),P("input",function(i){x(e);let a=s();return b(a.newContent.set(a.asTextareaValue(i)))}),g(),m(3,"div",140)(4,"button",141),P("click",function(){x(e);let i=s();return b(i.showAddForm.set(!1))}),c(5,"Otka\u017Ei"),g(),m(6,"button",104),P("click",function(){x(e);let i=s();return b(i.addNote())}),c(7),g()()()}if(o&2){let e=s();r(),B("value",e.newTitle()),r(),B("value",e.newContent()),r(4),B("disabled",!e.newTitle()||e.addingNote$()),r(),$(" ",e.addingNote$()?"Dodajem...":"Dodaj bele\u0161ku"," ")}}function Cp(o,t){if(o&1){let e=E();m(0,"button",142),P("click",function(){x(e);let i=s();return b(i.showAddForm.set(!0))}),c(1," + Dodaj bele\u0161ku "),g()}}var Zt=class o{notesApi=J(St);conversationId=R(null);conceptId=R(null);isExecuting=R(!1);folderConceptIds=R([]);folderConversationIds=R([]);folderName=R(null);autoSelectTaskIds=R([]);executingTaskId=R(null);taskExecutionContent=R("");submittingResultId=R(null);taskResultContent=R("");isGeneratingPlan=R(!1);parallelTaskStates=R([]);isParallelExecuting=R(!1);viewMessage=K();runAgents=K();executeTask=K();submitTaskResult=K();notes=v([]);loading=v(!1);activeFilter=v("all");showAddForm=v(!1);newTitle=v("");newContent=v("");selectedTaskIds=v(new Set);pendingTaskCount=v(0);filteredNotes=v([]);expandedNotes=v(new Set);expandedSubtasks=v(new Set);reportTexts=v(new Map);scoringInProgress=v(new Set);parallelCompletedCount=X(()=>this.parallelTaskStates().filter(t=>t.status==="completed"||t.status==="failed").length);deletingInProgress=v(new Set);submittingInProgress=v(new Set);generatingReportId=v(null);addingNote$=v(!1);togglingStatus=v(new Set);commentsExpanded=v(new Set);commentsByTask=v(new Map);commentInputs=v(new Map);loadingComments=v(new Set);submittingComment=v(new Set);editingCommentId=v(null);editCommentText=v("");isLoadingNotes=!1;pendingReload=!1;constructor(){dn(()=>{this.conversationId(),this.conceptId(),this.folderConceptIds(),this.folderConversationIds(),this.autoSelectTaskIds(),Di(()=>this.loadNotes())})}async loadNotes(){if(this.isLoadingNotes){this.pendingReload=!0;return}this.isLoadingNotes=!0;try{await this._loadNotesInternal()}finally{this.isLoadingNotes=!1,this.pendingReload&&(this.pendingReload=!1,this.loadNotes())}}async _loadNotesInternal(){let t=this.folderConceptIds(),e=this.folderConversationIds();if(t.length>0||e.length>0){this.loading.set(!0);try{let[a,l]=await Promise.all([t.length>0?this.notesApi.getByConceptIds(t):Promise.resolve([]),e.length>0?this.notesApi.getByConversationIds(e):Promise.resolve([])]),h=new Set,d=[];for(let k of[...a,...l])h.has(k.id)||(h.add(k.id),d.push(k));this.notes.set(d),this.updateFilteredNotes()}catch{this.notes.set([]),this.updateFilteredNotes()}finally{this.loading.set(!1)}return}let n=this.conversationId(),i=this.conceptId();if(!n&&!i){this.notes.set([]),this.updateFilteredNotes();return}this.loading.set(!0);try{let[a,l]=await Promise.all([n?this.notesApi.getByConversation(n):Promise.resolve([]),i?this.notesApi.getByConcept(i).catch(()=>[]):Promise.resolve([])]),h=new Set,d=[];for(let k of[...a,...l])h.has(k.id)||(h.add(k.id),d.push(k));this.notes.set(d),this.updateFilteredNotes(),this.applyAutoSelect()}catch{this.notes.set([]),this.updateFilteredNotes()}finally{this.loading.set(!1)}}applyAutoSelect(){let t=this.autoSelectTaskIds();t.length>0&&this.selectedTaskIds.set(new Set(t))}toggleExpand(t){this.expandedNotes.update(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})}toggleSubtaskExpand(t){this.expandedSubtasks.update(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})}getReportText(t){return this.reportTexts().get(t)??""}setReportText(t,e){this.reportTexts.update(n=>{let i=new Map(n);return i.set(t,e),i})}async submitReport(t){let e=this.getReportText(t);if(!(!e||this.submittingInProgress().has(t))){this.submittingInProgress.update(n=>{let i=new Set(n);return i.add(t),i});try{let n=await this.notesApi.submitReport(t,e);this.updateNoteInList(n),this.reportTexts.update(i=>{let a=new Map(i);return a.delete(t),a})}catch{}finally{this.submittingInProgress.update(n=>{let i=new Set(n);return i.delete(t),i})}}}async onGenerateReport(t){if(!this.generatingReportId()){this.generatingReportId.set(t);try{let e=await this.notesApi.generateReport(t);this.setReportText(t,e)}catch{}finally{this.generatingReportId.set(null)}}}async scoreReport(t){this.scoringInProgress.update(e=>{let n=new Set(e);return n.add(t),n});try{let e=await this.notesApi.scoreReport(t);this.updateNoteInList(e)}catch{}finally{this.scoringInProgress.update(e=>{let n=new Set(e);return n.delete(t),n})}}async toggleTaskStatus(t){if(this.togglingStatus().has(t.id))return;let e=t.status==="COMPLETED"?"PENDING":"COMPLETED";this.togglingStatus.update(n=>{let i=new Set(n);return i.add(t.id),i});try{await this.notesApi.updateStatus(t.id,e),this.notes.update(n=>n.map(i=>i.id===t.id?te(F({},i),{status:e}):i)),this.updateFilteredNotes()}catch{}finally{this.togglingStatus.update(n=>{let i=new Set(n);return i.delete(t.id),i})}}async deleteNote(t){if(!this.deletingInProgress().has(t)){this.deletingInProgress.update(e=>{let n=new Set(e);return n.add(t),n});try{await this.notesApi.deleteNote(t),this.notes.update(e=>e.filter(n=>n.id!==t)),this.updateFilteredNotes()}catch{}finally{this.deletingInProgress.update(e=>{let n=new Set(e);return n.delete(t),n})}}}async addNote(){let t=this.newTitle(),e=this.newContent();if(!(!t||this.addingNote$())){this.addingNote$.set(!0);try{let n=await this.notesApi.createNote({title:t,content:e,noteType:"NOTE",conversationId:this.conversationId()??void 0,conceptId:this.conceptId()??void 0});this.notes.update(i=>[n,...i]),this.updateFilteredNotes(),this.newTitle.set(""),this.newContent.set(""),this.showAddForm.set(!1)}catch{}finally{this.addingNote$.set(!1)}}}formatDate(t){let e=new Date(t),i=new Date().getTime()-e.getTime(),a=Math.floor(i/6e4),l=Math.floor(i/36e5),h=Math.floor(i/864e5);return a<1?"Upravo":a<60?`pre ${a} min`:l<24?`pre ${l}h`:h<7?`pre ${h}d`:e.toLocaleDateString("sr-Latn")}asInputValue(t){return t.target.value}asTextareaValue(t){return t.target.value}toggleSelection(t){this.selectedTaskIds.update(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})}selectAllPending(){let t=this.notes().filter(e=>e.noteType==="TASK"&&e.status!=="COMPLETED").map(e=>e.id);this.selectedTaskIds.set(new Set(t))}deselectAll(){this.selectedTaskIds.set(new Set)}onRunAgents(){let t=Array.from(this.selectedTaskIds());t.length>0&&(this.runAgents.emit(t),this.selectedTaskIds.set(new Set))}onExecuteTask(t){this.executeTask.emit(t)}onSubmitTaskResult(t){this.submitTaskResult.emit(t)}emitViewMessage(t){t.messageId&&t.conversationId&&this.viewMessage.emit({conversationId:t.conversationId,messageId:t.messageId})}updateFilteredNotes(){let t=this.activeFilter(),e=this.notes();t==="all"?this.filteredNotes.set(e):t==="READY_FOR_REVIEW"?this.filteredNotes.set(e.filter(n=>n.status==="READY_FOR_REVIEW")):this.filteredNotes.set(e.filter(n=>n.noteType===t)),this.pendingTaskCount.set(e.filter(n=>n.noteType==="TASK"&&n.status!=="COMPLETED").length)}updateNoteInList(t){this.notes.update(e=>e.map(n=>n.id===t.id?F(F({},n),t):n.children?te(F({},n),{children:n.children.map(i=>i.id===t.id?F(F({},i),t):i)}):n)),this.updateFilteredNotes()}toggleComments(t){let e=this.commentsExpanded(),n=new Set(e);n.has(t)?n.delete(t):(n.add(t),this.commentsByTask().has(t)||this.fetchComments(t,1)),this.commentsExpanded.set(n)}getCommentTotal(t){return this.commentsByTask().get(t)?.total??0}getComments(t){return this.commentsByTask().get(t)?.comments??[]}hasMoreComments(t){let e=this.commentsByTask().get(t);return e?e.comments.length<e.total:!1}getCommentInput(t){return this.commentInputs().get(t)??""}setCommentInput(t,e){this.commentInputs.update(n=>{let i=new Map(n);return i.set(t,e),i})}async fetchComments(t,e){this.loadingComments.update(n=>{let i=new Set(n);return i.add(t),i});try{let n=await this.notesApi.getComments(t,e,50);this.commentsByTask.update(i=>{let a=new Map(i),l=a.get(t);return l&&e>1?a.set(t,{comments:[...l.comments,...n.comments],total:n.total,page:e}):a.set(t,{comments:n.comments,total:n.total,page:e}),a})}catch{}finally{this.loadingComments.update(n=>{let i=new Set(n);return i.delete(t),i})}}loadMoreComments(t){let e=this.commentsByTask().get(t),n=e?e.page+1:1;this.fetchComments(t,n)}async submitComment(t){let e=this.getCommentInput(t);if(!(!e||this.submittingComment().has(t))){this.submittingComment.update(n=>{let i=new Set(n);return i.add(t),i});try{let n=await this.notesApi.createComment(t,e);this.commentsByTask.update(i=>{let a=new Map(i),l=a.get(t);return l?a.set(t,{comments:[...l.comments,n],total:l.total+1,page:l.page}):a.set(t,{comments:[n],total:1,page:1}),a}),this.setCommentInput(t,"")}catch{}finally{this.submittingComment.update(n=>{let i=new Set(n);return i.delete(t),i})}}}startEditComment(t){this.editingCommentId.set(t.id),this.editCommentText.set(t.content)}cancelEditComment(){this.editingCommentId.set(null),this.editCommentText.set("")}async saveEditComment(t){let e=this.editingCommentId(),n=this.editCommentText();if(!(!e||!n))try{let i=await this.notesApi.updateComment(e,n);this.commentsByTask.update(a=>{let l=new Map(a),h=l.get(t);return h&&l.set(t,te(F({},h),{comments:h.comments.map(d=>d.id===e?F(F({},d),i):d)})),l}),this.cancelEditComment()}catch{}}async deleteComment(t,e){try{await this.notesApi.deleteComment(e),this.commentsByTask.update(n=>{let i=new Map(n),a=i.get(t);return a&&i.set(t,te(F({},a),{comments:a.comments.filter(l=>l.id!==e),total:a.total-1})),i})}catch{}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-conversation-notes"]],inputs:{conversationId:[1,"conversationId"],conceptId:[1,"conceptId"],isExecuting:[1,"isExecuting"],folderConceptIds:[1,"folderConceptIds"],folderConversationIds:[1,"folderConversationIds"],folderName:[1,"folderName"],autoSelectTaskIds:[1,"autoSelectTaskIds"],executingTaskId:[1,"executingTaskId"],taskExecutionContent:[1,"taskExecutionContent"],submittingResultId:[1,"submittingResultId"],taskResultContent:[1,"taskResultContent"],isGeneratingPlan:[1,"isGeneratingPlan"],parallelTaskStates:[1,"parallelTaskStates"],isParallelExecuting:[1,"isParallelExecuting"]},outputs:{viewMessage:"viewMessage",runAgents:"runAgents",executeTask:"executeTask",submitTaskResult:"submitTaskResult"},decls:22,vars:17,consts:[[1,"mission-control"],[1,"executing-bar"],[1,"folder-header"],["role","tablist","aria-label","Filter zadataka",1,"filter-bar"],["role","tab",1,"filter-btn",3,"click"],[1,"run-agents-bar"],[1,"notes-container"],[1,"loading-spinner"],[1,"empty-notes"],[1,"add-note-section"],[1,"add-note-form"],[1,"btn-secondary",2,"width","100%"],[1,"mission-control-header"],[1,"mission-control-icon"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","18px","height","18px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 10V3L4 14h7v7l9-11h-7z"],[1,"mission-control-title"],[1,"mission-control-count"],[1,"mission-control-progress-bar"],[1,"mission-control-progress-fill"],[1,"mission-control-tasks"],[1,"mission-task-row",3,"mission-task-done","mission-task-failed"],[1,"mission-task-row"],[1,"mission-task-icon"],[1,"status-queued"],[1,"mission-spinner"],[1,"status-completed"],[1,"status-failed"],[1,"mission-task-title"],[1,"mission-task-status"],[1,"mission-error"],[1,"mission-score",3,"score-high","score-mid","score-low"],[1,"mission-score"],[1,"executing-spinner"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","18px","height","18px","color","#3B82F6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"],[1,"folder-title"],[1,"folder-count"],[1,"run-agents-actions"],[1,"select-link",3,"click"],[1,"run-agents-btn",3,"click","disabled"],[2,"font-size","11px","margin-top","4px"],[1,"task-card"],[1,"task-card-header",3,"click"],["type","checkbox","title","Izaberi za agente",1,"task-checkbox",3,"checked"],[1,"note-type-badge"],[1,"task-title"],["title","Kori\u0161\u0107en postoje\u0107i rezultat",1,"reuse-badge"],[1,"score-badge",3,"score-high","score-medium","score-low"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"expand-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],["title","Obri\u0161i",1,"delete-btn",3,"click","disabled"],[1,"scoring-spinner",2,"width","12px","height","12px","border-top-color","#EF4444"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","14px","height","14px"],["type","checkbox","title","Izaberi za agente",1,"task-checkbox",3,"change","click","checked"],[1,"score-badge"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"lifecycle-stepper"],[1,"task-card-body"],[1,"task-description","ai-content",3,"innerHTML"],[1,"expected-outcome"],[1,"execute-btn",3,"disabled"],[1,"execution-progress"],[1,"submit-result-btn",3,"disabled"],[1,"result-progress"],[1,"task-meta"],[1,"view-in-chat-btn"],[1,"subtasks-section"],[1,"report-section"],[1,"comments-section"],[1,"step-marker"],[1,"step-dot"],[1,"step-label","done"],[1,"step-line"],[1,"step-label"],[1,"expected-outcome-label"],[1,"ai-content",3,"innerHTML"],[1,"execute-btn",3,"click","disabled"],[1,"execute-spinner"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","12px","height","12px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"execution-progress-header"],[1,"execution-progress-spinner"],[1,"execution-progress-content","ai-content",3,"innerHTML"],[1,"submit-result-btn",3,"click","disabled"],[1,"submit-result-spinner"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"result-progress-header"],[1,"result-progress-content","ai-content",3,"innerHTML"],[1,"view-in-chat-btn",3,"click"],[1,"subtasks-label"],[1,"subtask-item",3,"click"],[1,"subtask-step-num"],["fill","currentColor","viewBox","0 0 20 20",1,"subtask-check"],[1,"subtask-title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"subtask-expand-icon"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"subtask-content","ai-content",3,"innerHTML"],[1,"report-section",2,"padding-left","32px"],[1,"report-label"],["placeholder","Opi\u0161ite \u0161ta ste uradili, \u0161ta ste nau\u010Dili, ostvarene rezultate...",1,"report-textarea",3,"input","value"],[1,"report-actions"],[1,"btn-ai-fill",3,"click","disabled"],[1,"btn-primary",3,"click","disabled"],[1,"existing-report","ai-content",3,"innerHTML"],[1,"score-section",2,"border","none","padding-top","8px"],[1,"score-bar-container"],[1,"score-bar-bg"],[1,"score-bar-fill"],[1,"score-number"],[1,"score-feedback","ai-content",3,"innerHTML"],[1,"btn-score",3,"click","disabled"],[1,"scoring-spinner"],[1,"score-section"],[1,"comments-header",3,"click"],[1,"comments-label"],[1,"comments-toggle"],[2,"font-size","11px","color","#9e9e9e","padding","4px 0"],[1,"comment-input-row"],["placeholder","Dodaj komentar...",1,"comment-input",3,"input","keydown.enter","value"],[1,"comment-send-btn",3,"click","disabled"],[1,"comment-item"],[1,"load-more-btn"],[1,"comment-meta"],[1,"comment-author"],[1,"comment-role"],[1,"comment-time"],[1,"comment-edited"],[1,"comment-edit-textarea",3,"input","value"],[1,"comment-edit-actions"],[1,"btn-secondary",2,"padding","3px 10px","font-size","10px",3,"click"],[1,"btn-primary",2,"padding","3px 10px","font-size","10px",3,"click","disabled"],[1,"comment-body"],[1,"comment-actions"],[1,"comment-action-btn",3,"click"],[1,"comment-action-btn","danger",3,"click"],[1,"load-more-btn",3,"click"],["placeholder","Naslov",1,"note-input",3,"input","value"],["placeholder","Sadr\u017Eaj...",1,"note-textarea",3,"input","value"],[1,"form-actions"],[1,"btn-secondary",3,"click"],[1,"btn-secondary",2,"width","100%",3,"click"]],template:function(e,n){e&1&&(_(0,md,14,4,"div",0)(1,hd,3,0,"div",1)(2,gd,3,0,"div",1),_(3,fd,7,3,"div",2),m(4,"div",3)(5,"button",4),P("click",function(){return n.activeFilter.set("all"),n.updateFilteredNotes()}),c(6," Sve "),g(),m(7,"button",4),P("click",function(){return n.activeFilter.set("TASK"),n.updateFilteredNotes()}),c(8," Zadaci "),g(),m(9,"button",4),P("click",function(){return n.activeFilter.set("READY_FOR_REVIEW"),n.updateFilteredNotes()}),c(10," Pregled "),g(),m(11,"button",4),P("click",function(){return n.activeFilter.set("NOTE"),n.updateFilteredNotes()}),c(12," Bele\u0161ke "),g()(),_(13,_d,8,3,"div",5)(14,Cd,5,2,"div",5),m(15,"div",6),_(16,xd,2,0,"div",7)(17,bd,5,0,"div",8)(18,fp,2,0),g(),m(19,"div",9),_(20,_p,8,4,"div",10)(21,Cp,2,0,"button",11),g()),e&2&&(C(n.isParallelExecuting()?0:n.isGeneratingPlan()?1:n.isExecuting()?2:-1),r(3),C(n.folderName()?3:-1),r(2),N("active",n.activeFilter()==="all"),ue("aria-selected",n.activeFilter()==="all"),r(2),N("active",n.activeFilter()==="TASK"),ue("aria-selected",n.activeFilter()==="TASK"),r(2),N("active",n.activeFilter()==="READY_FOR_REVIEW"),ue("aria-selected",n.activeFilter()==="READY_FOR_REVIEW"),r(2),N("active",n.activeFilter()==="NOTE"),ue("aria-selected",n.activeFilter()==="NOTE"),r(2),C(n.selectedTaskIds().size>0?13:n.pendingTaskCount()>0?14:-1),r(3),C(n.loading()?16:n.filteredNotes().length===0?17:18),r(4),C(n.showAddForm()?20:21))},dependencies:[ie,Ct,Qt],styles:[`:host{display:flex;flex-direction:column;flex:1;overflow:hidden}.notes-container{flex:1;overflow-y:auto;padding:16px}.filter-bar{display:flex;gap:4px;padding:0 16px 12px;border-bottom:1px solid #2a2a2a}.filter-btn{padding:4px 12px;border-radius:12px;font-size:12px;background:none;border:1px solid #2a2a2a;color:#9e9e9e;cursor:pointer}.filter-btn:hover{color:#a1a1a1;border-color:#3b82f6}.filter-btn.active{background:#3b82f6;color:#fafafa;border-color:#3b82f6}.task-card{background:#1a1a1a;border-radius:8px;margin-bottom:8px;border:1px solid #2a2a2a;overflow:hidden}.task-card:hover{border-color:#333}.task-card-header{display:flex;align-items:center;gap:8px;padding:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.task-checkbox{width:16px;height:16px;cursor:pointer;accent-color:#3b82f6;flex-shrink:0}.note-type-badge{font-size:10px;padding:2px 6px;border-radius:4px;text-transform:uppercase;font-weight:600;flex-shrink:0}.badge-task{background:#1e3a5f;color:#60a5fa}.badge-note{background:#1a2e1a;color:#86efac}.badge-summary{background:#2e1a2e;color:#c084fc}.badge-review{background:#3d2e0a;color:#f59e0b}.task-title{font-size:13px;font-weight:500;color:#fafafa;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.task-title.completed{text-decoration:line-through;color:#9e9e9e}.reuse-badge{font-size:13px;flex-shrink:0;cursor:default}.score-badge{font-size:11px;font-weight:600;padding:2px 8px;border-radius:10px;flex-shrink:0}.score-high{background:#22c55e26;color:#22c55e}.score-medium{background:#eab30826;color:#eab308}.score-low{background:#ef444426;color:#ef4444}.expand-icon{width:16px;height:16px;color:#9e9e9e;flex-shrink:0;transition:transform .2s}.expand-icon.expanded{transform:rotate(90deg)}.delete-btn{background:none;border:none;color:#707070;cursor:pointer;padding:2px;flex-shrink:0}.delete-btn:hover{color:#ef4444}.lifecycle-stepper{display:flex;align-items:center;gap:4px;padding:10px 12px;border-top:1px solid #242424;font-size:10px;color:#707070}.step-marker{display:flex;align-items:center;gap:4px}.step-dot{width:8px;height:8px;border-radius:50%;background:#2a2a2a;flex-shrink:0}.step-dot.active{background:#3b82f6}.step-dot.done{background:#22c55e}.step-label{white-space:nowrap}.step-label.active{color:#3b82f6;font-weight:600}.step-label.done{color:#22c55e}.step-line{width:12px;height:1px;background:#2a2a2a;flex-shrink:0}.step-line.done{background:#22c55e}.task-card-body{padding:0 12px 12px}.task-description{padding:10px 0;word-break:break-word}.expected-outcome{font-size:12px;color:#a1a1a1;line-height:1.5;padding:8px;background:#0d0d0d;border-radius:6px;margin-bottom:10px}.expected-outcome-label{font-size:11px;font-weight:600;color:#9e9e9e;margin-bottom:4px;text-transform:uppercase}.task-meta{font-size:10px;color:#707070;display:flex;gap:8px;margin-bottom:10px}.subtasks-section{margin-top:8px}.subtasks-label{font-size:11px;font-weight:600;color:#9e9e9e;margin-bottom:6px;text-transform:uppercase}.subtask-item{display:flex;align-items:flex-start;gap:8px;padding:8px;background:#0d0d0d;border-radius:6px;margin-bottom:4px;cursor:pointer}.subtask-item:hover{background:#141414}.subtask-step-num{font-size:11px;font-weight:600;color:#3b82f6;background:#3b82f61a;padding:1px 6px;border-radius:4px;flex-shrink:0}.subtask-check{width:14px;height:14px;color:#22c55e;flex-shrink:0;margin-top:1px}.subtask-title{font-size:12px;color:#d4d4d4;flex:1}.subtask-expand-icon{width:12px;height:12px;color:#707070;flex-shrink:0;transition:transform .2s}.subtask-expand-icon.expanded{transform:rotate(90deg)}.subtask-content{padding:8px 8px 8px 32px;word-break:break-word;max-height:300px;overflow-y:auto}.report-section{margin-top:12px;padding-top:12px;border-top:1px solid #242424}.report-label{font-size:11px;font-weight:600;color:#9e9e9e;margin-bottom:6px;text-transform:uppercase}.report-textarea{width:100%;background:#0d0d0d;border:1px solid #2a2a2a;border-radius:6px;padding:8px 12px;color:#fafafa;font-size:12px;font-family:inherit;resize:vertical;min-height:60px;box-sizing:border-box}.report-textarea:focus{outline:none;border-color:#3b82f6}.report-textarea::placeholder{color:#707070}.report-actions{display:flex;gap:8px;margin-top:8px;justify-content:flex-end}.existing-report{padding:8px;background:#0d0d0d;border-radius:6px}.score-section{margin-top:12px;padding-top:12px;border-top:1px solid #242424}.score-bar-container{display:flex;align-items:center;gap:12px;margin-bottom:8px}.score-bar-bg{flex:1;height:8px;background:#242424;border-radius:4px;overflow:hidden}.score-bar-fill{height:100%;border-radius:4px;transition:width .3s}.score-bar-fill.high{background:#22c55e}.score-bar-fill.medium{background:#eab308}.score-bar-fill.low{background:#ef4444}.score-number{font-size:18px;font-weight:700;flex-shrink:0}.score-number.high{color:#22c55e}.score-number.medium{color:#eab308}.score-number.low{color:#ef4444}.score-feedback{padding:8px;background:#0d0d0d;border-radius:6px}.btn-primary{background:#3b82f6;color:#fafafa;border:none;border-radius:6px;padding:6px 16px;font-size:12px;cursor:pointer}.btn-primary:hover{background:#2563eb}.btn-primary:disabled{opacity:.5;cursor:not-allowed}.btn-ai-fill{background:none;color:#8b5cf6;border:1px solid #8b5cf633;border-radius:6px;padding:6px 16px;font-size:12px;cursor:pointer}.btn-ai-fill:hover{background:#8b5cf620;border-color:#8b5cf6}.btn-ai-fill:disabled{opacity:.5;cursor:not-allowed}.btn-secondary{background:none;color:#a1a1a1;border:1px solid #2a2a2a;border-radius:6px;padding:6px 16px;font-size:12px;cursor:pointer}.btn-secondary:hover{color:#fafafa;border-color:#707070}.btn-score{background:#eab3081a;color:#eab308;border:1px solid rgba(234,179,8,.3);border-radius:6px;padding:6px 16px;font-size:12px;cursor:pointer}.btn-score:hover{background:#eab30833}.btn-score:disabled{opacity:.5;cursor:not-allowed}.view-in-chat-btn{background:none;border:none;color:#3b82f6;cursor:pointer;font-size:10px;padding:0}.view-in-chat-btn:hover{text-decoration:underline}.empty-notes{text-align:center;padding:32px 16px}.empty-notes p{font-size:13px;color:#9e9e9e}.add-note-section{border-top:1px solid #2a2a2a;padding:12px 16px}.add-note-form{display:flex;flex-direction:column;gap:8px}.note-input{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:8px 12px;color:#fafafa;font-size:13px;font-family:inherit}.note-input:focus{outline:none;border-color:#3b82f6}.note-input::placeholder{color:#707070}.note-textarea{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:8px 12px;color:#fafafa;font-size:13px;font-family:inherit;resize:vertical;min-height:60px}.note-textarea:focus{outline:none;border-color:#3b82f6}.note-textarea::placeholder{color:#707070}.form-actions{display:flex;gap:8px;justify-content:flex-end}.loading-spinner{text-align:center;padding:24px;color:#9e9e9e;font-size:13px}.run-agents-bar{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;background:#1a1a1a;border-bottom:1px solid #2a2a2a}.run-agents-bar span{font-size:12px;color:#a1a1a1}.run-agents-actions{display:flex;gap:8px;align-items:center}.run-agents-btn{background:#3b82f6;color:#fafafa;border:none;border-radius:6px;padding:6px 16px;font-size:12px;font-weight:500;cursor:pointer}.run-agents-btn:hover{background:#2563eb}.run-agents-btn:disabled{opacity:.5;cursor:not-allowed}.select-link{background:none;border:none;color:#3b82f6;cursor:pointer;font-size:11px;padding:0}.select-link:hover{text-decoration:underline}.executing-bar{display:flex;align-items:center;gap:8px;padding:10px 16px;background:#1a1a1a;border-bottom:1px solid #2a2a2a;font-size:12px;color:#60a5fa}.executing-spinner{width:14px;height:14px;border:2px solid #2a2a2a;border-top-color:#3b82f6;border-radius:50%;animation:spin .8s linear infinite;flex-shrink:0}.scoring-spinner{display:inline-block;width:12px;height:12px;border:2px solid #2a2a2a;border-top-color:#eab308;border-radius:50%;animation:spin .8s linear infinite;margin-right:6px;vertical-align:middle}@keyframes spin{to{transform:rotate(360deg)}}.mission-control{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:10px;margin:12px;overflow:hidden}.mission-control-header{display:flex;align-items:center;gap:8px;padding:12px 16px;border-bottom:1px solid #2a2a2a}.mission-control-icon{color:#3b82f6;display:flex;flex-shrink:0}.mission-control-title{font-size:13px;font-weight:600;color:#fafafa}.mission-control-count{margin-left:auto;font-size:12px;color:#a1a1a1}.mission-control-progress-bar{height:3px;background:#242424}.mission-control-progress-fill{height:100%;background:#3b82f6;transition:width .4s ease}.mission-control-tasks{padding:8px 0}.mission-task-row{display:flex;align-items:center;gap:10px;padding:8px 16px;font-size:13px}.mission-task-row:hover{background:#242424}.mission-task-done{opacity:.7}.mission-task-failed{opacity:.8}.mission-task-icon{width:18px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.mission-spinner{width:14px;height:14px;border:2px solid #2a2a2a;border-top-color:#3b82f6;border-radius:50%;animation:spin .8s linear infinite}.status-queued{color:#a1a1a1;font-size:10px}.status-completed{color:#22c55e;font-weight:700;font-size:14px}.status-failed{color:#ef4444;font-weight:700;font-size:14px}.mission-task-title{color:#fafafa;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mission-task-status{color:#a1a1a1;font-size:12px;flex-shrink:0;text-align:right;min-width:80px}.mission-score{font-weight:600;padding:2px 8px;border-radius:4px;font-size:12px}.score-high{color:#22c55e;background:#22c55e1a}.score-mid{color:#eab308;background:#eab3081a}.score-low{color:#ef4444;background:#ef44441a}.mission-error{color:#ef4444;font-size:11px;max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.comments-section{margin-top:12px;padding-top:12px;border-top:1px solid #242424}.comments-header{display:flex;align-items:center;justify-content:space-between;cursor:pointer;margin-bottom:8px}.comments-label{font-size:11px;font-weight:600;color:#9e9e9e;text-transform:uppercase}.comments-toggle{font-size:10px;color:#707070;background:none;border:none;cursor:pointer}.comments-toggle:hover{color:#a1a1a1}.comment-item{padding:8px;background:#0d0d0d;border-radius:6px;margin-bottom:4px}.comment-meta{display:flex;align-items:center;gap:6px;margin-bottom:4px}.comment-author{font-size:11px;font-weight:600;color:#d4d4d4}.comment-role{font-size:9px;padding:1px 4px;border-radius:3px;background:#3b82f61a;color:#60a5fa}.comment-time{font-size:10px;color:#707070;margin-left:auto}.comment-edited{font-size:10px;color:#707070;font-style:italic}.comment-body{font-size:12px;color:#a1a1a1;line-height:1.5;white-space:pre-wrap;word-break:break-word}.comment-actions{display:flex;gap:8px;margin-top:4px}.comment-action-btn{background:none;border:none;font-size:10px;color:#707070;cursor:pointer;padding:0}.comment-action-btn:hover{color:#a1a1a1}.comment-action-btn.danger:hover{color:#ef4444}.comment-edit-textarea{width:100%;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:4px;padding:6px 8px;color:#fafafa;font-size:12px;font-family:inherit;resize:vertical;min-height:40px;box-sizing:border-box}.comment-edit-textarea:focus{outline:none;border-color:#3b82f6}.comment-edit-actions{display:flex;gap:6px;margin-top:4px;justify-content:flex-end}.comment-input-row{display:flex;gap:6px;margin-top:8px}.comment-input{flex:1;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:6px 10px;color:#fafafa;font-size:12px;font-family:inherit}.comment-input:focus{outline:none;border-color:#3b82f6}.comment-input::placeholder{color:#707070}.comment-send-btn{background:#3b82f6;color:#fafafa;border:none;border-radius:6px;padding:6px 12px;font-size:11px;cursor:pointer;flex-shrink:0}.comment-send-btn:hover{background:#2563eb}.comment-send-btn:disabled{opacity:.5;cursor:not-allowed}.load-more-btn{display:block;width:100%;background:none;border:none;color:#3b82f6;font-size:11px;cursor:pointer;padding:6px 0;text-align:center}.load-more-btn:hover{text-decoration:underline}.folder-header{display:flex;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid #2a2a2a;background:#111}.folder-title{font-size:15px;font-weight:600;color:#fafafa;flex:1}.folder-count{font-size:12px;color:#9e9e9e}.execute-btn{display:inline-flex;align-items:center;gap:6px;background:#3b82f61a;color:#60a5fa;border:1px solid rgba(59,130,246,.3);border-radius:6px;padding:5px 12px;font-size:11px;cursor:pointer;margin-top:8px}.execute-btn:hover{background:#3b82f633;border-color:#3b82f6}.execute-btn:disabled{opacity:.5;cursor:not-allowed}.execute-spinner{display:inline-block;width:12px;height:12px;border:2px solid rgba(59,130,246,.3);border-top-color:#60a5fa;border-radius:50%;animation:spin .8s linear infinite}.execution-progress{margin-top:10px;padding:10px 12px;background:#111;border:1px solid rgba(34,197,94,.2);border-radius:6px}.execution-progress-header{display:flex;align-items:center;gap:8px;font-size:11px;font-weight:600;color:#4ade80;margin-bottom:8px}.execution-progress-spinner{display:inline-block;width:10px;height:10px;border:2px solid rgba(34,197,94,.3);border-top-color:#4ade80;border-radius:50%;animation:spin .8s linear infinite}.execution-progress-content{max-height:200px;overflow-y:auto;word-break:break-word;padding:6px 8px;background:#0d0d0d;border-radius:4px}.execution-complete-badge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;background:#22c55e1a;border:1px solid rgba(34,197,94,.3);border-radius:4px;font-size:11px;color:#4ade80;margin-top:8px}.submit-result-btn{display:inline-flex;align-items:center;gap:6px;background:#eab3081a;color:#eab308;border:1px solid rgba(234,179,8,.3);border-radius:6px;padding:5px 12px;font-size:11px;cursor:pointer;margin-top:8px}.submit-result-btn:hover{background:#eab30833;border-color:#eab308}.submit-result-btn:disabled{opacity:.5;cursor:not-allowed}.submit-result-spinner{display:inline-block;width:12px;height:12px;border:2px solid rgba(234,179,8,.3);border-top-color:#eab308;border-radius:50%;animation:spin .8s linear infinite}.result-progress{margin-top:10px;padding:10px 12px;background:#111;border:1px solid rgba(234,179,8,.2);border-radius:6px}.result-progress-header{display:flex;align-items:center;gap:8px;font-size:11px;font-weight:600;color:#eab308;margin-bottom:8px}.result-progress-content{max-height:200px;overflow-y:auto;word-break:break-word;padding:6px 8px;background:#0d0d0d;border-radius:4px}.ai-content{font-size:12px;line-height:1.65;color:#e0e0e0;word-break:break-word}.ai-content>:first-child{margin-top:0!important}.ai-content>:last-child{margin-bottom:0!important}.ai-content h1{font-size:1.35em;font-weight:700;color:#fafafa;margin:16px 0 6px;padding-bottom:4px;border-bottom:1px solid #2a2a2a}.ai-content h2{font-size:1.2em;font-weight:600;color:#fafafa;margin:14px 0 5px;padding-bottom:3px;border-bottom:1px solid rgba(42,42,42,.5)}.ai-content h3{font-size:1.1em;font-weight:600;color:#f0f0f0;margin:12px 0 4px}.ai-content h4,.ai-content h5,.ai-content h6{font-size:1em;font-weight:600;color:#e5e5e5;margin:10px 0 3px}.ai-content p{margin:8px 0;line-height:1.65}.ai-content strong{color:#fafafa;font-weight:600}.ai-content em{color:#d4d4d4;font-style:italic}.ai-content ul,.ai-content ol{margin:6px 0;padding-left:1.5em;list-style-position:outside}.ai-content ul{list-style-type:disc}.ai-content ol{list-style-type:decimal}.ai-content li{margin:3px 0;line-height:1.65;color:#e0e0e0}.ai-content li::marker{color:#9e9e9e}.ai-content li>ul,.ai-content li>ol{margin:3px 0}.ai-content li>p{margin:3px 0}.ai-content ul ul{list-style-type:circle}.ai-content ul ul ul{list-style-type:square}.ai-content table{width:100%;border-collapse:collapse;margin:10px 0;font-size:.9em;border-radius:6px;overflow:hidden;border:1px solid #2a2a2a}.ai-content thead th{background:#1a1a1a;color:#fafafa;font-weight:600;text-align:left;padding:7px 10px;border-bottom:2px solid #333}.ai-content tbody td{padding:7px 10px;border-bottom:1px solid #1e1e1e;color:#d4d4d4}.ai-content tbody tr:hover{background:#3b82f60a}.ai-content tbody tr:last-child td{border-bottom:none}.ai-content code{background:#ffffff0f;color:#e5e5e5;padding:.1em .35em;border-radius:3px;font-family:JetBrains Mono,Fira Code,Consolas,monospace;font-size:.875em}.ai-content pre{background:#111;border:1px solid #2a2a2a;border-radius:6px;padding:10px 14px;overflow-x:auto;margin:10px 0}.ai-content pre code{background:none;padding:0;border-radius:0;font-size:.85em;line-height:1.5}.ai-content blockquote{border-left:3px solid #3b82f6;margin:10px 0;padding:6px 12px;color:#b0b0b0;background:#3b82f60a;border-radius:0 6px 6px 0}.ai-content blockquote p{margin:3px 0}.ai-content a{color:#60a5fa;text-decoration:none}.ai-content a:hover{color:#93c5fd;text-decoration:underline}.ai-content hr{border:none;border-top:1px solid #2a2a2a;margin:14px 0}.ai-content del{color:#9e9e9e;text-decoration:line-through}
`],encapsulation:2,changeDetection:0})};var xp=(o,t)=>t.id;function bp(o,t){o&1&&(m(0,"div",9),c(1,"U\u010Ditavanje tema..."),g())}function vp(o,t){if(o&1&&c(0),o&2){let e=s(2);$(' Nema rezultata za "',e.searchQuery(),'" ')}}function kp(o,t){o&1&&c(0," Ukucajte da pretra\u017Eite teme ")}function yp(o,t){if(o&1&&(m(0,"div",10),_(1,vp,1,1)(2,kp,1,0),g()),o&2){let e=s();r(),C(e.searchQuery()?1:2)}}function wp(o,t){if(o&1&&(m(0,"div",17),c(1),g()),o&2){let e=s().$implicit,n=s(2);r(),I(n.getParentPath(e))}}function Sp(o,t){if(o&1){let e=E();m(0,"button",15),P("click",function(){let i=x(e).$implicit,a=s(2);return b(a.selectTopic(i))}),m(1,"div",16),c(2),g(),_(3,wp,2,1,"div",17),g()}if(o&2){let e=t.$implicit,n=s(2);r(2),I(e.label),r(),C(n.getParentPath(e)?3:-1)}}function Ep(o,t){if(o&1&&G(0,Sp,4,2,"button",14,xp),o&2){let e=s();q(e.results())}}var to=class o{http=J(Ee);apiUrl=`${et.apiUrl}/api/v1/knowledge/curriculum`;topicSelected=K();cancelled=K();searchQuery=v("");results=v([]);isLoading=v(!1);allNodes=[];searchTimeout=null;ngOnInit(){this.loadTopLevelNodes()}onSearchInput(t){let e=t.target.value;this.searchQuery.set(e),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.search(e)},200)}selectTopic(t){this.topicSelected.emit(t)}onOverlayClick(t){t.target.classList.contains("overlay")&&this.cancelled.emit()}getParentPath(t){if(!t.parentId)return"";let e=this.allNodes.find(i=>i.id===t.parentId);if(!e)return"";let n=e.parentId?this.allNodes.find(i=>i.id===e.parentId):null;return n?`${n.label} > ${e.label}`:e.label}async loadTopLevelNodes(){this.isLoading.set(!0);try{let t=await Z(this.http.get(this.apiUrl));this.allNodes=t.data;let e=await Z(this.http.get(`${this.apiUrl}/search`));this.results.set(e.data)}catch{this.results.set([])}finally{this.isLoading.set(!1)}}async search(t){if(!t){let e=this.allNodes.filter(n=>!n.parentId);this.results.set(e);return}try{let e=await Z(this.http.get(`${this.apiUrl}/search?q=${encodeURIComponent(t)}`));this.results.set(e.data)}catch{this.results.set([])}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-topic-picker"]],outputs:{topicSelected:"topicSelected",cancelled:"cancelled"},decls:18,vars:2,consts:[["role","dialog","aria-modal","true","aria-label","Izbor teme",1,"overlay",3,"click"],[1,"picker-panel",3,"click"],[1,"picker-header"],[1,"picker-title"],[1,"search-wrapper"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"search-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["placeholder","Pretra\u017Ei teme...","autofocus","","role","searchbox","aria-label","Pretra\u017Ei teme",1,"search-input",3,"input","value"],[1,"results-list"],[1,"loading-text"],[1,"empty-results"],[1,"picker-footer"],[1,"cancel-btn",3,"click"],[1,"skip-btn",3,"click"],[1,"result-item"],[1,"result-item",3,"click"],[1,"result-label"],[1,"result-path"]],template:function(e,n){e&1&&(m(0,"div",0),P("click",function(a){return n.onOverlayClick(a)}),m(1,"div",1),P("click",function(a){return a.stopPropagation()}),m(2,"div",2)(3,"div",3),c(4,"Izaberite temu za va\u0161u konverzaciju"),g(),m(5,"div",4),S(),m(6,"svg",5),M(7,"path",6),g(),j(),m(8,"input",7),P("input",function(a){return n.onSearchInput(a)}),g()()(),m(9,"div",8),_(10,bp,2,0,"div",9)(11,yp,3,1,"div",10)(12,Ep,2,0),g(),m(13,"div",11)(14,"button",12),P("click",function(){return n.cancelled.emit()}),c(15,"Otka\u017Ei"),g(),m(16,"button",13),P("click",function(){return n.topicSelected.emit(null)}),c(17," Presko\u010Di \u2014 Op\u0161ti razgovor "),g()()()()),e&2&&(r(8),B("value",n.searchQuery()),r(2),C(n.isLoading()?10:n.results().length===0?11:12))},dependencies:[ie],styles:["[_nghost-%COMP%]{display:block}.overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:100;background:#0009;display:flex;align-items:center;justify-content:center}.picker-panel[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;width:480px;max-height:520px;display:flex;flex-direction:column;box-shadow:0 8px 32px #0006}.picker-header[_ngcontent-%COMP%]{padding:16px 20px 12px;border-bottom:1px solid #2a2a2a}.picker-title[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:#fafafa;margin-bottom:12px}.search-input[_ngcontent-%COMP%]{width:100%;background:#0d0d0d;border:1px solid #2a2a2a;border-radius:8px;padding:10px 12px 10px 36px;color:#fafafa;font-size:13px;font-family:inherit}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.search-input[_ngcontent-%COMP%]::placeholder{color:#707070}.search-wrapper[_ngcontent-%COMP%]{position:relative}.search-icon[_ngcontent-%COMP%]{position:absolute;left:10px;top:50%;transform:translateY(-50%);width:16px;height:16px;color:#707070}.results-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:8px}.result-item[_ngcontent-%COMP%]{display:block;width:100%;text-align:left;padding:10px 12px;border-radius:6px;background:none;border:none;color:inherit;cursor:pointer}.result-item[_ngcontent-%COMP%]:hover{background:#242424}.result-label[_ngcontent-%COMP%]{font-size:13px;color:#fafafa}.result-path[_ngcontent-%COMP%]{font-size:11px;color:#707070;margin-top:2px}.picker-footer[_ngcontent-%COMP%]{padding:12px 20px;border-top:1px solid #2a2a2a;display:flex;justify-content:space-between;align-items:center}.skip-btn[_ngcontent-%COMP%]{background:none;border:1px solid #2a2a2a;border-radius:6px;padding:8px 16px;color:#a1a1a1;font-size:13px;cursor:pointer}.skip-btn[_ngcontent-%COMP%]:hover{color:#fafafa;border-color:#707070}.cancel-btn[_ngcontent-%COMP%]{background:none;border:none;color:#9e9e9e;font-size:13px;cursor:pointer}.cancel-btn[_ngcontent-%COMP%]:hover{color:#fafafa}.empty-results[_ngcontent-%COMP%], .loading-text[_ngcontent-%COMP%]{text-align:center;padding:24px;color:#9e9e9e;font-size:13px}"],changeDetection:0})};function Tp(o,t){if(o&1){let e=E();m(0,"div",0)(1,"div",1),S(),m(2,"svg",2),M(3,"path",3),g(),j(),m(4,"h2"),c(5,"Upoznajte Mentor AI"),g(),m(6,"p"),c(7," Brzi vodi\u010D kroz klju\u010Dne funkcije platforme. Nau\u010Dite kako da koristite AI poslovnog savetnika, upravljate razgovorima i pratite napredak va\u0161eg tima. "),g(),m(8,"div",4)(9,"button",5),P("click",function(){x(e);let i=s();return b(i.startTour())}),c(10,"Zapo\u010Dni vodi\u010D"),g(),m(11,"button",6),P("click",function(){x(e);let i=s();return b(i.skipTour())}),c(12,"Presko\u010Di za sada"),g()()()()}}function Pp(o,t){if(o&1&&M(0,"div",21),o&2){let e=t.$index,n=s(2);N("active",e===n.currentIndex$())("completed",e<n.currentIndex$())}}function Mp(o,t){if(o&1){let e=E();m(0,"button",22),P("click",function(){x(e);let i=s(2);return b(i.prevStep())}),c(1,"Nazad"),g()}}function Ip(o,t){if(o&1){let e=E();m(0,"div",7),P("click",function(){x(e);let i=s();return b(i.skipTour())}),g(),M(1,"div",8),m(2,"div",9),M(3,"div",10),m(4,"div",11),c(5),g(),m(6,"div",12),c(7),g(),m(8,"div",13),c(9),g(),m(10,"div",14)(11,"div",15),G(12,Pp,1,4,"div",16,qe),g(),m(14,"div",17)(15,"button",18),P("click",function(){x(e);let i=s();return b(i.skipTour())}),c(16,"Presko\u010Di"),g(),_(17,Mp,2,0,"button",19),m(18,"button",20),P("click",function(){x(e);let i=s();return b(i.nextStep())}),c(19),g()()()()}if(o&2){let e=s();r(),Y("top",e.spotlightRect$().top,"px")("left",e.spotlightRect$().left,"px")("width",e.spotlightRect$().width,"px")("height",e.spotlightRect$().height,"px"),r(),Y("top",e.tooltipPos$().top,"px")("left",e.tooltipPos$().left,"px"),r(),N("arrow-top",e.currentStep$().position==="bottom")("arrow-bottom",e.currentStep$().position==="top")("arrow-left",e.currentStep$().position==="right")("arrow-right",e.currentStep$().position==="left"),r(2),me("Korak ",e.currentIndex$()+1," od ",e.steps.length),r(2),I(e.currentStep$().title),r(2),I(e.currentStep$().description),r(3),q(e.steps),r(5),C(e.currentIndex$()>0?17:-1),r(2),$(" ",e.currentIndex$()===e.steps.length-1?"Zavr\u0161i":"Dalje"," ")}}var ir="mentor_ai_feature_tour_v1",no=[{target:".sidebar",title:"Navigacija razgovora",description:"Ovde nalazite sve va\u0161e razgovore organizovane po poslovnim konceptima. Kliknite na razgovor da ga otvorite.",position:"right"},{target:".new-chat-btn",title:"Novi razgovor",description:"Kliknite ovde da zapo\u010Dnete novi razgovor sa va\u0161im AI poslovnim savetnikom.",position:"right"},{target:".chat-main",title:"Prostor za razgovor",description:"Ovde se prikazuju poruke \u2014 va\u0161a pitanja i odgovori AI-a sa citiranjima i ocenama pouzdanosti.",position:"left"},{target:"app-chat-input",title:"Unos poruke",description:"Postavite pitanja, zatra\u017Eite analize ili pokrenite zadatke. AI \u0107e automatski kreirati i izvr\u0161iti poslovne zadatke.",position:"top"},{target:".auto-ai-toggle",title:"Automatski AI re\u017Eim",description:"Kada je uklju\u010Den, AI autonomno popunjava i ocenjuje sve kreirane zadatke bez \u010Dekanja na va\u0161u potvrdu.",position:"bottom"},{target:".sidebar-footer",title:"Pode\u0161avanja",description:"Pristupite konfiguraciji AI provajdera, upravljanju timom i pode\u0161avanjima naloga.",position:"right"}],Xt=class o{tourComplete=K();onEscapeKey(){(this.isActive$()||this.showWelcome$())&&this.skipTour()}onWindowResize(){this.isActive$()&&this.positionTooltip()}steps=no;showWelcome$=v(!1);isActive$=v(!1);currentIndex$=v(0);currentStep$=v(no[0]);spotlightRect$=v({top:0,left:0,width:0,height:0});tooltipPos$=v({top:0,left:0});resizeObserver;ngOnInit(){this.isTourCompleted()||setTimeout(()=>this.showWelcome$.set(!0),800)}ngOnDestroy(){this.resizeObserver?.disconnect()}launchTour(){this.currentIndex$.set(0),this.currentStep$.set(no[0]),this.showWelcome$.set(!0)}startTour(){this.showWelcome$.set(!1),this.isActive$.set(!0),this.currentIndex$.set(0),this.currentStep$.set(no[0]),this.positionTooltip(),this.listenForResize()}skipTour(){this.isActive$.set(!1),this.showWelcome$.set(!1),this.markTourCompleted(),this.resizeObserver?.disconnect(),this.tourComplete.emit()}nextStep(){let t=this.currentIndex$()+1;if(t>=this.steps.length){this.isActive$.set(!1),this.markTourCompleted(),this.resizeObserver?.disconnect(),this.tourComplete.emit();return}this.currentIndex$.set(t),this.currentStep$.set(this.steps[t]),this.positionTooltip()}prevStep(){let t=this.currentIndex$()-1;t<0||(this.currentIndex$.set(t),this.currentStep$.set(this.steps[t]),this.positionTooltip())}positionTooltip(){let t=this.currentStep$(),e=document.querySelector(t.target);if(!e){let y=this.currentIndex$()+1;y<this.steps.length?(this.currentIndex$.set(y),this.currentStep$.set(this.steps[y]),setTimeout(()=>this.positionTooltip(),50)):this.skipTour();return}let n=e.getBoundingClientRect(),i=8;this.spotlightRect$.set({top:n.top-i,left:n.left-i,width:n.width+i*2,height:n.height+i*2});let a=340,l=200,h=16,d=0,k=0;switch(t.position){case"right":d=n.top,k=n.right+h,k+a>window.innerWidth&&(k=Math.max(16,n.left),d=n.bottom+h);break;case"left":d=n.top,k=n.left-a-h,k<16&&(k=Math.max(16,n.left),d=n.bottom+h);break;case"bottom":d=n.bottom+h,k=Math.max(16,n.left+n.width/2-a/2);break;case"top":d=n.top-l-h,k=Math.max(16,n.left+n.width/2-a/2),d<16&&(d=n.bottom+h);break}k=Math.max(16,Math.min(k,window.innerWidth-a-16)),d=Math.max(16,d),this.tooltipPos$.set({top:d,left:k})}listenForResize(){this.resizeObserver?.disconnect(),this.resizeObserver=new ResizeObserver(()=>{this.isActive$()&&this.positionTooltip()}),this.resizeObserver.observe(document.body)}isTourCompleted(){try{return localStorage.getItem(ir)==="true"}catch{return!1}}markTourCompleted(){try{localStorage.setItem(ir,"true")}catch{}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-feature-tour"]],hostBindings:function(e,n){e&1&&O("keydown.escape",function(){return n.onEscapeKey()},Li)("resize",function(){return n.onWindowResize()},zi)},outputs:{tourComplete:"tourComplete"},decls:2,vars:2,consts:[[1,"welcome-overlay"],["role","dialog","aria-label","Dobrodo\u0161li u vodi\u010D",1,"welcome-card"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"welcome-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"],[1,"welcome-actions"],[1,"welcome-start-btn",3,"click"],[1,"welcome-skip-btn",3,"click"],[1,"tour-overlay",3,"click"],[1,"tour-spotlight"],["role","dialog","aria-label","Vodi\u010D kroz funkcije",1,"tour-tooltip"],[1,"tooltip-arrow"],[1,"tooltip-step"],[1,"tooltip-title"],[1,"tooltip-desc"],[1,"tooltip-footer"],[1,"tooltip-progress"],[1,"progress-dot",3,"active","completed"],[1,"tooltip-actions"],[1,"tour-btn","tour-btn-skip",3,"click"],[1,"tour-btn","tour-btn-prev"],[1,"tour-btn","tour-btn-next",3,"click"],[1,"progress-dot"],[1,"tour-btn","tour-btn-prev",3,"click"]],template:function(e,n){e&1&&(_(0,Tp,13,0,"div",0),_(1,Ip,20,26)),e&2&&(C(n.showWelcome$()?0:-1),r(),C(n.isActive$()&&!n.showWelcome$()?1:-1))},dependencies:[ie],styles:["[_nghost-%COMP%]{display:block}.tour-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9998;background:transparent}.tour-spotlight[_ngcontent-%COMP%]{position:fixed;z-index:9999;border-radius:8px;box-shadow:0 0 0 9999px #0009;transition:all .4s cubic-bezier(.4,0,.2,1);pointer-events:none}.tour-tooltip[_ngcontent-%COMP%]{position:fixed;z-index:10000;width:340px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;box-shadow:0 20px 60px #0006;font-family:Inter,system-ui,sans-serif;color:#fafafa;animation:_ngcontent-%COMP%_tooltipFadeIn .3s ease-out}@keyframes _ngcontent-%COMP%_tooltipFadeIn{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.tooltip-arrow[_ngcontent-%COMP%]{position:absolute;width:12px;height:12px;background:#1a1a1a;border:1px solid #2a2a2a;transform:rotate(45deg)}.arrow-top[_ngcontent-%COMP%]{top:-7px;left:24px;border-bottom:none;border-right:none}.arrow-bottom[_ngcontent-%COMP%]{bottom:-7px;left:24px;border-top:none;border-left:none}.arrow-left[_ngcontent-%COMP%]{left:-7px;top:24px;border-top:none;border-right:none}.arrow-right[_ngcontent-%COMP%]{right:-7px;top:24px;border-bottom:none;border-left:none}.tooltip-step[_ngcontent-%COMP%]{font-size:11px;font-weight:600;color:#3b82f6;text-transform:uppercase;letter-spacing:.05em;margin-bottom:8px}.tooltip-title[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:8px}.tooltip-desc[_ngcontent-%COMP%]{font-size:13px;color:#a1a1a1;line-height:1.5;margin-bottom:20px}.tooltip-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.tooltip-progress[_ngcontent-%COMP%]{display:flex;gap:4px}.progress-dot[_ngcontent-%COMP%]{width:6px;height:6px;border-radius:50%;background:#2a2a2a;transition:background .2s}.progress-dot.active[_ngcontent-%COMP%]{background:#3b82f6}.progress-dot.completed[_ngcontent-%COMP%]{background:#22c55e}.tooltip-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.tour-btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;font-family:inherit;border:none;transition:background .15s}.tour-btn-skip[_ngcontent-%COMP%]{background:transparent;color:#9e9e9e;padding:8px 12px}.tour-btn-skip[_ngcontent-%COMP%]:hover{color:#fafafa}.tour-btn-prev[_ngcontent-%COMP%]{background:#242424;color:#fafafa;border:1px solid #2a2a2a}.tour-btn-prev[_ngcontent-%COMP%]:hover{background:#2a2a2a}.tour-btn-next[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.tour-btn-next[_ngcontent-%COMP%]:hover{background:#2563eb}.welcome-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9998;display:flex;align-items:center;justify-content:center;background:#000000b3;animation:_ngcontent-%COMP%_tooltipFadeIn .3s ease-out}.welcome-card[_ngcontent-%COMP%]{width:100%;max-width:420px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:16px;padding:32px;text-align:center;box-shadow:0 25px 60px #00000080;font-family:Inter,system-ui,sans-serif;color:#fafafa;z-index:9999}.welcome-icon[_ngcontent-%COMP%]{width:56px;height:56px;margin:0 auto 20px;color:#3b82f6}.welcome-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:22px;font-weight:700;margin-bottom:12px}.welcome-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#a1a1a1;line-height:1.6;margin-bottom:24px}.welcome-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.welcome-start-btn[_ngcontent-%COMP%]{padding:12px 24px;border-radius:8px;border:none;background:#3b82f6;color:#fff;font-size:15px;font-weight:500;cursor:pointer;font-family:inherit}.welcome-start-btn[_ngcontent-%COMP%]:hover{background:#2563eb}.welcome-skip-btn[_ngcontent-%COMP%]{background:none;border:none;color:#9e9e9e;font-size:13px;cursor:pointer;font-family:inherit}.welcome-skip-btn[_ngcontent-%COMP%]:hover{color:#fafafa}"]})};var $p=["yoloLogContainer"],Op=["messagesContainer"],oo=(o,t)=>t.id,Np=(o,t)=>t.stepId,Ap=(o,t)=>t.planId,Dp=(o,t)=>t.conceptName;function Rp(o,t){if(o&1){let e=E();p(0,"div",28),S(),p(1,"svg",29),T(2,"path",30),u(),j(),p(3,"span",31),c(4),u(),p(5,"button",32),O("click",function(){let i=x(e).$implicit,a=s();return b(a.dismissErrorById(i.id))}),S(),p(6,"svg",33),T(7,"path",34),u()()()}if(o&2){let e=t.$implicit,n=t.$index;Y("top",16+n*64,"px"),r(4),I(e.message)}}function zp(o,t){if(o&1){let e=E();p(0,"div",35),S(),p(1,"svg",36),T(2,"path",37),u(),j(),p(3,"span",31),c(4),u(),p(5,"button",38),O("click",function(){let i=x(e).$implicit,a=s();return b(a.dismissInfoById(i.id))}),S(),p(6,"svg",33),T(7,"path",34),u()()()}if(o&2){let e=t.$implicit,n=t.$index,i=s();Y("top",16+(i.errorMessages$().length+n)*64,"px"),r(4),I(e.message)}}function Lp(o,t){if(o&1){let e=E();p(0,"app-topic-picker",39),O("topicSelected",function(i){x(e);let a=s();return b(a.onTopicSelected(i))})("cancelled",function(){x(e);let i=s();return b(i.onTopicPickerCancelled())}),u()}}function Fp(o,t){if(o&1){let e=E();p(0,"button",40),O("click",function(){x(e);let i=s();return b(i.toggleSidebar())}),S(),p(1,"svg",10),T(2,"path",41),u()()}}function Vp(o,t){if(o&1){let e=E();p(0,"div",42),O("click",function(){x(e);let i=s();return b(i.toggleSidebar())}),u()}}function Bp(o,t){o&1&&(p(0,"div",24)(1,"div",43),T(2,"div",44),u(),p(3,"div",45),T(4,"div",46),u(),p(5,"div",43),T(6,"div",44),u(),p(7,"div",45),T(8,"div",47),u(),p(9,"div",43),T(10,"div",44),u(),p(11,"div",45),T(12,"div",46),u()())}function jp(o,t){if(o&1&&(S(),p(0,"svg",53),T(1,"path",54),u(),j(),p(2,"h2"),c(3),u()),o&2){let e=s(2);r(3),I(e.folderName$())}}function Wp(o,t){if(o&1&&T(0,"app-persona-badge",55),o&2){let e=s(3);V("personaType",e.currentPersonaType$())}}function Hp(o,t){if(o&1&&(p(0,"h2"),c(1),u(),_(2,Wp,1,1,"app-persona-badge",55)),o&2){let e,n=s(2);r(),I(((e=n.activeConversation$())==null?null:e.title)||"New Conversation"),r(),C(n.currentPersonaType$()?2:-1)}}function Up(o,t){if(o&1){let e=E();p(0,"div",51)(1,"div",56)(2,"button",57),O("click",function(){x(e);let i=s(2);return b(i.activeTab$.set("chat"))}),c(3," Chat "),u(),p(4,"button",57),O("click",function(){x(e);let i=s(2);return b(i.activeTab$.set("notes"))}),c(5," Tasks "),u()(),p(6,"button",58),O("click",function(){x(e);let i=s(2);return b(i.togglePersonaSelector())}),S(),p(7,"svg",14),T(8,"path",59),u(),c(9),u(),j(),p(10,"div",60)(11,"span",61),c(12,"Auto AI"),u(),p(13,"button",62),O("click",function(){x(e);let i=s(2);return b(i.toggleAutoAiPopuni())}),T(14,"span",63),u()()()}if(o&2){let e=s(2);r(2),N("active",e.activeTab$()==="chat"),r(2),N("active",e.activeTab$()==="notes"),r(2),V("disabled",e.isCurrentConversationExecuting$()),r(3),$(" ",e.showPersonaSelector$()?"Hide Personas":"Switch Persona"," "),r(4),N("active",e.autoAiPopuni$()),V("disabled",e.isTogglingAutoPopuni$())}}function Gp(o,t){if(o&1){let e=E();p(0,"div",64),c(1),p(2,"button",65),O("click",function(){x(e);let i=s(2);return b(i.disconnectToast$.set(null))}),c(3," \xD7 "),u()()}if(o&2){let e=s(2);N("error",e.connectionState$()==="disconnected")("warning",e.connectionState$()==="reconnecting")("success",e.connectionState$()==="connected"),r(),$(" ",e.disconnectToast$()," ")}}function qp(o,t){if(o&1){let e=E();p(0,"div",69)(1,"p",83),c(2," Select a department persona for specialized AI responses: "),u(),p(3,"app-persona-selector",84),O("personaSelected",function(i){x(e);let a=s(4);return b(a.onPersonaSelected(i))}),u()()}if(o&2){let e=s(4);r(3),V("selectedType",e.currentPersonaType$())("allowNone",!1)}}function Yp(o,t){if(o&1){let e=E();p(0,"button",93),O("click",function(i){return x(e),s(6).cancelExecution(),b(i.stopPropagation())}),c(1," Prekini "),u()}}function Kp(o,t){if(o&1){let e=E();p(0,"button",93),O("click",function(i){return x(e),s(6).rejectPlan(),b(i.stopPropagation())}),c(1," Otka\u017Ei "),u(),p(2,"button",94),O("click",function(i){return x(e),s(6).approvePlan(),b(i.stopPropagation())}),c(3," Pokreni "),u()}}function Qp(o,t){if(o&1&&_(0,Yp,2,0,"button",92)(1,Kp,4,0),o&2){let e=s(5);C(e.isExecutingWorkflow$()?0:1)}}function Zp(o,t){o&1&&(S(),p(0,"svg",96),T(1,"path",103),u())}function Xp(o,t){o&1&&(S(),p(0,"svg",97),T(1,"path",104),u())}function Jp(o,t){o&1&&(S(),p(0,"svg",97),T(1,"path",34),u())}function eu(o,t){if(o&1&&c(0),o&2){let e=s().$implicit;$(" ",e.workflowStepNumber," ")}}function tu(o,t){if(o&1&&(p(0,"span",102),c(1),u()),o&2){let e=s().$implicit;r(),I(e.departmentTag)}}function nu(o,t){if(o&1&&(p(0,"div",91)(1,"div",95),_(2,Zp,2,0,":svg:svg",96)(3,Xp,2,0,":svg:svg",97)(4,Jp,2,0,":svg:svg",97)(5,eu,1,1),u(),p(6,"div",98)(7,"div",99),c(8),u(),p(9,"div",100),c(10),u(),p(11,"div",101)(12,"span",102),c(13),u(),_(14,tu,2,1,"span",102),p(15,"span",102),c(16),u()()()()),o&2){let e=t.$implicit,n=s(5);r(),N("step-pending",n.getStepStatus(e.stepId)==="pending")("step-in-progress",n.getStepStatus(e.stepId)==="in_progress")("step-completed",n.getStepStatus(e.stepId)==="completed")("step-failed",n.getStepStatus(e.stepId)==="failed"),r(),C(n.getStepStatus(e.stepId)==="in_progress"?2:n.getStepStatus(e.stepId)==="completed"?3:n.getStepStatus(e.stepId)==="failed"?4:5),r(6),I(e.title),r(2),I(e.description),r(3),I(e.conceptName),r(),C(e.departmentTag?14:-1),r(2),$("~",e.estimatedMinutes,"m")}}function ou(o,t){if(o&1){let e=E();p(0,"div",85)(1,"div",86),O("click",function(){x(e);let i=s(4);return b(i.togglePlanCollapse())}),S(),p(2,"svg",87),T(3,"path",88),u(),j(),p(4,"h3"),c(5),u(),p(6,"div",89)(7,"span"),c(8),u(),p(9,"span"),c(10),u()(),_(11,Qp,2,1),u(),p(12,"div",90),G(13,nu,17,14,"div",91,Np),u()()}if(o&2){let e=s(4);N("collapsed",e.planCollapsed$()),r(2),N("expanded",!e.planCollapsed$()),r(3),$(" ",e.isExecutingWorkflow$()?"Izvr\u0161avanje plana...":"Plan izvr\u0161avanja"," "),r(3),$("",e.currentPlan$().steps.length," koraka"),r(2),$("~",e.currentPlan$().totalEstimatedMinutes," min"),r(),C(e.planCollapsed$()?-1:11),r(2),q(e.currentPlan$().steps)}}function iu(o,t){if(o&1&&(p(0,"span",111),c(1),u()),o&2){let e=s(6);r(),me("",e.yoloProgress$().currentTasks.length," aktivn",e.yoloProgress$().currentTasks.length>1?"a":"o")}}function au(o,t){if(o&1&&(p(0,"span",112),c(1),u()),o&2){let e=s(6);r(),$("",e.yoloProgress$().failed," neuspe\u0161no")}}function ru(o,t){if(o&1&&(p(0,"span",113),c(1),u()),o&2){let e=s(6);r(),$("+",e.yoloProgress$().discoveredCount)}}function su(o,t){if(o&1&&(p(0,"div",105)(1,"span",107),c(2,"YOLO"),u(),p(3,"div",108),T(4,"div",109),u(),p(5,"span",110),c(6),u(),_(7,iu,2,2,"span",111),_(8,au,2,1,"span",112),_(9,ru,2,1,"span",113),u()),o&2){let e=s(5);r(4),Y("width",(e.yoloProgress$().executionBudget??e.yoloProgress$().total)>0?e.yoloProgress$().completed/(e.yoloProgress$().executionBudget??e.yoloProgress$().total)*100:0,"%"),r(2),me("",e.yoloProgress$().completed,"/",e.yoloProgress$().executionBudget??e.yoloProgress$().total),r(),C(e.yoloProgress$().currentTasks.length>0?7:-1),r(),C(e.yoloProgress$().failed>0?8:-1),r(),C(e.yoloProgress$().discoveredCount>0?9:-1)}}function lu(o,t){if(o&1&&(p(0,"span",111),c(1),u()),o&2){let e=s().$implicit;r(),I(e.currentStepTitle)}}function cu(o,t){o&1&&(p(0,"span",117),c(1,"Zavr\u0161eno"),u())}function du(o,t){o&1&&(p(0,"span",112),c(1,"Gre\u0161ka"),u())}function pu(o,t){o&1&&(p(0,"span",112),c(1,"Otkazano"),u())}function uu(o,t){if(o&1&&(p(0,"div",114)(1,"span",107),c(2),u(),p(3,"div",115)(4,"div",108),T(5,"div",116),u(),p(6,"span",110),c(7),u()(),_(8,lu,2,1,"span",111),_(9,cu,2,0,"span",117),_(10,du,2,0,"span",112),_(11,pu,2,0,"span",112),u()),o&2){let e=t.$implicit;N("wse-executing",e.status==="executing")("wse-completed",e.status==="completed")("wse-failed",e.status==="failed")("wse-cancelled",e.status==="cancelled"),r(2),I(e.title),r(3),Y("width",e.totalSteps>0?e.completedSteps/e.totalSteps*100:0,"%"),r(2),me("",e.completedSteps,"/",e.totalSteps),r(),C(e.status==="executing"&&e.currentStepTitle?8:-1),r(),C(e.status==="completed"?9:-1),r(),C(e.status==="failed"?10:-1),r(),C(e.status==="cancelled"?11:-1)}}function mu(o,t){if(o&1&&(p(0,"div",71),_(1,su,10,7,"div",105),G(2,uu,12,17,"div",106,Ap),u()),o&2){let e=s(4);r(),C(e.isYoloMode$()&&e.yoloProgress$()?1:-1),r(),q(e.workflowHistory$())}}function hu(o,t){if(o&1){let e=E();p(0,"app-chat-message",118),O("citationClick",function(i){x(e);let a=s(4);return b(a.onCitationClick(i))})("actionClick",function(i){x(e);let a=s(4);return b(a.onSuggestedAction(i))}),u()}if(o&2){let e=t.$implicit,n=s(4);V("message",e)("personaType",e.role==="ASSISTANT"?n.currentPersonaType$():null)}}function gu(o,t){if(o&1&&c(0),o&2){let e=s(5);mn(" Korak ",e.currentStepIndex$()+1,"/",e.totalStepsCount$(),": ",e.currentStepTitle$()," ")}}function fu(o,t){o&1&&c(0," Pripremam izvr\u0161avanje... ")}function _u(o,t){if(o&1&&(p(0,"div",76),S(),p(1,"svg",119),T(2,"path",103),u(),_(3,gu,1,3)(4,fu,1,0),u()),o&2){let e=s(4);r(3),C(e.currentStepTitle$()?3:4)}}function Cu(o,t){if(o&1&&c(0),o&2){let e=s(5);me(" Processing ",e.yoloProgress$().currentTasks.length," concept",e.yoloProgress$().currentTasks.length>1?"s":""," ")}}function xu(o,t){o&1&&c(0," YOLO Mode \u2014 Autonomous Execution ")}function bu(o,t){if(o&1&&(c(0," | Failed: "),p(1,"span",126),c(2),u()),o&2){let e=s(5);r(2),I(e.yoloProgress$().failed)}}function vu(o,t){if(o&1&&(c(0," | "),p(1,"span",127),c(2),u()),o&2){let e=s(5);r(2),$("",e.yoloProgress$().createdOnlyCount," queued for next run")}}function ku(o,t){if(o&1&&(c(0," | "),p(1,"span",128),c(2),u()),o&2){let e=s(5);r(2),$("Discovered: ",e.yoloProgress$().discoveredCount)}}function yu(o,t){if(o&1&&(p(0,"span",132),c(1),u()),o&2){let e=s().$implicit;r(),mn(" Step ",(e.currentStepIndex??0)+1,"/",e.totalSteps??"?",": ",e.currentStep," ")}}function wu(o,t){if(o&1&&(p(0,"div",129),T(1,"span",130),p(2,"span",131),c(3),u(),_(4,yu,2,3,"span",132),u()),o&2){let e=t.$implicit;r(3),I(e.conceptName),r(),C(e.currentStep?4:-1)}}function Su(o,t){if(o&1&&(p(0,"div",125),G(1,wu,5,2,"div",129,Dp),u()),o&2){let e=s(5);r(),q(e.yoloProgress$().currentTasks)}}function Eu(o,t){if(o&1&&(p(0,"div",137),c(1),u()),o&2){let e=t.$implicit;r(),I(e)}}function Tu(o,t){if(o&1&&(p(0,"div",136,1),G(2,Eu,2,1,"div",137,qe),u()),o&2){let e=s(6);r(2),q(e.yoloProgress$().recentLogs)}}function Pu(o,t){if(o&1){let e=E();p(0,"button",133),O("click",function(){x(e);let i=s(5);return b(i.toggleYoloActivityLog())}),S(),p(1,"svg",134),T(2,"path",135),u(),c(3),u(),_(4,Tu,4,0,"div",136)}if(o&2){let e=s(5);r(),N("expanded",e.showYoloActivityLog$()),r(2),me(" ",e.showYoloActivityLog$()?"Hide":"Show"," Activity Log (",e.yoloProgress$().recentLogs.length,") "),r(),C(e.showYoloActivityLog$()?4:-1)}}function Mu(o,t){if(o&1&&(p(0,"div",77)(1,"div",120),T(2,"span",121),_(3,Cu,1,2)(4,xu,1,0),u(),p(5,"div",122),c(6," Executing: "),p(7,"span"),c(8),u(),_(9,bu,3,1),_(10,vu,3,1),_(11,ku,3,1),u(),p(12,"div",123),T(13,"div",124),u(),_(14,Su,3,0,"div",125),_(15,Pu,5,5),u()),o&2){let e=s(4);r(3),C(e.yoloProgress$().currentTasks.length>0?3:4),r(5),me("",e.yoloProgress$().completed,"/",e.yoloProgress$().executionBudget??e.yoloProgress$().total),r(),C(e.yoloProgress$().failed>0?9:-1),r(),C((e.yoloProgress$().createdOnlyCount??0)>0?10:-1),r(),C(e.yoloProgress$().discoveredCount>0?11:-1),r(2),Y("width",(e.yoloProgress$().executionBudget??e.yoloProgress$().total)>0?e.yoloProgress$().completed/(e.yoloProgress$().executionBudget??e.yoloProgress$().total)*100:0,"%"),r(),C(e.yoloProgress$().currentTasks.length>0?14:-1),r(),C(e.yoloProgress$().recentLogs&&e.yoloProgress$().recentLogs.length>0?15:-1)}}function Iu(o,t){if(o&1&&(p(0,"span",147),S(),p(1,"svg",148),T(2,"path",149),u(),c(3),u()),o&2){let e=s().$implicit;r(3),$(" ",e.conceptName," ")}}function $u(o,t){o&1&&(p(0,"span",147),S(),p(1,"svg",148),T(2,"path",135),u(),c(3," Otvori "),u())}function Ou(o,t){if(o&1){let e=E();p(0,"button",145),O("click",function(){let i=x(e).$implicit,a=s(5);return b(a.navigateToCreatedTask(i))}),p(1,"span",146),c(2),u(),_(3,Iu,4,1,"span",147)(4,$u,4,0,"span",147),u()}if(o&2){let e=t.$implicit;N("cross-concept",e.isCrossConversation),r(2),I(e.title),r(),C(e.isCrossConversation&&e.conceptName?3:4)}}function Nu(o,t){if(o&1){let e=E();p(0,"div",78)(1,"div",138),S(),p(2,"svg",139),T(3,"path",140),u(),c(4," Kreirani zadaci "),j(),p(5,"button",141),O("click",function(){x(e);let i=s(4);return b(i.createdTaskNotifications$.set([]))}),S(),p(6,"svg",142),T(7,"path",143),u()()(),G(8,Ou,5,4,"button",144,oo),u()}if(o&2){let e=s(4);r(8),q(e.createdTaskNotifications$())}}function Au(o,t){if(o&1&&T(0,"app-chat-message",79),o&2){let e=s(4);V("message",e.streamingMessage$())("isStreaming",!0)("personaType",e.currentPersonaType$())}}function Du(o,t){if(o&1&&T(0,"app-typing-indicator",80),o&2){let e=s(4);V("personaType",e.currentPersonaType$())("phase",e.researchPhase$())}}function Ru(o,t){o&1&&(p(0,"div",76),S(),p(1,"svg",119),T(2,"path",103),u(),c(3," Generi\u0161em plan izvr\u0161avanja... "),u())}function zu(o,t){o&1&&(T(0,"span",161),c(1," Obra\u0111ujem... "))}function Lu(o,t){o&1&&(c(0," Nastavi "),S(),p(1,"svg",162),T(2,"line",163)(3,"polyline",164),u())}function Fu(o,t){if(o&1){let e=E();p(0,"div",157)(1,"button",159),O("click",function(){x(e);let i=s(5);return b(i.continueWorkflowStep())}),_(2,zu,2,0)(3,Lu,4,0),u(),p(4,"button",160),O("click",function(){x(e);let i=s(5);return b(i.cancelExecution())}),c(5," Otka\u017Ei "),u()()}if(o&2){let e=s(5);r(),V("disabled",e.isProcessingStep$()),r(),C(e.isProcessingStep$()?2:3),r(2),V("disabled",e.isProcessingStep$())}}function Vu(o,t){o&1&&(p(0,"div",158),S(),p(1,"svg",165),T(2,"path",166),u(),j(),p(3,"span"),c(4,"Unesite odgovor u polje za poruke ispod"),u()())}function Bu(o,t){if(o&1&&(p(0,"div",81)(1,"div",150),S(),p(2,"svg",151),T(3,"circle",152)(4,"polyline",153),u(),j(),p(5,"span",154),c(6),u()(),p(7,"p",155),c(8),u(),p(9,"p",156),c(10),u(),_(11,Fu,6,3,"div",157)(12,Vu,5,0,"div",158),u()),o&2){let e=t;r(6),mn("Korak ",e.stepIndex+1,"/",e.totalSteps,": ",e.conceptName),r(2),I(e.stepTitle),r(2),I(e.stepDescription),r(),C(e.inputType==="confirmation"?11:12)}}function ju(o,t){if(o&1){let e=E();p(0,"div",82)(1,"button",167),O("click",function(){x(e);let i=s(4);return b(i.returnToPreviousConversation())}),S(),p(2,"svg",162),T(3,"line",168)(4,"polyline",169),u(),c(5," Vrati se na prethodnu konverzaciju "),u()()}}function Wu(o,t){o&1&&(T(0,"span",161),c(1," Obra\u0111ujem... "))}function Hu(o,t){if(o&1&&(c(0),S(),p(1,"svg",162),T(2,"line",163)(3,"polyline",164),u()),o&2){let e=s(5);$(" ",e.userStepInput$()?"Izvr\u0161i sa odgovorom":"Presko\u010Di i izvr\u0161i"," ")}}function Uu(o,t){if(o&1){let e=E();p(0,"div",81)(1,"div",150),S(),p(2,"svg",151),T(3,"circle",152)(4,"polyline",153),u(),j(),p(5,"span",154),c(6),u()(),p(7,"p",155),c(8),u(),p(9,"p",156),c(10),u(),p(11,"div",158),S(),p(12,"svg",165),T(13,"path",166),u(),j(),p(14,"span"),c(15,"Imate li dodatne informacije ili odgovore za ovaj korak?"),u()(),p(16,"textarea",170),O("input",function(i){x(e);let a=s(4);return b(a.userStepInput$.set(i.target.value))}),u(),p(17,"div",157)(18,"button",159),O("click",function(){x(e);let i=s(4);return b(i.continueWorkflow())}),_(19,Wu,2,0)(20,Hu,4,1),u(),p(21,"button",160),O("click",function(){x(e);let i=s(4);return b(i.cancelExecution())}),c(22," Otka\u017Ei "),u()()()}if(o&2){let e=s(4);r(6),me("Korak ",e.nextStepInfo$().stepIndex+1,"/",e.nextStepInfo$().totalSteps,":"),r(2),I(e.nextStepInfo$().title),r(2),I(e.nextStepInfo$().description),r(6),V("value",e.userStepInput$()),r(2),V("disabled",e.isProcessingStep$()),r(),C(e.isProcessingStep$()?19:20),r(2),V("disabled",e.isProcessingStep$())}}function Gu(o,t){if(o&1){let e=E();p(0,"button",173),O("click",function(){x(e);let i=s(5);return b(i.stopGeneration())}),S(),p(1,"svg",10),T(2,"rect",174),u(),c(3," Zaustavi generisanje "),u()}}function qu(o,t){if(o&1){let e=E();p(0,"button",175),O("click",function(){x(e);let i=s(5);return b(i.scrollToBottom())}),S(),p(1,"svg",10),T(2,"path",176),u()()}}function Yu(o,t){if(o&1&&_(0,Gu,4,0,"button",171)(1,qu,3,0,"button",172),o&2){let e=s(4);C(e.isStreaming$()?0:1)}}function Ku(o,t){if(o&1){let e=E();_(0,qp,4,2,"div",69),_(1,ou,15,8,"div",70),_(2,mu,4,1,"div",71),p(3,"div",72)(4,"div",73,0),O("scroll",function(){x(e);let i=s(3);return b(i.onMessagesScroll())}),p(6,"div",74),G(7,hu,1,2,"app-chat-message",75,oo),_(9,_u,5,1,"div",76),_(10,Mu,16,10,"div",77),_(11,Nu,10,0,"div",78),_(12,Au,1,3,"app-chat-message",79),_(13,Du,1,2,"app-typing-indicator",80),_(14,Ru,4,0,"div",76),_(15,Bu,13,6,"div",81),_(16,ju,6,0,"div",82),_(17,Uu,23,8,"div",81),u()(),_(18,Yu,2,1),u()}if(o&2){let e,n=s(3);C(n.showPersonaSelector$()?0:-1),r(),C(n.showPlanOverlay$()&&n.currentPlan$()?1:-1),r(),C(n.sortedWorkflowHistory$().length>0||n.isYoloMode$()&&n.yoloProgress$()?2:-1),r(5),q(n.messages$()),r(2),C(n.isCurrentConversationExecuting$()&&!n.showPlanOverlay$()?9:-1),r(),C(n.isYoloMode$()&&n.yoloProgress$()?10:-1),r(),C(n.createdTaskNotifications$().length>0?11:-1),r(),C(n.isStreaming$()?12:-1),r(),C(n.isLoading$()&&!n.isStreaming$()?13:-1),r(),C(n.isGeneratingPlan$()?14:-1),r(),C((e=n.currentWorkflowStepInput$())?15:-1,e),r(),C(n.previousConversationId$()?16:-1),r(),C(n.awaitingConfirmation$()&&n.nextStepInfo$()&&!n.currentWorkflowStepInput$()?17:-1),r(),C(n.showScrollToBottom$()?18:-1)}}function Qu(o,t){if(o&1&&(p(0,"span",184)(1,"strong"),c(2),u(),c(3," na \u010Dekanju"),u()),o&2){let e=s(5);r(2),I(e.brainStats$().pendingTasks)}}function Zu(o,t){if(o&1){let e=E();p(0,"div",60)(1,"span",61),c(2,"Auto AI"),u(),p(3,"button",62),O("click",function(){x(e);let i=s(5);return b(i.toggleAutoAiPopuni())}),T(4,"span",63),u()()}if(o&2){let e=s(5);r(3),N("active",e.autoAiPopuni$()),V("disabled",e.isTogglingAutoPopuni$())}}function Xu(o,t){if(o&1&&(p(0,"div",177)(1,"span",180),c(2,"Mozak"),u(),p(3,"div",181),T(4,"div",182),u(),p(5,"span",183)(6,"strong"),c(7),u(),c(8," domena"),u(),_(9,Qu,4,1,"span",184),_(10,Zu,5,3,"div",60),u()),o&2){let e=s(4);r(4),Y("width",e.brainStats$().progressPercent,"%"),r(3),me("",e.brainStats$().completedDomains,"/",e.brainStats$().totalDomains),r(2),C(e.brainStats$().pendingTasks>0?9:-1),r(),C(e.isPlatformOwner$()?10:-1)}}function Ju(o,t){if(o&1){let e=E();_(0,Xu,11,6,"div",177),p(1,"div",178)(2,"app-conversation-notes",179),O("viewMessage",function(i){x(e);let a=s(3);return b(a.onViewMessage(i))})("runAgents",function(i){x(e);let a=s(3);return b(a.onRunAgents(i))})("executeTask",function(i){x(e);let a=s(3);return b(a.onExecuteSingleTask(i))})("submitTaskResult",function(i){x(e);let a=s(3);return b(a.onSubmitTaskResult(i))}),u()()}if(o&2){let e,n=s(3);C(n.brainStats$().totalDomains>0?0:-1),r(2),V("conversationId",n.activeConversationId$())("conceptId",((e=n.activeConversation$())==null?null:e.conceptId)??null)("autoSelectTaskIds",n.autoSelectTaskIds$())("isExecuting",n.isCurrentConversationExecuting$())("executingTaskId",n.executingTaskId$())("taskExecutionContent",n.taskExecutionStreamContent$())("submittingResultId",n.submittingResultId$())("taskResultContent",n.taskResultStreamContent$())("isGeneratingPlan",n.isGeneratingPlan$())("parallelTaskStates",n.parallelTaskStates$())("isParallelExecuting",n.isParallelExecuting$())}}function em(o,t){if(o&1){let e=E();p(0,"button",192),O("click",function(){x(e);let i=s(4);return i.activeTab$.set("notes"),b(i.dismissNextStep())}),c(1),u()}if(o&2){let e=s(4);r(),$(" ",e.nextStepSuggestion$().secondaryLabel," ")}}function tm(o,t){if(o&1){let e=E();p(0,"div",66),S(),p(1,"svg",185),T(2,"path",186),u(),j(),p(3,"span",187),c(4),u(),p(5,"div",188)(6,"button",189),O("click",function(){x(e);let i=s(3);return b(i.onNextStepAction())}),c(7),u(),_(8,em,2,1,"button",190),u(),p(9,"button",191),O("click",function(){x(e);let i=s(3);return b(i.dismissNextStep())}),c(10,"\xD7"),u()()}if(o&2){let e=s(3);r(4),I(e.nextStepSuggestion$().message),r(3),$(" ",e.nextStepSuggestion$().actionLabel," "),r(),C(e.nextStepSuggestion$().secondaryLabel?8:-1)}}function nm(o,t){if(o&1){let e=E();_(0,Ku,19,13)(1,Ju,3,12),_(2,tm,11,3,"div",66),p(3,"div",67)(4,"app-chat-input",68),O("messageSent",function(i){x(e);let a=s(2);return b(a.sendMessage(i))}),u()()}if(o&2){let e=s(2);C(e.activeTab$()==="chat"?0:1),r(2),C(e.nextStepSuggestion$()?2:-1),r(2),V("disabled",e.isLoading$()&&!e.allowWorkflowInput$())}}function om(o,t){if(o&1&&(p(0,"span",184)(1,"strong"),c(2),u(),c(3," na \u010Dekanju"),u()),o&2){let e=s(4);r(2),I(e.brainStats$().pendingTasks)}}function im(o,t){if(o&1){let e=E();p(0,"div",177)(1,"span",180),c(2,"Mozak"),u(),p(3,"div",181),T(4,"div",182),u(),p(5,"span",183)(6,"strong"),c(7),u(),c(8," domena"),u(),_(9,om,4,1,"span",184),p(10,"div",60)(11,"span",61),c(12,"Auto AI"),u(),p(13,"button",62),O("click",function(){x(e);let i=s(3);return b(i.toggleAutoAiPopuni())}),T(14,"span",63),u()()()}if(o&2){let e=s(3);r(4),Y("width",e.brainStats$().progressPercent,"%"),r(3),me("",e.brainStats$().completedDomains,"/",e.brainStats$().totalDomains),r(2),C(e.brainStats$().pendingTasks>0?9:-1),r(4),N("active",e.autoAiPopuni$()),V("disabled",e.isTogglingAutoPopuni$())}}function am(o,t){if(o&1){let e=E();p(0,"div",193)(1,"div",194)(2,"div",195)(3,"div",196),c(4,"Zavr\u0161eno"),u(),p(5,"div",197),c(6),u()(),p(7,"div",195)(8,"div",196),c(9,"Na \u010Dekanju"),u(),p(10,"div",198),c(11),u()(),p(12,"div",195)(13,"div",196),c(14,"Ukupno"),u(),p(15,"div",199),c(16),u()()(),p(17,"div",200)(18,"button",201),O("click",function(){x(e);let i=s(2);return b(i.onRunBrain())}),S(),p(19,"svg",14),T(20,"path",202),u(),c(21," Pokreni Brain "),u(),j(),p(22,"button",203),O("click",function(){x(e);let i=s(2);return b(i.onRunBrainYolo())}),S(),p(23,"svg",14),T(24,"path",202),u()(),j(),p(25,"button",204),O("click",function(){x(e);let i=s(2);return b(i.showTopicPicker$.set(!0))}),S(),p(26,"svg",14),T(27,"path",205),u(),c(28," Istra\u017Ei koncept "),u()()(),_(29,im,15,8,"div",177),j(),p(30,"div",206)(31,"app-conversation-notes",207),O("viewMessage",function(i){x(e);let a=s(2);return b(a.onViewMessage(i))})("runAgents",function(i){x(e);let a=s(2);return b(a.onRunAgents(i))})("executeTask",function(i){x(e);let a=s(2);return b(a.onExecuteSingleTask(i))})("submitTaskResult",function(i){x(e);let a=s(2);return b(a.onSubmitTaskResult(i))}),u()()}if(o&2){let e=s(2);r(6),I(e.domainCompletedCount$()),r(5),I(e.domainPendingCount$()),r(5),$(" ",e.domainCompletedCount$()+e.domainPendingCount$()," "),r(2),V("disabled",e.isCurrentConversationExecuting$()||e.isYoloMode$()||e.domainPendingCount$()===0),r(4),V("disabled",e.isCurrentConversationExecuting$()||e.isYoloMode$()||e.domainPendingCount$()===0),r(7),C(e.brainStats$().totalDomains>0?29:-1),r(2),V("conversationId",null)("conceptId",null)("folderConceptIds",e.folderConceptIds$())("folderConversationIds",e.folderConversationIds$())("folderName",e.folderName$())("autoSelectTaskIds",e.autoSelectTaskIds$())("isExecuting",e.isCurrentConversationExecuting$())("executingTaskId",e.executingTaskId$())("taskExecutionContent",e.taskExecutionStreamContent$())("submittingResultId",e.submittingResultId$())("taskResultContent",e.taskResultStreamContent$())("isGeneratingPlan",e.isGeneratingPlan$())("parallelTaskStates",e.parallelTaskStates$())("isParallelExecuting",e.isParallelExecuting$())}}function rm(o,t){if(o&1&&(p(0,"header",48)(1,"div",49),T(2,"span",50),_(3,jp,4,1)(4,Hp,3,2),u(),_(5,Up,15,9,"div",51),u(),_(6,Gp,4,7,"div",52),_(7,nm,5,3)(8,am,32,20)),o&2){let e=s();r(2),N("connected",e.connectionState$()==="connected")("disconnected",e.connectionState$()==="disconnected")("reconnecting",e.connectionState$()==="reconnecting"),V("title",e.connectionState$()==="connected"?"Povezano":e.connectionState$()==="reconnecting"?"Ponovno povezivanje...":"Veza prekinuta"),r(),C(e.folderName$()&&!e.activeConversation$()?3:4),r(2),C(e.activeConversation$()?5:-1),r(),C(e.disconnectToast$()?6:-1),r(),C(e.activeConversation$()?7:e.folderName$()?8:-1)}}function sm(o,t){if(o&1){let e=E();p(0,"div",25)(1,"div",208)(2,"div",209),S(),p(3,"svg",210),T(4,"path",211),u()(),j(),p(5,"h2",212),c(6,"Dobrodo\u0161li u Mentor AI"),u(),p(7,"p",213),c(8," Va\u0161 AI poslovni partner sa ekspertizom u finansijama, marketingu, tehnologiji, operacijama, pravu i kreativnom razvoju. "),u(),p(9,"button",214),O("click",function(){x(e);let i=s();return b(i.createNewConversation())}),S(),p(10,"svg",215),T(11,"path",15),u(),c(12," Novi razgovor "),u(),j(),p(13,"div",216)(14,"button",217),O("click",function(){x(e);let i=s();return b(i.onSuggestionClick("Analiziraj moje tr\u017Ei\u0161te i identifikuj klju\u010Dne prilike za rast"))}),p(15,"div",218),c(16,"\u{1F4CA}"),u(),p(17,"div",219),c(18,"Analiza tr\u017Ei\u0161ta"),u(),p(19,"div",220),c(20," Identifikuj prilike za rast i konkurentsku poziciju "),u()(),p(21,"button",217),O("click",function(){x(e);let i=s();return b(i.onSuggestionClick("Napravi profil idealnog kupca za moj biznis"))}),p(22,"div",218),c(23,"\u{1F464}"),u(),p(24,"div",219),c(25,"Profilisanje kupaca"),u(),p(26,"div",220),c(27,"Defini\u0161i idealnog kupca i segmente"),u()(),p(28,"button",217),O("click",function(){x(e);let i=s();return b(i.onSuggestionClick("Pomozi mi da napravim finansijski plan za narednih 12 meseci"))}),p(29,"div",218),c(30,"\u{1F4B0}"),u(),p(31,"div",219),c(32,"Finansijski plan"),u(),p(33,"div",220),c(34,"Projekcije prihoda, tro\u0161kova i bud\u017Eeta"),u()(),p(35,"button",217),O("click",function(){x(e);let i=s();return b(i.onSuggestionClick("Kreiraj marketing strategiju za moj proizvod"))}),p(36,"div",218),c(37,"\u{1F680}"),u(),p(38,"div",219),c(39,"Marketing strategija"),u(),p(40,"div",220),c(41,"Plan za promociju i pozicioniranje brenda"),u()()()()()}}function lm(o,t){if(o&1){let e=E();p(0,"aside",26)(1,"div",221),c(2,"Izvor"),u(),p(3,"app-concept-panel",222),O("close",function(){x(e);let i=s();return b(i.closeConceptPanel())})("conceptClick",function(i){x(e);let a=s();return b(a.onRelatedConceptClick(i))}),u()()}if(o&2){let e=s();r(3),V("conceptId",e.selectedConceptId$())("isOpen",!0)}}var ar=class o{conversationService=J(xt);chatWsService=J(On);http=J(Ee);route=J(Wi);router=J(Hi);destroyRef=J(Ai);authService=J(_n);notesApi=J(St);featureTour;conceptTree;conversationNotes;yoloLogContainer;messagesContainer;activeConversation$=v(null);activeConversationId$=X(()=>this.activeConversation$()?.id??null);messages$=X(()=>this.activeConversation$()?.messages??[]);isLoading$=v(!1);isStreaming$=v(!1);showScrollToBottom$=v(!1);sidebarCollapsed$=v(!1);isLoadingConversation$=v(!1);streamingContent$=v("");streamingMessage$=X(()=>({id:"streaming",conversationId:this.activeConversationId$()??"",role:"ASSISTANT",content:this.streamingContent$(),confidenceScore:null,confidenceFactors:null,createdAt:""}));showPersonaSelector$=v(!1);currentPersonaType$=X(()=>this.activeConversation$()?.personaType??null);errorMessages$=v([]);infoMessages$=v([]);isApprovingPlan$=v(!1);isProcessingStep$=v(!1);selectedConceptId$=v(null);activeTab$=v("chat");showTopicPicker$=v(!1);connectionState$=X(()=>this.chatWsService.connectionState$());disconnectToast$=v(null);showPlanOverlay$=v(!1);planCollapsed$=v(!1);currentPlan$=v(null);executionProgress$=v(new Map);executingWorkflowConversationIds$=v(new Set);isExecutingWorkflow$=X(()=>this.executingWorkflowConversationIds$().size>0);isCurrentConversationExecuting$=X(()=>{let t=this.activeConversationId$();return t!==null&&this.executingWorkflowConversationIds$().has(t)});createdConceptConversations$=v([]);newConversationIds$=v(new Set);folderConceptIds$=v([]);folderConversationIds$=v([]);folderName$=v(null);autoSelectTaskIds$=v([]);createdTaskNotifications$=v([]);domainCompletedCount$=v(0);domainPendingCount$=v(0);currentStepTitle$=v(null);currentStepIndex$=v(0);totalStepsCount$=v(0);completedStepsCount$=v(0);progressPercent$=X(()=>{let t=this.totalStepsCount$();return t===0?0:Math.round(this.completedStepsCount$()/t*100)});activePlanId$=v(null);awaitingConfirmation$=v(!1);nextStepInfo$=v(null);userStepInput$=v("");isGeneratingPlan$=v(!1);allowWorkflowInput$=v(!1);currentWorkflowStepInput$=v(null);previousConversationId$=v(null);executingTaskId$=v(null);taskExecutionStreamContent$=v("");submittingResultId$=v(null);taskResultStreamContent$=v("");loadingConversationId$=v(null);isCreatingConversation$=X(()=>this.conversationService.isCreating$());isYoloMode$=v(!1);yoloProgress$=v(null);showYoloActivityLog$=v(!1);yoloPending=!1;pendingPlanId=null;streamBuffer="";streamRafId=null;workflowHistory$=v([]);workflowPlans$=v(new Map);workflowProgressMaps$=v(new Map);selectedWorkflowPlanId$=v(null);sortedWorkflowHistory$=X(()=>{let t={executing:0,completed:1,failed:2,cancelled:3};return[...this.workflowHistory$()].sort((e,n)=>(t[e.status]??9)-(t[n.status]??9))});researchPhase$=v("thinking");autoAiPopuni$=v(!1);isTogglingAutoPopuni$=v(!1);autoPopuniTaskIds$=v([]);parallelBatchId$=v(null);parallelTaskStates$=v([]);isParallelExecuting$=X(()=>this.parallelBatchId$()!==null);isPlatformOwner$=X(()=>this.authService.currentUser()?.role==="PLATFORM_OWNER");viewInit$=v(!1);brainStats$=X(()=>{this.viewInit$();let t=this.conceptTree?.treeData$()?.tree??[];if(t.length===0)return{totalDomains:0,completedDomains:0,pendingTasks:0,progressPercent:0};let e=0,n=0,i=0,a=h=>{let d=0,k=0,y=0;for(let z of h)if(z.children.length>0){let D=a(z.children);d+=D.completed,k+=D.pending,y+=D.total}else z.status&&(y++,z.status==="completed"&&d++,z.status==="pending"&&k++);return{completed:d,pending:k,total:y}};for(let h of t){e++;let d=a(h.children);i+=d.pending,d.total>0&&d.completed===d.total&&n++}let l=e>0?Math.round(n/e*100):0;return{totalDomains:e,completedDomains:n,pendingTasks:i,progressPercent:l}});nextStepSuggestion$=v(null);nextStepDismissTimer=null;keyboardHandler=t=>this.handleKeyboardShortcut(t);ngOnInit(){document.addEventListener("keydown",this.keyboardHandler),this.setupWebSocket(),this.loadBrainConfig(),$i([this.route.params,this.route.queryParams]).pipe(vo(this.destroyRef),Oi(1)).subscribe(([t,e])=>{e.yolo==="true"&&!this.isYoloMode$()&&(this.isYoloMode$.set(!0),this.yoloPending=!0),e.planId&&!this.yoloPending&&(this.pendingPlanId=e.planId),e.tour==="true"&&setTimeout(()=>this.featureTour?.launchTour(),1e3),t.conversationId&&this.loadConversation(t.conversationId)}),this.route.params.pipe(vo(this.destroyRef)).subscribe(t=>{t.conversationId&&this.activeConversationId$()!==t.conversationId&&this.loadConversation(t.conversationId)})}ngAfterViewInit(){this.viewInit$.set(!0)}ngOnDestroy(){document.removeEventListener("keydown",this.keyboardHandler),this.chatWsService.disconnect()}handleKeyboardShortcut(t){t.ctrlKey&&t.key==="n"&&(t.preventDefault(),this.createNewConversation()),t.key==="Escape"&&(this.showPlanOverlay$()&&this.rejectPlan(),this.errorMessages$.set([])),t.ctrlKey&&t.shiftKey&&t.key==="T"&&(t.preventDefault(),this.activeTab$.set("notes")),t.ctrlKey&&t.shiftKey&&t.key==="C"&&(t.preventDefault(),this.activeTab$.set("chat"))}async loadConversation(t){this.isLoadingConversation$.set(!0);try{!this.executingWorkflowConversationIds$().has(t)&&!this.selectedWorkflowPlanId$()&&this.closePlanOverlay();let e=await this.conversationService.getConversation(t);if(this.activeConversation$.set(e),this.isLoadingConversation$.set(!1),this.activeTab$.set("chat"),this.isLoading$.set(!1),this.isStreaming$.set(!1),this.streamingContent$.set(""),this.createdTaskNotifications$.set([]),this.yoloPending){this.yoloPending=!1;try{await this.chatWsService.waitForConnection(),this.chatWsService.emitStartYolo(t)}catch{this.showError("WebSocket konekcija neuspe\u0161na \u2014 YOLO mod nije mogao da se pokrene")}}if(this.pendingPlanId){let n=this.pendingPlanId;this.pendingPlanId=null;try{await this.chatWsService.waitForConnection(),this.chatWsService.emitGetPlan(n,t)}catch{this.showError("WebSocket konekcija neuspe\u0161na \u2014 plan nije mogao da se u\u010Dita")}}}catch{this.activeConversation$.set(null),this.isLoadingConversation$.set(!1),this.showError("Gre\u0161ka pri u\u010Ditavanju konverzacije")}}async createNewConversation(t){try{let e=t?`${t} \u2014 Nova konverzacija`:void 0,n=await this.conversationService.createConversation(e);await this.loadConversation(n.id),this.router.navigate(["/chat",n.id]),this.conceptTree?.loadTree()}catch{this.showError("Gre\u0161ka pri kreiranju konverzacije")}}async onTopicSelected(t){this.showTopicPicker$.set(!1);try{let e=await this.conversationService.createConversation(void 0,void 0,void 0,t?.id);await this.loadConversation(e.id),this.router.navigate(["/chat",e.id]),this.conceptTree?.loadTree()}catch{this.showError("Gre\u0161ka pri kreiranju konverzacije")}}onTopicPickerCancelled(){this.showTopicPicker$.set(!1)}async createConversationUnderConcept(t){this.loadingConversationId$.set(t.conceptId);try{let e=this.formatConversationTitle(t.conceptName),n=await this.conversationService.createConversation(e,void 0,void 0,t.conceptId);this.newConversationIds$.update(i=>{let a=new Set(i);return a.add(n.id),a}),await this.loadConversation(n.id),this.router.navigate(["/chat",n.id]),this.conceptTree?.loadTree()}catch{this.showError("Gre\u0161ka pri kreiranju konverzacije")}finally{this.loadingConversationId$.set(null)}}selectConversation(t){this.folderConceptIds$.set([]),this.folderConversationIds$.set([]),this.folderName$.set(null),this.activeTab$.set("chat"),this.autoSelectTaskIds$.set([]),this.newConversationIds$.update(e=>{let n=new Set(e);return n.delete(t),n}),this.router.navigate(["/chat",t])}navigateToCreatedTask(t){this.createdTaskNotifications$.update(e=>e.filter(n=>n.id!==t.id)),this.autoSelectTaskIds$.set([t.id]),this.activeTab$.set("notes"),t.isCrossConversation&&this.router.navigate(["/chat",t.conversationId]),this.conversationNotes?.loadNotes()}togglePersonaSelector(){this.showPersonaSelector$.update(t=>!t)}showError(t){let e=crypto.randomUUID();this.errorMessages$.update(n=>[...n,{id:e,message:t}]),setTimeout(()=>this.dismissErrorById(e),8e3)}dismissErrorById(t){this.errorMessages$.update(e=>e.filter(n=>n.id!==t))}loadBrainConfig(){this.http.get("/api/admin/brain-config").subscribe({next:t=>this.autoAiPopuni$.set(t.data.autoAiPopuni),error:()=>{}})}toggleAutoAiPopuni(){if(this.isTogglingAutoPopuni$())return;this.isTogglingAutoPopuni$.set(!0);let t=!this.autoAiPopuni$();this.http.patch("/api/admin/brain-config",{autoAiPopuni:t}).subscribe({next:e=>{this.autoAiPopuni$.set(e.data.autoAiPopuni),this.isTogglingAutoPopuni$.set(!1)},error:()=>{this.isTogglingAutoPopuni$.set(!1),this.showError("Gre\u0161ka pri promeni Auto AI pode\u0161avanja")}})}showInfo(t){let e=crypto.randomUUID();this.infoMessages$.update(n=>[...n,{id:e,message:t}]),setTimeout(()=>this.dismissInfoById(e),1e4)}dismissInfoById(t){this.infoMessages$.update(e=>e.filter(n=>n.id!==t))}manualReconnect(){this.chatWsService.disconnect(),setTimeout(()=>this.chatWsService.connect(),500)}onSuggestedAction(t){switch(t.type){case"create_tasks":this.sendMessage("Kreiraj zadatke na osnovu prethodne analize."),this.activeTab$.set("notes");break;case"view_tasks":this.activeTab$.set("notes");break;case"deep_dive":case"explore_concept":this.sendMessage("Istra\u017Ei ovu temu dublje. Daj detaljniju analizu.");break;case"next_domain":t.payload?.conceptId&&this.selectedConceptId$.set(t.payload.conceptId);break;case"save_note":this.activeTab$.set("notes");break;case"web_search":this.sendMessage("Pretra\u017Ei web za vi\u0161e informacija o ovoj temi.");break;case"run_workflow":this.activeTab$.set("notes");break;case"score_task":this.activeTab$.set("notes");break}}onCitationClick(t){if(typeof t=="string"){this.lookupConceptByName(t);return}if(this.isCurrentConversationExecuting$()){this.selectedConceptId$.set(t.conceptId);return}let n=this.createdConceptConversations$().find(i=>i.conceptId===t.conceptId);if(n){this.router.navigate(["/chat",n.conversationId]);return}this.selectedConceptId$.set(t.conceptId)}async lookupConceptByName(t){try{let e=await Z(this.http.get(`/api/v1/knowledge/concepts/by-name/${encodeURIComponent(t)}`));e?.data?.id&&this.selectedConceptId$.set(e.data.id)}catch{}}closeConceptPanel(){this.selectedConceptId$.set(null)}onRelatedConceptClick(t){this.selectedConceptId$.set(t)}onViewMessage(t){this.activeTab$.set("chat"),setTimeout(()=>{let e=document.getElementById(`msg-${t.messageId}`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("highlight-flash"),setTimeout(()=>e.classList.remove("highlight-flash"),2e3))},100)}async onPersonaSelected(t){let e=this.activeConversationId$();if(e){if(t)try{let n=await this.conversationService.updatePersona(e,t.type);this.activeConversation$.update(i=>i&&te(F({},i),{personaType:n.personaType}))}catch{this.showError("Gre\u0161ka pri a\u017Euriranju persone")}this.showPersonaSelector$.set(!1)}}async onConceptSelected(t){if(t.isFolder){this.folderConceptIds$.set(t.descendantConceptIds),this.folderConversationIds$.set(t.descendantConversationIds),this.folderName$.set(t.conceptName),this.activeConversation$.set(null),this.activeTab$.set("notes");let e=Math.min(t.descendantConversationIds.length,t.descendantConceptIds.length);this.domainCompletedCount$.set(e),this.domainPendingCount$.set(Math.max(0,t.descendantConceptIds.length-e));return}this.folderConceptIds$.set([]),this.folderConversationIds$.set([]),this.folderName$.set(null);try{let e=this.conceptTree?.treeData$(),n=this.findNodeByCurriculumId(e?.tree??[],t.curriculumId);if(n&&n.conversations.length>0){let i=n.conversations[0];await this.loadConversation(i.id),this.router.navigate(["/chat",i.id]),this.activeTab$.set("chat")}else{let i=this.formatConversationTitle(t.conceptName),a=await this.conversationService.createConversation(i,void 0,void 0,t.curriculumId);this.newConversationIds$.update(l=>{let h=new Set(l);return h.add(a.id),h}),await this.loadConversation(a.id),this.router.navigate(["/chat",a.id]),this.conceptTree?.loadTree(),this.activeTab$.set("chat")}}catch{this.showError("Gre\u0161ka pri u\u010Ditavanju koncepta")}}findNodeByCurriculumId(t,e){for(let n of t){if(n.curriculumId===e)return n;let i=this.findNodeByCurriculumId(n.children,e);if(i)return i}return null}formatConversationTitle(t){let e=new Date,n=e.toISOString().slice(0,10),i=e.toTimeString().slice(0,5).replace(":","-");return`${t}_${n}_${i}`}planGenerationTimeout=null;async onRunAgents(t){if(t.length===0)return;let e=this.activeConversationId$();if(!e){let n=this.conversationNotes?.notes()?.find(i=>t.includes(i.id));if(n?.conversationId)e=n.conversationId,await this.loadConversation(e),this.router.navigate(["/chat",e]);else try{let i=n?.conceptId??void 0,a=n?.title?`${n.title}`:"Izvr\u0161avanje zadatka";e=(await this.conversationService.createConversation(a,void 0,i)).id,await this.loadConversation(e),this.router.navigate(["/chat",e]),this.conceptTree?.loadTree()}catch{this.showError("Gre\u0161ka pri kreiranju konverzacije za zadatak.");return}}this.chatWsService.emitParallelPopuni(t,e,this.autoAiPopuni$())}onExecuteSingleTask(t){this.activeTab$.set("chat"),this.onRunAgents([t])}resultSubmissionTimeout=null;onSubmitTaskResult(t){this.submittingResultId$.set(t),this.taskResultStreamContent$.set(""),this.chatWsService.emitSubmitTaskResult(t),this.resultSubmissionTimeout&&clearTimeout(this.resultSubmissionTimeout),this.resultSubmissionTimeout=setTimeout(()=>{this.submittingResultId$()===t&&(this.submittingResultId$.set(null),this.taskResultStreamContent$.set(""),this.showError("Ocenjivanje rezultata je isteklo. Poku\u0161ajte ponovo."))},6e4)}async onRunBrain(){let t=this.folderName$(),e=this.folderConceptIds$();if(!(!t||e.length===0))try{let n=`Brain: ${t}`,i=await this.conversationService.createConversation(n);await this.loadConversation(i.id);let l=(await this.notesApi.getByConceptIds(e)).filter(h=>h.noteType==="TASK"&&h.status==="PENDING").map(h=>h.id);if(l.length===0){this.showError("Nema zadataka na \u010Dekanju u ovom domenu.");return}this.onRunAgents(l)}catch{this.showError("Pokretanje Brain-a nije uspelo. Poku\u0161ajte ponovo.")}}async onRunBrainYolo(){let t=this.folderName$();if(t)try{let e=`Brain: ${t}`,n=await this.conversationService.createConversation(e);await this.loadConversation(n.id),this.isYoloMode$.set(!0),this.chatWsService.emitStartDomainYolo(n.id,t)}catch{this.showError("Pokretanje YOLO re\u017Eima nije uspelo.")}}navigateToWorkflow(t){if(this.selectedWorkflowPlanId$()===t.planId&&this.showPlanOverlay$()){this.showPlanOverlay$.set(!1),this.selectedWorkflowPlanId$.set(null);return}t.conversationId!==this.activeConversationId$()&&(this.folderConceptIds$.set([]),this.folderConversationIds$.set([]),this.folderName$.set(null),this.router.navigate(["/chat",t.conversationId]));let n=this.workflowPlans$().get(t.planId);n&&(this.currentPlan$.set(n),this.executionProgress$.set(this.workflowProgressMaps$().get(t.planId)??new Map),this.activePlanId$.set(t.planId),this.selectedWorkflowPlanId$.set(t.planId),this.showPlanOverlay$.set(!0),this.planCollapsed$.set(!1)),this.activeTab$.set("notes"),this.autoSelectTaskIds$.set(t.taskIds.length>0?t.taskIds:[])}getStepStatus(t){return this.executionProgress$().get(t)??"pending"}approvePlan(){let t=this.currentPlan$(),e=this.activeConversationId$();if(!t||!e)return;this.executingWorkflowConversationIds$.update(i=>new Set([...i,e])),this.planCollapsed$.set(!0),this.chatWsService.emitWorkflowApproval(t.planId,!0,e);let n=t.steps[0]?.conceptName??"Workflow";this.workflowHistory$.update(i=>[...i,{planId:t.planId,conversationId:e,taskIds:t.steps.map(a=>a.taskId).filter(Boolean),title:t.conceptOrder.length>1?`${n} (+${t.conceptOrder.length-1})`:n,totalSteps:t.steps.length,completedSteps:0,currentStepTitle:null,status:"executing"}])}rejectPlan(){let t=this.currentPlan$(),e=this.activeConversationId$();!t||!e||(this.chatWsService.emitWorkflowApproval(t.planId,!1,e),this.isApprovingPlan$.set(!1),this.closePlanOverlay())}cancelExecution(){let t=this.activePlanId$()??this.currentPlan$()?.planId,e=this.activeConversationId$();!t||!e||this.chatWsService.emitWorkflowCancel(t,e)}togglePlanCollapse(){this.planCollapsed$.update(t=>!t)}closePlanOverlay(){this.showPlanOverlay$.set(!1),this.currentPlan$.set(null),this.activePlanId$.set(null),this.executionProgress$.set(new Map),this.selectedWorkflowPlanId$.set(null),this.isApprovingPlan$.set(!1),this.currentStepTitle$.set(null),this.currentStepIndex$.set(0),this.totalStepsCount$.set(0),this.completedStepsCount$.set(0),this.createdConceptConversations$.set([]),this.awaitingConfirmation$.set(!1),this.nextStepInfo$.set(null),this.userStepInput$.set(""),this.isGeneratingPlan$.set(!1),this.allowWorkflowInput$.set(!1),this.currentWorkflowStepInput$.set(null),this.previousConversationId$.set(null)}toggleSidebar(){this.sidebarCollapsed$.set(!this.sidebarCollapsed$())}async onSuggestionClick(t){await this.createNewConversation(),setTimeout(()=>{this.activeConversationId$()&&this.sendMessage(t)},500)}onMessagesScroll(){let t=this.messagesContainer?.nativeElement;if(!t)return;let e=t.scrollHeight-t.scrollTop-t.clientHeight;this.showScrollToBottom$.set(e>100)}scrollToBottom(){let t=this.messagesContainer?.nativeElement;t&&(t.scrollTop=t.scrollHeight)}stopGeneration(){this.isStreaming$.set(!1),this.isLoading$.set(!1),this.showScrollToBottom$.set(!1)}async sendMessage(t){let e=typeof t=="string"?t:t.content,n=typeof t=="string"?void 0:t.attachmentIds,i=this.activeConversationId$();if(!i||!e.trim())return;this.activeTab$()!=="chat"&&this.activeTab$.set("chat");let a=this.currentWorkflowStepInput$();if(a&&a.inputType==="text"){let d={id:`wf_user_${Date.now()}`,conversationId:i,role:"USER",content:e,confidenceScore:null,confidenceFactors:null,createdAt:new Date().toISOString()};this.activeConversation$.update(k=>k&&te(F({},k),{messages:[...k.messages,d]})),this.chatWsService.emitStepContinue(a.planId,i,e),this.currentWorkflowStepInput$.set(null),this.allowWorkflowInput$.set(!1),this.isLoading$.set(!0);return}this.isLoading$.set(!0),this.streamingContent$.set("");let l={id:`temp_${Date.now()}`,conversationId:i,role:"USER",content:e,confidenceScore:null,confidenceFactors:null,createdAt:new Date().toISOString()};this.activeConversation$.update(d=>d&&te(F({},d),{messages:[...d.messages,l]})),this.chatWsService.sendMessage(i,e,n?.length?n:void 0)||(this.isLoading$.set(!1),this.showError("Konekcija sa serverom nije uspostavljena. Osve\u017Eite stranicu."))}setupWebSocket(){this.chatWsService.connect();let t=!1,e=setInterval(()=>{let n=this.chatWsService.connectionState$();n==="disconnected"&&t?this.disconnectToast$.set("Veza prekinuta. Poku\u0161avam ponovo..."):n==="reconnecting"?this.disconnectToast$.set("Ponovno povezivanje..."):n==="connected"&&!t&&this.disconnectToast$()&&(this.chatWsService.wasWorkflowActive$()?(this.disconnectToast$.set("Veza obnovljena. Workflow je mo\u017Eda nastavljen u pozadini."),this.chatWsService.wasWorkflowActive$.set(!1)):this.disconnectToast$.set("Veza obnovljena."),setTimeout(()=>{this.connectionState$()==="connected"&&this.disconnectToast$.set(null)},3e3)),t=n==="connected",this.chatWsService.setWorkflowRunning(this.isExecutingWorkflow$()||this.isYoloMode$());let i=this.chatWsService.lastEmitError$();i&&(this.disconnectToast$.set(i),this.chatWsService.lastEmitError$.set(null),setTimeout(()=>this.disconnectToast$.set(null),5e3));let a=this.notesApi.lastError$();a&&(this.disconnectToast$.set(a),this.notesApi.lastError$.set(null),setTimeout(()=>this.disconnectToast$.set(null),5e3))},500);this.destroyRef.onDestroy(()=>clearInterval(e)),this.chatWsService.onMessageReceived(n=>{this.activeConversation$.update(i=>{if(!i)return i;let a=i.messages.map((l,h,d)=>l.role==="USER"&&l.id.startsWith("temp_")&&!d.slice(h+1).some(y=>y.role==="USER"&&y.id.startsWith("temp_"))?te(F({},l),{id:n.messageId}):l);return te(F({},i),{messages:a})}),this.isStreaming$.set(!0)}),this.chatWsService.onMessageChunk(n=>{this.streamBuffer+=n.content,this.streamRafId||(this.streamRafId=requestAnimationFrame(()=>{this.streamingContent$.update(i=>i+this.streamBuffer),this.streamBuffer="",this.streamRafId=null}))}),this.chatWsService.onResearchPhase(n=>{this.researchPhase$.set(n.phase==="researching"?"researching":"thinking")}),this.chatWsService.onComplete(n=>{let i=n.metadata?.confidence,a=n.metadata?.citations??[],l=n.metadata?.memoryAttributions??[],h=n.metadata?.webSearchSources??[],d=n.metadata?.suggestedActions??[],k={id:n.messageId,conversationId:this.activeConversationId$()??"",role:"ASSISTANT",content:n.fullContent,confidenceScore:i?.score??null,confidenceFactors:i?.factors??null,citations:a.length>0?a:void 0,memoryAttributions:l.length>0?l:void 0,webSearchSources:h.length>0?h:void 0,suggestedActions:d.length>0?d:void 0,createdAt:new Date().toISOString()};this.activeConversation$.update(y=>y&&te(F({},y),{messages:[...y.messages,k]})),this.isLoading$.set(!1),this.isStreaming$.set(!1),this.streamingContent$.set(""),this.researchPhase$.set("thinking")}),this.chatWsService.onError(n=>{this.isLoading$.set(!1),this.isStreaming$.set(!1),this.researchPhase$.set("thinking");let i=n.type?`[${n.type}] `:"";this.showError(i+(n.message||"Poruka nije poslata. Poku\u0161ajte ponovo."))}),this.chatWsService.onNotesUpdated(()=>{this.conversationNotes?.loadNotes()}),this.chatWsService.onTasksCreatedForExecution(n=>{if(n.conversationId!==this.activeConversationId$())return;n.taskIds.length>0&&this.autoSelectTaskIds$.set(n.taskIds),this.conversationNotes?.loadNotes(),this.conceptTree?.loadTree();let i=n.taskCount??n.taskIds.length,a=`**Kreirano ${i} ${i===1?"zadatak":"zadataka"}!**`;a+=" Kliknite na dugme ispod da biste pre\u0161li na zadatak.";let l={id:`tasks_created_${Date.now()}`,conversationId:n.conversationId,role:"ASSISTANT",content:a,confidenceScore:null,confidenceFactors:null,createdAt:new Date().toISOString()};this.activeConversation$.update(k=>k&&te(F({},k),{messages:[...k.messages,l]}));let h=new Set(n.reusedTaskIds??[]),d=n.taskIds.filter(k=>!h.has(k));this.autoAiPopuni$()&&d.length>0&&setTimeout(()=>{let k=n.conversationId;for(let y of d)this.chatWsService.emitExecuteTaskAi(y,k)},1500)}),this.chatWsService.onConceptDetected(n=>{this.conceptTree?.loadTree(),n.conversationId===this.activeConversationId$()&&this.activeConversation$.update(i=>i&&te(F({},i),{conceptId:n.conceptId}))}),this.chatWsService.onPlanReady(n=>{n.conversationId===this.activeConversationId$()&&(this.planGenerationTimeout&&(clearTimeout(this.planGenerationTimeout),this.planGenerationTimeout=null),this.isGeneratingPlan$.set(!1),this.executingTaskId$.set(null),this.currentPlan$.set(n.plan),this.activePlanId$.set(n.plan.planId),this.executionProgress$.set(new Map),this.showPlanOverlay$.set(!0))}),this.chatWsService.onConversationsCreated(n=>{n.originalConversationId===this.activeConversationId$()&&(this.createdConceptConversations$.set(n.conversations),this.newConversationIds$.update(i=>{let a=new Set(i);return n.conversations.forEach(l=>a.add(l.conversationId)),a}),this.conceptTree?.loadTree())}),this.chatWsService.onStepProgress(n=>{if(n.conversationId===this.activeConversationId$()){if(this.executingWorkflowConversationIds$.update(i=>new Set([...i,n.conversationId])),!this.activePlanId$()&&n.planId&&this.activePlanId$.set(n.planId),this.executionProgress$.update(i=>{let a=new Map(i);return a.set(n.stepId,n.status),a}),n.planId&&this.workflowHistory$.update(i=>i.map(a=>a.planId===n.planId?te(F({},a),{currentStepTitle:n.status==="in_progress"?n.stepTitle??a.currentStepTitle:a.currentStepTitle,completedSteps:n.status==="completed"||n.status==="failed"?a.completedSteps+1:a.completedSteps}):a)),n.totalSteps!=null&&this.totalStepsCount$.set(n.totalSteps),n.status==="in_progress"){this.currentStepTitle$.set(n.stepTitle??"Izvr\u0161avanje..."),n.stepIndex!=null&&this.currentStepIndex$.set(n.stepIndex);let i=n.stepTitle??"Korak",a=(n.stepIndex??0)+1,l=n.totalSteps??0,h={id:`wf_status_${n.stepId}`,conversationId:this.activeConversationId$()??"",role:"ASSISTANT",content:`**Izvr\u0161avam korak ${a}/${l}:** ${i}`,confidenceScore:null,confidenceFactors:null,createdAt:new Date().toISOString()};this.activeConversation$.update(d=>d&&te(F({},d),{messages:[...d.messages,h]}))}if(n.status==="completed"&&n.content){this.completedStepsCount$.update(l=>l+1),this.conceptTree?.loadTree(),this.conversationNotes?.loadNotes();let i=this.completedStepsCount$(),a=this.totalStepsCount$();i<a&&this.currentStepTitle$.set("Pripremam slede\u0107i korak...")}if(n.status==="completed"&&!n.content){this.completedStepsCount$.update(l=>l+1),this.conceptTree?.loadTree(),this.conversationNotes?.loadNotes();let i=this.completedStepsCount$(),a=this.totalStepsCount$();i<a&&this.currentStepTitle$.set("Pripremam slede\u0107i korak...")}n.status==="failed"&&(this.completedStepsCount$.update(i=>i+1),this.conceptTree?.loadTree(),this.conversationNotes?.loadNotes())}}),this.chatWsService.onWorkflowComplete(n=>{if(n.conversationId!==this.activeConversationId$())return;let i=n.status==="completed"?"Zavr\u0161eno":n.status==="cancelled"?"Otkazano":"Gre\u0161ka",a=this.createdConceptConversations$(),l=`**${i}!** Izvr\u0161eno ${n.completedSteps}/${n.totalSteps} koraka.`;a.length>0&&(l+=`

**Rezultati po konceptima:**`,a.forEach((d,k)=>{l+=`
${k+1}. [[${d.conceptName}]]`}),l+=`

Kliknite na koncept ili odaberite konverzaciju u drvetu sa leve strane da pregledate rezultate.`);let h={id:`wf_summary_${n.planId}`,conversationId:this.activeConversationId$()??"",role:"ASSISTANT",content:l,confidenceScore:null,confidenceFactors:null,createdAt:new Date().toISOString()};if(this.activeConversation$.update(d=>d&&te(F({},d),{messages:[...d.messages,h]})),this.currentStepTitle$.set(null),this.currentStepIndex$.set(0),this.totalStepsCount$.set(0),this.completedStepsCount$.set(0),this.executingWorkflowConversationIds$.update(d=>{let k=new Set(d);return k.delete(n.conversationId),k}),this.closePlanOverlay(),this.conversationNotes?.loadNotes(),this.conceptTree?.loadTree(),n.planId){let d=n.status==="completed"?"completed":n.status==="cancelled"?"cancelled":"failed";this.workflowHistory$.update(k=>k.map(y=>y.planId===n.planId?te(F({},y),{status:d,completedSteps:n.completedSteps}):y)),setTimeout(()=>{this.workflowHistory$.update(k=>k.filter(y=>y.planId!==n.planId))},3e4)}n.status==="completed"&&setTimeout(()=>this.suggestNextStep(),1500)}),this.chatWsService.onWorkflowError(n=>{this.executingWorkflowConversationIds$.update(i=>{let a=new Set(i);return a.delete(n.conversationId),a}),n.conversationId===this.activeConversationId$()&&(this.closePlanOverlay(),this.isYoloMode$.set(!1),this.yoloProgress$.set(null),this.showError(n.message??"Izvr\u0161avanje workflow-a neuspe\u0161no"))}),this.chatWsService.onTaskAiStart(n=>{n.conversationId&&n.conversationId!==this.activeConversationId$()||(this.isGeneratingPlan$()&&(this.isGeneratingPlan$.set(!1),this.planGenerationTimeout&&(clearTimeout(this.planGenerationTimeout),this.planGenerationTimeout=null)),this.executingTaskId$.set(n.taskId),this.taskExecutionStreamContent$.set(""),this.isStreaming$.set(!0),this.streamingContent$.set(""))}),this.chatWsService.onTaskAiChunk(n=>{n.conversationId&&n.conversationId!==this.activeConversationId$()||(this.streamBuffer+=n.content,this.streamRafId||(this.streamRafId=requestAnimationFrame(()=>{this.streamingContent$.update(i=>i+this.streamBuffer),this.taskExecutionStreamContent$.update(i=>i+this.streamBuffer),this.streamBuffer="",this.streamRafId=null})))}),this.chatWsService.onTaskAiComplete(n=>{if(n.conversationId!==this.activeConversationId$())return;this.isStreaming$.set(!1),this.streamingContent$.set(""),this.taskExecutionStreamContent$.set(""),this.executingTaskId$.set(null),this.conversationNotes?.loadNotes();let i=this.activeConversationId$();i&&this.loadConversation(i)}),this.chatWsService.onTaskAiError(n=>{n.conversationId&&n.conversationId!==this.activeConversationId$()||(this.isStreaming$.set(!1),this.streamingContent$.set(""),this.taskExecutionStreamContent$.set(""),this.executingTaskId$.set(null),this.showError(n.message??"Izvr\u0161avanje zadatka neuspe\u0161no"))}),this.chatWsService.onTaskResultChunk(n=>{n.conversationId&&n.conversationId!==this.activeConversationId$()||this.taskResultStreamContent$.update(i=>i+n.content)}),this.chatWsService.onTaskResultComplete(n=>{n.conversationId&&n.conversationId!==this.activeConversationId$()||(this.resultSubmissionTimeout&&(clearTimeout(this.resultSubmissionTimeout),this.resultSubmissionTimeout=null),this.submittingResultId$.set(null),this.taskResultStreamContent$.set(""),this.conversationNotes?.loadNotes())}),this.chatWsService.onTaskResultError(n=>{n.conversationId&&n.conversationId!==this.activeConversationId$()||(this.resultSubmissionTimeout&&(clearTimeout(this.resultSubmissionTimeout),this.resultSubmissionTimeout=null),this.submittingResultId$.set(null),this.taskResultStreamContent$.set(""),this.showError(n.message??"Slanje rezultata neuspe\u0161no"))}),this.chatWsService.onAutoPopuniStart(n=>{this.autoPopuniTaskIds$.set(n.taskIds)}),this.chatWsService.onAutoPopuniComplete(()=>{this.autoPopuniTaskIds$.set([]),this.conversationNotes?.loadNotes(),this.conceptTree?.loadTree()}),this.chatWsService.onAutoPopuniTaskError(()=>{}),this.chatWsService.onParallelPopuniStart(n=>{this.parallelBatchId$.set(n.batchId),this.parallelTaskStates$.set(n.tasks)}),this.chatWsService.onParallelPopuniProgress(n=>{this.parallelTaskStates$.update(i=>i.map(a=>a.taskId===n.taskId?te(F({},a),{status:n.status,currentStep:n.currentStep??a.currentStep,totalSteps:n.totalSteps??a.totalSteps,stepLabel:n.stepLabel??a.stepLabel}):a))}),this.chatWsService.onParallelPopuniTaskDone(n=>{this.parallelTaskStates$.update(i=>i.map(a=>a.taskId===n.taskId?te(F({},a),{status:n.status,score:n.score??a.score,error:n.error}):a))}),this.chatWsService.onParallelPopuniBatchDone(()=>{this.parallelBatchId$.set(null),this.conversationNotes?.loadNotes(),this.conceptTree?.loadTree()}),this.chatWsService.onExecutionActiveState(n=>{let i=!1,a=!1;for(let h of n.active){if((h.type==="yolo"||h.type==="domain-yolo")&&!i){i=!0,this.isYoloMode$.set(!0),h.conversationId&&this.executingWorkflowConversationIds$.update(z=>{let D=new Set(z);return D.add(h.conversationId),D});let d=h.checkpoint,k=d.completed??d.completedCount??0,y=d.failed??d.failedCount??0;this.yoloProgress$.set({planId:d.planId??h.planId??"resume",running:d.running??0,maxConcurrency:d.maxConcurrency??3,completed:k,failed:y,total:d.total??0,discoveredCount:d.discoveredCount??0,currentTasks:d.currentTasks??[],conversationId:d.conversationId??h.conversationId??""}),this.chatWsService.replayEvents(h.id,h.createdAt)}if(h.type==="workflow"&&!a){a=!0,h.conversationId&&this.executingWorkflowConversationIds$.update(k=>{let y=new Set(k);return y.add(h.conversationId),y}),h.planId&&(this.activePlanId$.set(h.planId),this.showPlanOverlay$.set(!0));let d=h.checkpoint;d.lastCompletedStepIndex!=null&&(this.completedStepsCount$.set(d.lastCompletedStepIndex+1),this.currentStepIndex$.set(d.lastCompletedStepIndex+1)),d.totalSteps!=null&&this.totalStepsCount$.set(d.totalSteps),d.currentStepTitle&&this.currentStepTitle$.set(d.currentStepTitle),this.chatWsService.replayEvents(h.id,h.createdAt)}if(h.type==="auto-popuni"){let d=h.metadata;Array.isArray(d?.taskIds)&&this.autoPopuniTaskIds$.set(d.taskIds)}}let l=!1;for(let h of n.recentlyCompleted){let d=h.type==="yolo"||h.type==="domain-yolo"?"YOLO":h.type==="workflow"?"Workflow":"Auto AI";this.showError(`Brain je radio dok ste bili odsutni: ${d} zavr\u0161en`),l=!0}l&&(this.conceptTree?.loadTree(),this.conversationNotes?.loadNotes())}),this.chatWsService.onStepAwaitingConfirmation(n=>{n.conversationId===this.activeConversationId$()&&(this.activePlanId$.set(n.planId),!this.isCurrentConversationExecuting$()&&(this.awaitingConfirmation$.set(!0),this.nextStepInfo$.set(n.nextStep),this.userStepInput$.set("")))}),this.chatWsService.onStepAwaitingInput(n=>{n.conversationId===this.activeConversationId$()&&n.inputType!=="confirmation"&&(this.currentWorkflowStepInput$.set(n),this.allowWorkflowInput$.set(n.inputType==="text"),this.isLoading$.set(!1))}),this.chatWsService.onStepMessage(n=>{if(n.conversationId!==this.activeConversationId$())return;let i={id:n.messageId,conversationId:n.conversationId,role:"ASSISTANT",content:n.content,confidenceScore:null,confidenceFactors:null,createdAt:new Date().toISOString()};this.activeConversation$.update(a=>a&&te(F({},a),{messages:[...a.messages,i]}))}),this.chatWsService.onNavigateToConversation(n=>{}),this.chatWsService.onYoloProgress(n=>{this.executingWorkflowConversationIds$.update(i=>new Set([...i,n.conversationId])),n.conversationId===this.activeConversationId$()&&(this.yoloProgress$.set(n),this.showYoloActivityLog$()&&this.yoloLogContainer?.nativeElement&&setTimeout(()=>{let i=this.yoloLogContainer?.nativeElement;i&&(i.scrollTop=i.scrollHeight)}))}),this.chatWsService.onYoloComplete(n=>{this.executingWorkflowConversationIds$.update(i=>{let a=new Set(i);return a.delete(n.conversationId),a}),n.conversationId===this.activeConversationId$()&&(this.yoloProgress$.set(null),this.isYoloMode$.set(!1),this.conversationNotes?.loadNotes(),this.conceptTree?.loadTree(),setTimeout(()=>this.suggestNextStep(),1500))}),this.chatWsService.onTasksDiscovered(()=>{this.conceptTree?.loadTree()}),this.chatWsService.onAutoPopuniStart(n=>{this.autoPopuniTaskIds$.set(n.taskIds)}),this.chatWsService.onAutoPopuniComplete(n=>{this.autoPopuniTaskIds$.set([]),this.conversationNotes?.loadNotes(),this.conceptTree?.loadTree(),n.completedTasks<n.totalTasks&&this.showError(`Auto AI: ${n.completedTasks}/${n.totalTasks} zadataka uspe\u0161no popunjeno`)}),this.chatWsService.onAutoPopuniTaskError(()=>{}),this.chatWsService.onParallelPopuniStart(n=>{this.parallelBatchId$.set(n.batchId),this.parallelTaskStates$.set(n.tasks)}),this.chatWsService.onParallelPopuniProgress(n=>{this.parallelTaskStates$.update(i=>i.map(a=>a.taskId===n.taskId?te(F({},a),{status:n.status,currentStep:n.currentStep??a.currentStep,totalSteps:n.totalSteps??a.totalSteps,stepLabel:n.stepLabel??a.stepLabel}):a))}),this.chatWsService.onParallelPopuniTaskDone(n=>{this.parallelTaskStates$.update(i=>i.map(a=>a.taskId===n.taskId?te(F({},a),{status:n.status,score:n.score??a.score,error:n.error}):a))}),this.chatWsService.onParallelPopuniBatchDone(()=>{this.parallelBatchId$.set(null),this.conversationNotes?.loadNotes(),this.conceptTree?.loadTree()}),this.chatWsService.onExecutionActiveState(n=>{let i=!1,a=!1;for(let h of n.active){if((h.type==="yolo"||h.type==="domain-yolo")&&!i){i=!0,this.isYoloMode$.set(!0),h.conversationId&&this.executingWorkflowConversationIds$.update(z=>{let D=new Set(z);return D.add(h.conversationId),D});let d=h.checkpoint,k=d.completed??d.completedCount??0,y=d.failed??d.failedCount??0;this.yoloProgress$.set({planId:d.planId??h.planId??"resume",running:d.running??0,maxConcurrency:d.maxConcurrency??3,completed:k,failed:y,total:d.total??0,discoveredCount:d.discoveredCount??0,currentTasks:d.currentTasks??[],conversationId:d.conversationId??h.conversationId??""}),this.chatWsService.replayEvents(h.id,h.createdAt)}if(h.type==="workflow"&&!a){a=!0,h.conversationId&&this.executingWorkflowConversationIds$.update(k=>{let y=new Set(k);return y.add(h.conversationId),y}),h.planId&&(this.activePlanId$.set(h.planId),this.showPlanOverlay$.set(!0));let d=h.checkpoint;d.lastCompletedStepIndex!=null&&(this.completedStepsCount$.set(d.lastCompletedStepIndex+1),this.currentStepIndex$.set(d.lastCompletedStepIndex+1)),d.totalSteps!=null&&this.totalStepsCount$.set(d.totalSteps),d.currentStepTitle&&this.currentStepTitle$.set(d.currentStepTitle),this.chatWsService.replayEvents(h.id,h.createdAt)}if(h.type==="auto-popuni"){let d=h.metadata;Array.isArray(d?.taskIds)&&this.autoPopuniTaskIds$.set(d.taskIds)}}let l=!1;for(let h of n.recentlyCompleted){let d=h.type==="yolo"||h.type==="domain-yolo"?"YOLO":h.type==="workflow"?"Workflow":"Auto AI";this.showInfo(`Brain je radio dok ste bili odsutni: ${d} zavr\u0161en`),l=!0}l&&(this.conceptTree?.loadTree(),this.conversationNotes?.loadNotes())})}continueWorkflow(){let t=this.activePlanId$(),e=this.activeConversationId$();if(!t||!e||this.isProcessingStep$())return;this.isProcessingStep$.set(!0);let n=this.userStepInput$().trim()||void 0;this.chatWsService.emitStepContinue(t,e,n),this.awaitingConfirmation$.set(!1),this.nextStepInfo$.set(null),this.userStepInput$.set(""),setTimeout(()=>this.isProcessingStep$.set(!1),1e3)}continueWorkflowStep(){let t=this.currentWorkflowStepInput$(),e=this.activeConversationId$();!t||!e||this.isProcessingStep$()||(this.isProcessingStep$.set(!0),this.chatWsService.emitStepContinue(t.planId,e),this.currentWorkflowStepInput$.set(null),this.allowWorkflowInput$.set(!1),setTimeout(()=>this.isProcessingStep$.set(!1),1e3))}returnToPreviousConversation(){let t=this.previousConversationId$();t&&(this.previousConversationId$.set(null),this.router.navigate(["/chat",t]))}toggleYoloActivityLog(){this.showYoloActivityLog$.update(t=>!t)}suggestNextStep(){let t=this.conceptTree?.treeData$()?.tree??[];if(t.length!==0){for(let e of t)if(this.domainHasPending(e)){this.nextStepSuggestion$.set({message:`Preporu\u010Dujem: ${e.label} \u2014 ima zadatke na \u010Dekanju.`,actionLabel:`Otvori ${e.label} \u2192`,actionCurriculumId:e.curriculumId,secondaryLabel:"Poka\u017Ei sve domene"}),this.nextStepDismissTimer&&clearTimeout(this.nextStepDismissTimer),this.nextStepDismissTimer=setTimeout(()=>this.nextStepSuggestion$.set(null),6e4);return}this.nextStepSuggestion$.set({message:"Svi zadaci su zavr\u0161eni. Pregledajte rezultate ili zapo\u010Dnite novi koncept.",actionLabel:"Pogledaj zadatke"}),this.nextStepDismissTimer&&clearTimeout(this.nextStepDismissTimer),this.nextStepDismissTimer=setTimeout(()=>this.nextStepSuggestion$.set(null),6e4)}}domainHasPending(t){return t.status==="pending"?!0:t.children.some(e=>this.domainHasPending(e))}dismissNextStep(){this.nextStepSuggestion$.set(null),this.nextStepDismissTimer&&(clearTimeout(this.nextStepDismissTimer),this.nextStepDismissTimer=null)}onNextStepAction(){let t=this.nextStepSuggestion$();if(t){if(t.actionCurriculumId){let n=(this.conceptTree?.treeData$()?.tree??[]).find(i=>i.curriculumId===t.actionCurriculumId);if(n){let i=this.collectAllConceptIds(n),a=this.collectAllConversationIds(n);this.onConceptSelected({conceptId:null,curriculumId:n.curriculumId,conceptName:n.label,isFolder:!0,descendantConceptIds:i,descendantConversationIds:a})}}else this.activeTab$.set("notes");this.dismissNextStep()}}collectAllConceptIds(t){let e=[];t.conceptId&&e.push(t.conceptId);for(let n of t.children)e.push(...this.collectAllConceptIds(n));return e}collectAllConversationIds(t){let e=[];for(let n of t.conversations)e.push(n.id);for(let n of t.children)e.push(...this.collectAllConversationIds(n));return e}onTourComplete(){}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-chat"]],viewQuery:function(e,n){if(e&1&&un(Xt,5)(Kt,5)(Zt,5)($p,5)(Op,5),e&2){let i;Ze(i=Xe())&&(n.featureTour=i.first),Ze(i=Xe())&&(n.conceptTree=i.first),Ze(i=Xe())&&(n.conversationNotes=i.first),Ze(i=Xe())&&(n.yoloLogContainer=i.first),Ze(i=Xe())&&(n.messagesContainer=i.first)}},decls:37,vars:12,consts:[["messagesContainer",""],["yoloLogContainer",""],["role","alert",1,"error-toast",3,"top"],["role","status",1,"info-toast",3,"top"],[1,"layout"],[1,"sidebar-expand-btn"],[1,"sidebar-overlay"],[1,"sidebar"],[1,"sidebar-header"],[1,"sidebar-toggle",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 19l-7-7 7-7m8 14l-7-7 7-7"],[1,"sidebar-actions"],[1,"new-chat-btn",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","16px","height","16px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[3,"conversationSelected","newChatRequested","conceptSelected","activeConversationId","locked","newConversationIds","loadingItemId"],[1,"sidebar-footer"],["routerLink","/admin/llm-config"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["routerLink","/dashboard"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"],[1,"chat-main"],[1,"skeleton-messages"],[1,"empty-state"],[1,"right-panel"],[3,"tourComplete"],["role","alert",1,"error-toast"],["fill","currentColor","viewBox","0 0 20 20",2,"width","20px","height","20px","color","#EF4444","flex-shrink","0"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[2,"font-size","13px","color","#FAFAFA"],["aria-label","Dismiss",2,"background","none","border","none","color","#a1a1a1","cursor","pointer","margin-left","auto",3,"click"],["fill","currentColor","viewBox","0 0 20 20",2,"width","16px","height","16px"],["fill-rule","evenodd","d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule","evenodd"],["role","status",1,"info-toast"],["fill","currentColor","viewBox","0 0 20 20",2,"width","20px","height","20px","color","#3B82F6","flex-shrink","0"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],["aria-label","Zatvori",2,"background","none","border","none","color","#a1a1a1","cursor","pointer","margin-left","auto",3,"click"],[3,"topicSelected","cancelled"],[1,"sidebar-expand-btn",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 12h16M4 18h16"],[1,"sidebar-overlay",3,"click"],[1,"skeleton-msg","user"],[1,"skeleton-bubble","user"],[1,"skeleton-msg"],[1,"skeleton-bubble","ai"],[1,"skeleton-bubble","ai-short"],[1,"chat-header"],[1,"chat-header-left"],[1,"connection-dot",3,"title"],[1,"header-actions"],[1,"disconnect-toast",3,"error","warning","success"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","18px","height","18px","color","#3B82F6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"],[3,"personaType"],[1,"tab-bar",2,"border-bottom","none"],[1,"tab",3,"click"],[1,"switch-btn",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"],[1,"auto-ai-toggle"],[1,"auto-ai-label"],[1,"toggle-track",3,"click","disabled"],[1,"toggle-thumb"],[1,"disconnect-toast"],[1,"disconnect-toast-close",3,"click"],[1,"next-step-banner"],[2,"flex-shrink","0"],[3,"messageSent","disabled"],[1,"persona-selector-panel"],[1,"plan-inline-panel",3,"collapsed"],[1,"workflow-status-bar"],[1,"chat-messages-wrapper"],[1,"chat-messages",3,"scroll"],[1,"messages-container"],[2,"display","block","margin-bottom","16px",3,"message","personaType"],[1,"step-status-msg"],[1,"yolo-progress"],[1,"task-nav-card"],[3,"message","isStreaming","personaType"],[3,"personaType","phase"],[1,"step-confirmation"],[1,"return-link-container"],[1,"persona-selector-label"],[3,"personaSelected","selectedType","allowNone"],[1,"plan-inline-panel"],[1,"plan-header",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"plan-collapse-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"plan-meta"],[1,"plan-steps"],[1,"plan-step"],[1,"plan-btn-cancel"],[1,"plan-btn-cancel",3,"click"],[1,"plan-btn-approve",3,"click"],[1,"step-indicator"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"spinner",2,"width","16px","height","16px"],["fill","currentColor","viewBox","0 0 20 20",2,"width","14px","height","14px"],[1,"step-info"],[1,"step-title"],[1,"step-desc"],[1,"step-tags"],[1,"step-tag"],["stroke-linecap","round","stroke-width","2","d","M4 12a8 8 0 018-8"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"],[1,"workflow-status-entry","wse-executing",2,"border-left-color","#F59E0B"],[1,"workflow-status-entry",3,"wse-executing","wse-completed","wse-failed","wse-cancelled"],[1,"ws-title"],[1,"ws-progress-bar"],[1,"ws-progress-fill",2,"background","#F59E0B"],[1,"ws-count"],[1,"ws-current"],[1,"ws-badge-fail"],[2,"color","#10B981","font-size","11px","font-weight","600"],[1,"workflow-status-entry"],[1,"ws-detail-row"],[1,"ws-progress-fill"],[1,"ws-badge-done"],[2,"display","block","margin-bottom","16px",3,"citationClick","actionClick","message","personaType"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"step-icon","spinner"],[1,"yolo-progress-title"],[1,"yolo-spinner"],[1,"yolo-progress-stats"],[1,"yolo-progress-bar"],[1,"yolo-progress-fill"],[1,"yolo-workers"],[1,"yolo-failed"],[1,"yolo-deferred"],[1,"yolo-discovered"],[1,"yolo-worker-item"],[1,"yolo-worker-spinner"],[1,"yolo-worker-concept"],[1,"yolo-worker-step"],[1,"yolo-activity-toggle",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"yolo-toggle-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"yolo-activity-log"],[1,"yolo-log-entry"],[1,"task-nav-header"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"task-nav-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"],[1,"task-nav-dismiss",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","14px","height","14px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"task-nav-btn",3,"cross-concept"],[1,"task-nav-btn",3,"click"],[1,"task-nav-title"],[1,"task-nav-concept"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","12px","height","12px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 7l5 5m0 0l-5 5m5-5H6"],[1,"confirmation-header"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","#3B82F6","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","10"],["points","12 6 12 12 16 14"],[1,"confirmation-label"],[1,"confirmation-title"],[1,"confirmation-desc"],[1,"confirmation-actions"],[1,"input-prompt"],[1,"confirm-btn","primary",3,"click","disabled"],[1,"confirm-btn","cancel",3,"click","disabled"],[1,"btn-spinner"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","5","y1","12","x2","19","y2","12"],["points","12 5 19 12 12 19"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","#F59E0B","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"],[1,"return-link",3,"click"],["x1","19","y1","12","x2","5","y2","12"],["points","12 19 5 12 12 5"],["placeholder","Unesite va\u0161e odgovore, podatke o kompaniji, specifi\u010Dne zahteve...","rows","4",1,"confirmation-input",3,"input","value"],[1,"stop-generation-btn"],[1,"scroll-to-bottom"],[1,"stop-generation-btn",3,"click"],["x","6","y","6","width","12","height","12","rx","2","stroke-width","2"],[1,"scroll-to-bottom",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 14l-7 7m0 0l-7-7m7 7V3"],[1,"brain-status-bar"],[1,"notes-view",2,"flex","1","overflow-y","auto"],[3,"viewMessage","runAgents","executeTask","submitTaskResult","conversationId","conceptId","autoSelectTaskIds","isExecuting","executingTaskId","taskExecutionContent","submittingResultId","taskResultContent","isGeneratingPlan","parallelTaskStates","isParallelExecuting"],[1,"brain-status-label"],[1,"brain-progress-bar"],[1,"brain-progress-fill"],[1,"brain-stat"],[1,"brain-stat",2,"color","#F59E0B"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"next-step-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"],[1,"next-step-text"],[1,"next-step-actions"],[1,"next-step-btn","primary",3,"click"],[1,"next-step-btn","secondary"],[1,"next-step-close",3,"click"],[1,"next-step-btn","secondary",3,"click"],[1,"domain-dashboard"],[1,"domain-stats"],[1,"stat-card"],[1,"stat-label"],[1,"stat-value","completed"],[1,"stat-value","pending"],[1,"stat-value"],[1,"domain-actions"],[1,"run-brain-btn",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 10V3L4 14h7v7l9-11h-7z"],["title","YOLO re\u017Eim (bez pregleda plana)",1,"yolo-btn",3,"click","disabled"],[1,"add-investigation-btn",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"notes-view"],[3,"viewMessage","runAgents","executeTask","submitTaskResult","conversationId","conceptId","folderConceptIds","folderConversationIds","folderName","autoSelectTaskIds","isExecuting","executingTaskId","taskExecutionContent","submittingResultId","taskResultContent","isGeneratingPlan","parallelTaskStates","isParallelExecuting"],[1,"empty-content"],[1,"empty-icon"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","40px","height","40px","color","#3B82F6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"],[1,"empty-title"],[1,"empty-desc"],[1,"start-btn",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","20px","height","20px"],[1,"suggestion-grid"],[1,"suggestion-card",3,"click"],[1,"suggestion-card-icon"],[1,"suggestion-card-title"],[1,"suggestion-card-desc"],[1,"source-header"],[3,"close","conceptClick","conceptId","isOpen"]],template:function(e,n){e&1&&(G(0,Rp,8,3,"div",2,oo),G(2,zp,8,3,"div",3,oo),_(4,Lp,1,0,"app-topic-picker"),p(5,"div",4),_(6,Fp,3,0,"button",5),_(7,Vp,1,0,"div",6),p(8,"aside",7)(9,"div",8)(10,"h1"),c(11,"Mentor AI"),u(),p(12,"button",9),O("click",function(){return n.toggleSidebar()}),S(),p(13,"svg",10),T(14,"path",11),u()()(),j(),p(15,"div",12)(16,"button",13),O("click",function(){return n.createNewConversation()}),S(),p(17,"svg",14),T(18,"path",15),u(),c(19," New Conversation "),u()(),j(),p(20,"app-concept-tree",16),O("conversationSelected",function(a){return n.selectConversation(a)})("newChatRequested",function(a){return n.createConversationUnderConcept(a)})("conceptSelected",function(a){return n.onConceptSelected(a)}),u(),p(21,"div",17)(22,"a",18),S(),p(23,"svg",14),T(24,"path",19)(25,"path",20),u(),c(26," AI Configuration "),u(),j(),p(27,"a",21),S(),p(28,"svg",14),T(29,"path",22),u(),c(30," Dashboard "),u()()(),j(),p(31,"main",23),_(32,Bp,13,0,"div",24)(33,rm,9,11)(34,sm,42,0,"div",25),u(),_(35,lm,4,2,"aside",26),u(),p(36,"app-feature-tour",27),O("tourComplete",function(){return n.onTourComplete()}),u()),e&2&&(q(n.errorMessages$()),r(2),q(n.infoMessages$()),r(2),C(n.showTopicPicker$()?4:-1),r(2),C(n.sidebarCollapsed$()?6:-1),r(),C(n.sidebarCollapsed$()?-1:7),r(),N("collapsed",n.sidebarCollapsed$()),r(8),V("disabled",n.isLoading$()||n.isCurrentConversationExecuting$()),r(4),V("activeConversationId",n.activeConversationId$())("locked",n.isCurrentConversationExecuting$())("newConversationIds",n.newConversationIds$())("loadingItemId",n.loadingConversationId$()),r(12),C(n.isLoadingConversation$()&&!n.activeConversation$()?32:n.activeConversation$()||n.folderName$()?33:34),r(3),C(n.selectedConceptId$()?35:-1))},dependencies:[ie,Ui,Gn,Yn,Kn,Zn,Xn,Jn,Kt,Zt,to,Xt],styles:["[_nghost-%COMP%]{display:block;height:100vh}*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box}.layout[_ngcontent-%COMP%]{display:flex;height:100vh;background:#0d0d0d;color:#fafafa;font-family:Inter,system-ui,sans-serif}.sidebar[_ngcontent-%COMP%]{width:280px;min-width:280px;background:#0d0d0d;border-right:1px solid #2a2a2a;display:flex;flex-direction:column;transition:width .25s ease,min-width .25s ease;overflow:hidden}.sidebar.collapsed[_ngcontent-%COMP%]{width:0;min-width:0;border-right:none}.sidebar-toggle[_ngcontent-%COMP%]{background:none;border:none;color:#9e9e9e;cursor:pointer;padding:4px;display:flex;align-items:center;justify-content:center;border-radius:4px;flex-shrink:0}.sidebar-toggle[_ngcontent-%COMP%]:hover{color:#fafafa;background:#1a1a1a}.sidebar-toggle[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.sidebar-expand-btn[_ngcontent-%COMP%]{position:fixed;top:12px;left:12px;z-index:50;background:#1a1a1a;border:1px solid #2a2a2a;color:#9e9e9e;cursor:pointer;padding:8px;border-radius:8px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px #0000004d;transition:all .2s}.sidebar-expand-btn[_ngcontent-%COMP%]:hover{color:#fafafa;background:#242424;border-color:#3b82f6}.sidebar-expand-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.sidebar-overlay[_ngcontent-%COMP%]{display:none}@media(max-width:768px){.sidebar[_ngcontent-%COMP%]{position:fixed;top:0;left:0;height:100vh;z-index:100;box-shadow:4px 0 16px #0006}.sidebar.collapsed[_ngcontent-%COMP%]{width:0;box-shadow:none}.sidebar-overlay[_ngcontent-%COMP%]{display:block;position:fixed;inset:0;background:#00000080;z-index:99}.chat-main[_ngcontent-%COMP%]{min-width:0!important}}.sidebar-header[_ngcontent-%COMP%]{height:48px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;border-bottom:1px solid #2a2a2a}.sidebar-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:15px;font-weight:600}.sidebar-actions[_ngcontent-%COMP%]{padding:12px}.new-chat-btn[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;gap:8px;background:#3b82f6;color:#fff;border:none;padding:10px 16px;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer}.new-chat-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb}.new-chat-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.sidebar-footer[_ngcontent-%COMP%]{padding:12px;border-top:1px solid #2a2a2a;display:flex;flex-direction:column;gap:4px}.sidebar-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:13px;color:#9e9e9e;text-decoration:none;padding:6px 4px;border-radius:4px}.sidebar-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#fafafa;background:#1a1a1a}.chat-main[_ngcontent-%COMP%]{flex:1;min-width:480px;display:flex;flex-direction:column;background:#0d0d0d}.chat-header[_ngcontent-%COMP%]{height:48px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;border-bottom:1px solid #2a2a2a}.chat-header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.chat-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:15px;font-weight:500}.switch-btn[_ngcontent-%COMP%]{background:none;border:none;color:#9e9e9e;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:6px}.switch-btn[_ngcontent-%COMP%]:hover:not(:disabled){color:#fafafa}.switch-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.connection-dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;flex-shrink:0}.connection-label[_ngcontent-%COMP%]{font-size:11px;color:#707070;transition:color .2s}.connection-label.connected[_ngcontent-%COMP%]{color:#22c55e}.connection-label.disconnected[_ngcontent-%COMP%]{color:#ef4444}.connection-label.reconnecting[_ngcontent-%COMP%]{color:#f59e0b}.connection-dot.connected[_ngcontent-%COMP%]{background:#22c55e}.connection-dot.disconnected[_ngcontent-%COMP%]{background:#ef4444}.connection-dot.reconnecting[_ngcontent-%COMP%]{background:#f59e0b;animation:_ngcontent-%COMP%_pulse-dot 1s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse-dot{0%,to{opacity:1}50%{opacity:.3}}.disconnect-toast[_ngcontent-%COMP%]{padding:8px 16px;background:#1a1a1a;border-bottom:1px solid #2a2a2a;display:flex;align-items:center;gap:8px;font-size:12px;flex-shrink:0}.disconnect-toast.error[_ngcontent-%COMP%]{border-left:3px solid #ef4444;color:#fca5a5}.disconnect-toast.warning[_ngcontent-%COMP%]{border-left:3px solid #f59e0b;color:#fde68a}.disconnect-toast.success[_ngcontent-%COMP%]{border-left:3px solid #22c55e;color:#86efac}.disconnect-toast-close[_ngcontent-%COMP%]{background:none;border:none;color:#707070;cursor:pointer;margin-left:auto;font-size:14px;padding:0 4px}.disconnect-toast-close[_ngcontent-%COMP%]:hover{color:#fafafa}.chat-messages-wrapper[_ngcontent-%COMP%]{position:relative;flex:1;display:flex;flex-direction:column;overflow:hidden}.chat-messages[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:24px;scroll-behavior:smooth}.messages-container[_ngcontent-%COMP%]{max-width:768px;margin:0 auto}.scroll-to-bottom[_ngcontent-%COMP%]{position:absolute;bottom:16px;left:50%;transform:translate(-50%);width:36px;height:36px;border-radius:50%;background:#242424;border:1px solid #3a3a3a;color:#fafafa;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px #0000004d;transition:all .2s;z-index:10;animation:_ngcontent-%COMP%_scrollBtnFadeIn .2s ease-out}@keyframes _ngcontent-%COMP%_scrollBtnFadeIn{0%{opacity:0;transform:translate(-50%) translateY(8px)}to{opacity:1;transform:translate(-50%) translateY(0)}}.scroll-to-bottom[_ngcontent-%COMP%]:hover{background:#3a3a3a;border-color:#3b82f6}.scroll-to-bottom[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:18px;height:18px}.stop-generation-btn[_ngcontent-%COMP%]{position:absolute;bottom:16px;left:50%;transform:translate(-50%);display:flex;align-items:center;gap:8px;padding:8px 16px;background:#242424;border:1px solid #3a3a3a;border-radius:20px;color:#fafafa;font-size:13px;font-weight:500;cursor:pointer;font-family:inherit;box-shadow:0 4px 12px #0000004d;transition:all .2s;z-index:10;animation:_ngcontent-%COMP%_scrollBtnFadeIn .2s ease-out}.stop-generation-btn[_ngcontent-%COMP%]:hover{background:#3a3a3a;border-color:#ef4444}.stop-generation-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.empty-state[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;animation:_ngcontent-%COMP%_emptyFadeIn .5s ease-out}@keyframes _ngcontent-%COMP%_emptyFadeIn{0%{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}.empty-content[_ngcontent-%COMP%]{text-align:center;max-width:560px;padding:24px}.empty-icon[_ngcontent-%COMP%]{width:80px;height:80px;margin:0 auto 24px;background:#1a1a1a;border-radius:16px;display:flex;align-items:center;justify-content:center}.empty-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;margin-bottom:8px}.empty-desc[_ngcontent-%COMP%]{font-size:15px;color:#a1a1a1;margin-bottom:24px;line-height:1.5}.start-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;background:#3b82f6;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:15px;font-weight:500;cursor:pointer}.start-btn[_ngcontent-%COMP%]:hover{background:#2563eb}.suggestion-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:24px}.suggestion-card[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:16px;text-align:left;cursor:pointer;font-family:inherit;transition:all .2s}.suggestion-card[_ngcontent-%COMP%]:hover{background:#242424;border-color:#3b82f6;transform:translateY(-2px)}.suggestion-card-icon[_ngcontent-%COMP%]{font-size:20px;margin-bottom:8px}.suggestion-card-title[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:#fafafa;margin-bottom:4px}.suggestion-card-desc[_ngcontent-%COMP%]{font-size:12px;color:#9e9e9e;line-height:1.4}.persona-pills[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin-top:24px}.domain-pill[_ngcontent-%COMP%]{padding:8px 16px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:20px;font-size:13px;font-weight:500;color:#a1a1a1;cursor:pointer;font-family:inherit;transition:all .15s}.domain-pill[_ngcontent-%COMP%]:hover{background:#242424;border-color:#3b82f6;color:#fafafa}.empty-or[_ngcontent-%COMP%]{font-size:12px;color:#707070;margin-top:16px;margin-bottom:0}.persona-selector-panel[_ngcontent-%COMP%]{padding:12px 16px;border-bottom:1px solid #2a2a2a;background:#1a1a1a;animation:_ngcontent-%COMP%_panelSlideDown .2s ease}@keyframes _ngcontent-%COMP%_panelSlideDown{0%{opacity:0;max-height:0;padding-top:0;padding-bottom:0}to{opacity:1;max-height:200px;padding-top:12px;padding-bottom:12px}}.persona-selector-label[_ngcontent-%COMP%]{font-size:13px;color:#a1a1a1;margin-bottom:12px}.error-toast[_ngcontent-%COMP%]{position:fixed;top:16px;right:16px;z-index:9999;background:#1a1a1a;border:1px solid #ef4444;border-left:3px solid #ef4444;padding:12px 16px;border-radius:8px;display:flex;align-items:center;gap:12px;max-width:400px;box-shadow:0 4px 16px #0006;animation:_ngcontent-%COMP%_toastSlideIn .3s ease-out;font-size:13px;color:#fca5a5}.info-toast[_ngcontent-%COMP%]{position:fixed;top:16px;right:16px;z-index:9999;background:#1a1a1a;border:1px solid #3b82f6;border-left:3px solid #3b82f6;padding:12px 16px;border-radius:8px;display:flex;align-items:center;gap:12px;max-width:400px;box-shadow:0 4px 16px #0006;animation:_ngcontent-%COMP%_toastSlideIn .3s ease-out;font-size:13px;color:#93c5fd}.success-toast[_ngcontent-%COMP%]{position:fixed;top:16px;right:16px;z-index:9999;background:#1a1a1a;border:1px solid #22c55e;border-left:3px solid #22c55e;padding:12px 16px;border-radius:8px;display:flex;align-items:center;gap:12px;max-width:400px;box-shadow:0 4px 16px #0006;animation:_ngcontent-%COMP%_toastSlideIn .3s ease-out;font-size:13px;color:#86efac}@keyframes _ngcontent-%COMP%_toastSlideIn{0%{opacity:0;transform:translate(100%)}to{opacity:1;transform:translate(0)}}.toast-dismiss[_ngcontent-%COMP%]{background:none;border:none;color:#707070;cursor:pointer;padding:2px;font-size:16px;line-height:1;margin-left:auto;flex-shrink:0}.toast-dismiss[_ngcontent-%COMP%]:hover{color:#fafafa}.right-panel[_ngcontent-%COMP%]{width:360px;min-width:360px;background:#0d0d0d;border-left:1px solid #2a2a2a;display:flex;flex-direction:column}.source-header[_ngcontent-%COMP%]{padding:12px 16px;border-bottom:1px solid #2a2a2a;font-size:11px;font-weight:600;color:#9e9e9e;text-transform:uppercase;letter-spacing:.5px;flex-shrink:0}.tab-bar[_ngcontent-%COMP%]{display:flex;gap:0;border-bottom:1px solid #2a2a2a}.tab[_ngcontent-%COMP%]{padding:8px 20px;background:none;border:none;border-bottom:2px solid transparent;color:#9e9e9e;font-size:13px;cursor:pointer}.tab[_ngcontent-%COMP%]:hover{color:#d4d4d4}.tab.active[_ngcontent-%COMP%]{color:#fafafa;border-bottom-color:#3b82f6;font-weight:600}.notes-view[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden}.brain-status-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px 16px;background:#1a1a1a;border-bottom:1px solid #2a2a2a;font-size:11px;flex-shrink:0}.brain-status-label[_ngcontent-%COMP%]{color:#707070;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.brain-progress-bar[_ngcontent-%COMP%]{flex:1;height:4px;background:#242424;border-radius:2px;overflow:hidden;min-width:60px}.brain-progress-fill[_ngcontent-%COMP%]{height:100%;background:#3b82f6;border-radius:2px;transition:width .5s}.brain-stat[_ngcontent-%COMP%]{color:#9e9e9e;white-space:nowrap}.brain-stat[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#fafafa}.auto-ai-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-left:auto}.auto-ai-label[_ngcontent-%COMP%]{color:#707070;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.toggle-track[_ngcontent-%COMP%]{width:36px;height:20px;border-radius:10px;background:#2a2a2a;cursor:pointer;position:relative;transition:background .2s;border:none;padding:0}.toggle-track.active[_ngcontent-%COMP%]{background:#3b82f6}.toggle-track[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.toggle-thumb[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:50%;background:#fafafa;position:absolute;top:2px;left:2px;transition:transform .2s}.toggle-track.active[_ngcontent-%COMP%]   .toggle-thumb[_ngcontent-%COMP%]{transform:translate(16px)}.next-step-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:10px 16px;background:linear-gradient(135deg,#3b82f614,#3b82f608);border:1px solid rgba(59,130,246,.2);border-radius:8px;margin:8px 16px;font-size:13px;animation:_ngcontent-%COMP%_fadeSlideIn .3s ease}.next-step-icon[_ngcontent-%COMP%]{width:20px;height:20px;color:#3b82f6;flex-shrink:0}.next-step-text[_ngcontent-%COMP%]{flex:1;color:#bfbfbf}.next-step-actions[_ngcontent-%COMP%]{display:flex;gap:8px;flex-shrink:0}.next-step-btn[_ngcontent-%COMP%]{padding:4px 12px;border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;border:none;transition:all .15s ease}.next-step-btn.primary[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.next-step-btn.primary[_ngcontent-%COMP%]:hover{background:#2563eb}.next-step-btn.secondary[_ngcontent-%COMP%]{background:transparent;color:#9e9e9e;border:1px solid #2a2a2a}.next-step-btn.secondary[_ngcontent-%COMP%]:hover{color:#fafafa;border-color:#525252}.next-step-close[_ngcontent-%COMP%]{background:none;border:none;color:#525252;font-size:16px;cursor:pointer;padding:0 4px;line-height:1}.next-step-close[_ngcontent-%COMP%]:hover{color:#fafafa}@keyframes _ngcontent-%COMP%_fadeSlideIn{0%{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}.domain-dashboard[_ngcontent-%COMP%]{padding:20px 24px;border-bottom:1px solid #2a2a2a}.domain-stats[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:16px}.stat-card[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:8px;padding:12px 16px;flex:1}.stat-label[_ngcontent-%COMP%]{font-size:11px;color:#9e9e9e;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}.stat-value[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#fafafa}.stat-value.completed[_ngcontent-%COMP%]{color:#10b981}.stat-value.pending[_ngcontent-%COMP%]{color:#f59e0b}.domain-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.run-brain-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 18px;background:#3b82f6;color:#fff;border:none;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer}.run-brain-btn[_ngcontent-%COMP%]:hover{background:#2563eb}.run-brain-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.add-investigation-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 18px;background:#242424;color:#fafafa;border:1px solid #2a2a2a;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer}.add-investigation-btn[_ngcontent-%COMP%]:hover{background:#2a2a2a}.yolo-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:8px 10px;border-radius:8px;border:1px solid #2a2a2a;background:none;color:#9e9e9e;cursor:pointer}.yolo-btn[_ngcontent-%COMP%]:hover{color:#eab308;border-color:#eab308}.yolo-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.plan-inline-panel[_ngcontent-%COMP%]{background:#1a1a1a;border-bottom:1px solid #2a2a2a;display:flex;flex-direction:column;flex-shrink:0}.plan-inline-panel.collapsed[_ngcontent-%COMP%]   .plan-steps[_ngcontent-%COMP%], .plan-inline-panel.collapsed[_ngcontent-%COMP%]   .plan-footer[_ngcontent-%COMP%]{display:none}.plan-header[_ngcontent-%COMP%]{padding:10px 16px;border-bottom:1px solid #2a2a2a;display:flex;align-items:center;gap:12px;cursor:pointer}.plan-header[_ngcontent-%COMP%]:hover{background:#242424}.plan-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#fafafa;flex:1}.plan-collapse-icon[_ngcontent-%COMP%]{width:16px;height:16px;color:#9e9e9e;transition:transform .2s;flex-shrink:0}.plan-collapse-icon.expanded[_ngcontent-%COMP%]{transform:rotate(180deg)}.plan-meta[_ngcontent-%COMP%]{display:flex;gap:16px;font-size:12px;color:#a1a1a1}.plan-summary[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1;padding:8px 0 0}.plan-steps[_ngcontent-%COMP%]{max-height:40vh;overflow-y:auto;padding:8px 16px;transition:max-height .3s ease,opacity .3s ease,padding .3s ease}.plan-step[_ngcontent-%COMP%]{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid #242424}.plan-step[_ngcontent-%COMP%]:last-child{border-bottom:none}.step-indicator[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600}.step-pending[_ngcontent-%COMP%]{background:#242424;color:#9e9e9e}.step-in-progress[_ngcontent-%COMP%]{background:#1e3a5f;color:#60a5fa}.step-completed[_ngcontent-%COMP%]{background:#1a2e1a;color:#86efac}.step-failed[_ngcontent-%COMP%]{background:#3b1a1a;color:#fca5a5}.step-info[_ngcontent-%COMP%]{flex:1}.step-title[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:#fafafa}.step-desc[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1;margin-top:2px}.step-tags[_ngcontent-%COMP%]{display:flex;gap:6px;margin-top:4px}.step-tag[_ngcontent-%COMP%]{font-size:10px;padding:1px 6px;border-radius:4px;background:#242424;color:#9e9e9e}.plan-btn-cancel[_ngcontent-%COMP%]{background:none;border:1px solid #2a2a2a;color:#a1a1a1;border-radius:6px;padding:4px 12px;font-size:12px;cursor:pointer;font-family:inherit;flex-shrink:0}.plan-btn-cancel[_ngcontent-%COMP%]:hover{color:#fafafa;border-color:#4a4a4a}.plan-btn-approve[_ngcontent-%COMP%]{background:#3b82f6;color:#fafafa;border:none;border-radius:6px;padding:4px 12px;font-size:12px;font-weight:500;font-family:inherit;flex-shrink:0;cursor:pointer}.plan-btn-approve[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb}.plan-btn-approve[_ngcontent-%COMP%]:disabled, .plan-btn-cancel[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.btn-spinner[_ngcontent-%COMP%]{display:inline-block;width:12px;height:12px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;vertical-align:middle}.workflow-status-bar[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;padding:10px 16px;background:#1a1a1a;border-bottom:1px solid #2a2a2a;flex-shrink:0}.workflow-status-entry[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:8px;font-size:12px;padding:8px 12px;border-radius:6px;background:#0d0d0d}.ws-detail-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex:1;min-width:0}.wse-executing[_ngcontent-%COMP%]{border-left:3px solid #3b82f6}.wse-completed[_ngcontent-%COMP%]{border-left:3px solid #22c55e;animation:_ngcontent-%COMP%_fadeOutEntry 1.5s ease 3s forwards}.wse-failed[_ngcontent-%COMP%]{border-left:3px solid #ef4444;animation:_ngcontent-%COMP%_fadeOutEntry 1.5s ease 3s forwards}.wse-cancelled[_ngcontent-%COMP%]{border-left:3px solid #f59e0b;animation:_ngcontent-%COMP%_fadeOutEntry 1.5s ease 3s forwards}@keyframes _ngcontent-%COMP%_fadeOutEntry{0%{opacity:1;max-height:60px}to{opacity:0;max-height:0;padding:0;margin:0;overflow:hidden}}.ws-title[_ngcontent-%COMP%]{color:#fafafa;font-weight:600;font-size:13px;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%}.ws-progress-bar[_ngcontent-%COMP%]{flex:1;height:4px;background:#242424;border-radius:2px;overflow:hidden;min-width:60px}.ws-progress-fill[_ngcontent-%COMP%]{height:100%;background:#3b82f6;border-radius:2px;transition:width .3s}.ws-count[_ngcontent-%COMP%]{color:#9e9e9e;flex-shrink:0}.ws-current[_ngcontent-%COMP%]{color:#60a5fa;font-size:11px;width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ws-badge-done[_ngcontent-%COMP%]{color:#22c55e;font-weight:600}.ws-badge-fail[_ngcontent-%COMP%]{color:#ef4444;font-weight:600}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:-200% 0}to{background-position:200% 0}}.skeleton-messages[_ngcontent-%COMP%]{max-width:768px;margin:0 auto;padding:24px}.skeleton-msg[_ngcontent-%COMP%]{margin-bottom:20px;display:flex}.skeleton-msg.user[_ngcontent-%COMP%]{justify-content:flex-end}.skeleton-bubble[_ngcontent-%COMP%]{border-radius:12px;background:linear-gradient(90deg,#1a1a1a 25%,#242424,#1a1a1a 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s ease-in-out infinite}.skeleton-bubble.user[_ngcontent-%COMP%]{width:40%;height:48px}.skeleton-bubble.ai[_ngcontent-%COMP%]{width:70%;height:80px}.skeleton-bubble.ai-short[_ngcontent-%COMP%]{width:55%;height:56px}.step-status-msg[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 14px;margin:8px 0;max-width:768px;background:#1a1a1a;border-left:3px solid #3b82f6;border-radius:0 6px 6px 0;font-size:12px;color:#a1a1a1}.step-status-msg[_ngcontent-%COMP%]   .step-icon[_ngcontent-%COMP%]{width:14px;height:14px;flex-shrink:0}.task-nav-card[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:10px;margin-bottom:16px;overflow:hidden;animation:_ngcontent-%COMP%_cardFadeIn .25s ease}.task-nav-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 14px;font-size:12px;font-weight:600;color:#a1a1a1;border-bottom:1px solid #242424}.task-nav-icon[_ngcontent-%COMP%]{width:16px;height:16px;color:#3b82f6;flex-shrink:0}.task-nav-dismiss[_ngcontent-%COMP%]{margin-left:auto;background:none;border:none;color:#707070;cursor:pointer;padding:2px;display:flex;align-items:center}.task-nav-dismiss[_ngcontent-%COMP%]:hover{color:#a1a1a1}.task-nav-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:10px 14px;background:none;border:none;border-bottom:1px solid #1e1e1e;color:#fafafa;font-size:13px;cursor:pointer;text-align:left;transition:background .15s;gap:12px;font-family:inherit}.task-nav-btn[_ngcontent-%COMP%]:last-child{border-bottom:none}.task-nav-btn[_ngcontent-%COMP%]:hover{background:#242424}.task-nav-btn.cross-concept[_ngcontent-%COMP%]{border-left:3px solid #3b82f6}.task-nav-title[_ngcontent-%COMP%]{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.task-nav-concept[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:11px;color:#3b82f6;flex-shrink:0;white-space:nowrap}@keyframes _ngcontent-%COMP%_cardFadeIn{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_highlightFlash{0%{outline:2px solid #3b82f6;outline-offset:4px}to{outline:2px solid transparent;outline-offset:4px}}[_nghost-%COMP%]     .highlight-flash{animation:_ngcontent-%COMP%_highlightFlash 2s ease-out}.step-confirmation[_ngcontent-%COMP%]{margin:16px 0;padding:16px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;border-left:3px solid #3b82f6}.confirmation-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px}.confirmation-label[_ngcontent-%COMP%]{font-size:.8rem;font-weight:600;color:#3b82f6;text-transform:uppercase;letter-spacing:.05em}.confirmation-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#fafafa;margin:0 0 4px}.confirmation-desc[_ngcontent-%COMP%]{font-size:.875rem;color:#a3a3a3;margin:0 0 12px;line-height:1.5}.input-prompt[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;margin-bottom:8px;background:#f59e0b14;border:1px solid rgba(245,158,11,.2);border-radius:8px;font-size:.85rem;color:#f59e0b;font-weight:500}.input-prompt[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}.confirmation-input[_ngcontent-%COMP%]{width:100%;padding:10px 12px;background:#0d0d0d;border:1px solid #2a2a2a;border-radius:8px;color:#fafafa;font-size:.875rem;font-family:inherit;resize:vertical;min-height:60px;margin-bottom:12px;transition:border-color .15s ease;box-sizing:border-box}.confirmation-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.confirmation-input[_ngcontent-%COMP%]::placeholder{color:#525252}.confirmation-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.confirm-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:6px;padding:8px 16px;font-size:.875rem;font-weight:500;border-radius:8px;cursor:pointer;transition:all .15s ease;border:1px solid transparent}.confirm-btn.primary[_ngcontent-%COMP%]{background:#3b82f6;color:#fff;border-color:#3b82f6}.confirm-btn.primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb;border-color:#2563eb}.confirm-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.confirm-btn.cancel[_ngcontent-%COMP%]{background:transparent;color:#a3a3a3;border-color:#2a2a2a}.confirm-btn.cancel[_ngcontent-%COMP%]:hover{background:#1a1a1a;color:#ef4444;border-color:#ef4444}.return-link-container[_ngcontent-%COMP%]{margin:12px 0;text-align:center}.return-link[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;background:none;border:1px solid #2a2a2a;color:#60a5fa;padding:8px 16px;border-radius:8px;font-size:13px;cursor:pointer;transition:all .15s ease}.return-link[_ngcontent-%COMP%]:hover{background:#1a1a1a;border-color:#3b82f6;color:#93c5fd}.return-link[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}"]})};export{ar as ChatComponent};
