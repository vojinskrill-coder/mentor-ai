import{$a as u,A as g,K as o,gb as m,p as c,u as n,x as d}from"./chunk-G6XBTM5S.js";var i={production:!0,apiUrl:"",appName:"Mentor AI",version:"0.0.1",google:{clientId:"723199480172-346msdc1rhff92r50attqd9dl78snhva.apps.googleusercontent.com",redirectUri:""}};var t={TOKEN:"mentor_ai_token",USER:"mentor_ai_user",GOOGLE_USER:"mentor_ai_google_user",CODE_VERIFIER:"mentor_ai_code_verifier"},h=class l{http=g(u);router=g(m);_isAuthenticated=o(this.hasStoredToken());_isLoading=o(!1);_currentUser=o(this.getStoredUser());_googleUser=o(this.getStoredGoogleUser());_mfaRequired=o(!1);_mfaStatus=o(null);isAuthenticated$=this._isAuthenticated.asReadonly();isLoading$=this._isLoading.asReadonly();user$=this._googleUser.asReadonly();currentUser=this._currentUser.asReadonly();mfaRequired=this._mfaRequired.asReadonly();mfaStatus=this._mfaStatus.asReadonly();login(e){e&&sessionStorage.setItem("returnUrl",e);let r=this.generateCodeVerifier();localStorage.setItem(t.CODE_VERIFIER,r),this.generateCodeChallenge(r).then(s=>{let a=i.google.redirectUri||`${window.location.origin}/callback`,p=new URLSearchParams({client_id:i.google.clientId,redirect_uri:a,response_type:"code",scope:"openid email profile",access_type:"offline",prompt:"consent",code_challenge:s,code_challenge_method:"S256"});window.location.href=`https://accounts.google.com/o/oauth2/v2/auth?${p.toString()}`})}handleCallback(e){this._isLoading.set(!0);let r=localStorage.getItem(t.CODE_VERIFIER)||"",s=i.google.redirectUri||`${window.location.origin}/callback`;return this.http.post("/api/auth/google/callback",{code:e,redirectUri:s,codeVerifier:r}).pipe(n(a=>{localStorage.removeItem(t.CODE_VERIFIER),a.token&&localStorage.setItem(t.TOKEN,a.token),a.user&&(localStorage.setItem(t.USER,JSON.stringify(a.user)),this._currentUser.set(a.user)),this._isAuthenticated.set(!0),this._isLoading.set(!1),this._mfaRequired.set(a.requiresMfaSetup)}),c(a=>{throw this._isLoading.set(!1),localStorage.removeItem(t.CODE_VERIFIER),a}))}logout(){localStorage.removeItem(t.TOKEN),localStorage.removeItem(t.USER),localStorage.removeItem(t.GOOGLE_USER),localStorage.removeItem(t.CODE_VERIFIER),this._isAuthenticated.set(!1),this._currentUser.set(null),this._googleUser.set(null),this._mfaStatus.set(null),this._mfaRequired.set(!1),this.router.navigate(["/login"])}getAccessToken(){return localStorage.getItem(t.TOKEN)}checkMfaStatus(){return this.http.get("/api/auth/2fa/status").pipe(n(e=>{this._mfaStatus.set(e),this._mfaRequired.set(!e.enabled)}))}enrollMfa(){return this.http.post("/api/auth/2fa/enroll",{})}verifyMfaEnrollment(e){return this.http.post("/api/auth/2fa/verify",{code:e}).pipe(n(()=>{this._mfaRequired.set(!1),this._mfaStatus.set({enabled:!0})}))}verifyLoginTotp(e){return this.http.post("/api/auth/2fa/verify-login",{code:e})}verifyRecoveryCode(e){return this.http.post("/api/auth/2fa/recovery",{recoveryCode:e})}devLogin(){let e="dev-mode-token",r={userId:"dev-user-001",email:"dev@mentor-ai.local",tenantId:"dev-tenant-001",role:"PLATFORM_OWNER"};localStorage.setItem(t.TOKEN,e),localStorage.setItem(t.USER,JSON.stringify(r)),this._isAuthenticated.set(!0),this._currentUser.set(r),this._mfaRequired.set(!1)}hasStoredToken(){return!!localStorage.getItem(t.TOKEN)}getStoredUser(){try{let e=localStorage.getItem(t.USER);return e?JSON.parse(e):null}catch{return null}}getStoredGoogleUser(){try{let e=localStorage.getItem(t.GOOGLE_USER);return e?JSON.parse(e):null}catch{return null}}generateCodeVerifier(){let e=new Uint8Array(32);return crypto.getRandomValues(e),this.base64UrlEncode(e)}async generateCodeChallenge(e){let s=new TextEncoder().encode(e),a=await crypto.subtle.digest("SHA-256",s);return this.base64UrlEncode(new Uint8Array(a))}base64UrlEncode(e){let r="";for(let s of e)r+=String.fromCharCode(s);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}static \u0275fac=function(r){return new(r||l)};static \u0275prov=d({token:l,factory:l.\u0275fac,providedIn:"root"})};export{i as a,h as b};
