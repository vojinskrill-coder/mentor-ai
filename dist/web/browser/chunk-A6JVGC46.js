import{c as z,d as w,e as R,f as D,h as I,i as L,j as N,o as j,p as q,q as A,s as G}from"./chunk-BJPJ353G.js";import{b as V}from"./chunk-X5FYGGBF.js";import{a as M}from"./chunk-QLHVQZLH.js";import{$a as F,A as u,C as f,D as x,E as b,Ea as r,F as h,Fa as C,H as S,K as l,V as a,Z as O,fa as m,ga as g,ia as P,ja as k,ka as T,kb as E,la as v,ma as t,na as n,oa as s,sa as y,ua as _,wa as p}from"./chunk-GC2SN3QZ.js";function B(o,i){if(o&1&&(t(0,"div",3),r(1),n()),o&2){let e=p();a(),C(e.error())}}function H(o,i){o&1&&(t(0,"div",4),s(1,"div",6),t(2,"p",7),r(3,"Loading 2FA setup..."),n()())}function $(o,i){o&1&&(t(0,"p",16),r(1,"Please enter a valid 6-digit code"),n())}function Q(o,i){o&1&&(s(0,"span",18),r(1," Verifying... "))}function J(o,i){o&1&&r(0," Verify and Enable 2FA ")}function K(o,i){if(o&1){let e=y();t(0,"div",5)(1,"h2"),r(2,"Step 1: Scan QR Code"),n(),t(3,"p",8),r(4," Open your authenticator app (Google Authenticator, Authy, etc.) and scan this QR code: "),n(),t(5,"div",9)(6,"div",10)(7,"div")(8,"p"),r(9),n(),t(10,"p",11),r(11,"Scan with authenticator app"),n()()()(),t(12,"p",12),r(13," Manual entry code: "),t(14,"code"),r(15),n()()(),t(16,"div",5)(17,"h2"),r(18,"Step 2: Enter Verification Code"),n(),t(19,"form",13),_("ngSubmit",function(){f(e);let d=p();return x(d.verifyCode())}),t(20,"label",14),r(21,"6-digit code"),n(),s(22,"input",15),m(23,$,2,0,"p",16),t(24,"button",17),m(25,Q,2,0)(26,J,1,0),n()()()}if(o&2){let e=p();a(9),C(e.secret()),a(6),C(e.secret()),a(4),v("formGroup",e.verifyForm),a(4),g(e.verifyForm.controls.code.touched&&e.verifyForm.controls.code.errors?23:-1),a(),v("disabled",e.isVerifying()||e.verifyForm.invalid),a(),g(e.isVerifying()?25:26)}}function W(o,i){if(o&1&&(t(0,"div",25),r(1),n()),o&2){let e=i.$implicit;a(),C(e)}}function X(o,i){o&1&&(b(),t(0,"svg",31),s(1,"path",21),n(),r(2," Copied! "))}function Y(o,i){o&1&&(b(),t(0,"svg",28),s(1,"path",32),n(),r(2," Copy Codes "))}function Z(o,i){if(o&1){let e=y();t(0,"div",5)(1,"div",19),b(),t(2,"svg",20),s(3,"path",21),n(),h(),t(4,"h2"),r(5,"2FA Enabled Successfully!"),n()(),t(6,"div",22)(7,"p"),r(8,"Save your recovery codes"),n(),t(9,"p",23),r(10," If you lose access to your authenticator app, you can use these codes. Each code can only be used once. "),n()(),t(11,"div",24),k(12,W,2,1,"div",25,P),n(),t(14,"div",26)(15,"button",27),_("click",function(){f(e);let d=p();return x(d.copyRecoveryCodes())}),m(16,X,3,0)(17,Y,3,0),n(),t(18,"button",27),_("click",function(){f(e);let d=p();return x(d.downloadRecoveryCodes())}),b(),t(19,"svg",28),s(20,"path",29),n(),r(21," Download "),n()(),h(),t(22,"button",30),_("click",function(){f(e);let d=p();return x(d.complete())}),r(23," Continue to Dashboard "),n()()}if(o&2){let e=p();a(12),T(e.recoveryCodes()),a(4),g(e.copied()?16:17)}}var U=class o{authService=u(V);router=u(E);fb=u(A);destroyRef=u(S);isLoading=l(!0);isVerifying=l(!1);error=l(null);step=l("qr");secret=l("");recoveryCodes=l([]);copied=l(!1);verifyForm=this.fb.group({code:["",[w.required,w.pattern(/^\d{6}$/)]]});ngOnInit(){this.enrollMfa()}enrollMfa(){this.isLoading.set(!0),this.error.set(null),this.authService.enrollMfa().pipe(M(this.destroyRef)).subscribe({next:i=>{this.secret.set(i.secret),this.recoveryCodes.set(i.recoveryCodes),this.isLoading.set(!1)},error:i=>{this.error.set(i?.error?.detail||"Failed to initialize 2FA setup"),this.isLoading.set(!1)}})}verifyCode(){if(this.verifyForm.invalid)return;this.isVerifying.set(!0),this.error.set(null);let i=this.verifyForm.value.code;this.authService.verifyMfaEnrollment(i).pipe(M(this.destroyRef)).subscribe({next:()=>{this.isVerifying.set(!1),this.step.set("recovery")},error:e=>{this.error.set(e?.error?.detail||"Invalid verification code"),this.isVerifying.set(!1)}})}copyRecoveryCodes(){let i=this.recoveryCodes().join(`
`);navigator.clipboard.writeText(i).then(()=>{this.copied.set(!0),setTimeout(()=>this.copied.set(!1),2e3)})}downloadRecoveryCodes(){let i=this.recoveryCodes().join(`
`),e=new Blob([`Mentor AI Recovery Codes

${i}

Store these codes safely. Each code can only be used once.`],{type:"text/plain"}),c=URL.createObjectURL(e),d=document.createElement("a");d.href=c,d.download="mentor-ai-recovery-codes.txt",d.click(),URL.revokeObjectURL(c)}complete(){let i=sessionStorage.getItem("returnUrl")||"/dashboard";sessionStorage.removeItem("returnUrl"),this.router.navigate([i])}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["app-two-factor-setup"]],decls:11,vars:2,consts:[[1,"page"],[1,"container"],[1,"header"],[1,"error-box"],[1,"loading-state"],[1,"card"],[1,"load-spinner"],[1,"load-text"],[1,"card-desc"],[1,"qr-container"],[1,"qr-placeholder"],[1,"hint"],[1,"manual-code"],[3,"ngSubmit","formGroup"],[1,"field-label"],["type","text","formControlName","code","maxlength","6","placeholder","000000","inputmode","numeric","pattern","[0-9]*",1,"code-input"],[1,"field-error"],["type","submit",1,"submit-btn",3,"disabled"],[1,"btn-spinner"],[1,"success-header"],["fill","currentColor","viewBox","0 0 20 20"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"],[1,"warn-box"],[1,"sub"],[1,"codes-grid"],[1,"code-box"],[1,"action-row"],["type","button",1,"action-btn",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"],["type","button",1,"submit-btn",3,"click"],["fill","currentColor","viewBox","0 0 20 20",1,"check-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"]],template:function(e,c){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),r(4,"Set up Two-Factor Authentication"),n(),t(5,"p"),r(6,"Secure your account with an authenticator app"),n()(),m(7,B,2,1,"div",3),m(8,H,4,0,"div",4)(9,K,27,6)(10,Z,24,1,"div",5),n()()),e&2&&(a(7),g(c.error()?7:-1),a(),g(c.isLoading()?8:c.step()==="qr"?9:c.step()==="recovery"?10:-1))},dependencies:[F,G,I,z,R,D,j,q,N,L],styles:["[_nghost-%COMP%]{display:block}.page[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:#0d0d0d;padding:16px;font-family:Inter,system-ui,sans-serif;color:#fafafa}.container[_ngcontent-%COMP%]{width:100%;max-width:520px}.header[_ngcontent-%COMP%]{text-align:center;margin-bottom:32px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px;font-weight:700;margin-bottom:8px}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:15px;color:#a1a1a1}.error-box[_ngcontent-%COMP%]{background:#ef44441a;border:1px solid rgba(239,68,68,.2);border-radius:8px;padding:12px 16px;margin-bottom:16px;font-size:13px;color:#ef4444}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:32px 0}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.load-spinner[_ngcontent-%COMP%]{width:32px;height:32px;border:3px solid #2a2a2a;border-top-color:#3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin:0 auto 12px}.load-text[_ngcontent-%COMP%]{font-size:14px;color:#a1a1a1}.card[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:16px}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:16px}.card-desc[_ngcontent-%COMP%]{font-size:13px;color:#a1a1a1;margin-bottom:16px;line-height:1.5}.qr-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:16px;background:#fff;border-radius:8px;margin-bottom:16px}.qr-placeholder[_ngcontent-%COMP%]{width:192px;height:192px;border:2px dashed #d1d5db;display:flex;align-items:center;justify-content:center;text-align:center}.qr-placeholder[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:monospace;font-size:11px;color:#666;word-break:break-all}.qr-placeholder[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-top:8px;font-family:inherit}.manual-code[_ngcontent-%COMP%]{text-align:center;font-size:12px;color:#9e9e9e}.manual-code[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:#242424;padding:2px 8px;border-radius:4px;font-family:monospace}.field-label[_ngcontent-%COMP%]{font-size:13px;font-weight:500;margin-bottom:8px;display:block}.code-input[_ngcontent-%COMP%]{width:100%;border-radius:8px;border:1px solid #2a2a2a;background:#0d0d0d;padding:10px;text-align:center;font-size:22px;letter-spacing:.3em;font-family:monospace;color:#fafafa;outline:none}.code-input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}.field-error[_ngcontent-%COMP%]{font-size:12px;color:#ef4444;margin-top:4px}.submit-btn[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;gap:8px;margin-top:16px;padding:12px;background:#3b82f6;color:#fff;border:none;border-radius:8px;font-size:15px;font-weight:500;cursor:pointer;font-family:inherit}.submit-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb}.submit-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.success-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#22c55e;margin-bottom:16px}.success-header[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.success-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:600}.warn-box[_ngcontent-%COMP%]{background:#f59e0b1a;border:1px solid rgba(245,158,11,.2);border-radius:8px;padding:12px 16px;margin-bottom:16px}.warn-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:#f59e0b}.warn-box[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{font-size:12px;color:#fbbf24;margin-top:4px;font-weight:400}.codes-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px}.code-box[_ngcontent-%COMP%]{font-family:monospace;font-size:13px;background:#242424;padding:8px 12px;border-radius:6px;text-align:center}.action-row[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:16px}.action-btn[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:8px;padding:10px;background:#242424;border:1px solid #2a2a2a;border-radius:8px;color:#fafafa;font-size:13px;font-weight:500;cursor:pointer;font-family:inherit}.action-btn[_ngcontent-%COMP%]:hover{background:#2a2a2a}.action-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}.action-btn[_ngcontent-%COMP%]   .check-icon[_ngcontent-%COMP%]{color:#22c55e}"]})};export{U as TwoFactorSetupComponent};
