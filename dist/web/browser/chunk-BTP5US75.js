import{I as s,Za as d,eb as m,o as c,s as o,v as u,y as g}from"./chunk-4VSIGE6D.js";var n={production:!0,apiUrl:"",appName:"Mentor AI",version:"0.0.1",google:{clientId:"",redirectUri:""}};var t={TOKEN:"mentor_ai_token",USER:"mentor_ai_user",GOOGLE_USER:"mentor_ai_google_user",CODE_VERIFIER:"mentor_ai_code_verifier"},h=class i{http=g(d);router=g(m);_isAuthenticated=s(this.hasStoredToken());_isLoading=s(!1);_currentUser=s(this.getStoredUser());_googleUser=s(this.getStoredGoogleUser());_mfaRequired=s(!1);_mfaStatus=s(null);isAuthenticated$=this._isAuthenticated.asReadonly();isLoading$=this._isLoading.asReadonly();user$=this._googleUser.asReadonly();currentUser=this._currentUser.asReadonly();mfaRequired=this._mfaRequired.asReadonly();mfaStatus=this._mfaStatus.asReadonly();login(e){e&&sessionStorage.setItem("returnUrl",e);let a=this.generateCodeVerifier();localStorage.setItem(t.CODE_VERIFIER,a),this.generateCodeChallenge(a).then(r=>{let l=new URLSearchParams({client_id:n.google.clientId,redirect_uri:n.google.redirectUri,response_type:"code",scope:"openid email profile",access_type:"offline",prompt:"consent",code_challenge:r,code_challenge_method:"S256"});window.location.href=`https://accounts.google.com/o/oauth2/v2/auth?${l.toString()}`})}handleCallback(e){this._isLoading.set(!0);let a=localStorage.getItem(t.CODE_VERIFIER)||"";return this.http.post("/api/auth/google/callback",{code:e,redirectUri:n.google.redirectUri,codeVerifier:a}).pipe(o(r=>{localStorage.removeItem(t.CODE_VERIFIER),r.token&&localStorage.setItem(t.TOKEN,r.token),r.user&&(localStorage.setItem(t.USER,JSON.stringify(r.user)),this._currentUser.set(r.user)),this._isAuthenticated.set(!0),this._isLoading.set(!1),this._mfaRequired.set(r.requiresMfaSetup)}),c(r=>{throw this._isLoading.set(!1),localStorage.removeItem(t.CODE_VERIFIER),r}))}logout(){localStorage.removeItem(t.TOKEN),localStorage.removeItem(t.USER),localStorage.removeItem(t.GOOGLE_USER),localStorage.removeItem(t.CODE_VERIFIER),this._isAuthenticated.set(!1),this._currentUser.set(null),this._googleUser.set(null),this._mfaStatus.set(null),this._mfaRequired.set(!1),this.router.navigate(["/login"])}getAccessToken(){return localStorage.getItem(t.TOKEN)}checkMfaStatus(){return this.http.get("/api/auth/2fa/status").pipe(o(e=>{this._mfaStatus.set(e),this._mfaRequired.set(!e.enabled)}))}enrollMfa(){return this.http.post("/api/auth/2fa/enroll",{})}verifyMfaEnrollment(e){return this.http.post("/api/auth/2fa/verify",{code:e}).pipe(o(()=>{this._mfaRequired.set(!1),this._mfaStatus.set({enabled:!0})}))}verifyLoginTotp(e){return this.http.post("/api/auth/2fa/verify-login",{code:e})}verifyRecoveryCode(e){return this.http.post("/api/auth/2fa/recovery",{recoveryCode:e})}devLogin(){let e="dev-mode-token",a={userId:"dev-user-001",email:"dev@mentor-ai.local",tenantId:"dev-tenant-001",role:"PLATFORM_OWNER"};localStorage.setItem(t.TOKEN,e),localStorage.setItem(t.USER,JSON.stringify(a)),this._isAuthenticated.set(!0),this._currentUser.set(a),this._mfaRequired.set(!1)}hasStoredToken(){return!!localStorage.getItem(t.TOKEN)}getStoredUser(){try{let e=localStorage.getItem(t.USER);return e?JSON.parse(e):null}catch{return null}}getStoredGoogleUser(){try{let e=localStorage.getItem(t.GOOGLE_USER);return e?JSON.parse(e):null}catch{return null}}generateCodeVerifier(){let e=new Uint8Array(32);return crypto.getRandomValues(e),this.base64UrlEncode(e)}async generateCodeChallenge(e){let r=new TextEncoder().encode(e),l=await crypto.subtle.digest("SHA-256",r);return this.base64UrlEncode(new Uint8Array(l))}base64UrlEncode(e){let a="";for(let r of e)a+=String.fromCharCode(r);return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}static \u0275fac=function(a){return new(a||i)};static \u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"})};export{n as a,h as b};
