import{d as cn,e as kt,f as Ei,g as Ti}from"./chunk-R4LDHEAD.js";import{c as Mi,e as Ii,g as Oi,q as dn}from"./chunk-NTA47MF3.js";import{a as Ye,b as ln}from"./chunk-4Z5LMYYC.js";import{a as ro}from"./chunk-IZGLU5CJ.js";import{$a as Ee,A as ee,Aa as rn,Ba as c,C as x,Ca as E,D as b,Da as O,E as S,Ea as we,F as W,Fa as sn,Ga as bi,H as _i,Ha as vi,Ia as ki,K as v,Ka as Be,L as tn,M as fi,N as Ci,Na as re,Qa as Z,R as nn,Ra as z,S as xi,T as r,X as ie,Xa as ae,a as V,b as te,ba as _e,c as er,ca as f,da as C,db as yi,ea as qe,eb as wi,fa as on,ga as U,gb as Si,ha as G,hb as Pi,i as H,ia as q,ja as u,k as hi,ka as p,la as T,ma as h,na as _,oa as A,pa as P,q as gi,qa as Y,ra as L,sa as M,ta as l,ua as an,va as Je,wa as et,x as Ge,ya as K,za as R}from"./chunk-G6XBTM5S.js";var ut=class o{http=ee(Ee);baseUrl=`${Ye.apiUrl}/api/v1/conversations`;isCreating$=v(!1);async createConversation(t,e,n,i){this.isCreating$.set(!0);try{return(await H(this.http.post(this.baseUrl,{title:t,personaType:e,conceptId:n,curriculumId:i}))).data}finally{this.isCreating$.set(!1)}}async updatePersona(t,e){return(await H(this.http.patch(`${this.baseUrl}/${t}/persona`,{personaType:e}))).data}async getConversations(){return(await H(this.http.get(this.baseUrl))).data}async getConversation(t){return(await H(this.http.get(`${this.baseUrl}/${t}`))).data}async deleteConversation(t){await H(this.http.delete(`${this.baseUrl}/${t}`))}async getGroupedConversations(){return(await H(this.http.get(`${this.baseUrl}/grouped`))).data}async getBrainTree(){return(await H(this.http.get(`${this.baseUrl}/brain-tree`))).data}static \u0275fac=function(e){return new(e||o)};static \u0275prov=Ge({token:o,factory:o.\u0275fac,providedIn:"root"})};var Ie=Object.create(null);Ie.open="0";Ie.close="1";Ie.ping="2";Ie.pong="3";Ie.message="4";Ie.upgrade="5";Ie.noop="6";var yt=Object.create(null);Object.keys(Ie).forEach(o=>{yt[Ie[o]]=o});var wt={type:"error",data:"parser error"};var Ni=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Ri=typeof ArrayBuffer=="function",Di=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer,St=({type:o,data:t},e,n)=>Ni&&t instanceof Blob?e?n(t):$i(t,n):Ri&&(t instanceof ArrayBuffer||Di(t))?e?n(t):$i(new Blob([t]),n):n(Ie[o]+(t||"")),$i=(o,t)=>{let e=new FileReader;return e.onload=function(){let n=e.result.split(",")[1];t("b"+(n||""))},e.readAsDataURL(o)};function Ai(o){return o instanceof Uint8Array?o:o instanceof ArrayBuffer?new Uint8Array(o):new Uint8Array(o.buffer,o.byteOffset,o.byteLength)}var so;function Li(o,t){if(Ni&&o.data instanceof Blob)return o.data.arrayBuffer().then(Ai).then(t);if(Ri&&(o.data instanceof ArrayBuffer||Di(o.data)))return t(Ai(o.data));St(o,!1,e=>{so||(so=new TextEncoder),t(so.encode(e))})}var zi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Pt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let o=0;o<zi.length;o++)Pt[zi.charCodeAt(o)]=o;var Vi=o=>{let t=o.length*.75,e=o.length,n,i=0,a,s,m,d;o[o.length-1]==="="&&(t--,o[o.length-2]==="="&&t--);let y=new ArrayBuffer(t),k=new Uint8Array(y);for(n=0;n<e;n+=4)a=Pt[o.charCodeAt(n)],s=Pt[o.charCodeAt(n+1)],m=Pt[o.charCodeAt(n+2)],d=Pt[o.charCodeAt(n+3)],k[i++]=a<<2|s>>4,k[i++]=(s&15)<<4|m>>2,k[i++]=(m&3)<<6|d&63;return y};var tr=typeof ArrayBuffer=="function",Et=(o,t)=>{if(typeof o!="string")return{type:"message",data:Fi(o,t)};let e=o.charAt(0);return e==="b"?{type:"message",data:nr(o.substring(1),t)}:yt[e]?o.length>1?{type:yt[e],data:o.substring(1)}:{type:yt[e]}:wt},nr=(o,t)=>{if(tr){let e=Vi(o);return Fi(e,t)}else return{base64:!0,data:o}},Fi=(o,t)=>t==="blob"?o instanceof Blob?o:new Blob([o]):o instanceof ArrayBuffer?o:o.buffer;var Bi="",Wi=(o,t)=>{let e=o.length,n=new Array(e),i=0;o.forEach((a,s)=>{St(a,!1,m=>{n[s]=m,++i===e&&t(n.join(Bi))})})},ji=(o,t)=>{let e=o.split(Bi),n=[];for(let i=0;i<e.length;i++){let a=Et(e[i],t);if(n.push(a),a.type==="error")break}return n};function Hi(){return new TransformStream({transform(o,t){Li(o,e=>{let n=e.length,i;if(n<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,n);else if(n<65536){i=new Uint8Array(3);let a=new DataView(i.buffer);a.setUint8(0,126),a.setUint16(1,n)}else{i=new Uint8Array(9);let a=new DataView(i.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(n))}o.data&&typeof o.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(e)})}})}var lo;function pn(o){return o.reduce((t,e)=>t+e.length,0)}function un(o,t){if(o[0].length===t)return o.shift();let e=new Uint8Array(t),n=0;for(let i=0;i<t;i++)e[i]=o[0][n++],n===o[0].length&&(o.shift(),n=0);return o.length&&n<o[0].length&&(o[0]=o[0].slice(n)),e}function Ui(o,t){lo||(lo=new TextDecoder);let e=[],n=0,i=-1,a=!1;return new TransformStream({transform(s,m){for(e.push(s);;){if(n===0){if(pn(e)<1)break;let d=un(e,1);a=(d[0]&128)===128,i=d[0]&127,i<126?n=3:i===126?n=1:n=2}else if(n===1){if(pn(e)<2)break;let d=un(e,2);i=new DataView(d.buffer,d.byteOffset,d.length).getUint16(0),n=3}else if(n===2){if(pn(e)<8)break;let d=un(e,8),y=new DataView(d.buffer,d.byteOffset,d.length),k=y.getUint32(0);if(k>Math.pow(2,21)-1){m.enqueue(wt);break}i=k*Math.pow(2,32)+y.getUint32(4),n=3}else{if(pn(e)<i)break;let d=un(e,i);m.enqueue(Et(a?d:lo.decode(d),t)),n=0}if(i===0||i>o){m.enqueue(wt);break}}}})}var co=4;function ne(o){if(o)return or(o)}function or(o){for(var t in ne.prototype)o[t]=ne.prototype[t];return o}ne.prototype.on=ne.prototype.addEventListener=function(o,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+o]=this._callbacks["$"+o]||[]).push(t),this};ne.prototype.once=function(o,t){function e(){this.off(o,e),t.apply(this,arguments)}return e.fn=t,this.on(o,e),this};ne.prototype.off=ne.prototype.removeListener=ne.prototype.removeAllListeners=ne.prototype.removeEventListener=function(o,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var e=this._callbacks["$"+o];if(!e)return this;if(arguments.length==1)return delete this._callbacks["$"+o],this;for(var n,i=0;i<e.length;i++)if(n=e[i],n===t||n.fn===t){e.splice(i,1);break}return e.length===0&&delete this._callbacks["$"+o],this};ne.prototype.emit=function(o){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),e=this._callbacks["$"+o],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e){e=e.slice(0);for(var n=0,i=e.length;n<i;++n)e[n].apply(this,t)}return this};ne.prototype.emitReserved=ne.prototype.emit;ne.prototype.listeners=function(o){return this._callbacks=this._callbacks||{},this._callbacks["$"+o]||[]};ne.prototype.hasListeners=function(o){return!!this.listeners(o).length};var We=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,e)=>e(t,0),Ce=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Gi="arraybuffer";function mn(o,...t){return t.reduce((e,n)=>(o.hasOwnProperty(n)&&(e[n]=o[n]),e),{})}var ir=Ce.setTimeout,ar=Ce.clearTimeout;function je(o,t){t.useNativeTimers?(o.setTimeoutFn=ir.bind(Ce),o.clearTimeoutFn=ar.bind(Ce)):(o.setTimeoutFn=Ce.setTimeout.bind(Ce),o.clearTimeoutFn=Ce.clearTimeout.bind(Ce))}var rr=1.33;function qi(o){return typeof o=="string"?sr(o):Math.ceil((o.byteLength||o.size)*rr)}function sr(o){let t=0,e=0;for(let n=0,i=o.length;n<i;n++)t=o.charCodeAt(n),t<128?e+=1:t<2048?e+=2:t<55296||t>=57344?e+=3:(n++,e+=4);return e}function hn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Yi(o){let t="";for(let e in o)o.hasOwnProperty(e)&&(t.length&&(t+="&"),t+=encodeURIComponent(e)+"="+encodeURIComponent(o[e]));return t}function Ki(o){let t={},e=o.split("&");for(let n=0,i=e.length;n<i;n++){let a=e[n].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}var gn=class extends Error{constructor(t,e,n){super(t),this.description=e,this.context=n,this.type="TransportError"}},He=class extends ne{constructor(t){super(),this.writable=!1,je(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,e,n){return super.emitReserved("error",new gn(t,e,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){let e=Et(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){let t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){let e=Yi(t);return e.length?"?"+e:""}};var Tt=class extends He{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";let e=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||e()})),this.writable||(n++,this.once("drain",function(){--n||e()}))}else e()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){let e=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};ji(t,this.socket.binaryType).forEach(e),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){let t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Wi(t,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.opts.secure?"https":"http",e=this.query||{};return this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=hn()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.createUri(t,e)}};var Qi=!1;try{Qi=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var Xi=Qi;function lr(){}var po=class extends Tt{constructor(t){if(super(t),typeof location<"u"){let e=location.protocol==="https:",n=location.port;n||(n=e?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||n!==t.port}}doWrite(t,e){let n=this.request({method:"POST",data:t});n.on("success",e),n.on("error",(i,a)=>{this.onError("xhr post error",i,a)})}doPoll(){let t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(e,n)=>{this.onError("xhr poll error",e,n)}),this.pollXhr=t}},_n=(()=>{class o extends ne{constructor(e,n,i){super(),this.createRequest=e,je(this,i),this._opts=i,this._method=i.method||"GET",this._uri=n,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var e;let n=mn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;let i=this._xhr=this.createRequest(n);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let a in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(a)&&i.setRequestHeader(a,this._opts.extraHeaders[a])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var a;i.readyState===3&&((a=this._opts.cookieJar)===null||a===void 0||a.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(a){this.setTimeoutFn(()=>{this._onError(a)},0);return}typeof document<"u"&&(this._index=o.requestsCount++,o.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=lr,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete o.requests[this._index],this._xhr=null}}_onLoad(){let e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}return o.requestsCount=0,o.requests={},o})();if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Zi);else if(typeof addEventListener=="function"){let o="onpagehide"in Ce?"pagehide":"unload";addEventListener(o,Zi,!1)}}function Zi(){for(let o in _n.requests)_n.requests.hasOwnProperty(o)&&_n.requests[o].abort()}var cr=(function(){let o=Ji({xdomain:!1});return o&&o.responseType!==null})(),Ke=class extends po{constructor(t){super(t);let e=t&&t.forceBase64;this.supportsBinary=cr&&!e}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new _n(Ji,this.uri(),t)}};function Ji(o){let t=o.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Xi))return new XMLHttpRequest}catch{}if(!t)try{return new Ce[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}var ea=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",mo=class extends He{get name(){return"websocket"}doOpen(){let t=this.uri(),e=this.opts.protocols,n=ea?{}:mn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,e,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){let n=t[e],i=e===t.length-1;St(n,this.supportsBinary,a=>{try{this.doWrite(n,a)}catch{}i&&We(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){let t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=hn()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}},uo=Ce.WebSocket||Ce.MozWebSocket,Qe=class extends mo{createSocket(t,e,n){return ea?new uo(t,e,n):e?new uo(t,e):new uo(t)}doWrite(t,e){this.ws.send(e)}};var mt=class extends He{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{let e=Ui(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=t.readable.pipeThrough(e).getReader(),i=Hi();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();let a=()=>{n.read().then(({done:m,value:d})=>{m||(this.onPacket(d),a())}).catch(m=>{})};a();let s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this._writer.write(s).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let e=0;e<t.length;e++){let n=t[e],i=e===t.length-1;this._writer.write(n).then(()=>{i&&We(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}};var ho={websocket:Qe,webtransport:mt,polling:Ke};var dr=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,pr=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ht(o){if(o.length>8e3)throw"URI too long";let t=o,e=o.indexOf("["),n=o.indexOf("]");e!=-1&&n!=-1&&(o=o.substring(0,e)+o.substring(e,n).replace(/:/g,";")+o.substring(n,o.length));let i=dr.exec(o||""),a={},s=14;for(;s--;)a[pr[s]]=i[s]||"";return e!=-1&&n!=-1&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=ur(a,a.path),a.queryKey=mr(a,a.query),a}function ur(o,t){let e=/\/{2,9}/g,n=t.replace(e,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&n.splice(0,1),t.slice(-1)=="/"&&n.splice(n.length-1,1),n}function mr(o,t){let e={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,a){i&&(e[i]=a)}),e}var go=typeof addEventListener=="function"&&typeof removeEventListener=="function",fn=[];go&&addEventListener("offline",()=>{fn.forEach(o=>o())},!1);var Cn=(()=>{class o extends ne{constructor(e,n){if(super(),this.binaryType=Gi,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(n=e,e=null),e){let i=ht(e);n.hostname=i.host,n.secure=i.protocol==="https"||i.protocol==="wss",n.port=i.port,i.query&&(n.query=i.query)}else n.host&&(n.hostname=ht(n.host).host);je(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(i=>{let a=i.prototype.name;this.transports.push(a),this._transportsByName[a]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Ki(this.opts.query)),go&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},fn.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){let n=Object.assign({},this.opts.query);n.EIO=co,n.transport=e,this.id&&(n.sid=this.id);let i=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}let e=this.opts.rememberUpgrade&&o.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";let n=this.createTransport(e);n.open(),this.setTransport(n)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",o.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":let n=new Error("server error");n.code=e.data,this._onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let i=0;i<this.writeBuffer.length;i++){let a=this.writeBuffer[i].data;if(a&&(n+=qi(a)),i>0&&n>this._maxPayload)return this.writeBuffer.slice(0,i);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,We(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,n,i){return this._sendPacket("message",e,n,i),this}send(e,n,i){return this._sendPacket("message",e,n,i),this}_sendPacket(e,n,i,a){if(typeof n=="function"&&(a=n,n=void 0),typeof i=="function"&&(a=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;let s={type:e,data:n,options:i};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),a&&this.once("flush",a),this.flush()}close(){let e=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},i=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}_onError(e){if(o.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),go&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){let i=fn.indexOf(this._offlineEventListener);i!==-1&&fn.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this._prevBufferLen=0}}}return o.protocol=co,o})(),xn=class extends Cn{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let e=this.createTransport(t),n=!1;Cn.priorWebsocketSuccess=!1;let i=()=>{n||(e.send([{type:"ping",data:"probe"}]),e.once("packet",D=>{if(!n)if(D.type==="pong"&&D.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;Cn.priorWebsocketSuccess=e.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(k(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())})}else{let $=new Error("probe error");$.transport=e.name,this.emitReserved("upgradeError",$)}}))};function a(){n||(n=!0,k(),e.close(),e=null)}let s=D=>{let $=new Error("probe error: "+D);$.transport=e.name,a(),this.emitReserved("upgradeError",$)};function m(){s("transport closed")}function d(){s("socket closed")}function y(D){e&&D.name!==e.name&&a()}let k=()=>{e.removeListener("open",i),e.removeListener("error",s),e.removeListener("close",m),this.off("close",d),this.off("upgrading",y)};e.once("open",i),e.once("error",s),e.once("close",m),this.once("close",d),this.once("upgrading",y),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{n||e.open()},200):e.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){let e=[];for(let n=0;n<t.length;n++)~this.transports.indexOf(t[n])&&e.push(t[n]);return e}},gt=class extends xn{constructor(t,e={}){let n=typeof t=="object"?t:e;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(i=>ho[i]).filter(i=>!!i)),super(t,n)}};var Ju=gt.protocol;function ta(o,t="",e){let n=o;e=e||typeof location<"u"&&location,o==null&&(o=e.protocol+"//"+e.host),typeof o=="string"&&(o.charAt(0)==="/"&&(o.charAt(1)==="/"?o=e.protocol+o:o=e.host+o),/^(https?|wss?):\/\//.test(o)||(typeof e<"u"?o=e.protocol+"//"+o:o="https://"+o),n=ht(o)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";let a=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+a+":"+n.port+t,n.href=n.protocol+"://"+a+(e&&e.port===n.port?"":":"+n.port),n}var vo={};er(vo,{Decoder:()=>xo,Encoder:()=>Co,PacketType:()=>F,isPacketValid:()=>yr,protocol:()=>ra});var gr=typeof ArrayBuffer=="function",_r=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o.buffer instanceof ArrayBuffer,na=Object.prototype.toString,fr=typeof Blob=="function"||typeof Blob<"u"&&na.call(Blob)==="[object BlobConstructor]",Cr=typeof File=="function"||typeof File<"u"&&na.call(File)==="[object FileConstructor]";function It(o){return gr&&(o instanceof ArrayBuffer||_r(o))||fr&&o instanceof Blob||Cr&&o instanceof File}function Mt(o,t){if(!o||typeof o!="object")return!1;if(Array.isArray(o)){for(let e=0,n=o.length;e<n;e++)if(Mt(o[e]))return!0;return!1}if(It(o))return!0;if(o.toJSON&&typeof o.toJSON=="function"&&arguments.length===1)return Mt(o.toJSON(),!0);for(let e in o)if(Object.prototype.hasOwnProperty.call(o,e)&&Mt(o[e]))return!0;return!1}function oa(o){let t=[],e=o.data,n=o;return n.data=_o(e,t),n.attachments=t.length,{packet:n,buffers:t}}function _o(o,t){if(!o)return o;if(It(o)){let e={_placeholder:!0,num:t.length};return t.push(o),e}else if(Array.isArray(o)){let e=new Array(o.length);for(let n=0;n<o.length;n++)e[n]=_o(o[n],t);return e}else if(typeof o=="object"&&!(o instanceof Date)){let e={};for(let n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=_o(o[n],t));return e}return o}function ia(o,t){return o.data=fo(o.data,t),delete o.attachments,o}function fo(o,t){if(!o)return o;if(o&&o._placeholder===!0){if(typeof o.num=="number"&&o.num>=0&&o.num<t.length)return t[o.num];throw new Error("illegal attachments")}else if(Array.isArray(o))for(let e=0;e<o.length;e++)o[e]=fo(o[e],t);else if(typeof o=="object")for(let e in o)Object.prototype.hasOwnProperty.call(o,e)&&(o[e]=fo(o[e],t));return o}var aa=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ra=5,F=(function(o){return o[o.CONNECT=0]="CONNECT",o[o.DISCONNECT=1]="DISCONNECT",o[o.EVENT=2]="EVENT",o[o.ACK=3]="ACK",o[o.CONNECT_ERROR=4]="CONNECT_ERROR",o[o.BINARY_EVENT=5]="BINARY_EVENT",o[o.BINARY_ACK=6]="BINARY_ACK",o})(F||{}),Co=class{constructor(t){this.replacer=t}encode(t){return(t.type===F.EVENT||t.type===F.ACK)&&Mt(t)?this.encodeAsBinary({type:t.type===F.EVENT?F.BINARY_EVENT:F.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let e=""+t.type;return(t.type===F.BINARY_EVENT||t.type===F.BINARY_ACK)&&(e+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(e+=t.nsp+","),t.id!=null&&(e+=t.id),t.data!=null&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){let e=oa(t),n=this.encodeAsString(e.packet),i=e.buffers;return i.unshift(n),i}},xo=class o extends ne{constructor(t){super(),this.reviver=t}add(t){let e;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);let n=e.type===F.BINARY_EVENT;n||e.type===F.BINARY_ACK?(e.type=n?F.EVENT:F.ACK,this.reconstructor=new bo(e),e.attachments===0&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(It(t)||t.base64)if(this.reconstructor)e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let e=0,n={type:Number(t.charAt(0))};if(F[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===F.BINARY_EVENT||n.type===F.BINARY_ACK){let a=e+1;for(;t.charAt(++e)!=="-"&&e!=t.length;);let s=t.substring(a,e);if(s!=Number(s)||t.charAt(e)!=="-")throw new Error("Illegal attachments");n.attachments=Number(s)}if(t.charAt(e+1)==="/"){let a=e+1;for(;++e&&!(t.charAt(e)===","||e===t.length););n.nsp=t.substring(a,e)}else n.nsp="/";let i=t.charAt(e+1);if(i!==""&&Number(i)==i){let a=e+1;for(;++e;){let s=t.charAt(e);if(s==null||Number(s)!=s){--e;break}if(e===t.length)break}n.id=Number(t.substring(a,e+1))}if(t.charAt(++e)){let a=this.tryParse(t.substr(e));if(o.isPayloadValid(n.type,a))n.data=a;else throw new Error("invalid payload")}return n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,e){switch(t){case F.CONNECT:return bn(e);case F.DISCONNECT:return e===void 0;case F.CONNECT_ERROR:return typeof e=="string"||bn(e);case F.EVENT:case F.BINARY_EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&aa.indexOf(e[0])===-1);case F.ACK:case F.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},bo=class{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){let e=ia(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function xr(o){return typeof o=="string"}var br=Number.isInteger||function(o){return typeof o=="number"&&isFinite(o)&&Math.floor(o)===o};function vr(o){return o===void 0||br(o)}function bn(o){return Object.prototype.toString.call(o)==="[object Object]"}function kr(o,t){switch(o){case F.CONNECT:return t===void 0||bn(t);case F.DISCONNECT:return t===void 0;case F.EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&aa.indexOf(t[0])===-1);case F.ACK:return Array.isArray(t);case F.CONNECT_ERROR:return typeof t=="string"||bn(t);default:return!1}}function yr(o){return xr(o.nsp)&&vr(o.id)&&kr(o.type,o.data)}function Pe(o,t,e){return o.on(t,e),function(){o.off(t,e)}}var wr=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),_t=class extends ne{constructor(t,e,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let t=this.io;this.subs=[Pe(t,"open",this.onopen.bind(this)),Pe(t,"packet",this.onpacket.bind(this)),Pe(t,"error",this.onerror.bind(this)),Pe(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){var n,i,a;if(wr.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;let s={type:F.EVENT,data:e};if(s.options={},s.options.compress=this.flags.compress!==!1,typeof e[e.length-1]=="function"){let k=this.ids++,D=e.pop();this._registerAckCallback(k,D),s.id=k}let m=(i=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||i===void 0?void 0:i.writable,d=this.connected&&!(!((a=this.io.engine)===null||a===void 0)&&a._hasPingExpired());return this.flags.volatile&&!m||(d?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(t,e){var n;let i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[t]=e;return}let a=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let m=0;m<this.sendBuffer.length;m++)this.sendBuffer[m].id===t&&this.sendBuffer.splice(m,1);e.call(this,new Error("operation has timed out"))},i),s=(...m)=>{this.io.clearTimeoutFn(a),e.apply(this,m)};s.withError=!0,this.acks[t]=s}emitWithAck(t,...e){return new Promise((n,i)=>{let a=(s,m)=>s?i(s):n(m);a.withError=!0,e.push(a),this.emit(t,...e)})}_addToQueue(t){let e;typeof t[t.length-1]=="function"&&(e=t.pop());let n={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...a)=>(this._queue[0],i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(i)):(this._queue.shift(),e&&e(null,...a)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;let e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:F.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(n=>String(n.id)===t)){let n=this.acks[t];delete this.acks[t],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case F.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case F.EVENT:case F.BINARY_EVENT:this.onevent(t);break;case F.ACK:case F.BINARY_ACK:this.onack(t);break;case F.DISCONNECT:this.ondisconnect();break;case F.CONNECT_ERROR:this.destroy();let n=new Error(t.data.message);n.data=t.data.data,this.emitReserved("connect_error",n);break}}onevent(t){let e=t.data||[];t.id!=null&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){let e=this._anyListeners.slice();for(let n of e)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){let e=this,n=!1;return function(...i){n||(n=!0,e.packet({type:F.ACK,id:t,data:i}))}}onack(t){let e=this.acks[t.id];typeof e=="function"&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:F.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){let e=this._anyListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){let e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let e=this._anyOutgoingListeners.slice();for(let n of e)n.apply(this,t.data)}}};function tt(o){o=o||{},this.ms=o.min||100,this.max=o.max||1e4,this.factor=o.factor||2,this.jitter=o.jitter>0&&o.jitter<=1?o.jitter:0,this.attempts=0}tt.prototype.duration=function(){var o=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),e=Math.floor(t*this.jitter*o);o=(Math.floor(t*10)&1)==0?o-e:o+e}return Math.min(o,this.max)|0};tt.prototype.reset=function(){this.attempts=0};tt.prototype.setMin=function(o){this.ms=o};tt.prototype.setMax=function(o){this.max=o};tt.prototype.setJitter=function(o){this.jitter=o};var ft=class extends ne{constructor(t,e){var n;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.opts=e,je(this,e),this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor((n=e.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new tt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(e.timeout==null?2e4:e.timeout),this._readyState="closed",this.uri=t;let i=e.parser||vo;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=e.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(e=this.backoff)===null||e===void 0||e.setMin(t),this)}randomizationFactor(t){var e;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(e=this.backoff)===null||e===void 0||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(e=this.backoff)===null||e===void 0||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new gt(this.uri,this.opts);let e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;let i=Pe(e,"open",function(){n.onopen(),t&&t()}),a=m=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",m),t?t(m):this.maybeReconnectOnOpen()},s=Pe(e,"error",a);if(this._timeout!==!1){let m=this._timeout,d=this.setTimeoutFn(()=>{i(),a(new Error("timeout")),e.close()},m);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}return this.subs.push(i),this.subs.push(s),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let t=this.engine;this.subs.push(Pe(t,"ping",this.onping.bind(this)),Pe(t,"data",this.ondata.bind(this)),Pe(t,"error",this.onerror.bind(this)),Pe(t,"close",this.onclose.bind(this)),Pe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){We(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new _t(this,t,e),this.nsps[t]=n),n}_destroy(t){let e=Object.keys(this.nsps);for(let n of e)if(this.nsps[n].active)return;this._close()}_packet(t){let e=this.encoder.encode(t);for(let n=0;n<e.length;n++)this.engine.write(e[n],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,e){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let e=this.backoff.duration();this._reconnecting=!0;let n=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},e);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){let t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}};var Ot={};function $t(o,t){typeof o=="object"&&(t=o,o=void 0),t=t||{};let e=ta(o,t.path||"/socket.io"),n=e.source,i=e.id,a=e.path,s=Ot[i]&&a in Ot[i].nsps,m=t.forceNew||t["force new connection"]||t.multiplex===!1||s,d;return m?d=new ft(n,t):(Ot[i]||(Ot[i]=new ft(n,t)),d=Ot[i]),e.query&&!t.query&&(t.query=e.queryKey),d.socket(e.path,t)}Object.assign($t,{Manager:ft,Socket:_t,io:$t,connect:$t});var vn=class o{socket=null;authService=ee(ln);connectionState$=v("disconnected");wasWorkflowActive$=v(!1);lastEmitError$=v(null);_isWorkflowRunning=!1;setWorkflowRunning(t){this._isWorkflowRunning=t}checkConnected(t){return this.socket?.connected?!0:(this.lastEmitError$.set(`Nije mogu\u0107e: ${t} \u2014 veza nije aktivna`),!1)}messageReceivedCallbacks=[];messageChunkCallbacks=[];completeCallbacks=[];errorCallbacks=[];notesUpdatedCallbacks=[];conceptDetectedCallbacks=[];planReadyCallbacks=[];stepProgressCallbacks=[];workflowCompleteCallbacks=[];workflowErrorCallbacks=[];conversationsCreatedCallbacks=[];stepConfirmationCallbacks=[];stepAwaitingInputCallbacks=[];stepMessageCallbacks=[];navigateToConversationCallbacks=[];tasksCreatedForExecutionCallbacks=[];yoloProgressCallbacks=[];yoloCompleteCallbacks=[];discoveryChunkCallbacks=[];discoveryCompleteCallbacks=[];discoveryErrorCallbacks=[];tasksDiscoveredCallbacks=[];taskAiStartCallbacks=[];taskAiChunkCallbacks=[];taskAiCompleteCallbacks=[];taskAiErrorCallbacks=[];taskResultStartCallbacks=[];taskResultChunkCallbacks=[];taskResultCompleteCallbacks=[];taskResultErrorCallbacks=[];researchPhaseCallbacks=[];autoPopuniStartCallbacks=[];autoPopuniCompleteCallbacks=[];autoPopuniTaskErrorCallbacks=[];executionActiveStateCallbacks=[];async connect(){if(this.socket?.connected)return;this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect(),this.socket=null),this.clearCallbacks();let t=this.authService.getAccessToken();if(!t)return;let e=Ye.apiUrl.replace(/^http/,"ws");this.socket=$t(`${e}/ws/chat`,{auth:{token:t},query:{token:t},transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3}),this.socket.on("auth:session-expired",()=>{localStorage.removeItem("mentor_ai_token"),localStorage.removeItem("mentor_ai_user"),localStorage.removeItem("mentor_ai_google_user"),window.location.href="/login"}),this.socket.on("connect",()=>{this.connectionState$.set("connected")}),this.socket.on("disconnect",n=>{this.connectionState$.set("disconnected"),this._isWorkflowRunning&&this.wasWorkflowActive$.set(!0)}),this.socket.io.on("reconnect_attempt",()=>{this.connectionState$.set("reconnecting")}),this.socket.io.on("reconnect",()=>{this.connectionState$.set("connected")}),this.socket.io.on("reconnect_failed",()=>{this.connectionState$.set("disconnected")}),this.socket.on("chat:message-received",n=>{this.messageReceivedCallbacks.forEach(i=>i(n))}),this.socket.on("chat:message-chunk",n=>{this.messageChunkCallbacks.forEach(i=>i(n))}),this.socket.on("chat:complete",n=>{this.completeCallbacks.forEach(i=>i(n))}),this.socket.on("chat:research-phase",n=>{this.researchPhaseCallbacks.forEach(i=>i(n))}),this.socket.on("chat:error",n=>{this.errorCallbacks.forEach(i=>i(n))}),this.socket.on("chat:notes-updated",n=>{this.notesUpdatedCallbacks.forEach(i=>i(n))}),this.socket.on("chat:concept-detected",n=>{this.conceptDetectedCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:plan-ready",n=>{this.planReadyCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:step-progress",n=>{this.stepProgressCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:complete",n=>{this.workflowCompleteCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:error",n=>{this.workflowErrorCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:conversations-created",n=>{this.conversationsCreatedCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:step-awaiting-confirmation",n=>{this.stepConfirmationCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:step-awaiting-input",n=>{this.stepAwaitingInputCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:step-message",n=>{this.stepMessageCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:navigate-to-conversation",n=>{this.navigateToConversationCallbacks.forEach(i=>i(n))}),this.socket.on("chat:tasks-created-for-execution",n=>{this.tasksCreatedForExecutionCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:yolo-progress",n=>{this.yoloProgressCallbacks.forEach(i=>i(n))}),this.socket.on("workflow:yolo-complete",n=>{this.yoloCompleteCallbacks.forEach(i=>i(n))}),this.socket.on("tree:tasks-discovered",n=>{this.tasksDiscoveredCallbacks.forEach(i=>i(n))}),this.socket.on("discovery:message-chunk",n=>{this.discoveryChunkCallbacks.forEach(i=>i(n))}),this.socket.on("discovery:message-complete",n=>{this.discoveryCompleteCallbacks.forEach(i=>i(n))}),this.socket.on("discovery:error",n=>{this.discoveryErrorCallbacks.forEach(i=>i(n))}),this.socket.on("task:ai-start",n=>{this.taskAiStartCallbacks.forEach(i=>i(n))}),this.socket.on("task:ai-chunk",n=>{this.taskAiChunkCallbacks.forEach(i=>i(n))}),this.socket.on("task:ai-complete",n=>{this.taskAiCompleteCallbacks.forEach(i=>i(n))}),this.socket.on("task:ai-error",n=>{this.taskAiErrorCallbacks.forEach(i=>i(n))}),this.socket.on("task:result-start",n=>{this.taskResultStartCallbacks.forEach(i=>i(n))}),this.socket.on("task:result-chunk",n=>{this.taskResultChunkCallbacks.forEach(i=>i(n))}),this.socket.on("task:result-complete",n=>{this.taskResultCompleteCallbacks.forEach(i=>i(n))}),this.socket.on("task:result-error",n=>{this.taskResultErrorCallbacks.forEach(i=>i(n))}),this.socket.on("auto-popuni:start",n=>{this.autoPopuniStartCallbacks.forEach(i=>i(n))}),this.socket.on("auto-popuni:complete",n=>{this.autoPopuniCompleteCallbacks.forEach(i=>i(n))}),this.socket.on("auto-popuni:task-error",n=>{this.autoPopuniTaskErrorCallbacks.forEach(i=>i(n))}),this.socket.on("execution:active-state",n=>{this.executionActiveStateCallbacks.forEach(i=>i(n))})}waitForConnection(t=1e4){return new Promise((e,n)=>{if(this.socket?.connected){e();return}let i=setTimeout(()=>{n(new Error("WebSocket connection timeout"))},t),a=()=>{this.socket?.connected?(clearTimeout(i),e()):setTimeout(a,100)};a()})}disconnect(){this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect(),this.socket=null),this.clearCallbacks()}sendMessage(t,e){return this.checkConnected("slanje poruke")?(this.socket.emit("chat:message-send",{conversationId:t,content:e}),!0):!1}emitRunAgents(t,e){this.checkConnected("pokretanje agenata")&&this.socket.emit("workflow:run-agents",{taskIds:t,conversationId:e})}emitGetPlan(t,e){this.checkConnected("u\u010Ditavanje plana")&&this.socket.emit("workflow:get-plan",{planId:t,conversationId:e})}emitWorkflowApproval(t,e,n){this.checkConnected("odobravanje plana")&&this.socket.emit("workflow:approve",{planId:t,approved:e,conversationId:n})}emitWorkflowCancel(t,e){this.checkConnected("otkazivanje")&&this.socket.emit("workflow:cancel",{planId:t,conversationId:e})}emitStepContinue(t,e,n){this.checkConnected("nastavak koraka")&&this.socket.emit("workflow:step-continue",{planId:t,conversationId:e,userInput:n})}emitStartYolo(t){this.checkConnected("pokretanje YOLO re\u017Eima")&&this.socket.emit("workflow:start-yolo",{conversationId:t})}emitStartDomainYolo(t,e){this.checkConnected("pokretanje YOLO re\u017Eima")&&this.socket.emit("yolo:start-domain",{conversationId:t,category:e})}emitDiscoveryMessage(t){this.checkConnected("slanje poruke")&&this.socket.emit("discovery:send-message",{content:t})}emitExecuteTaskAi(t,e){this.checkConnected("izvr\u0161avanje zadatka")&&this.socket.emit("task:execute-ai",{taskId:t,conversationId:e})}emitSubmitTaskResult(t){this.checkConnected("slanje rezultata")&&this.socket.emit("task:submit-result",{taskId:t})}getActiveExecutions(){this.checkConnected("provera aktivnih izvr\u0161avanja")&&this.socket.emit("execution:get-active")}replayEvents(t,e){this.checkConnected("replay doga\u0111aja")&&this.socket.emit("execution:replay-events",{executionId:t,since:e})}onMessageReceived(t){return this.messageReceivedCallbacks.push(t),()=>{let e=this.messageReceivedCallbacks.indexOf(t);e>-1&&this.messageReceivedCallbacks.splice(e,1)}}onMessageChunk(t){return this.messageChunkCallbacks.push(t),()=>{let e=this.messageChunkCallbacks.indexOf(t);e>-1&&this.messageChunkCallbacks.splice(e,1)}}onComplete(t){return this.completeCallbacks.push(t),()=>{let e=this.completeCallbacks.indexOf(t);e>-1&&this.completeCallbacks.splice(e,1)}}onResearchPhase(t){return this.researchPhaseCallbacks.push(t),()=>{let e=this.researchPhaseCallbacks.indexOf(t);e>-1&&this.researchPhaseCallbacks.splice(e,1)}}onError(t){return this.errorCallbacks.push(t),()=>{let e=this.errorCallbacks.indexOf(t);e>-1&&this.errorCallbacks.splice(e,1)}}onNotesUpdated(t){return this.notesUpdatedCallbacks.push(t),()=>{let e=this.notesUpdatedCallbacks.indexOf(t);e>-1&&this.notesUpdatedCallbacks.splice(e,1)}}onTasksCreatedForExecution(t){return this.tasksCreatedForExecutionCallbacks.push(t),()=>{let e=this.tasksCreatedForExecutionCallbacks.indexOf(t);e>-1&&this.tasksCreatedForExecutionCallbacks.splice(e,1)}}onConceptDetected(t){return this.conceptDetectedCallbacks.push(t),()=>{let e=this.conceptDetectedCallbacks.indexOf(t);e>-1&&this.conceptDetectedCallbacks.splice(e,1)}}onPlanReady(t){return this.planReadyCallbacks.push(t),()=>{let e=this.planReadyCallbacks.indexOf(t);e>-1&&this.planReadyCallbacks.splice(e,1)}}onStepProgress(t){return this.stepProgressCallbacks.push(t),()=>{let e=this.stepProgressCallbacks.indexOf(t);e>-1&&this.stepProgressCallbacks.splice(e,1)}}onWorkflowComplete(t){return this.workflowCompleteCallbacks.push(t),()=>{let e=this.workflowCompleteCallbacks.indexOf(t);e>-1&&this.workflowCompleteCallbacks.splice(e,1)}}onWorkflowError(t){return this.workflowErrorCallbacks.push(t),()=>{let e=this.workflowErrorCallbacks.indexOf(t);e>-1&&this.workflowErrorCallbacks.splice(e,1)}}onConversationsCreated(t){return this.conversationsCreatedCallbacks.push(t),()=>{let e=this.conversationsCreatedCallbacks.indexOf(t);e>-1&&this.conversationsCreatedCallbacks.splice(e,1)}}onStepAwaitingConfirmation(t){return this.stepConfirmationCallbacks.push(t),()=>{let e=this.stepConfirmationCallbacks.indexOf(t);e>-1&&this.stepConfirmationCallbacks.splice(e,1)}}onStepAwaitingInput(t){return this.stepAwaitingInputCallbacks.push(t),()=>{let e=this.stepAwaitingInputCallbacks.indexOf(t);e>-1&&this.stepAwaitingInputCallbacks.splice(e,1)}}onStepMessage(t){return this.stepMessageCallbacks.push(t),()=>{let e=this.stepMessageCallbacks.indexOf(t);e>-1&&this.stepMessageCallbacks.splice(e,1)}}onNavigateToConversation(t){return this.navigateToConversationCallbacks.push(t),()=>{let e=this.navigateToConversationCallbacks.indexOf(t);e>-1&&this.navigateToConversationCallbacks.splice(e,1)}}onYoloProgress(t){return this.yoloProgressCallbacks.push(t),()=>{let e=this.yoloProgressCallbacks.indexOf(t);e>-1&&this.yoloProgressCallbacks.splice(e,1)}}onYoloComplete(t){return this.yoloCompleteCallbacks.push(t),()=>{let e=this.yoloCompleteCallbacks.indexOf(t);e>-1&&this.yoloCompleteCallbacks.splice(e,1)}}onDiscoveryChunk(t){return this.discoveryChunkCallbacks.push(t),()=>{let e=this.discoveryChunkCallbacks.indexOf(t);e>-1&&this.discoveryChunkCallbacks.splice(e,1)}}onDiscoveryComplete(t){return this.discoveryCompleteCallbacks.push(t),()=>{let e=this.discoveryCompleteCallbacks.indexOf(t);e>-1&&this.discoveryCompleteCallbacks.splice(e,1)}}onDiscoveryError(t){return this.discoveryErrorCallbacks.push(t),()=>{let e=this.discoveryErrorCallbacks.indexOf(t);e>-1&&this.discoveryErrorCallbacks.splice(e,1)}}onTasksDiscovered(t){return this.tasksDiscoveredCallbacks.push(t),()=>{let e=this.tasksDiscoveredCallbacks.indexOf(t);e>-1&&this.tasksDiscoveredCallbacks.splice(e,1)}}onTaskAiStart(t){return this.taskAiStartCallbacks.push(t),()=>{let e=this.taskAiStartCallbacks.indexOf(t);e>-1&&this.taskAiStartCallbacks.splice(e,1)}}onTaskAiChunk(t){return this.taskAiChunkCallbacks.push(t),()=>{let e=this.taskAiChunkCallbacks.indexOf(t);e>-1&&this.taskAiChunkCallbacks.splice(e,1)}}onTaskAiComplete(t){return this.taskAiCompleteCallbacks.push(t),()=>{let e=this.taskAiCompleteCallbacks.indexOf(t);e>-1&&this.taskAiCompleteCallbacks.splice(e,1)}}onTaskAiError(t){return this.taskAiErrorCallbacks.push(t),()=>{let e=this.taskAiErrorCallbacks.indexOf(t);e>-1&&this.taskAiErrorCallbacks.splice(e,1)}}onTaskResultStart(t){return this.taskResultStartCallbacks.push(t),()=>{let e=this.taskResultStartCallbacks.indexOf(t);e>-1&&this.taskResultStartCallbacks.splice(e,1)}}onTaskResultChunk(t){return this.taskResultChunkCallbacks.push(t),()=>{let e=this.taskResultChunkCallbacks.indexOf(t);e>-1&&this.taskResultChunkCallbacks.splice(e,1)}}onTaskResultComplete(t){return this.taskResultCompleteCallbacks.push(t),()=>{let e=this.taskResultCompleteCallbacks.indexOf(t);e>-1&&this.taskResultCompleteCallbacks.splice(e,1)}}onTaskResultError(t){return this.taskResultErrorCallbacks.push(t),()=>{let e=this.taskResultErrorCallbacks.indexOf(t);e>-1&&this.taskResultErrorCallbacks.splice(e,1)}}onAutoPopuniStart(t){return this.autoPopuniStartCallbacks.push(t),()=>{let e=this.autoPopuniStartCallbacks.indexOf(t);e>-1&&this.autoPopuniStartCallbacks.splice(e,1)}}onAutoPopuniComplete(t){return this.autoPopuniCompleteCallbacks.push(t),()=>{let e=this.autoPopuniCompleteCallbacks.indexOf(t);e>-1&&this.autoPopuniCompleteCallbacks.splice(e,1)}}onAutoPopuniTaskError(t){return this.autoPopuniTaskErrorCallbacks.push(t),()=>{let e=this.autoPopuniTaskErrorCallbacks.indexOf(t);e>-1&&this.autoPopuniTaskErrorCallbacks.splice(e,1)}}onExecutionActiveState(t){return this.executionActiveStateCallbacks.push(t),()=>{let e=this.executionActiveStateCallbacks.indexOf(t);e>-1&&this.executionActiveStateCallbacks.splice(e,1)}}clearCallbacks(){this.messageReceivedCallbacks=[],this.messageChunkCallbacks=[],this.completeCallbacks=[],this.errorCallbacks=[],this.notesUpdatedCallbacks=[],this.conceptDetectedCallbacks=[],this.planReadyCallbacks=[],this.stepProgressCallbacks=[],this.workflowCompleteCallbacks=[],this.workflowErrorCallbacks=[],this.conversationsCreatedCallbacks=[],this.stepConfirmationCallbacks=[],this.stepAwaitingInputCallbacks=[],this.stepMessageCallbacks=[],this.navigateToConversationCallbacks=[],this.tasksCreatedForExecutionCallbacks=[],this.yoloProgressCallbacks=[],this.yoloCompleteCallbacks=[],this.discoveryChunkCallbacks=[],this.discoveryCompleteCallbacks=[],this.discoveryErrorCallbacks=[],this.tasksDiscoveredCallbacks=[],this.taskAiStartCallbacks=[],this.taskAiChunkCallbacks=[],this.taskAiCompleteCallbacks=[],this.taskAiErrorCallbacks=[],this.taskResultStartCallbacks=[],this.taskResultChunkCallbacks=[],this.taskResultCompleteCallbacks=[],this.taskResultErrorCallbacks=[],this.researchPhaseCallbacks=[],this.autoPopuniStartCallbacks=[],this.autoPopuniCompleteCallbacks=[],this.autoPopuniTaskErrorCallbacks=[],this.executionActiveStateCallbacks=[]}static \u0275fac=function(e){return new(e||o)};static \u0275prov=Ge({token:o,factory:o.\u0275fac,providedIn:"root"})};var Ct=class o{http=ee(Ee);baseUrl=`${Ye.apiUrl}/api/v1/notes`;lastError$=v(null);async getByConversation(t){return(await H(this.http.get(`${this.baseUrl}/conversation/${t}`))).data}async getByConcept(t){return(await H(this.http.get(`${this.baseUrl}/concept/${t}`))).data}async getByConceptIds(t){let e=0,n=await Promise.all(t.map(i=>this.getByConcept(i).catch(()=>(e++,[]))));return e>0&&this.lastError$.set(`Gre\u0161ka pri u\u010Ditavanju bele\u0161ki (${e} od ${t.length})`),n.flat()}async getByConversationIds(t){let e=0,n=await Promise.all(t.map(i=>this.getByConversation(i).catch(()=>(e++,[]))));return e>0&&this.lastError$.set(`Gre\u0161ka pri u\u010Ditavanju bele\u0161ki (${e} od ${t.length})`),n.flat()}async createNote(t){return(await H(this.http.post(this.baseUrl,t))).data}async updateStatus(t,e){return(await H(this.http.patch(`${this.baseUrl}/${t}/status`,{status:e}))).data}async updateNote(t,e,n){return(await H(this.http.patch(`${this.baseUrl}/${t}`,{title:e,content:n}))).data}async submitReport(t,e){return(await H(this.http.post(`${this.baseUrl}/${t}/report`,{report:e}))).data}async generateReport(t){return(await H(this.http.post(`${this.baseUrl}/${t}/generate-report`,{}))).data.report}async scoreReport(t){return(await H(this.http.post(`${this.baseUrl}/${t}/score`,{}))).data}async deleteNote(t){await H(this.http.delete(`${this.baseUrl}/${t}`))}async getComments(t,e=1,n=50){return(await H(this.http.get(`${this.baseUrl}/${t}/comments?page=${e}&limit=${n}`))).data}async createComment(t,e){return(await H(this.http.post(`${this.baseUrl}/${t}/comments`,{content:e}))).data}async updateComment(t,e){return(await H(this.http.patch(`${this.baseUrl}/${t}/comment`,{content:e}))).data}async deleteComment(t){await H(this.http.delete(`${this.baseUrl}/${t}/comment`))}static \u0275fac=function(e){return new(e||o)};static \u0275prov=Ge({token:o,factory:o.\u0275fac,providedIn:"root"})};function So(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var ot=So();function ma(o){ot=o}var Dt={exec:()=>null};function Q(o,t=""){let e=typeof o=="string"?o:o.source,n={replace:(i,a)=>{let s=typeof a=="string"?a:a.source;return s=s.replace(xe.caret,"$1"),e=e.replace(i,s),n},getRegex:()=>new RegExp(e,t)};return n}var Sr=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),xe={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:o=>new RegExp(`^( {0,3}${o})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}#`),htmlBeginRegex:o=>new RegExp(`^ {0,${Math.min(3,o-1)}}<(?:[a-z].*>|!--)`,"i")},Pr=/^(?:[ \t]*(?:\n|$))+/,Er=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Tr=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Lt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Mr=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Po=/(?:[*+-]|\d{1,9}[.)])/,ha=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,ga=Q(ha).replace(/bull/g,Po).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Ir=Q(ha).replace(/bull/g,Po).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Eo=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Or=/^[^\n]+/,To=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,$r=Q(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",To).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Ar=Q(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Po).getRegex(),Pn="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Mo=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Nr=Q("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Mo).replace("tag",Pn).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),_a=Q(Eo).replace("hr",Lt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Pn).getRegex(),Rr=Q(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",_a).getRegex(),Io={blockquote:Rr,code:Er,def:$r,fences:Tr,heading:Mr,hr:Lt,html:Nr,lheading:ga,list:Ar,newline:Pr,paragraph:_a,table:Dt,text:Or},sa=Q("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Lt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Pn).getRegex(),Dr=te(V({},Io),{lheading:Ir,table:sa,paragraph:Q(Eo).replace("hr",Lt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",sa).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Pn).getRegex()}),Lr=te(V({},Io),{html:Q(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Mo).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Dt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Q(Eo).replace("hr",Lt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",ga).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()}),zr=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Vr=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,fa=/^( {2,}|\\)\n(?!\s*$)/,Fr=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,En=/[\p{P}\p{S}]/u,Oo=/[\s\p{P}\p{S}]/u,Ca=/[^\s\p{P}\p{S}]/u,Br=Q(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Oo).getRegex(),xa=/(?!~)[\p{P}\p{S}]/u,Wr=/(?!~)[\s\p{P}\p{S}]/u,jr=/(?:[^\s\p{P}\p{S}]|~)/u,Hr=Q(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",Sr?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),ba=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Ur=Q(ba,"u").replace(/punct/g,En).getRegex(),Gr=Q(ba,"u").replace(/punct/g,xa).getRegex(),va="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",qr=Q(va,"gu").replace(/notPunctSpace/g,Ca).replace(/punctSpace/g,Oo).replace(/punct/g,En).getRegex(),Yr=Q(va,"gu").replace(/notPunctSpace/g,jr).replace(/punctSpace/g,Wr).replace(/punct/g,xa).getRegex(),Kr=Q("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Ca).replace(/punctSpace/g,Oo).replace(/punct/g,En).getRegex(),Qr=Q(/\\(punct)/,"gu").replace(/punct/g,En).getRegex(),Xr=Q(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Zr=Q(Mo).replace("(?:-->|$)","-->").getRegex(),Jr=Q("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Zr).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),yn=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,es=Q(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",yn).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),ka=Q(/^!?\[(label)\]\[(ref)\]/).replace("label",yn).replace("ref",To).getRegex(),ya=Q(/^!?\[(ref)\](?:\[\])?/).replace("ref",To).getRegex(),ts=Q("reflink|nolink(?!\\()","g").replace("reflink",ka).replace("nolink",ya).getRegex(),la=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,$o={_backpedal:Dt,anyPunctuation:Qr,autolink:Xr,blockSkip:Hr,br:fa,code:Vr,del:Dt,emStrongLDelim:Ur,emStrongRDelimAst:qr,emStrongRDelimUnd:Kr,escape:zr,link:es,nolink:ya,punctuation:Br,reflink:ka,reflinkSearch:ts,tag:Jr,text:Fr,url:Dt},ns=te(V({},$o),{link:Q(/^!?\[(label)\]\((.*?)\)/).replace("label",yn).getRegex(),reflink:Q(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",yn).getRegex()}),ko=te(V({},$o),{emStrongRDelimAst:Yr,emStrongLDelim:Gr,url:Q(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",la).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:Q(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",la).getRegex()}),os=te(V({},ko),{br:Q(fa).replace("{2,}","*").getRegex(),text:Q(ko.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()}),kn={normal:Io,gfm:Dr,pedantic:Lr},At={normal:$o,gfm:ko,breaks:os,pedantic:ns},is={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ca=o=>is[o];function Ue(o,t){if(t){if(xe.escapeTest.test(o))return o.replace(xe.escapeReplace,ca)}else if(xe.escapeTestNoEncode.test(o))return o.replace(xe.escapeReplaceNoEncode,ca);return o}function da(o){try{o=encodeURI(o).replace(xe.percentDecode,"%")}catch{return null}return o}function pa(o,t){let e=o.replace(xe.findPipe,(a,s,m)=>{let d=!1,y=s;for(;--y>=0&&m[y]==="\\";)d=!d;return d?"|":" |"}),n=e.split(xe.splitPipe),i=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(xe.slashPipe,"|");return n}function Nt(o,t,e){let n=o.length;if(n===0)return"";let i=0;for(;i<n;){let a=o.charAt(n-i-1);if(a===t&&!e)i++;else if(a!==t&&e)i++;else break}return o.slice(0,n-i)}function as(o,t){if(o.indexOf(t[1])===-1)return-1;let e=0;for(let n=0;n<o.length;n++)if(o[n]==="\\")n++;else if(o[n]===t[0])e++;else if(o[n]===t[1]&&(e--,e<0))return n;return e>0?-2:-1}function ua(o,t,e,n,i){let a=t.href,s=t.title||null,m=o[1].replace(i.other.outputLinkReplace,"$1");n.state.inLink=!0;let d={type:o[0].charAt(0)==="!"?"image":"link",raw:e,href:a,title:s,text:m,tokens:n.inlineTokens(m)};return n.state.inLink=!1,d}function rs(o,t,e){let n=o.match(e.other.indentCodeCompensation);if(n===null)return t;let i=n[1];return t.split(`
`).map(a=>{let s=a.match(e.other.beginningSpace);if(s===null)return a;let[m]=s;return m.length>=i.length?a.slice(i.length):a}).join(`
`)}var wn=class{options;rules;lexer;constructor(o){this.options=o||ot}space(o){let t=this.rules.block.newline.exec(o);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(o){let t=this.rules.block.code.exec(o);if(t){let e=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:Nt(e,`
`)}}}fences(o){let t=this.rules.block.fences.exec(o);if(t){let e=t[0],n=rs(e,t[3]||"",this.rules);return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(o){let t=this.rules.block.heading.exec(o);if(t){let e=t[2].trim();if(this.rules.other.endingHash.test(e)){let n=Nt(e,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(e=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(o){let t=this.rules.block.hr.exec(o);if(t)return{type:"hr",raw:Nt(t[0],`
`)}}blockquote(o){let t=this.rules.block.blockquote.exec(o);if(t){let e=Nt(t[0],`
`).split(`
`),n="",i="",a=[];for(;e.length>0;){let s=!1,m=[],d;for(d=0;d<e.length;d++)if(this.rules.other.blockquoteStart.test(e[d]))m.push(e[d]),s=!0;else if(!s)m.push(e[d]);else break;e=e.slice(d);let y=m.join(`
`),k=y.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${y}`:y,i=i?`${i}
${k}`:k;let D=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(k,a,!0),this.lexer.state.top=D,e.length===0)break;let $=a.at(-1);if($?.type==="code")break;if($?.type==="blockquote"){let J=$,X=J.raw+`
`+e.join(`
`),Se=this.blockquote(X);a[a.length-1]=Se,n=n.substring(0,n.length-J.raw.length)+Se.raw,i=i.substring(0,i.length-J.text.length)+Se.text;break}else if($?.type==="list"){let J=$,X=J.raw+`
`+e.join(`
`),Se=this.list(X);a[a.length-1]=Se,n=n.substring(0,n.length-$.raw.length)+Se.raw,i=i.substring(0,i.length-J.raw.length)+Se.raw,e=X.substring(a.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:a,text:i}}}list(o){let t=this.rules.block.list.exec(o);if(t){let e=t[1].trim(),n=e.length>1,i={type:"list",raw:"",ordered:n,start:n?+e.slice(0,-1):"",loose:!1,items:[]};e=n?`\\d{1,9}\\${e.slice(-1)}`:`\\${e}`,this.options.pedantic&&(e=n?e:"[*+-]");let a=this.rules.other.listItemRegex(e),s=!1;for(;o;){let d=!1,y="",k="";if(!(t=a.exec(o))||this.rules.block.hr.test(o))break;y=t[0],o=o.substring(y.length);let D=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,Se=>" ".repeat(3*Se.length)),$=o.split(`
`,1)[0],J=!D.trim(),X=0;if(this.options.pedantic?(X=2,k=D.trimStart()):J?X=t[1].length+1:(X=t[2].search(this.rules.other.nonSpaceChar),X=X>4?1:X,k=D.slice(X),X+=t[1].length),J&&this.rules.other.blankLine.test($)&&(y+=$+`
`,o=o.substring($.length+1),d=!0),!d){let Se=this.rules.other.nextBulletRegex(X),Ut=this.rules.other.hrRegex(X),Gt=this.rules.other.fencesBeginRegex(X),qt=this.rules.other.headingBeginRegex(X),it=this.rules.other.htmlBeginRegex(X);for(;o;){let ce=o.split(`
`,1)[0],Me;if($=ce,this.options.pedantic?($=$.replace(this.rules.other.listReplaceNesting,"  "),Me=$):Me=$.replace(this.rules.other.tabCharGlobal,"    "),Gt.test($)||qt.test($)||it.test($)||Se.test($)||Ut.test($))break;if(Me.search(this.rules.other.nonSpaceChar)>=X||!$.trim())k+=`
`+Me.slice(X);else{if(J||D.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||Gt.test(D)||qt.test(D)||Ut.test(D))break;k+=`
`+$}!J&&!$.trim()&&(J=!0),y+=ce+`
`,o=o.substring(ce.length+1),D=Me.slice(X)}}i.loose||(s?i.loose=!0:this.rules.other.doubleBlankLine.test(y)&&(s=!0)),i.items.push({type:"list_item",raw:y,task:!!this.options.gfm&&this.rules.other.listIsTask.test(k),loose:!1,text:k,tokens:[]}),i.raw+=y}let m=i.items.at(-1);if(m)m.raw=m.raw.trimEnd(),m.text=m.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let d of i.items){if(this.lexer.state.top=!1,d.tokens=this.lexer.blockTokens(d.text,[]),d.task){if(d.text=d.text.replace(this.rules.other.listReplaceTask,""),d.tokens[0]?.type==="text"||d.tokens[0]?.type==="paragraph"){d.tokens[0].raw=d.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),d.tokens[0].text=d.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let k=this.lexer.inlineQueue.length-1;k>=0;k--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[k].src)){this.lexer.inlineQueue[k].src=this.lexer.inlineQueue[k].src.replace(this.rules.other.listReplaceTask,"");break}}let y=this.rules.other.listTaskCheckbox.exec(d.raw);if(y){let k={type:"checkbox",raw:y[0]+" ",checked:y[0]!=="[ ]"};d.checked=k.checked,i.loose?d.tokens[0]&&["paragraph","text"].includes(d.tokens[0].type)&&"tokens"in d.tokens[0]&&d.tokens[0].tokens?(d.tokens[0].raw=k.raw+d.tokens[0].raw,d.tokens[0].text=k.raw+d.tokens[0].text,d.tokens[0].tokens.unshift(k)):d.tokens.unshift({type:"paragraph",raw:k.raw,text:k.raw,tokens:[k]}):d.tokens.unshift(k)}}if(!i.loose){let y=d.tokens.filter(D=>D.type==="space"),k=y.length>0&&y.some(D=>this.rules.other.anyLine.test(D.raw));i.loose=k}}if(i.loose)for(let d of i.items){d.loose=!0;for(let y of d.tokens)y.type==="text"&&(y.type="paragraph")}return i}}html(o){let t=this.rules.block.html.exec(o);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(o){let t=this.rules.block.def.exec(o);if(t){let e=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:n,title:i}}}table(o){let t=this.rules.block.table.exec(o);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let e=pa(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(e.length===n.length){for(let s of n)this.rules.other.tableAlignRight.test(s)?a.align.push("right"):this.rules.other.tableAlignCenter.test(s)?a.align.push("center"):this.rules.other.tableAlignLeft.test(s)?a.align.push("left"):a.align.push(null);for(let s=0;s<e.length;s++)a.header.push({text:e[s],tokens:this.lexer.inline(e[s]),header:!0,align:a.align[s]});for(let s of i)a.rows.push(pa(s,a.header.length).map((m,d)=>({text:m,tokens:this.lexer.inline(m),header:!1,align:a.align[d]})));return a}}lheading(o){let t=this.rules.block.lheading.exec(o);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(o){let t=this.rules.block.paragraph.exec(o);if(t){let e=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(o){let t=this.rules.block.text.exec(o);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(o){let t=this.rules.inline.escape.exec(o);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(o){let t=this.rules.inline.tag.exec(o);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(o){let t=this.rules.inline.link.exec(o);if(t){let e=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(e)){if(!this.rules.other.endAngleBracket.test(e))return;let a=Nt(e.slice(0,-1),"\\");if((e.length-a.length)%2===0)return}else{let a=as(t[2],"()");if(a===-2)return;if(a>-1){let s=(t[0].indexOf("!")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,s).trim(),t[3]=""}}let n=t[2],i="";if(this.options.pedantic){let a=this.rules.other.pedanticHrefTitle.exec(n);a&&(n=a[1],i=a[3])}else i=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(e)?n=n.slice(1):n=n.slice(1,-1)),ua(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(o,t){let e;if((e=this.rules.inline.reflink.exec(o))||(e=this.rules.inline.nolink.exec(o))){let n=(e[2]||e[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=t[n.toLowerCase()];if(!i){let a=e[0].charAt(0);return{type:"text",raw:a,text:a}}return ua(e,i,e[0],this.lexer,this.rules)}}emStrong(o,t,e=""){let n=this.rules.inline.emStrongLDelim.exec(o);if(!(!n||n[3]&&e.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!e||this.rules.inline.punctuation.exec(e))){let i=[...n[0]].length-1,a,s,m=i,d=0,y=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(y.lastIndex=0,t=t.slice(-1*o.length+i);(n=y.exec(t))!=null;){if(a=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!a)continue;if(s=[...a].length,n[3]||n[4]){m+=s;continue}else if((n[5]||n[6])&&i%3&&!((i+s)%3)){d+=s;continue}if(m-=s,m>0)continue;s=Math.min(s,s+m+d);let k=[...n[0]][0].length,D=o.slice(0,i+n.index+k+s);if(Math.min(i,s)%2){let J=D.slice(1,-1);return{type:"em",raw:D,text:J,tokens:this.lexer.inlineTokens(J)}}let $=D.slice(2,-2);return{type:"strong",raw:D,text:$,tokens:this.lexer.inlineTokens($)}}}}codespan(o){let t=this.rules.inline.code.exec(o);if(t){let e=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(e),i=this.rules.other.startingSpaceChar.test(e)&&this.rules.other.endingSpaceChar.test(e);return n&&i&&(e=e.substring(1,e.length-1)),{type:"codespan",raw:t[0],text:e}}}br(o){let t=this.rules.inline.br.exec(o);if(t)return{type:"br",raw:t[0]}}del(o){let t=this.rules.inline.del.exec(o);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(o){let t=this.rules.inline.autolink.exec(o);if(t){let e,n;return t[2]==="@"?(e=t[1],n="mailto:"+e):(e=t[1],n=e),{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}url(o){let t;if(t=this.rules.inline.url.exec(o)){let e,n;if(t[2]==="@")e=t[0],n="mailto:"+e;else{let i;do i=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(i!==t[0]);e=t[0],t[1]==="www."?n="http://"+t[0]:n=t[0]}return{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(o){let t=this.rules.inline.text.exec(o);if(t){let e=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:e}}}},Oe=class yo{tokens;options;state;inlineQueue;tokenizer;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||ot,this.options.tokenizer=this.options.tokenizer||new wn,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let e={other:xe,block:kn.normal,inline:At.normal};this.options.pedantic?(e.block=kn.pedantic,e.inline=At.pedantic):this.options.gfm&&(e.block=kn.gfm,this.options.breaks?e.inline=At.breaks:e.inline=At.gfm),this.tokenizer.rules=e}static get rules(){return{block:kn,inline:At}}static lex(t,e){return new yo(e).lex(t)}static lexInline(t,e){return new yo(e).inlineTokens(t)}lex(t){t=t.replace(xe.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){let n=this.inlineQueue[e];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,e=[],n=!1){for(this.options.pedantic&&(t=t.replace(xe.tabCharGlobal,"    ").replace(xe.spaceLine,""));t;){let i;if(this.options.extensions?.block?.some(s=>(i=s.call({lexer:this},t,e))?(t=t.substring(i.raw.length),e.push(i),!0):!1))continue;if(i=this.tokenizer.space(t)){t=t.substring(i.raw.length);let s=e.at(-1);i.raw.length===1&&s!==void 0?s.raw+=`
`:e.push(i);continue}if(i=this.tokenizer.code(t)){t=t.substring(i.raw.length);let s=e.at(-1);s?.type==="paragraph"||s?.type==="text"?(s.raw+=(s.raw.endsWith(`
`)?"":`
`)+i.raw,s.text+=`
`+i.text,this.inlineQueue.at(-1).src=s.text):e.push(i);continue}if(i=this.tokenizer.fences(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.heading(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.hr(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.blockquote(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.list(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.html(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.def(t)){t=t.substring(i.raw.length);let s=e.at(-1);s?.type==="paragraph"||s?.type==="text"?(s.raw+=(s.raw.endsWith(`
`)?"":`
`)+i.raw,s.text+=`
`+i.raw,this.inlineQueue.at(-1).src=s.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},e.push(i));continue}if(i=this.tokenizer.table(t)){t=t.substring(i.raw.length),e.push(i);continue}if(i=this.tokenizer.lheading(t)){t=t.substring(i.raw.length),e.push(i);continue}let a=t;if(this.options.extensions?.startBlock){let s=1/0,m=t.slice(1),d;this.options.extensions.startBlock.forEach(y=>{d=y.call({lexer:this},m),typeof d=="number"&&d>=0&&(s=Math.min(s,d))}),s<1/0&&s>=0&&(a=t.substring(0,s+1))}if(this.state.top&&(i=this.tokenizer.paragraph(a))){let s=e.at(-1);n&&s?.type==="paragraph"?(s.raw+=(s.raw.endsWith(`
`)?"":`
`)+i.raw,s.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=s.text):e.push(i),n=a.length!==t.length,t=t.substring(i.raw.length);continue}if(i=this.tokenizer.text(t)){t=t.substring(i.raw.length);let s=e.at(-1);s?.type==="text"?(s.raw+=(s.raw.endsWith(`
`)?"":`
`)+i.raw,s.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=s.text):e.push(i);continue}if(t){let s="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(s);break}else throw new Error(s)}}return this.state.top=!0,e}inline(t,e=[]){return this.inlineQueue.push({src:t,tokens:e}),e}inlineTokens(t,e=[]){let n=t,i=null;if(this.tokens.links){let d=Object.keys(this.tokens.links);if(d.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)d.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,i.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let a;for(;(i=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)a=i[2]?i[2].length:0,n=n.slice(0,i.index+a)+"["+"a".repeat(i[0].length-a-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);n=this.options.hooks?.emStrongMask?.call({lexer:this},n)??n;let s=!1,m="";for(;t;){s||(m=""),s=!1;let d;if(this.options.extensions?.inline?.some(k=>(d=k.call({lexer:this},t,e))?(t=t.substring(d.raw.length),e.push(d),!0):!1))continue;if(d=this.tokenizer.escape(t)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.tag(t)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.link(t)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(d.raw.length);let k=e.at(-1);d.type==="text"&&k?.type==="text"?(k.raw+=d.raw,k.text+=d.text):e.push(d);continue}if(d=this.tokenizer.emStrong(t,n,m)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.codespan(t)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.br(t)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.del(t)){t=t.substring(d.raw.length),e.push(d);continue}if(d=this.tokenizer.autolink(t)){t=t.substring(d.raw.length),e.push(d);continue}if(!this.state.inLink&&(d=this.tokenizer.url(t))){t=t.substring(d.raw.length),e.push(d);continue}let y=t;if(this.options.extensions?.startInline){let k=1/0,D=t.slice(1),$;this.options.extensions.startInline.forEach(J=>{$=J.call({lexer:this},D),typeof $=="number"&&$>=0&&(k=Math.min(k,$))}),k<1/0&&k>=0&&(y=t.substring(0,k+1))}if(d=this.tokenizer.inlineText(y)){t=t.substring(d.raw.length),d.raw.slice(-1)!=="_"&&(m=d.raw.slice(-1)),s=!0;let k=e.at(-1);k?.type==="text"?(k.raw+=d.raw,k.text+=d.text):e.push(d);continue}if(t){let k="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(k);break}else throw new Error(k)}}return e}},Sn=class{options;parser;constructor(o){this.options=o||ot}space(o){return""}code({text:o,lang:t,escaped:e}){let n=(t||"").match(xe.notSpaceStart)?.[0],i=o.replace(xe.endingNewline,"")+`
`;return n?'<pre><code class="language-'+Ue(n)+'">'+(e?i:Ue(i,!0))+`</code></pre>
`:"<pre><code>"+(e?i:Ue(i,!0))+`</code></pre>
`}blockquote({tokens:o}){return`<blockquote>
${this.parser.parse(o)}</blockquote>
`}html({text:o}){return o}def(o){return""}heading({tokens:o,depth:t}){return`<h${t}>${this.parser.parseInline(o)}</h${t}>
`}hr(o){return`<hr>
`}list(o){let t=o.ordered,e=o.start,n="";for(let s=0;s<o.items.length;s++){let m=o.items[s];n+=this.listitem(m)}let i=t?"ol":"ul",a=t&&e!==1?' start="'+e+'"':"";return"<"+i+a+`>
`+n+"</"+i+`>
`}listitem(o){return`<li>${this.parser.parse(o.tokens)}</li>
`}checkbox({checked:o}){return"<input "+(o?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:o}){return`<p>${this.parser.parseInline(o)}</p>
`}table(o){let t="",e="";for(let i=0;i<o.header.length;i++)e+=this.tablecell(o.header[i]);t+=this.tablerow({text:e});let n="";for(let i=0;i<o.rows.length;i++){let a=o.rows[i];e="";for(let s=0;s<a.length;s++)e+=this.tablecell(a[s]);n+=this.tablerow({text:e})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:o}){return`<tr>
${o}</tr>
`}tablecell(o){let t=this.parser.parseInline(o.tokens),e=o.header?"th":"td";return(o.align?`<${e} align="${o.align}">`:`<${e}>`)+t+`</${e}>
`}strong({tokens:o}){return`<strong>${this.parser.parseInline(o)}</strong>`}em({tokens:o}){return`<em>${this.parser.parseInline(o)}</em>`}codespan({text:o}){return`<code>${Ue(o,!0)}</code>`}br(o){return"<br>"}del({tokens:o}){return`<del>${this.parser.parseInline(o)}</del>`}link({href:o,title:t,tokens:e}){let n=this.parser.parseInline(e),i=da(o);if(i===null)return n;o=i;let a='<a href="'+o+'"';return t&&(a+=' title="'+Ue(t)+'"'),a+=">"+n+"</a>",a}image({href:o,title:t,text:e,tokens:n}){n&&(e=this.parser.parseInline(n,this.parser.textRenderer));let i=da(o);if(i===null)return Ue(e);o=i;let a=`<img src="${o}" alt="${e}"`;return t&&(a+=` title="${Ue(t)}"`),a+=">",a}text(o){return"tokens"in o&&o.tokens?this.parser.parseInline(o.tokens):"escaped"in o&&o.escaped?o.text:Ue(o.text)}},Ao=class{strong({text:o}){return o}em({text:o}){return o}codespan({text:o}){return o}del({text:o}){return o}html({text:o}){return o}text({text:o}){return o}link({text:o}){return""+o}image({text:o}){return""+o}br(){return""}checkbox({raw:o}){return o}},$e=class wo{options;renderer;textRenderer;constructor(t){this.options=t||ot,this.options.renderer=this.options.renderer||new Sn,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Ao}static parse(t,e){return new wo(e).parse(t)}static parseInline(t,e){return new wo(e).parseInline(t)}parse(t){let e="";for(let n=0;n<t.length;n++){let i=t[n];if(this.options.extensions?.renderers?.[i.type]){let s=i,m=this.options.extensions.renderers[s.type].call({parser:this},s);if(m!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(s.type)){e+=m||"";continue}}let a=i;switch(a.type){case"space":{e+=this.renderer.space(a);break}case"hr":{e+=this.renderer.hr(a);break}case"heading":{e+=this.renderer.heading(a);break}case"code":{e+=this.renderer.code(a);break}case"table":{e+=this.renderer.table(a);break}case"blockquote":{e+=this.renderer.blockquote(a);break}case"list":{e+=this.renderer.list(a);break}case"checkbox":{e+=this.renderer.checkbox(a);break}case"html":{e+=this.renderer.html(a);break}case"def":{e+=this.renderer.def(a);break}case"paragraph":{e+=this.renderer.paragraph(a);break}case"text":{e+=this.renderer.text(a);break}default:{let s='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(s),"";throw new Error(s)}}}return e}parseInline(t,e=this.renderer){let n="";for(let i=0;i<t.length;i++){let a=t[i];if(this.options.extensions?.renderers?.[a.type]){let m=this.options.extensions.renderers[a.type].call({parser:this},a);if(m!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(a.type)){n+=m||"";continue}}let s=a;switch(s.type){case"escape":{n+=e.text(s);break}case"html":{n+=e.html(s);break}case"link":{n+=e.link(s);break}case"image":{n+=e.image(s);break}case"checkbox":{n+=e.checkbox(s);break}case"strong":{n+=e.strong(s);break}case"em":{n+=e.em(s);break}case"codespan":{n+=e.codespan(s);break}case"br":{n+=e.br(s);break}case"del":{n+=e.del(s);break}case"text":{n+=e.text(s);break}default:{let m='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(m),"";throw new Error(m)}}}return n}},Rt=class{options;block;constructor(o){this.options=o||ot}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(o){return o}postprocess(o){return o}processAllTokens(o){return o}emStrongMask(o){return o}provideLexer(){return this.block?Oe.lex:Oe.lexInline}provideParser(){return this.block?$e.parse:$e.parseInline}},ss=class{defaults=So();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=$e;Renderer=Sn;TextRenderer=Ao;Lexer=Oe;Tokenizer=wn;Hooks=Rt;constructor(...o){this.use(...o)}walkTokens(o,t){let e=[];for(let n of o)switch(e=e.concat(t.call(this,n)),n.type){case"table":{let i=n;for(let a of i.header)e=e.concat(this.walkTokens(a.tokens,t));for(let a of i.rows)for(let s of a)e=e.concat(this.walkTokens(s.tokens,t));break}case"list":{let i=n;e=e.concat(this.walkTokens(i.items,t));break}default:{let i=n;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(a=>{let s=i[a].flat(1/0);e=e.concat(this.walkTokens(s,t))}):i.tokens&&(e=e.concat(this.walkTokens(i.tokens,t)))}}return e}use(...o){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return o.forEach(e=>{let n=V({},e);if(n.async=this.defaults.async||n.async||!1,e.extensions&&(e.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let a=t.renderers[i.name];a?t.renderers[i.name]=function(...s){let m=i.renderer.apply(this,s);return m===!1&&(m=a.apply(this,s)),m}:t.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let a=t[i.level];a?a.unshift(i.tokenizer):t[i.level]=[i.tokenizer],i.start&&(i.level==="block"?t.startBlock?t.startBlock.push(i.start):t.startBlock=[i.start]:i.level==="inline"&&(t.startInline?t.startInline.push(i.start):t.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(t.childTokens[i.name]=i.childTokens)}),n.extensions=t),e.renderer){let i=this.defaults.renderer||new Sn(this.defaults);for(let a in e.renderer){if(!(a in i))throw new Error(`renderer '${a}' does not exist`);if(["options","parser"].includes(a))continue;let s=a,m=e.renderer[s],d=i[s];i[s]=(...y)=>{let k=m.apply(i,y);return k===!1&&(k=d.apply(i,y)),k||""}}n.renderer=i}if(e.tokenizer){let i=this.defaults.tokenizer||new wn(this.defaults);for(let a in e.tokenizer){if(!(a in i))throw new Error(`tokenizer '${a}' does not exist`);if(["options","rules","lexer"].includes(a))continue;let s=a,m=e.tokenizer[s],d=i[s];i[s]=(...y)=>{let k=m.apply(i,y);return k===!1&&(k=d.apply(i,y)),k}}n.tokenizer=i}if(e.hooks){let i=this.defaults.hooks||new Rt;for(let a in e.hooks){if(!(a in i))throw new Error(`hook '${a}' does not exist`);if(["options","block"].includes(a))continue;let s=a,m=e.hooks[s],d=i[s];Rt.passThroughHooks.has(a)?i[s]=y=>{if(this.defaults.async&&Rt.passThroughHooksRespectAsync.has(a))return(async()=>{let D=await m.call(i,y);return d.call(i,D)})();let k=m.call(i,y);return d.call(i,k)}:i[s]=(...y)=>{if(this.defaults.async)return(async()=>{let D=await m.apply(i,y);return D===!1&&(D=await d.apply(i,y)),D})();let k=m.apply(i,y);return k===!1&&(k=d.apply(i,y)),k}}n.hooks=i}if(e.walkTokens){let i=this.defaults.walkTokens,a=e.walkTokens;n.walkTokens=function(s){let m=[];return m.push(a.call(this,s)),i&&(m=m.concat(i.call(this,s))),m}}this.defaults=V(V({},this.defaults),n)}),this}setOptions(o){return this.defaults=V(V({},this.defaults),o),this}lexer(o,t){return Oe.lex(o,t??this.defaults)}parser(o,t){return $e.parse(o,t??this.defaults)}parseMarkdown(o){return(t,e)=>{let n=V({},e),i=V(V({},this.defaults),n),a=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&n.async===!1)return a(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(i.hooks&&(i.hooks.options=i,i.hooks.block=o),i.async)return(async()=>{let s=i.hooks?await i.hooks.preprocess(t):t,m=await(i.hooks?await i.hooks.provideLexer():o?Oe.lex:Oe.lexInline)(s,i),d=i.hooks?await i.hooks.processAllTokens(m):m;i.walkTokens&&await Promise.all(this.walkTokens(d,i.walkTokens));let y=await(i.hooks?await i.hooks.provideParser():o?$e.parse:$e.parseInline)(d,i);return i.hooks?await i.hooks.postprocess(y):y})().catch(a);try{i.hooks&&(t=i.hooks.preprocess(t));let s=(i.hooks?i.hooks.provideLexer():o?Oe.lex:Oe.lexInline)(t,i);i.hooks&&(s=i.hooks.processAllTokens(s)),i.walkTokens&&this.walkTokens(s,i.walkTokens);let m=(i.hooks?i.hooks.provideParser():o?$e.parse:$e.parseInline)(s,i);return i.hooks&&(m=i.hooks.postprocess(m)),m}catch(s){return a(s)}}}onError(o,t){return e=>{if(e.message+=`
Please report this to https://github.com/markedjs/marked.`,o){let n="<p>An error occurred:</p><pre>"+Ue(e.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(e);throw e}}},nt=new ss;function j(o,t){return nt.parse(o,t)}j.options=j.setOptions=function(o){return nt.setOptions(o),j.defaults=nt.defaults,ma(j.defaults),j};j.getDefaults=So;j.defaults=ot;j.use=function(...o){return nt.use(...o),j.defaults=nt.defaults,ma(j.defaults),j};j.walkTokens=function(o,t){return nt.walkTokens(o,t)};j.parseInline=nt.parseInline;j.Parser=$e;j.parser=$e.parse;j.Renderer=Sn;j.TextRenderer=Ao;j.Lexer=Oe;j.lexer=Oe.lex;j.Tokenizer=wn;j.Hooks=Rt;j.parse=j;var Zm=j.options,Jm=j.setOptions,e0=j.use,t0=j.walkTokens,n0=j.parseInline;var o0=$e.parse,i0=Oe.lex;var{entries:$a,setPrototypeOf:wa,isFrozen:ls,getPrototypeOf:cs,getOwnPropertyDescriptor:ds}=Object,{freeze:ve,seal:Te,create:Fo}=Object,{apply:Bo,construct:Wo}=typeof Reflect<"u"&&Reflect;ve||(ve=function(t){return t});Te||(Te=function(t){return t});Bo||(Bo=function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];return t.apply(e,i)});Wo||(Wo=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return new t(...n)});var Tn=ke(Array.prototype.forEach),ps=ke(Array.prototype.lastIndexOf),Sa=ke(Array.prototype.pop),zt=ke(Array.prototype.push),us=ke(Array.prototype.splice),In=ke(String.prototype.toLowerCase),No=ke(String.prototype.toString),Ro=ke(String.prototype.match),Vt=ke(String.prototype.replace),ms=ke(String.prototype.indexOf),hs=ke(String.prototype.trim),Ae=ke(Object.prototype.hasOwnProperty),be=ke(RegExp.prototype.test),Ft=gs(TypeError);function ke(o){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return Bo(o,t,n)}}function gs(o){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Wo(o,e)}}function B(o,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:In;wa&&wa(o,null);let n=t.length;for(;n--;){let i=t[n];if(typeof i=="string"){let a=e(i);a!==i&&(ls(t)||(t[n]=a),i=a)}o[i]=!0}return o}function _s(o){for(let t=0;t<o.length;t++)Ae(o,t)||(o[t]=null);return o}function Le(o){let t=Fo(null);for(let[e,n]of $a(o))Ae(o,e)&&(Array.isArray(n)?t[e]=_s(n):n&&typeof n=="object"&&n.constructor===Object?t[e]=Le(n):t[e]=n);return t}function Bt(o,t){for(;o!==null;){let n=ds(o,t);if(n){if(n.get)return ke(n.get);if(typeof n.value=="function")return ke(n.value)}o=cs(o)}function e(){return null}return e}var Pa=ve(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Do=ve(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Lo=ve(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),fs=ve(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),zo=ve(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Cs=ve(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ea=ve(["#text"]),Ta=ve(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Vo=ve(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ma=ve(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Mn=ve(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),xs=Te(/\{\{[\w\W]*|[\w\W]*\}\}/gm),bs=Te(/<%[\w\W]*|[\w\W]*%>/gm),vs=Te(/\$\{[\w\W]*/gm),ks=Te(/^data-[\-\w.\u00B7-\uFFFF]+$/),ys=Te(/^aria-[\-\w]+$/),Aa=Te(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ws=Te(/^(?:\w+script|data):/i),Ss=Te(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Na=Te(/^html$/i),Ps=Te(/^[a-z][.\w]*(-[.\w]+)+$/i),Ia=Object.freeze({__proto__:null,ARIA_ATTR:ys,ATTR_WHITESPACE:Ss,CUSTOM_ELEMENT:Ps,DATA_ATTR:ks,DOCTYPE_NAME:Na,ERB_EXPR:bs,IS_ALLOWED_URI:Aa,IS_SCRIPT_OR_DATA:ws,MUSTACHE_EXPR:xs,TMPLIT_EXPR:vs}),Wt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},Es=function(){return typeof window>"u"?null:window},Ts=function(t,e){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let n=null,i="data-tt-policy-suffix";e&&e.hasAttribute(i)&&(n=e.getAttribute(i));let a="dompurify"+(n?"#"+n:"");try{return t.createPolicy(a,{createHTML(s){return s},createScriptURL(s){return s}})}catch{return console.warn("TrustedTypes policy "+a+" could not be created."),null}},Oa=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Ra(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Es(),t=N=>Ra(N);if(t.version="3.3.1",t.removed=[],!o||!o.document||o.document.nodeType!==Wt.document||!o.Element)return t.isSupported=!1,t;let{document:e}=o,n=e,i=n.currentScript,{DocumentFragment:a,HTMLTemplateElement:s,Node:m,Element:d,NodeFilter:y,NamedNodeMap:k=o.NamedNodeMap||o.MozNamedAttrMap,HTMLFormElement:D,DOMParser:$,trustedTypes:J}=o,X=d.prototype,Se=Bt(X,"cloneNode"),Ut=Bt(X,"remove"),Gt=Bt(X,"nextSibling"),qt=Bt(X,"childNodes"),it=Bt(X,"parentNode");if(typeof s=="function"){let N=e.createElement("template");N.content&&N.content.ownerDocument&&(e=N.content.ownerDocument)}let ce,Me="",{implementation:Hn,createNodeIterator:za,createDocumentFragment:Va,getElementsByTagName:Fa}=e,{importNode:Ba}=n,ge=Oa();t.isSupported=typeof $a=="function"&&typeof it=="function"&&Hn&&Hn.createHTMLDocument!==void 0;let{MUSTACHE_EXPR:Un,ERB_EXPR:Gn,TMPLIT_EXPR:qn,DATA_ATTR:Wa,ARIA_ATTR:ja,IS_SCRIPT_OR_DATA:Ha,ATTR_WHITESPACE:Ho,CUSTOM_ELEMENT:Ua}=Ia,{IS_ALLOWED_URI:Uo}=Ia,pe=null,Go=B({},[...Pa,...Do,...Lo,...zo,...Ea]),ue=null,qo=B({},[...Ta,...Vo,...Ma,...Mn]),se=Object.seal(Fo(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),xt=null,Yn=null,at=Object.seal(Fo(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}})),Yo=!0,Kn=!0,Ko=!1,Qo=!0,rt=!1,Yt=!0,Xe=!1,Qn=!1,Xn=!1,st=!1,Kt=!1,Qt=!1,Xo=!0,Zo=!1,Ga="user-content-",Zn=!0,bt=!1,lt={},Re=null,Jn=B({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Jo=null,ei=B({},["audio","video","img","source","image","track"]),eo=null,ti=B({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Xt="http://www.w3.org/1998/Math/MathML",Zt="http://www.w3.org/2000/svg",ze="http://www.w3.org/1999/xhtml",ct=ze,to=!1,no=null,qa=B({},[Xt,Zt,ze],No),Jt=B({},["mi","mo","mn","ms","mtext"]),en=B({},["annotation-xml"]),Ya=B({},["title","style","font","a","script"]),vt=null,Ka=["application/xhtml+xml","text/html"],Qa="text/html",de=null,dt=null,Xa=e.createElement("form"),ni=function(g){return g instanceof RegExp||g instanceof Function},oo=function(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(dt&&dt===g)){if((!g||typeof g!="object")&&(g={}),g=Le(g),vt=Ka.indexOf(g.PARSER_MEDIA_TYPE)===-1?Qa:g.PARSER_MEDIA_TYPE,de=vt==="application/xhtml+xml"?No:In,pe=Ae(g,"ALLOWED_TAGS")?B({},g.ALLOWED_TAGS,de):Go,ue=Ae(g,"ALLOWED_ATTR")?B({},g.ALLOWED_ATTR,de):qo,no=Ae(g,"ALLOWED_NAMESPACES")?B({},g.ALLOWED_NAMESPACES,No):qa,eo=Ae(g,"ADD_URI_SAFE_ATTR")?B(Le(ti),g.ADD_URI_SAFE_ATTR,de):ti,Jo=Ae(g,"ADD_DATA_URI_TAGS")?B(Le(ei),g.ADD_DATA_URI_TAGS,de):ei,Re=Ae(g,"FORBID_CONTENTS")?B({},g.FORBID_CONTENTS,de):Jn,xt=Ae(g,"FORBID_TAGS")?B({},g.FORBID_TAGS,de):Le({}),Yn=Ae(g,"FORBID_ATTR")?B({},g.FORBID_ATTR,de):Le({}),lt=Ae(g,"USE_PROFILES")?g.USE_PROFILES:!1,Yo=g.ALLOW_ARIA_ATTR!==!1,Kn=g.ALLOW_DATA_ATTR!==!1,Ko=g.ALLOW_UNKNOWN_PROTOCOLS||!1,Qo=g.ALLOW_SELF_CLOSE_IN_ATTR!==!1,rt=g.SAFE_FOR_TEMPLATES||!1,Yt=g.SAFE_FOR_XML!==!1,Xe=g.WHOLE_DOCUMENT||!1,st=g.RETURN_DOM||!1,Kt=g.RETURN_DOM_FRAGMENT||!1,Qt=g.RETURN_TRUSTED_TYPE||!1,Xn=g.FORCE_BODY||!1,Xo=g.SANITIZE_DOM!==!1,Zo=g.SANITIZE_NAMED_PROPS||!1,Zn=g.KEEP_CONTENT!==!1,bt=g.IN_PLACE||!1,Uo=g.ALLOWED_URI_REGEXP||Aa,ct=g.NAMESPACE||ze,Jt=g.MATHML_TEXT_INTEGRATION_POINTS||Jt,en=g.HTML_INTEGRATION_POINTS||en,se=g.CUSTOM_ELEMENT_HANDLING||{},g.CUSTOM_ELEMENT_HANDLING&&ni(g.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(se.tagNameCheck=g.CUSTOM_ELEMENT_HANDLING.tagNameCheck),g.CUSTOM_ELEMENT_HANDLING&&ni(g.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(se.attributeNameCheck=g.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),g.CUSTOM_ELEMENT_HANDLING&&typeof g.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(se.allowCustomizedBuiltInElements=g.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),rt&&(Kn=!1),Kt&&(st=!0),lt&&(pe=B({},Ea),ue=[],lt.html===!0&&(B(pe,Pa),B(ue,Ta)),lt.svg===!0&&(B(pe,Do),B(ue,Vo),B(ue,Mn)),lt.svgFilters===!0&&(B(pe,Lo),B(ue,Vo),B(ue,Mn)),lt.mathMl===!0&&(B(pe,zo),B(ue,Ma),B(ue,Mn))),g.ADD_TAGS&&(typeof g.ADD_TAGS=="function"?at.tagCheck=g.ADD_TAGS:(pe===Go&&(pe=Le(pe)),B(pe,g.ADD_TAGS,de))),g.ADD_ATTR&&(typeof g.ADD_ATTR=="function"?at.attributeCheck=g.ADD_ATTR:(ue===qo&&(ue=Le(ue)),B(ue,g.ADD_ATTR,de))),g.ADD_URI_SAFE_ATTR&&B(eo,g.ADD_URI_SAFE_ATTR,de),g.FORBID_CONTENTS&&(Re===Jn&&(Re=Le(Re)),B(Re,g.FORBID_CONTENTS,de)),g.ADD_FORBID_CONTENTS&&(Re===Jn&&(Re=Le(Re)),B(Re,g.ADD_FORBID_CONTENTS,de)),Zn&&(pe["#text"]=!0),Xe&&B(pe,["html","head","body"]),pe.table&&(B(pe,["tbody"]),delete xt.tbody),g.TRUSTED_TYPES_POLICY){if(typeof g.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ft('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof g.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ft('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');ce=g.TRUSTED_TYPES_POLICY,Me=ce.createHTML("")}else ce===void 0&&(ce=Ts(J,i)),ce!==null&&typeof Me=="string"&&(Me=ce.createHTML(""));ve&&ve(g),dt=g}},oi=B({},[...Do,...Lo,...fs]),ii=B({},[...zo,...Cs]),Za=function(g){let w=it(g);(!w||!w.tagName)&&(w={namespaceURI:ct,tagName:"template"});let I=In(g.tagName),oe=In(w.tagName);return no[g.namespaceURI]?g.namespaceURI===Zt?w.namespaceURI===ze?I==="svg":w.namespaceURI===Xt?I==="svg"&&(oe==="annotation-xml"||Jt[oe]):!!oi[I]:g.namespaceURI===Xt?w.namespaceURI===ze?I==="math":w.namespaceURI===Zt?I==="math"&&en[oe]:!!ii[I]:g.namespaceURI===ze?w.namespaceURI===Zt&&!en[oe]||w.namespaceURI===Xt&&!Jt[oe]?!1:!ii[I]&&(Ya[I]||!oi[I]):!!(vt==="application/xhtml+xml"&&no[g.namespaceURI]):!1},De=function(g){zt(t.removed,{element:g});try{it(g).removeChild(g)}catch{Ut(g)}},Ze=function(g,w){try{zt(t.removed,{attribute:w.getAttributeNode(g),from:w})}catch{zt(t.removed,{attribute:null,from:w})}if(w.removeAttribute(g),g==="is")if(st||Kt)try{De(w)}catch{}else try{w.setAttribute(g,"")}catch{}},ai=function(g){let w=null,I=null;if(Xn)g="<remove></remove>"+g;else{let le=Ro(g,/^[\r\n\t ]+/);I=le&&le[0]}vt==="application/xhtml+xml"&&ct===ze&&(g='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+g+"</body></html>");let oe=ce?ce.createHTML(g):g;if(ct===ze)try{w=new $().parseFromString(oe,vt)}catch{}if(!w||!w.documentElement){w=Hn.createDocument(ct,"template",null);try{w.documentElement.innerHTML=to?Me:oe}catch{}}let he=w.body||w.documentElement;return g&&I&&he.insertBefore(e.createTextNode(I),he.childNodes[0]||null),ct===ze?Fa.call(w,Xe?"html":"body")[0]:Xe?w.documentElement:he},ri=function(g){return za.call(g.ownerDocument||g,g,y.SHOW_ELEMENT|y.SHOW_COMMENT|y.SHOW_TEXT|y.SHOW_PROCESSING_INSTRUCTION|y.SHOW_CDATA_SECTION,null)},io=function(g){return g instanceof D&&(typeof g.nodeName!="string"||typeof g.textContent!="string"||typeof g.removeChild!="function"||!(g.attributes instanceof k)||typeof g.removeAttribute!="function"||typeof g.setAttribute!="function"||typeof g.namespaceURI!="string"||typeof g.insertBefore!="function"||typeof g.hasChildNodes!="function")},si=function(g){return typeof m=="function"&&g instanceof m};function Ve(N,g,w){Tn(N,I=>{I.call(t,g,w,dt)})}let li=function(g){let w=null;if(Ve(ge.beforeSanitizeElements,g,null),io(g))return De(g),!0;let I=de(g.nodeName);if(Ve(ge.uponSanitizeElement,g,{tagName:I,allowedTags:pe}),Yt&&g.hasChildNodes()&&!si(g.firstElementChild)&&be(/<[/\w!]/g,g.innerHTML)&&be(/<[/\w!]/g,g.textContent)||g.nodeType===Wt.progressingInstruction||Yt&&g.nodeType===Wt.comment&&be(/<[/\w]/g,g.data))return De(g),!0;if(!(at.tagCheck instanceof Function&&at.tagCheck(I))&&(!pe[I]||xt[I])){if(!xt[I]&&di(I)&&(se.tagNameCheck instanceof RegExp&&be(se.tagNameCheck,I)||se.tagNameCheck instanceof Function&&se.tagNameCheck(I)))return!1;if(Zn&&!Re[I]){let oe=it(g)||g.parentNode,he=qt(g)||g.childNodes;if(he&&oe){let le=he.length;for(let ye=le-1;ye>=0;--ye){let Fe=Se(he[ye],!0);Fe.__removalCount=(g.__removalCount||0)+1,oe.insertBefore(Fe,Gt(g))}}}return De(g),!0}return g instanceof d&&!Za(g)||(I==="noscript"||I==="noembed"||I==="noframes")&&be(/<\/no(script|embed|frames)/i,g.innerHTML)?(De(g),!0):(rt&&g.nodeType===Wt.text&&(w=g.textContent,Tn([Un,Gn,qn],oe=>{w=Vt(w,oe," ")}),g.textContent!==w&&(zt(t.removed,{element:g.cloneNode()}),g.textContent=w)),Ve(ge.afterSanitizeElements,g,null),!1)},ci=function(g,w,I){if(Xo&&(w==="id"||w==="name")&&(I in e||I in Xa))return!1;if(!(Kn&&!Yn[w]&&be(Wa,w))){if(!(Yo&&be(ja,w))){if(!(at.attributeCheck instanceof Function&&at.attributeCheck(w,g))){if(!ue[w]||Yn[w]){if(!(di(g)&&(se.tagNameCheck instanceof RegExp&&be(se.tagNameCheck,g)||se.tagNameCheck instanceof Function&&se.tagNameCheck(g))&&(se.attributeNameCheck instanceof RegExp&&be(se.attributeNameCheck,w)||se.attributeNameCheck instanceof Function&&se.attributeNameCheck(w,g))||w==="is"&&se.allowCustomizedBuiltInElements&&(se.tagNameCheck instanceof RegExp&&be(se.tagNameCheck,I)||se.tagNameCheck instanceof Function&&se.tagNameCheck(I))))return!1}else if(!eo[w]){if(!be(Uo,Vt(I,Ho,""))){if(!((w==="src"||w==="xlink:href"||w==="href")&&g!=="script"&&ms(I,"data:")===0&&Jo[g])){if(!(Ko&&!be(Ha,Vt(I,Ho,"")))){if(I)return!1}}}}}}}return!0},di=function(g){return g!=="annotation-xml"&&Ro(g,Ua)},pi=function(g){Ve(ge.beforeSanitizeAttributes,g,null);let{attributes:w}=g;if(!w||io(g))return;let I={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ue,forceKeepAttr:void 0},oe=w.length;for(;oe--;){let he=w[oe],{name:le,namespaceURI:ye,value:Fe}=he,pt=de(le),ao=Fe,me=le==="value"?ao:hs(ao);if(I.attrName=pt,I.attrValue=me,I.keepAttr=!0,I.forceKeepAttr=void 0,Ve(ge.uponSanitizeAttribute,g,I),me=I.attrValue,Zo&&(pt==="id"||pt==="name")&&(Ze(le,g),me=Ga+me),Yt&&be(/((--!?|])>)|<\/(style|title|textarea)/i,me)){Ze(le,g);continue}if(pt==="attributename"&&Ro(me,"href")){Ze(le,g);continue}if(I.forceKeepAttr)continue;if(!I.keepAttr){Ze(le,g);continue}if(!Qo&&be(/\/>/i,me)){Ze(le,g);continue}rt&&Tn([Un,Gn,qn],mi=>{me=Vt(me,mi," ")});let ui=de(g.nodeName);if(!ci(ui,pt,me)){Ze(le,g);continue}if(ce&&typeof J=="object"&&typeof J.getAttributeType=="function"&&!ye)switch(J.getAttributeType(ui,pt)){case"TrustedHTML":{me=ce.createHTML(me);break}case"TrustedScriptURL":{me=ce.createScriptURL(me);break}}if(me!==ao)try{ye?g.setAttributeNS(ye,le,me):g.setAttribute(le,me),io(g)?De(g):Sa(t.removed)}catch{Ze(le,g)}}Ve(ge.afterSanitizeAttributes,g,null)},Ja=function N(g){let w=null,I=ri(g);for(Ve(ge.beforeSanitizeShadowDOM,g,null);w=I.nextNode();)Ve(ge.uponSanitizeShadowNode,w,null),li(w),pi(w),w.content instanceof a&&N(w.content);Ve(ge.afterSanitizeShadowDOM,g,null)};return t.sanitize=function(N){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},w=null,I=null,oe=null,he=null;if(to=!N,to&&(N="<!-->"),typeof N!="string"&&!si(N))if(typeof N.toString=="function"){if(N=N.toString(),typeof N!="string")throw Ft("dirty is not a string, aborting")}else throw Ft("toString is not a function");if(!t.isSupported)return N;if(Qn||oo(g),t.removed=[],typeof N=="string"&&(bt=!1),bt){if(N.nodeName){let Fe=de(N.nodeName);if(!pe[Fe]||xt[Fe])throw Ft("root node is forbidden and cannot be sanitized in-place")}}else if(N instanceof m)w=ai("<!---->"),I=w.ownerDocument.importNode(N,!0),I.nodeType===Wt.element&&I.nodeName==="BODY"||I.nodeName==="HTML"?w=I:w.appendChild(I);else{if(!st&&!rt&&!Xe&&N.indexOf("<")===-1)return ce&&Qt?ce.createHTML(N):N;if(w=ai(N),!w)return st?null:Qt?Me:""}w&&Xn&&De(w.firstChild);let le=ri(bt?N:w);for(;oe=le.nextNode();)li(oe),pi(oe),oe.content instanceof a&&Ja(oe.content);if(bt)return N;if(st){if(Kt)for(he=Va.call(w.ownerDocument);w.firstChild;)he.appendChild(w.firstChild);else he=w;return(ue.shadowroot||ue.shadowrootmode)&&(he=Ba.call(n,he,!0)),he}let ye=Xe?w.outerHTML:w.innerHTML;return Xe&&pe["!doctype"]&&w.ownerDocument&&w.ownerDocument.doctype&&w.ownerDocument.doctype.name&&be(Na,w.ownerDocument.doctype.name)&&(ye="<!DOCTYPE "+w.ownerDocument.doctype.name+`>
`+ye),rt&&Tn([Un,Gn,qn],Fe=>{ye=Vt(ye,Fe," ")}),ce&&Qt?ce.createHTML(ye):ye},t.setConfig=function(){let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};oo(N),Qn=!0},t.clearConfig=function(){dt=null,Qn=!1},t.isValidAttribute=function(N,g,w){dt||oo({});let I=de(N),oe=de(g);return ci(I,oe,w)},t.addHook=function(N,g){typeof g=="function"&&zt(ge[N],g)},t.removeHook=function(N,g){if(g!==void 0){let w=ps(ge[N],g);return w===-1?void 0:us(ge[N],w,1)[0]}return Sa(ge[N])},t.removeHooks=function(N){ge[N]=[]},t.removeAllHooks=function(){ge=Oa()},t}var Da=Ra();function Ms(o,t){if(o&1&&A(0,"span",1),o&2){let e=l().$implicit;Y("innerHTML",e.content,nn)}}function Is(o,t){if(o&1){let e=P();h(0,"button",3),M("click",function(){x(e);let i=l().$implicit,a=l();return b(a.emitCitation(i))})("keydown.enter",function(){x(e);let i=l().$implicit,a=l();return b(a.emitCitation(i))})("keydown.space",function(){x(e);let i=l().$implicit,a=l();return b(a.emitCitation(i))}),c(1),_()}if(o&2){let e=l().$implicit,n=l();R("finance",n.getCategoryClass(e.citation==null?null:e.citation.conceptCategory)==="finance")("marketing",n.getCategoryClass(e.citation==null?null:e.citation.conceptCategory)==="marketing")("technology",n.getCategoryClass(e.citation==null?null:e.citation.conceptCategory)==="technology")("operations",n.getCategoryClass(e.citation==null?null:e.citation.conceptCategory)==="operations")("legal",n.getCategoryClass(e.citation==null?null:e.citation.conceptCategory)==="legal")("creative",n.getCategoryClass(e.citation==null?null:e.citation.conceptCategory)==="creative"),_e("aria-label","Koncept: "+e.content+". Kliknite za detalje."),r(),O(" ",e.content," ")}}function Os(o,t){if(o&1&&f(0,Ms,1,1,"span",1)(1,Is,2,14,"button",2),o&2){let e=t.$implicit;C(e.type==="text"?0:1)}}var On=new j.Renderer,$s=On.link.bind(On);On.link=o=>$s(o).replace("<a ",'<a target="_blank" rel="noopener noreferrer" ');j.setOptions({gfm:!0,breaks:!0,renderer:On});var As={ADD_ATTR:["target","rel","class"],ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","strong","em","del","s","ul","ol","li","a","code","pre","blockquote","table","thead","tbody","tr","th","td","span","div","img"]},$n=class o{content=z.required();citations=z([]);citationClick=Z();segments$=re(()=>this.parseContent(this.content(),this.citations()));parseContent(t,e){let n=new Map;for(let $ of e)n.set($.conceptName.toLowerCase(),$);let i=new Map,a=0,s=t.replace(/\[\[([^\]]+)\]\]/g,($,J)=>{let X=`%%CITE_${a++}%%`;return i.set(X,{name:J,citation:n.get(J.toLowerCase())}),X}),d=j.parse(s,{async:!1}).replace(/<blockquote>\s*<p>\s*<strong>Kljuni uvid:?<\/strong>/gi,'<blockquote class="callout callout-insight"><p><strong>Klju\u010Dni uvid:</strong>').replace(/<blockquote>\s*<p>\s*<strong>Upozorenje:?<\/strong>/gi,'<blockquote class="callout callout-warning"><p><strong>Upozorenje:</strong>').replace(/<blockquote>\s*<p>\s*<strong>Metrika:?<\/strong>/gi,'<blockquote class="callout callout-metric"><p><strong>Metrika:</strong>').replace(/<blockquote>\s*<p>\s*<strong>Rezime:?<\/strong>/gi,'<blockquote class="callout callout-summary"><p><strong>Rezime:</strong>'),y=Da.sanitize(d,As);if(i.size===0)return[{type:"text",content:y}];let k=[],D=y.split(/(%%CITE_\d+%%)/);for(let $ of D){let J=i.get($);J?k.push({type:"citation",content:J.name,citation:J.citation}):$.length>0&&k.push({type:"text",content:$})}return k}getCategoryClass(t){return t?t.toLowerCase():""}emitCitation(t){t.citation?this.citationClick.emit(t.citation):this.citationClick.emit(t.content)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=ie({type:o,selectors:[["app-concept-citation"]],inputs:{content:[1,"content"],citations:[1,"citations"]},outputs:{citationClick:"citationClick"},decls:3,vars:0,consts:[[1,"content-with-citations"],[3,"innerHTML"],["type","button","tabindex","0",1,"citation-badge",3,"finance","marketing","technology","operations","legal","creative"],["type","button","tabindex","0",1,"citation-badge",3,"click","keydown.enter","keydown.space"]],template:function(e,n){e&1&&(h(0,"div",0),U(1,Os,2,1,null,null,qe),_()),e&2&&(r(),G(n.segments$()))},dependencies:[ae],styles:[".content-with-citations[_ngcontent-%COMP%]{display:block;line-height:1.6}.citation-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:.125rem .5rem;margin:0 .125rem;font-size:.875rem;font-weight:500;font-family:Inter,system-ui,sans-serif;border-radius:.375rem;background-color:#1a1a1a;border:1px solid #333;color:#a3a3a3;cursor:pointer;transition:all .15s ease;vertical-align:baseline;text-decoration:none}.citation-badge[_ngcontent-%COMP%]:hover, .citation-badge[_ngcontent-%COMP%]:focus{background-color:#262626;border-color:#525252;color:#e5e5e5;outline:none}.citation-badge[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 2px #3b82f6}.citation-badge.finance[_ngcontent-%COMP%]{border-color:#10b98133;color:#10b981}.citation-badge.finance[_ngcontent-%COMP%]:hover{background-color:#10b98120;border-color:#10b981}.citation-badge.marketing[_ngcontent-%COMP%]{border-color:#f59e0b33;color:#f59e0b}.citation-badge.marketing[_ngcontent-%COMP%]:hover{background-color:#f59e0b20;border-color:#f59e0b}.citation-badge.technology[_ngcontent-%COMP%]{border-color:#3b82f633;color:#3b82f6}.citation-badge.technology[_ngcontent-%COMP%]:hover{background-color:#3b82f620;border-color:#3b82f6}.citation-badge.operations[_ngcontent-%COMP%]{border-color:#8b5cf633;color:#8b5cf6}.citation-badge.operations[_ngcontent-%COMP%]:hover{background-color:#8b5cf620;border-color:#8b5cf6}.citation-badge.legal[_ngcontent-%COMP%]{border-color:#6b728033;color:#6b7280}.citation-badge.legal[_ngcontent-%COMP%]:hover{background-color:#6b728020;border-color:#6b7280}.citation-badge.creative[_ngcontent-%COMP%]{border-color:#ec489933;color:#ec4899}.citation-badge.creative[_ngcontent-%COMP%]:hover{background-color:#ec489920;border-color:#ec4899}"],changeDetection:0})};var Ns=(o,t)=>t.memoryId;function Rs(o,t){if(o&1&&(h(0,"span",5),c(1),_()),o&2){let e=l(2);r(),O(" (+",e.additionalCount$()," more) ")}}function Ds(o,t){if(o&1){let e=P();h(0,"div",9)(1,"div",10)(2,"span",11),c(3),_(),h(4,"span",12),c(5),_()(),h(6,"p",13),c(7),_(),h(8,"div",14)(9,"button",15),M("click",function(){let i=x(e).$implicit,a=l(3);return b(a.onViewDetails(i))}),c(10," View details "),_(),h(11,"button",16),M("click",function(){let i=x(e).$implicit,a=l(3);return b(a.onMarkOutdated(i))}),c(12," This is outdated "),_()()()}if(o&2){let e=t.$implicit,n=l(3);rn(n.getTypeClass(e.type)),r(2),K("background-color",n.getTypeColor(e.type)+"20")("color",n.getTypeColor(e.type)),r(),O(" ",n.getTypeLabel(e.type)," "),r(2),E(e.subject),r(2),E(e.summary)}}function Ls(o,t){if(o&1&&(h(0,"div",7),U(1,Ds,13,9,"div",8,Ns),_()),o&2){let e=l(2);r(),G(e.attributions())}}function zs(o,t){if(o&1){let e=P();h(0,"div",0)(1,"div",1)(2,"button",2),M("click",function(){x(e);let i=l();return b(i.toggleExpand())}),h(3,"span",3),c(4,"\u{1F4AD}"),_(),h(5,"span",4),c(6," Based on our previous discussion about "),h(7,"strong"),c(8),_(),f(9,Rs,2,1,"span",5),_(),h(10,"span",6),c(11," \u25BC "),_()()(),f(12,Ls,3,0,"div",7),_()}if(o&2){let e=l();r(2),_e("aria-expanded",e.isExpanded$()),r(6),E(e.primarySubject$()),r(),C(e.additionalCount$()>0?9:-1),r(),R("expanded",e.isExpanded$()),r(2),C(e.isExpanded$()?12:-1)}}var An=class o{attributions=z([]);attributionClick=Z();outdatedClick=Z();isExpanded$=v(!1);primarySubject$=v("");additionalCount$=v(0);ngOnChanges(){this.updatePrimarySubject()}ngOnInit(){this.updatePrimarySubject()}updatePrimarySubject(){let t=this.attributions();t.length>0&&(this.primarySubject$.set(t[0]?.subject??"previous context"),this.additionalCount$.set(Math.max(0,t.length-1)))}toggleExpand(){this.isExpanded$.update(t=>!t)}getTypeClass(t){return t.toLowerCase().replace("_","-")}getTypeColor(t){return Ei[t]??"#6b7280"}getTypeLabel(t){return Ti[t]??"Note"}onViewDetails(t){this.attributionClick.emit(t)}onMarkOutdated(t){this.outdatedClick.emit(t)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=ie({type:o,selectors:[["app-memory-attribution"]],inputs:{attributions:[1,"attributions"]},outputs:{attributionClick:"attributionClick",outdatedClick:"outdatedClick"},features:[Ci],decls:1,vars:1,consts:[[1,"memory-attribution-container"],[1,"attribution-header"],["type","button","aria-controls","attribution-details",1,"attribution-toggle",3,"click"],["aria-hidden","true",1,"memory-icon"],[1,"attribution-text"],[1,"additional-count"],[1,"expand-icon"],["id","attribution-details","role","region","aria-label","Memory attribution details",1,"attribution-details"],[1,"attribution-item",3,"class"],[1,"attribution-item"],[1,"item-header"],[1,"type-badge"],[1,"subject"],[1,"summary"],[1,"item-actions"],["type","button","aria-label","View full memory details",1,"action-btn","view-btn",3,"click"],["type","button","aria-label","Mark this memory as outdated",1,"action-btn","outdated-btn",3,"click"]],template:function(e,n){e&1&&f(0,zs,13,6,"div",0),e&2&&C(n.attributions().length>0?0:-1)},dependencies:[ae],styles:[".memory-attribution-container[_ngcontent-%COMP%]{margin:.5rem 0;border-radius:.5rem;background-color:#1a1a1a;border:1px solid #333;overflow:hidden}.attribution-header[_ngcontent-%COMP%]{padding:0}.attribution-toggle[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:transparent;border:none;color:#a3a3a3;cursor:pointer;font-size:.875rem;text-align:left;transition:background-color .15s ease}.attribution-toggle[_ngcontent-%COMP%]:hover{background-color:#262626}.attribution-toggle[_ngcontent-%COMP%]:focus{outline:none}.attribution-toggle[_ngcontent-%COMP%]:focus-visible{box-shadow:inset 0 0 0 2px #3b82f6}.memory-icon[_ngcontent-%COMP%]{font-size:1rem}.attribution-text[_ngcontent-%COMP%]{flex:1;font-style:italic}.attribution-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#e5e5e5;font-weight:600}.additional-count[_ngcontent-%COMP%]{color:#737373;font-size:.75rem;margin-left:.25rem}.expand-icon[_ngcontent-%COMP%]{font-size:.625rem;transition:transform .2s ease;color:#737373}.expand-icon.expanded[_ngcontent-%COMP%]{transform:rotate(180deg)}.attribution-details[_ngcontent-%COMP%]{padding:0 1rem 1rem;border-top:1px solid #333}.attribution-item[_ngcontent-%COMP%]{padding:.75rem;margin-top:.75rem;border-radius:.375rem;background-color:#0d0d0d;border:1px solid #262626}.item-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem}.type-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:.125rem .5rem;font-size:.75rem;font-weight:500;border-radius:.25rem;text-transform:uppercase;letter-spacing:.025em}.subject[_ngcontent-%COMP%]{font-weight:600;color:#e5e5e5;font-size:.875rem}.summary[_ngcontent-%COMP%]{margin:0 0 .75rem;color:#a3a3a3;font-size:.875rem;line-height:1.5}.item-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.action-btn[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.75rem;font-weight:500;border-radius:.25rem;border:1px solid #333;background-color:transparent;color:#a3a3a3;cursor:pointer;transition:all .15s ease}.action-btn[_ngcontent-%COMP%]:hover{background-color:#262626;color:#e5e5e5}.action-btn[_ngcontent-%COMP%]:focus{outline:none}.action-btn[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 2px #3b82f6}.view-btn[_ngcontent-%COMP%]:hover{border-color:#3b82f6;color:#3b82f6}.outdated-btn[_ngcontent-%COMP%]{color:#f59e0b;border-color:#f59e0b33}.outdated-btn[_ngcontent-%COMP%]:hover{background-color:#f59e0b20;border-color:#f59e0b;color:#f59e0b}"],changeDetection:0})};var Rn=()=>[];function Vs(o,t){if(o&1&&(u(0,"p",4),c(1),p()),o&2){let e=l(2);r(),E(e.formatTime(e.message().createdAt))}}function Fs(o,t){if(o&1&&(u(0,"div",0)(1,"div",2)(2,"div",3),c(3),p(),f(4,Vs,2,1,"p",4),p()()),o&2){let e=l();r(3),E(e.message().content),r(),C(e.message().createdAt?4:-1)}}function Bs(o,t){o&1&&(S(),T(0,"path",19))}function Ws(o,t){o&1&&(S(),T(0,"path",20))}function js(o,t){o&1&&(S(),T(0,"path",21))}function Hs(o,t){if(o&1&&(u(0,"div",17),S(),u(1,"svg",18),f(2,Bs,1,0,":svg:path",19)(3,Ws,1,0,":svg:path",20)(4,js,1,0,":svg:path",21),p(),c(5),p()),o&2){let e=l(2);R("confidence-high",e.confidenceLevel$()==="HIGH")("confidence-medium",e.confidenceLevel$()==="MEDIUM")("confidence-low",e.confidenceLevel$()==="LOW"),r(2),C(e.confidenceLevel$()==="HIGH"?2:e.confidenceLevel$()==="MEDIUM"?3:4),r(3),O(" ",(e.message().confidenceScore*100).toFixed(0),"% pouzdanost ")}}function Us(o,t){if(o&1){let e=P();u(0,"div",11)(1,"app-memory-attribution",22),L("attributionClick",function(i){x(e);let a=l(2);return b(a.onAttributionClick(i))})("outdatedClick",function(i){x(e);let a=l(2);return b(a.onOutdatedClick(i))}),p()()}if(o&2){let e=l(2);r(),q("attributions",e.message().memoryAttributions??Be(1,Rn))}}function Gs(o,t){o&1&&(u(0,"span",13),c(1,"\xA0"),p())}function qs(o,t){if(o&1&&(u(0,"a",27)(1,"div",28),S(),u(2,"svg",29),T(3,"path",30),p(),c(4),p(),W(),u(5,"div",31),c(6),p()()),o&2){let e=t.$implicit,n=l(3);q("href",e.link,xi),r(4),O(" ",n.extractDomain(e.link)," "),r(2),E(e.title)}}function Ys(o,t){if(o&1&&(u(0,"div",14)(1,"div",23),S(),u(2,"svg",24),T(3,"path",25),p(),c(4," Web izvori "),p(),W(),u(5,"div",26),U(6,qs,7,3,"a",27,qe),p()()),o&2){let e=l(2);r(6),G(e.message().webSearchSources??Be(0,Rn))}}function Ks(o,t){o&1&&(S(),u(0,"svg",24),T(1,"path",35),p())}function Qs(o,t){o&1&&(S(),u(0,"svg",24),T(1,"path",36),p())}function Xs(o,t){o&1&&(S(),u(0,"svg",24),T(1,"path",37),p())}function Zs(o,t){o&1&&(S(),u(0,"svg",24),T(1,"path",38),p())}function Js(o,t){o&1&&(S(),u(0,"svg",24),T(1,"path",36),p())}function el(o,t){o&1&&(S(),u(0,"svg",24),T(1,"path",39),p())}function tl(o,t){o&1&&(S(),u(0,"svg",24),T(1,"path",40),p())}function nl(o,t){o&1&&(S(),u(0,"svg",24),T(1,"path",41),p())}function ol(o,t){o&1&&(S(),u(0,"svg",24),T(1,"path",42),p())}function il(o,t){if(o&1){let e=P();u(0,"button",34),L("click",function(){let i=x(e).$implicit,a=l(3);return b(a.onActionClick(i))}),f(1,Ks,2,0,":svg:svg",24)(2,Qs,2,0,":svg:svg",24)(3,Xs,2,0,":svg:svg",24)(4,Zs,2,0,":svg:svg",24)(5,Js,2,0,":svg:svg",24)(6,el,2,0,":svg:svg",24)(7,tl,2,0,":svg:svg",24)(8,nl,2,0,":svg:svg",24)(9,ol,2,0,":svg:svg",24),c(10),p()}if(o&2){let e,n=t.$implicit;r(),C((e=n.icon)==="tasks"?1:e==="explore"?2:e==="arrow"?3:e==="workflow"?4:e==="search"?5:e==="score"?6:e==="note"?7:e==="web"?8:9),r(9),O(" ",n.label," ")}}function al(o,t){if(o&1&&(u(0,"div",15)(1,"div",32),c(2,"Preporu\u010Deni slede\u0107i koraci"),p(),U(3,il,11,2,"button",33,qe),p()),o&2){let e=l(2);r(3),G(e.message().suggestedActions??Be(0,Rn))}}function rl(o,t){if(o&1&&(u(0,"div",47)(1,"span",48),c(2),p(),u(3,"div",49),T(4,"div",50),p(),u(5,"span",51),c(6),p()()),o&2){let e=t.$implicit,n=t.$index,i=l(4);r(),q("title",e.label),r(),E(e.label),r(2),K("width",e.percent,"%")("background-color",i.chartColors[n%i.chartColors.length]),r(2),E(e.displayValue)}}function sl(o,t){if(o&1&&(u(0,"div",46),U(1,rl,7,7,"div",47,qe),p()),o&2){let e=l(3);r(),G(e.chartData$())}}function ll(o,t){if(o&1){let e=P();u(0,"div",43)(1,"button",44),L("click",function(){x(e);let i=l(2);return b(i.showChart$.set(!i.showChart$()))}),S(),u(2,"svg",24),T(3,"path",45),p(),c(4),p()(),f(5,sl,3,0,"div",46)}if(o&2){let e=l(2);r(4),O(" ",e.showChart$()?"Sakrij grafikon":"Prika\u017Ei grafikon"," "),r(),C(e.showChart$()?5:-1)}}function cl(o,t){if(o&1&&(u(0,"div",52),S(),u(1,"svg",18),T(2,"path",54),p(),W(),u(3,"p",55)(4,"span",56),c(5,"Za pobolj\u0161anje:"),p(),c(6),p()()),o&2){let e=l(3);r(6),O(" ",e.improvementSuggestion()," ")}}function dl(o,t){if(o&1&&(u(0,"p",53),c(1),p()),o&2){let e=l(3);r(),E(e.formatTime(e.message().createdAt))}}function pl(o,t){if(o&1&&(u(0,"div",16),f(1,cl,7,1,"div",52),f(2,dl,2,1,"p",53),p()),o&2){let e=l(2);r(),C(e.showImprovementSuggestion$()?1:-1),r(),C(e.message().createdAt?2:-1)}}function ul(o,t){if(o&1){let e=P();u(0,"div",1)(1,"div",5)(2,"div",6)(3,"div",7),c(4),p(),u(5,"span",8),c(6),p()(),f(7,Hs,6,8,"div",9),p(),u(8,"div",10),f(9,Us,2,2,"div",11),u(10,"app-concept-citation",12),L("citationClick",function(i){x(e);let a=l();return b(a.onCitationClick(i))}),p(),f(11,Gs,2,0,"span",13),p(),f(12,Ys,8,1,"div",14),f(13,al,5,1,"div",15),f(14,ll,6,2),f(15,pl,3,2,"div",16),p()}if(o&2){let e=l();r(3),K("background-color",e.getPersonaColor()),r(),O(" ",e.getPersonaInitial()," "),r(),K("color",e.personaType()?e.getPersonaColor():"#FAFAFA"),r(),O(" ",e.getPersonaLabel()," "),r(),C(!e.isStreaming()&&e.hasConfidence$()?7:-1),r(2),C(!e.isStreaming()&&e.hasMemoryAttributions$()?9:-1),r(),q("content",e.message().content)("citations",e.message().citations??Be(15,Rn)),r(),C(e.isStreaming()?11:-1),r(),C(!e.isStreaming()&&e.hasWebSearchSources$()?12:-1),r(),C(!e.isStreaming()&&e.hasSuggestedActions$()?13:-1),r(),C(!e.isStreaming()&&e.chartData$().length>0?14:-1),r(),C(e.isStreaming()?-1:15)}}var Nn=class o{get hostId(){return`msg-${this.message().id}`}message=z.required();isStreaming=z(!1);personaType=z(null);improvementSuggestion=z(null);citationClick=Z();attributionClick=Z();outdatedClick=Z();actionClick=Z();onCitationClick(t){this.citationClick.emit(t)}onActionClick(t){this.actionClick.emit(t)}onAttributionClick(t){this.attributionClick.emit(t)}onOutdatedClick(t){this.outdatedClick.emit(t)}previousScore=z(null);improvementDelta=z(null);showChart$=v(!1);chartColors=["#3B82F6","#10B981","#F59E0B","#8B5CF6","#EC4899","#EF4444","#06B6D4","#84CC16"];chartData$=re(()=>{let t=this.message().content;if(!t||this.message().role!=="ASSISTANT")return[];let e=t.match(/\|(.+)\|\r?\n\|[\s\-:|]+\|\r?\n((?:\|.+\|\r?\n?)+)/);if(!e||!e[1]||!e[2])return[];let n=e[1].split("|").map(d=>d.trim()).filter(Boolean),i=e[2].trim().split(/\r?\n/).map(d=>d.split("|").map(y=>y.trim()).filter(Boolean));if(n.length<2||i.length<2)return[];let a=-1;for(let d=1;d<n.length;d++)if(i.every(k=>{let D=k[d]?.replace(/[$%,.\s+KkMm]/g,"");return D&&!isNaN(Number(D))})){a=d;break}if(a===-1)return[];let s=i.map(d=>{let y=d[a]?.replace(/[$%,.\s+KkMm]/g,"")??"0";return{label:d[0]??"",value:Math.abs(Number(y)||0),displayValue:d[a]??""}}).filter(d=>d.label),m=Math.max(...s.map(d=>d.value),1);return s.map(d=>te(V({},d),{percent:d.value/m*100}))});hasConfidence$=re(()=>{let t=this.message().confidenceScore;return t!=null});hasWebSearchSources$=re(()=>{let t=this.message().webSearchSources;return t!=null&&t.length>0});hasMemoryAttributions$=re(()=>{let t=this.message().memoryAttributions;return t!=null&&t.length>0});hasSuggestedActions$=re(()=>{let t=this.message().suggestedActions;return t!=null&&t.length>0});confidenceLevel$=re(()=>{let t=this.message().confidenceScore;return t==null?"MEDIUM":t>=.85?"HIGH":t>=.5?"MEDIUM":"LOW"});showImprovementSuggestion$=re(()=>{let t=this.improvementSuggestion(),e=this.confidenceLevel$();return t!=null&&(e==="LOW"||e==="MEDIUM")});formatTime(t){return t?new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""}extractDomain(t){try{return new URL(t).hostname.replace(/^www\./,"")}catch{return t}}getPersonaColor(){let t=this.personaType();return t?cn[t]??"#3B82F6":"#3B82F6"}getPersonaInitial(){let t=this.personaType();return t?(kt[t]??"AI").charAt(0):"AI"}getPersonaLabel(){let t=this.personaType();return t?kt[t]??"AI Asistent":"AI Asistent"}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=ie({type:o,selectors:[["app-chat-message"]],hostVars:1,hostBindings:function(e,n){e&2&&_e("id",n.hostId)},inputs:{message:[1,"message"],isStreaming:[1,"isStreaming"],personaType:[1,"personaType"],improvementSuggestion:[1,"improvementSuggestion"],previousScore:[1,"previousScore"],improvementDelta:[1,"improvementDelta"]},outputs:{citationClick:"citationClick",attributionClick:"attributionClick",outdatedClick:"outdatedClick",actionClick:"actionClick"},decls:2,vars:2,consts:[[1,"msg-user-row"],[1,"ai-card"],[1,"msg-user"],[1,"msg-user-text"],[1,"msg-user-time"],[1,"ai-header"],[1,"ai-header-left"],[1,"persona-avatar"],[1,"persona-name"],[1,"confidence-badge",3,"confidence-high","confidence-medium","confidence-low"],[1,"ai-content"],[1,"memory-section"],[3,"citationClick","content","citations"],[1,"cursor-blink"],[1,"sources-section"],[1,"actions-section"],[1,"ai-footer"],[1,"confidence-badge"],["fill","currentColor","viewBox","0 0 20 20"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule","evenodd"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[3,"attributionClick","outdatedClick","attributions"],[1,"sources-label"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"],[1,"sources-grid"],["target","_blank","rel","noopener noreferrer",1,"source-card",3,"href"],[1,"source-domain"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"source-domain-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"source-title"],[1,"actions-label"],[1,"action-pill"],[1,"action-pill",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 7l5 5m0 0l-5 5m5-5H6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 10V3L4 14h7v7l9-11h-7z"],[1,"chart-toggle-row"],[1,"chart-toggle-btn",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"chart-container"],[1,"chart-bar-row"],[1,"chart-bar-label",3,"title"],[1,"chart-bar-track"],[1,"chart-bar-fill"],[1,"chart-bar-value"],[1,"improvement-row"],[1,"ai-time"],["d","M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"],[1,"improvement-text"],[1,"improvement-label"]],template:function(e,n){e&1&&(f(0,Fs,5,2,"div",0),f(1,ul,16,16,"div",1)),e&2&&(C(n.message().role==="USER"?0:-1),r(),C(n.message().role==="ASSISTANT"?1:-1))},dependencies:[ae,$n,An],styles:["[_nghost-%COMP%]{display:block}.msg-user-row[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.msg-user[_ngcontent-%COMP%]{max-width:70%;background:#3b82f6;color:#fff;border-radius:16px 16px 4px;padding:12px 16px}.msg-user-text[_ngcontent-%COMP%]{font-size:15px;line-height:1.6;white-space:pre-wrap;word-break:break-word}.msg-user-time[_ngcontent-%COMP%]{font-size:11px;color:#fff9;margin-top:8px;text-align:right}.ai-card[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:12px;border:1px solid #2a2a2a;overflow:hidden}.ai-header[_ngcontent-%COMP%]{padding:12px 16px;border-bottom:1px solid #2a2a2a;display:flex;align-items:center;justify-content:space-between}.ai-header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.persona-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:13px;font-weight:600}.persona-name[_ngcontent-%COMP%]{font-size:13px;font-weight:500}.confidence-badge[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:500}.confidence-badge[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.confidence-high[_ngcontent-%COMP%]{color:#22c55e;background:#22c55e1a}.confidence-medium[_ngcontent-%COMP%]{color:#eab308;background:#eab3081a}.confidence-low[_ngcontent-%COMP%]{color:#ef4444;background:#ef44441a}.ai-content[_ngcontent-%COMP%]{padding:20px;font-size:15px;line-height:1.75;color:#e0e0e0;word-break:break-word}.ai-content[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child{margin-top:0!important}.ai-content[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:last-child{margin-bottom:0!important}.ai-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.6em;font-weight:700;color:#fafafa;margin:28px 0 12px;letter-spacing:-.01em}.ai-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.35em;font-weight:600;color:#fafafa;margin:24px 0 10px;letter-spacing:-.01em}.ai-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.15em;font-weight:600;color:#fafafa;margin:22px 0 8px}.ai-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .ai-content[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%], .ai-content[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:1em;font-weight:600;color:#e5e5e5;margin:20px 0 6px}.ai-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:16px 0}.ai-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#fafafa;font-weight:600}.ai-content[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{color:#d4d4d4;font-style:italic}.ai-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .ai-content[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:16px 0;padding-left:1.75em;list-style-position:outside}.ai-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:disc}.ai-content[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{list-style-type:decimal}.ai-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:.4em 0;line-height:1.75;color:#e0e0e0}.ai-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]::marker{color:#8b8b8b}.ai-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] > ul[_ngcontent-%COMP%], .ai-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] > ol[_ngcontent-%COMP%]{margin:.3em 0}.ai-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{margin:.4em 0}.ai-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:circle}.ai-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:square}.ai-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin:20px 0;font-size:.9em}.ai-content[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#262626;color:#fafafa;font-weight:600;text-align:left;padding:10px 14px;border:1px solid #333}.ai-content[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 14px;border:1px solid #2a2a2a;color:#d4d4d4}.ai-content[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background:#1a1a1a}.ai-content[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background:#0d0d0d}.ai-content[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#262626}.ai-content[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:#262626;color:#e5e5e5;padding:.15em .4em;border-radius:4px;font-family:JetBrains Mono,Fira Code,Consolas,monospace;font-size:.875em}.ai-content[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{background:#0d0d0d;border:1px solid #2a2a2a;border-radius:8px;padding:14px 18px;overflow-x:auto;margin:20px 0}.ai-content[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:none;padding:0;border-radius:0;font-size:.85em;line-height:1.5}.ai-content[_ngcontent-%COMP%]   blockquote[_ngcontent-%COMP%]{border-left:3px solid #3b82f6;margin:20px 0;padding:.75em 1.25em;color:#a1a1a1;background:#3b82f60d;border-radius:0 6px 6px 0}.ai-content[_ngcontent-%COMP%]   blockquote[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.4em 0}.ai-content[_ngcontent-%COMP%]   blockquote.callout[_ngcontent-%COMP%]{padding:12px 16px;border-radius:8px}.ai-content[_ngcontent-%COMP%]   blockquote.callout[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]:first-child{display:block;margin-bottom:4px;font-size:12px;text-transform:uppercase;letter-spacing:.5px}.ai-content[_ngcontent-%COMP%]   .callout-insight[_ngcontent-%COMP%]{border-left-color:#3b82f6;background:#3b82f614}.ai-content[_ngcontent-%COMP%]   .callout-insight[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#60a5fa}.ai-content[_ngcontent-%COMP%]   .callout-warning[_ngcontent-%COMP%]{border-left-color:#f59e0b;background:#f59e0b14}.ai-content[_ngcontent-%COMP%]   .callout-warning[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#fbbf24}.ai-content[_ngcontent-%COMP%]   .callout-metric[_ngcontent-%COMP%]{border-left-color:#10b981;background:#10b98114}.ai-content[_ngcontent-%COMP%]   .callout-metric[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#34d399}.ai-content[_ngcontent-%COMP%]   .callout-summary[_ngcontent-%COMP%]{border-left-color:#8b5cf6;background:#8b5cf614}.ai-content[_ngcontent-%COMP%]   .callout-summary[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#a78bfa}.ai-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#60a5fa;text-decoration:underline;text-underline-offset:2px}.ai-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#93c5fd}.ai-content[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{border:none;border-top:1px solid #2a2a2a;margin:24px 0}.ai-content[_ngcontent-%COMP%]   del[_ngcontent-%COMP%]{color:#8b8b8b;text-decoration:line-through}.ai-footer[_ngcontent-%COMP%]{padding:12px 16px;border-top:1px solid #2a2a2a}.ai-time[_ngcontent-%COMP%]{font-size:11px;color:#8b8b8b}.improvement-row[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;margin-bottom:8px}.improvement-row[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px;color:#eab308;flex-shrink:0;margin-top:2px}.improvement-text[_ngcontent-%COMP%]{font-size:13px;color:#a1a1a1;line-height:1.5}.improvement-label[_ngcontent-%COMP%]{color:#eab308;font-weight:500}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.cursor-blink[_ngcontent-%COMP%]{display:inline-block;width:6px;height:20px;background:#3b82f6;border-radius:2px;margin-left:2px;animation:_ngcontent-%COMP%_pulse 1s ease-in-out infinite;vertical-align:text-bottom}.memory-section[_ngcontent-%COMP%]{margin-bottom:12px}.sources-section[_ngcontent-%COMP%]{padding:12px 20px;border-top:1px solid #2a2a2a;background:#3b82f608}.sources-label[_ngcontent-%COMP%]{font-size:11px;font-weight:600;color:#60a5fa;text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;gap:6px}.sources-label[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.sources-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:8px}.source-card[_ngcontent-%COMP%]{display:block;text-decoration:none;background:#0d0d0d;border:1px solid #2a2a2a;border-radius:8px;padding:10px 12px;transition:all .15s}.source-card[_ngcontent-%COMP%]:hover{border-color:#3b82f6;background:#1a1a1a}.source-domain[_ngcontent-%COMP%]{font-size:10px;color:#707070;margin-bottom:4px;display:flex;align-items:center;gap:4px}.source-domain-icon[_ngcontent-%COMP%]{width:12px;height:12px;flex-shrink:0}.source-title[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.actions-section[_ngcontent-%COMP%]{padding:10px 20px 14px;border-top:1px solid #2a2a2a;display:flex;flex-wrap:wrap;gap:8px}.actions-label[_ngcontent-%COMP%]{font-size:10px;color:#707070;width:100%;margin-bottom:2px}.action-pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;background:#0d0d0d;border:1px solid #2a2a2a;border-radius:20px;font-size:12px;font-weight:500;color:#a1a1a1;cursor:pointer;font-family:inherit;transition:all .15s}.action-pill[_ngcontent-%COMP%]:hover{background:#1a1a1a;border-color:#3b82f6;color:#fafafa}.action-pill[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px;flex-shrink:0}.chart-toggle-row[_ngcontent-%COMP%]{padding:8px 16px;border-top:1px solid #242424}.chart-toggle-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border:1px solid #2a2a2a;border-radius:6px;background:transparent;color:#8b8b8b;font-size:12px;cursor:pointer;transition:all .15s ease}.chart-toggle-btn[_ngcontent-%COMP%]:hover{color:#fafafa;border-color:#3b82f6;background:#3b82f60d}.chart-toggle-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.chart-container[_ngcontent-%COMP%]{padding:16px;border-top:1px solid #242424}.chart-bar-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:6px}.chart-bar-label[_ngcontent-%COMP%]{width:100px;font-size:11px;color:#8b8b8b;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:0}.chart-bar-track[_ngcontent-%COMP%]{flex:1;height:20px;background:#242424;border-radius:4px;overflow:hidden}.chart-bar-fill[_ngcontent-%COMP%]{height:100%;border-radius:4px;transition:width .3s ease;min-width:2px}.chart-bar-value[_ngcontent-%COMP%]{width:70px;font-size:11px;color:#fafafa;font-weight:500;flex-shrink:0}"]})};var ml=["inputRef"];function hl(o,t){o&1&&(S(),u(0,"svg",7),T(1,"circle",10)(2,"path",11),p())}function gl(o,t){o&1&&(S(),u(0,"svg",8),T(1,"path",12),p())}var Dn=class o{disabled=z(!1);messageSent=Z();inputRef;inputValue="";handleKeydown(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.send())}send(){let t=this.inputValue.trim();!t||this.disabled()||(this.messageSent.emit(t),this.inputValue="",this.inputRef?.nativeElement&&(this.inputRef.nativeElement.style.height="auto"))}autoResize(){let t=this.inputRef?.nativeElement;t&&(t.style.height="auto",t.style.height=`${Math.min(t.scrollHeight,200)}px`)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=ie({type:o,selectors:[["app-chat-input"]],viewQuery:function(e,n){if(e&1&&an(ml,5),e&2){let i;Je(i=et())&&(n.inputRef=i.first)}},inputs:{disabled:[1,"disabled"]},outputs:{messageSent:"messageSent"},decls:17,vars:4,consts:[["inputRef",""],[1,"input-wrapper"],[1,"input-inner"],[1,"input-row"],[1,"textarea-wrap"],["placeholder","Pitajte Mentor AI bilo \u0161ta...","rows","1",3,"ngModelChange","keydown","input","ngModel","disabled"],["title","Po\u0161alji poruku",1,"send-btn",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"spin"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],[1,"hint"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",2,"opacity","0.25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",2,"opacity","0.75"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 19l9 2-9-18-9 18 9-2zm0 0v-8"]],template:function(e,n){if(e&1){let i=P();u(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"textarea",5,0),ki("ngModelChange",function(s){return x(i),vi(n.inputValue,s)||(n.inputValue=s),b(s)}),L("keydown",function(s){return x(i),b(n.handleKeydown(s))})("input",function(){return x(i),b(n.autoResize())}),p()(),u(6,"button",6),L("click",function(){return x(i),b(n.send())}),f(7,hl,3,0,":svg:svg",7)(8,gl,2,0,":svg:svg",8),p()(),u(9,"p",9),c(10," Pritisnite "),u(11,"kbd"),c(12,"Enter"),p(),c(13," za slanje, "),u(14,"kbd"),c(15,"Shift+Enter"),p(),c(16," za novi red "),p()()()}e&2&&(r(4),bi("ngModel",n.inputValue),q("disabled",n.disabled()),r(2),q("disabled",n.disabled()||!n.inputValue.trim()),r(),C(n.disabled()?7:8))},dependencies:[ae,dn,Mi,Ii,Oi],styles:["[_nghost-%COMP%]{display:block}.input-wrapper[_ngcontent-%COMP%]{border-top:1px solid #2a2a2a;padding:16px;background:#0d0d0d}.input-inner[_ngcontent-%COMP%]{max-width:768px;margin:0 auto}.input-row[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:12px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:8px;transition:border-color .2s}.input-row[_ngcontent-%COMP%]:focus-within{border-color:#3b82f6}.textarea-wrap[_ngcontent-%COMP%]{flex:1}textarea[_ngcontent-%COMP%]{width:100%;resize:none;background:transparent;border:none;outline:none;color:#fafafa;font-size:15px;font-family:inherit;line-height:1.5;padding:6px 8px;max-height:200px}textarea[_ngcontent-%COMP%]::placeholder{color:#8b8b8b}textarea[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.send-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;min-width:40px;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;transition:opacity .15s}.send-btn[_ngcontent-%COMP%]:hover:not(:disabled){opacity:.9}.send-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.send-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.hint[_ngcontent-%COMP%]{font-size:11px;color:#8b8b8b;text-align:center;margin-top:8px}.hint[_ngcontent-%COMP%]   kbd[_ngcontent-%COMP%]{display:inline-block;padding:1px 6px;background:#242424;border-radius:3px;font-size:10px;font-family:monospace}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}"]})};var Ln=class o{personaType=z(null);phase=z("thinking");personaColors={CFO:"#3B82F6",CMO:"#8B5CF6",CTO:"#10B981",OPERATIONS:"#F59E0B",LEGAL:"#EF4444",CREATIVE:"#EC4899"};personaLabels={CFO:"CFO",CMO:"CMO",CTO:"CTO",OPERATIONS:"Operations",LEGAL:"Legal",CREATIVE:"Creative"};getPersonaColor(){let t=this.personaType();return t?this.personaColors[t]??"#3B82F6":"#3B82F6"}getPersonaInitial(){let t=this.personaType();if(!t)return"AI";let e=this.personaLabels[t];return e?e.charAt(0):"AI"}getPersonaLabel(){let t=this.personaType();return t?this.personaLabels[t]??"AI Assistant":"AI Assistant"}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=ie({type:o,selectors:[["app-typing-indicator"]],inputs:{personaType:[1,"personaType"],phase:[1,"phase"]},decls:14,vars:13,consts:[[1,"typing-card"],[1,"typing-header"],[1,"typing-avatar"],[1,"typing-label"],[1,"typing-name"],[1,"typing-status"],[1,"typing-content"],[1,"typing-dots"],[1,"typing-dot"]],template:function(e,n){e&1&&(h(0,"div",0)(1,"div",1)(2,"div",2),c(3),_(),h(4,"div",3)(5,"span",4),c(6),_(),h(7,"span",5),c(8),_()()(),h(9,"div",6)(10,"div",7),A(11,"span",8)(12,"span",8)(13,"span",8),_()()()),e&2&&(r(2),K("background-color",n.getPersonaColor()),r(),O(" ",n.getPersonaInitial()," "),r(2),K("color",n.getPersonaColor()),r(),O(" ",n.getPersonaLabel()," "),r(2),E(n.phase()==="researching"?"istra\u017Euje...":"razmi\u0161lja..."),r(3),K("background-color",n.getPersonaColor()),r(),K("background-color",n.getPersonaColor()),r(),K("background-color",n.getPersonaColor()))},dependencies:[ae],styles:[".typing-card[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:8px;border:1px solid #2a2a2a;overflow:hidden}.typing-header[_ngcontent-%COMP%]{padding:12px 16px;border-bottom:1px solid #2a2a2a;display:flex;align-items:center;gap:12px}.typing-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:13px;font-weight:600}.typing-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.typing-name[_ngcontent-%COMP%]{font-size:13px;font-weight:500}.typing-status[_ngcontent-%COMP%]{font-size:11px;color:#8b8b8b}.typing-content[_ngcontent-%COMP%]{padding:16px}.typing-dots[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.typing-dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;animation:_ngcontent-%COMP%_bounce 1s ease-in-out infinite}.typing-dot[_ngcontent-%COMP%]:nth-child(2){animation-delay:.15s}.typing-dot[_ngcontent-%COMP%]:nth-child(3){animation-delay:.3s}@keyframes _ngcontent-%COMP%_bounce{0%,to{transform:translateY(0)}50%{transform:translateY(-4px)}}"]})};var zn=class o{http=ee(Ee);baseUrl="/api/v1/personas";async getPersonas(){return(await H(this.http.get(this.baseUrl))).data}async getPersonaByType(t){return(await H(this.http.get(`${this.baseUrl}/${t}`))).data}static \u0275fac=function(e){return new(e||o)};static \u0275prov=Ge({token:o,factory:o.\u0275fac,providedIn:"root"})};var _l=()=>[1,2,3,4,5,6],fl=(o,t)=>t.id;function Cl(o,t){o&1&&A(0,"div",3)}function xl(o,t){o&1&&(h(0,"div",1),U(1,Cl,1,0,"div",3,on),_()),o&2&&(r(),G(Be(0,_l)))}function bl(o,t){if(o&1&&(h(0,"div",2),S(),h(1,"svg",4),A(2,"path",5),_(),c(3),_()),o&2){let e=l();r(3),O(" ",e.errorMessage$()," ")}}function vl(o,t){if(o&1){let e=P();h(0,"button",8),M("click",function(){let i=x(e).$implicit,a=l(2);return b(a.selectPersona(i))}),h(1,"div",9),c(2),_(),h(3,"span",10),c(4),_(),h(5,"span",11),c(6),_()()}if(o&2){let e,n,i,a,s=t.$implicit,m=l(2);K("border-color",((e=m.selectedPersona$())==null?null:e.id)===s.id?s.color:"transparent")("background-color",((n=m.selectedPersona$())==null?null:n.id)===s.id?s.color+"15":""),R("selected",((i=m.selectedPersona$())==null?null:i.id)===s.id),r(),K("background-color",s.color),r(),O(" ",s.shortName.charAt(0)," "),r(),K("color",((a=m.selectedPersona$())==null?null:a.id)===s.id?s.color:"#FAFAFA"),r(),O(" ",s.shortName," "),r(2),O(" ",m.getShortDescription(s.description)," ")}}function kl(o,t){if(o&1){let e=P();h(0,"button",12),M("click",function(){x(e);let i=l(2);return b(i.clearSelection())}),S(),h(1,"svg",13),A(2,"path",14),_(),c(3),_()}if(o&2){let e=l(2);R("active",!e.selectedPersona$()),r(3),O(" ",e.selectedPersona$()?"Poni\u0161ti izbor":"Persona nije izabrana"," ")}}function yl(o,t){if(o&1&&(h(0,"div",1),U(1,vl,7,13,"button",6,fl),_(),f(3,kl,4,3,"button",7)),o&2){let e=l();r(),G(e.personas$()),r(2),C(e.allowNone()?3:-1)}}var Vn=class o{personasService=ee(zn);selectedType=z(null);allowNone=z(!0);personaSelected=Z();personas$=v([]);selectedPersona$=v(null);isLoading$=v(!0);errorMessage$=v(null);async ngOnInit(){await this.loadPersonas();let t=this.selectedType();if(t){let e=this.personas$().find(n=>n.type===t);e&&this.selectedPersona$.set(e)}}async loadPersonas(){this.isLoading$.set(!0),this.errorMessage$.set(null);try{let t=await this.personasService.getPersonas();this.personas$.set(t)}catch{this.errorMessage$.set("U\u010Ditavanje persona nije uspelo")}finally{this.isLoading$.set(!1)}}selectPersona(t){this.selectedPersona$.set(t),this.personaSelected.emit(t)}clearSelection(){this.selectedPersona$.set(null),this.personaSelected.emit(null)}getShortDescription(t){return t.length<=50?t:t.substring(0,47)+"..."}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=ie({type:o,selectors:[["app-persona-selector"]],inputs:{selectedType:[1,"selectedType"],allowNone:[1,"allowNone"]},outputs:{personaSelected:"personaSelected"},decls:4,vars:1,consts:[[1,"persona-selector"],[1,"persona-grid"],[1,"error-box"],[1,"skeleton-card"],["fill","currentColor","viewBox","0 0 20 20",2,"width","16px","height","16px","flex-shrink","0"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"persona-card",3,"selected","borderColor","backgroundColor"],[1,"clear-btn",3,"active"],[1,"persona-card",3,"click"],[1,"persona-avatar"],[1,"persona-name"],[1,"persona-desc"],[1,"clear-btn",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","16px","height","16px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"]],template:function(e,n){e&1&&(h(0,"div",0),f(1,xl,3,1,"div",1)(2,bl,4,1,"div",2)(3,yl,4,1),_()),e&2&&(r(),C(n.isLoading$()?1:n.errorMessage$()?2:3))},dependencies:[ae],styles:[".persona-selector[_ngcontent-%COMP%]{width:100%}.persona-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}@media(max-width:1024px){.persona-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media(max-width:640px){.persona-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}.skeleton-card[_ngcontent-%COMP%]{height:96px;border-radius:12px;background:#242424;animation:_ngcontent-%COMP%_shimmer 1.5s linear infinite;background-image:linear-gradient(90deg,#242424 25%,#2a2a2a,#242424 75%);background-size:200% 100%}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:200% 0}to{background-position:-200% 0}}.error-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#ef4444;font-size:13px;padding:12px;background:#242424;border-radius:8px}.persona-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:12px;border-radius:12px;border:2px solid transparent;background:#242424;cursor:pointer;transition:all .2s;min-height:96px}.persona-card[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.persona-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:13px;margin-bottom:8px;box-shadow:0 4px 6px #0000004d}.persona-name[_ngcontent-%COMP%]{font-size:13px;font-weight:500;text-align:center;color:#fafafa}.persona-desc[_ngcontent-%COMP%]{font-size:11px;color:#8b8b8b;text-align:center;margin-top:4px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}@media(max-width:640px){.persona-desc[_ngcontent-%COMP%]{display:none}}.clear-btn[_ngcontent-%COMP%]{margin-top:12px;font-size:13px;color:#8b8b8b;background:none;border:none;cursor:pointer;display:flex;align-items:center;gap:6px;transition:color .15s}.clear-btn[_ngcontent-%COMP%]:hover, .clear-btn.active[_ngcontent-%COMP%]{color:#fafafa}"]})};function wl(o,t){if(o&1&&(h(0,"span",1),c(1),_()),o&2){let e=l();K("background-color",e.getColor()+"30")("color",e.getColor())("border-color",e.getColor()),r(),O(" ",e.getName()," ")}}var Fn=class o{personaType=z(null);getColor(){let t=this.personaType();return t&&cn[t]||"#6B7280"}getName(){let t=this.personaType();return t?kt[t]||t:""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=ie({type:o,selectors:[["app-persona-badge"]],inputs:{personaType:[1,"personaType"]},decls:1,vars:1,consts:[[1,"inline-flex","items-center","px-2","py-0.5","rounded-full","text-xs","font-medium",2,"border-width","1px",3,"backgroundColor","color","borderColor"],[1,"inline-flex","items-center","px-2","py-0.5","rounded-full","text-xs","font-medium",2,"border-width","1px"]],template:function(e,n){e&1&&f(0,wl,2,7,"span",0),e&2&&C(n.personaType()?0:-1)},dependencies:[ae],encapsulation:2})};var Sl=(o,t)=>t.id;function Pl(o,t){if(o&1&&(h(0,"span",15),c(1),_(),h(2,"h2",16),c(3),_()),o&2){let e=l(2);rn(e.getCategoryClass(e.concept$().category)),r(),O(" ",e.concept$().category," "),r(2),E(e.concept$().name)}}function El(o,t){o&1&&A(0,"div",17)(1,"div",18)}function Tl(o,t){if(o&1){let e=P();h(0,"div",9)(1,"p"),c(2),_(),h(3,"button",19),M("click",function(){x(e);let i=l(2);return b(i.loadConcept())}),c(4," Retry "),_()()}if(o&2){let e=l(2);r(2),E(e.error$())}}function Ml(o,t){o&1&&A(0,"div",20)(1,"div",21)}function Il(o,t){if(o&1&&(h(0,"div",23)(1,"h3",25),c(2,"Detalji"),_(),A(3,"div",26),_()),o&2){let e=l(3);r(3),Y("innerHTML",e.renderMarkdown(e.concept$().extendedDescription),nn)}}function Ol(o,t){if(o&1){let e=P();h(0,"button",29),M("click",function(){let i=x(e).$implicit,a=l(4);return b(a.onConceptClicked(i.id))}),c(1),_()}if(o&2){let e=t.$implicit;r(),O(" ",e.name," ")}}function $l(o,t){if(o&1&&(h(0,"div",24)(1,"h3",25),c(2,"Related Concepts"),_(),h(3,"div",27),U(4,Ol,2,1,"button",28,Sl),_()()),o&2){let e=l(3);r(4),G(e.concept$().relatedConcepts)}}function Al(o,t){if(o&1&&(h(0,"p",22),c(1),_(),f(2,Il,4,1,"div",23),f(3,$l,6,0,"div",24)),o&2){let e=l(2);r(),E(e.concept$().definition),r(),C(e.concept$().extendedDescription?2:-1),r(),C(e.concept$().relatedConcepts.length>0?3:-1)}}function Nl(o,t){if(o&1){let e=P();h(0,"div",0),M("click",function(){x(e);let i=l();return b(i.onClose())}),_(),h(1,"div",1)(2,"div",2)(3,"div",3),f(4,Pl,4,4)(5,El,2,0),_(),h(6,"button",4),M("click",function(){x(e);let i=l();return b(i.onClose())}),S(),h(7,"svg",5),A(8,"line",6)(9,"line",7),_()()(),W(),h(10,"div",8),f(11,Tl,5,1,"div",9)(12,Ml,2,0)(13,Al,4,3),_(),h(14,"div",10)(15,"button",11),M("click",function(){x(e);let i=l();return b(i.onLearnMore())}),c(16," Learn More "),S(),h(17,"svg",12),A(18,"line",13)(19,"polyline",14),_()()()()}if(o&2){let e,n=l();r(),_e("aria-label",(e=n.concept$())!=null&&e.name?"Concept: "+((e=n.concept$())==null?null:e.name):"Loading concept"),r(3),C(n.concept$()?4:n.isLoading$()?5:-1),r(7),C(n.error$()?11:n.isLoading$()?12:n.concept$()?13:-1),r(4),Y("disabled",!n.concept$())}}var Bn=class o{http=ee(Ee);sanitizer=ee(yi);conceptId=z(null);isOpen=z(!1);close=Z();conceptClick=Z();learnMore=Z();concept$=v(null);isLoading$=v(!1);error$=v(null);constructor(){tn(()=>{this.conceptId()&&this.isOpen()&&this.loadConcept()})}async loadConcept(){let t=this.conceptId();if(t){this.isLoading$.set(!0),this.error$.set(null);try{let e=await H(this.http.get(`/api/v1/knowledge/concepts/${t}/summary`));e?.data&&this.concept$.set(e.data)}catch(e){let n=e instanceof Error?e.message:"Unknown error";this.error$.set(`Failed to load concept details: ${n}`)}finally{this.isLoading$.set(!1)}}}getCategoryClass(t){return t?t.toLowerCase():""}onClose(){this.close.emit()}onConceptClicked(t){this.conceptClick.emit(t)}renderMarkdown(t){let e=j.parse(t,{async:!1});return this.sanitizer.bypassSecurityTrustHtml(e)}onLearnMore(){let t=this.concept$();t&&this.learnMore.emit(t.id)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=ie({type:o,selectors:[["app-concept-panel"]],inputs:{conceptId:[1,"conceptId"],isOpen:[1,"isOpen"]},outputs:{close:"close",conceptClick:"conceptClick",learnMore:"learnMore"},decls:1,vars:1,consts:[["role","presentation",1,"panel-backdrop",3,"click"],["role","dialog","aria-modal","true",1,"concept-panel"],[1,"panel-header"],[1,"header-content"],["type","button","aria-label","Close panel",1,"close-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"panel-content"],[1,"error-message"],[1,"panel-footer"],["type","button",1,"learn-more-button",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","5","y1","12","x2","19","y2","12"],["points","12 5 19 12 12 19"],[1,"category-badge"],[1,"concept-name"],[1,"skeleton","skeleton-badge"],[1,"skeleton","skeleton-title"],["type","button",1,"retry-button",3,"click"],[1,"skeleton","skeleton-text"],[1,"skeleton","skeleton-text","short"],[1,"definition"],[1,"extended-section"],[1,"related-section"],[1,"section-title"],[1,"extended-text",3,"innerHTML"],[1,"related-chips"],["type","button",1,"related-chip"],["type","button",1,"related-chip",3,"click"]],template:function(e,n){e&1&&f(0,Nl,20,4),e&2&&C(n.isOpen()?0:-1)},dependencies:[ae],styles:[".panel-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:40}.concept-panel[_ngcontent-%COMP%]{position:fixed;top:0;right:0;height:100vh;width:320px;max-width:90vw;background:#0a0a0a;border-left:1px solid #262626;display:flex;flex-direction:column;z-index:50;animation:_ngcontent-%COMP%_slideIn .2s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%)}to{transform:translate(0)}}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;padding:1rem;border-bottom:1px solid #262626}.header-content[_ngcontent-%COMP%]{flex:1;min-width:0}.category-badge[_ngcontent-%COMP%]{display:inline-block;padding:.125rem .5rem;font-size:.75rem;font-weight:500;border-radius:9999px;background:#1a1a1a;color:#a3a3a3;margin-bottom:.5rem}.category-badge.finance[_ngcontent-%COMP%]{background:#10b98120;color:#10b981}.category-badge.marketing[_ngcontent-%COMP%]{background:#f59e0b20;color:#f59e0b}.category-badge.technology[_ngcontent-%COMP%]{background:#3b82f620;color:#3b82f6}.category-badge.operations[_ngcontent-%COMP%]{background:#8b5cf620;color:#8b5cf6}.category-badge.legal[_ngcontent-%COMP%]{background:#6b728020;color:#6b7280}.category-badge.creative[_ngcontent-%COMP%]{background:#ec489920;color:#ec4899}.concept-name[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#f5f5f5;margin:0;line-height:1.4}.close-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:transparent;border:none;color:#737373;cursor:pointer;border-radius:.375rem;transition:all .15s ease;flex-shrink:0;margin-left:.5rem}.close-button[_ngcontent-%COMP%]:hover{background:#262626;color:#e5e5e5}.panel-content[_ngcontent-%COMP%]{flex:1;padding:1rem;overflow-y:auto}.definition[_ngcontent-%COMP%]{color:#d4d4d4;line-height:1.6;margin:0 0 1.5rem}.extended-section[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1rem;border-top:1px solid #262626}.extended-text[_ngcontent-%COMP%]{color:#b0b0b0;font-size:.875rem;line-height:1.7}.extended-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:10px 0}.extended-text[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .extended-text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .extended-text[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#e0e0e0;margin:16px 0 8px}.extended-text[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .extended-text[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{padding-left:1.5em;margin:8px 0}.extended-text[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:4px 0}.extended-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#e5e5e5}.related-section[_ngcontent-%COMP%]{margin-top:1.5rem}.section-title[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#737373;margin:0 0 .75rem;text-transform:uppercase;letter-spacing:.05em}.related-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.related-chip[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.875rem;background:#1a1a1a;border:1px solid #333;color:#a3a3a3;border-radius:9999px;cursor:pointer;transition:all .15s ease}.related-chip[_ngcontent-%COMP%]:hover{background:#262626;border-color:#525252;color:#e5e5e5}.panel-footer[_ngcontent-%COMP%]{padding:1rem;border-top:1px solid #262626}.learn-more-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;width:100%;padding:.75rem;font-size:.875rem;font-weight:500;background:#262626;border:1px solid #333;color:#e5e5e5;border-radius:.5rem;cursor:pointer;transition:all .15s ease}.learn-more-button[_ngcontent-%COMP%]:hover:not(:disabled){background:#333;border-color:#525252}.learn-more-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.error-message[_ngcontent-%COMP%]{text-align:center;color:#ef4444;padding:2rem}.retry-button[_ngcontent-%COMP%]{margin-top:1rem;padding:.5rem 1rem;background:#262626;border:1px solid #333;color:#e5e5e5;border-radius:.375rem;cursor:pointer}.skeleton[_ngcontent-%COMP%]{background:linear-gradient(90deg,#1a1a1a 25%,#262626,#1a1a1a 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite;border-radius:.25rem}.skeleton-badge[_ngcontent-%COMP%]{width:80px;height:20px;margin-bottom:.5rem}.skeleton-title[_ngcontent-%COMP%]{width:180px;height:24px}.skeleton-text[_ngcontent-%COMP%]{width:100%;height:16px;margin-bottom:.75rem}.skeleton-text.short[_ngcontent-%COMP%]{width:75%}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:200% 0}to{background-position:-200% 0}}"],changeDetection:0})};var Rl=()=>[1,2,3];function Dl(o,t){return this.trackRow(t)}var Ll=(o,t)=>t.id;function zl(o,t){if(o&1){let e=P();h(0,"button",8),M("click",function(){x(e);let i=l();return b(i.clearSearch())}),S(),h(1,"svg",9),A(2,"path",10),_()()}}function Vl(o,t){o&1&&(h(0,"div",11),A(1,"div",12)(2,"div",13)(3,"div",14),_())}function Fl(o,t){o&1&&(h(0,"div",7),U(1,Vl,4,0,"div",11,on),_()),o&2&&(r(),G(Be(0,Rl)))}function Bl(o,t){if(o&1&&A(0,"span",30),o&2){let e=l(2).$implicit;R("completed",e.node.status==="completed")("pending",e.node.status==="pending"),Y("title",e.node.status==="completed"?"Zavr\u0161eno":"Na \u010Dekanju")}}function Wl(o,t){o&1&&A(0,"span",25)}function jl(o,t){if(o&1&&(h(0,"span",26),c(1),_()),o&2){let e=l(2).$implicit;Y("title",e.node.completedByUserId),r(),E(e.node.completedByUserId)}}function Hl(o,t){if(o&1&&(h(0,"span",27),c(1),_()),o&2){let e=l(2).$implicit;r(),E(e.node.conversationCount)}}function Ul(o,t){if(o&1){let e=P();h(0,"button",31),M("click",function(i){x(e);let a=l(2).$implicit,s=l(2);return b(s.onViewLinkedConversation(i,a.node.linkedConversationId))}),S(),h(1,"svg",32),A(2,"path",33)(3,"path",34),_()()}}function Gl(o,t){if(o&1){let e=P();h(0,"button",31),M("click",function(i){x(e);let a=l(2).$implicit,s=l(2);return b(s.onViewConversation(i,a.node))}),S(),h(1,"svg",32),A(2,"path",33)(3,"path",34),_()()}}function ql(o,t){if(o&1){let e=P();h(0,"button",35),M("click",function(i){x(e);let a=l(2).$implicit,s=l(2);return b(s.onNewChat(i,a.node.curriculumId,a.node.label))}),S(),h(1,"svg",32),A(2,"path",36),_()()}}function Yl(o,t){if(o&1){let e=P();h(0,"button",20),M("click",function(){x(e);let i=l().$implicit,a=l(2);return b(a.toggleNode(i.node.curriculumId))}),S(),h(1,"svg",21),M("click",function(i){x(e);let a=l().$implicit;return l(2).toggleNode(a.node.curriculumId),b(i.stopPropagation())}),A(2,"path",22),_(),f(3,Bl,1,5,"span",23),W(),h(4,"span",24),M("click",function(i){x(e);let a=l().$implicit,s=l(2);return b(s.onNodeClick(i,a.node))}),c(5),_(),f(6,Wl,1,0,"span",25),f(7,jl,2,2,"span",26),f(8,Hl,2,1,"span",27),f(9,Ul,4,0,"button",28)(10,Gl,4,0,"button",28),f(11,ql,3,0,"button",29),_()}if(o&2){let e=l().$implicit,n=l(2);K("padding-left",12+e.depth*16,"px"),R("root-node",e.depth===0),_e("aria-expanded",n.expandedNodes().has(e.node.curriculumId))("aria-label",e.node.label+(e.node.status==="completed"?" \u2014 zavr\u0161eno":e.node.status==="pending"?" \u2014 na \u010Dekanju":"")),r(),R("expanded",n.expandedNodes().has(e.node.curriculumId)),r(2),C(e.node.status?3:-1),r(2),E(e.node.label),r(),C(n.hasNewConversations(e.node.curriculumId)?6:-1),r(),C(e.node.completedByUserId?7:-1),r(),C(e.node.conversationCount>0?8:-1),r(),C(e.node.linkedConversationId?9:e.node.conversations.length>0?10:-1),r(2),C(e.node.conceptId?11:-1)}}function Kl(o,t){o&1&&A(0,"span",39)}function Ql(o,t){o&1&&A(0,"span",25)}function Xl(o,t){if(o&1){let e=P();h(0,"button",37),M("click",function(){x(e);let i=l().$implicit,a=l(2);return b(a.onConversationSelect(i.conversation.id))}),h(1,"div",38),f(2,Kl,1,0,"span",39)(3,Ql,1,0,"span",25),h(4,"div",40),c(5),_()(),h(6,"div",41),c(7),_()()}if(o&2){let e=l().$implicit,n=l(2);K("padding-left",12+e.depth*16,"px"),R("active",n.activeConversationId()===e.conversation.id)("tree-item-loading",n.loadingItemId()===e.conversation.id),r(2),C(n.loadingItemId()===e.conversation.id?2:n.newConversationIds().has(e.conversation.id)?3:-1),r(3),O(" ",e.conversation.title||"Bez naslova"," "),r(2),E(n.formatDate(e.conversation.updatedAt))}}function Zl(o,t){if(o&1&&(f(0,Yl,12,15,"button",18),f(1,Xl,8,9,"button",19)),o&2){let e=t.$implicit;C(e.type==="node"&&e.node?0:-1),r(),C(e.type==="conversation"&&e.conversation?1:-1)}}function Jl(o,t){if(o&1&&(h(0,"div",15),c(1),_()),o&2){let e=l(2);r(),O('Nema rezultata za "',e.searchQuery(),'"')}}function ec(o,t){if(o&1){let e=P();h(0,"button",45),M("click",function(){let i=x(e).$implicit,a=l(4);return b(a.onConversationSelect(i.id))}),h(1,"div",46),c(2),_(),h(3,"div",41),c(4),_()()}if(o&2){let e=t.$implicit,n=l(4);R("active",n.activeConversationId()===e.id),r(2),E(e.title||"Konverzacija bez naslova"),r(2),E(n.formatDate(e.updatedAt))}}function tc(o,t){if(o&1&&U(0,ec,5,4,"button",44,Ll),o&2){let e=l(3);G(e.treeData$().uncategorized)}}function nc(o,t){if(o&1){let e=P();h(0,"div",16)(1,"button",42),M("click",function(){x(e);let i=l(2);return b(i.toggleGeneral())}),S(),h(2,"svg",43),A(3,"path",22),_(),c(4," Op\u0161te "),W(),h(5,"span",27),c(6),_()(),f(7,tc,2,0),_()}if(o&2){let e=l(2);r(2),R("expanded",e.generalExpanded()),r(4),E(e.treeData$().uncategorized.length),r(),C(e.generalExpanded()?7:-1)}}function oc(o,t){o&1&&(h(0,"div",17)(1,"div",47),S(),h(2,"svg",48),A(3,"path",49),_()(),W(),h(4,"p",50),c(5,"Jo\u0161 nema konverzacija"),_(),h(6,"p",51),c(7," Zapo\u010Dnite novu konverzaciju iznad "),_()())}function ic(o,t){if(o&1&&(U(0,Zl,2,2,null,null,Dl,!0),f(2,Jl,2,1,"div",15),f(3,nc,8,4,"div",16),f(4,oc,8,0,"div",17)),o&2){let e=l();G(e.flatRows()),r(2),C(e.searchQuery()&&e.flatRows().length===0?2:-1),r(),C(!e.searchQuery()&&e.treeData$().uncategorized.length>0?3:-1),r(),C(!e.searchQuery()&&e.treeData$().tree.length===0&&e.treeData$().uncategorized.length===0?4:-1)}}var jt=class o{conversationService=ee(ut);activeConversationId=z(null);locked=z(!1);newConversationIds=z(new Set);loadingItemId=z(null);conversationSelected=Z();newChatRequested=Z();conceptSelected=Z();treeData$=v(null);isLoading$=v(!1);expandedNodes=v(new Set);generalExpanded=v(!0);flatRows=v([]);searchQuery=v("");searchTimeout=null;ngOnInit(){this.loadTree()}async loadTree(){this.isLoading$.set(!0);try{let t=await this.conversationService.getBrainTree();this.treeData$.set(t);let e=new Set;this.collectAllIds(t.tree,e),this.expandedNodes.set(e),this.rebuildFlatRows()}catch{}finally{this.isLoading$.set(!1)}}toggleNode(t){this.expandedNodes.update(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n}),this.rebuildFlatRows()}toggleGeneral(){this.generalExpanded.update(t=>!t)}onSearchInput(t){let e=t.target.value;this.searchQuery.set(e),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>this.rebuildFlatRows(),200)}clearSearch(){this.searchQuery.set(""),this.rebuildFlatRows()}onConversationSelect(t){this.conversationSelected.emit(t)}onNewChat(t,e,n){t.stopPropagation(),this.newChatRequested.emit({conceptId:e,conceptName:n})}onViewConversation(t,e){t.stopPropagation();let n=[...e.conversations].sort((i,a)=>new Date(a.updatedAt).getTime()-new Date(i.updatedAt).getTime());n[0]&&this.conversationSelected.emit(n[0].id)}onViewLinkedConversation(t,e){t.stopPropagation(),this.conversationSelected.emit(e)}onNodeClick(t,e){if(t.stopPropagation(),e.conceptId)this.conceptSelected.emit({conceptId:e.conceptId,curriculumId:e.curriculumId,conceptName:e.label,isFolder:!1,descendantConceptIds:[e.conceptId],descendantConversationIds:e.conversations.map(n=>n.id)}),this.expandedNodes().has(e.curriculumId)||this.toggleNode(e.curriculumId);else{let n=this.collectDescendantConceptIds(e),i=this.collectDescendantConversationIds(e);this.conceptSelected.emit({conceptId:null,curriculumId:e.curriculumId,conceptName:e.label,isFolder:!0,descendantConceptIds:n,descendantConversationIds:i}),this.expandedNodes().has(e.curriculumId)||this.toggleNode(e.curriculumId)}}collectDescendantConceptIds(t){let e=[];t.conceptId&&e.push(t.conceptId);for(let n of t.children)e.push(...this.collectDescendantConceptIds(n));return e}collectDescendantConversationIds(t){let e=[];for(let n of t.conversations)e.push(n.id);for(let n of t.children)e.push(...this.collectDescendantConversationIds(n));return e}hasNewConversations(t){let e=this.newConversationIds();if(e.size===0)return!1;let n=this.treeData$();return n?this.checkNodeForNew(n.tree,t,e):!1}checkNodeForNew(t,e,n){for(let i of t){if(i.curriculumId===e)return i.conversations.some(s=>n.has(s.id))||this.anyDescendantHasNew(i.children,n);if(this.checkNodeForNew(i.children,e,n))return!0}return!1}anyDescendantHasNew(t,e){for(let n of t)if(n.conversations.some(i=>e.has(i.id))||this.anyDescendantHasNew(n.children,e))return!0;return!1}trackRow(t){return t.type==="node"&&t.node?`node-${t.node.curriculumId}`:t.type==="conversation"&&t.conversation?`conv-${t.conversation.id}`:`${t.type}-${t.depth}`}formatDate(t){let e=new Date(t),i=new Date().getTime()-e.getTime(),a=Math.floor(i/6e4),s=Math.floor(i/36e5),m=Math.floor(i/864e5);return a<1?"Upravo":a<60?`pre ${a} min`:s<24?`pre ${s} \u010D`:m<7?`pre ${m} d`:e.toLocaleDateString("sr-Latn")}collectAllIds(t,e){for(let n of t)e.add(n.curriculumId),this.collectAllIds(n.children,e)}rebuildFlatRows(){let t=this.treeData$();if(!t){this.flatRows.set([]);return}let e=this.searchQuery().toLowerCase().trim();if(e){let n=[];this.searchTree(t.tree,e,n);for(let i of t.uncategorized)(i.title||"").toLowerCase().includes(e)&&n.push({type:"general-conv",depth:0,conversation:i});this.flatRows.set(n)}else{let n=[],i=this.expandedNodes();this.flattenTree(t.tree,0,n,i),this.flatRows.set(n)}}searchTree(t,e,n){for(let i of t){if(i.label.toLowerCase().includes(e)){n.push({type:"node",depth:0,node:i,curriculumId:i.curriculumId});for(let a of i.conversations)n.push({type:"conversation",depth:1,conversation:a,curriculumId:i.curriculumId})}else for(let a of i.conversations)(a.title||"").toLowerCase().includes(e)&&n.push({type:"conversation",depth:0,conversation:a,curriculumId:i.curriculumId});this.searchTree(i.children,e,n)}}flattenTree(t,e,n,i){for(let a of t)if(n.push({type:"node",depth:e,node:a,curriculumId:a.curriculumId}),i.has(a.curriculumId)){this.flattenTree(a.children,e+1,n,i);for(let s of a.conversations)n.push({type:"conversation",depth:e+1,conversation:s,curriculumId:a.curriculumId})}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=ie({type:o,selectors:[["app-concept-tree"]],inputs:{activeConversationId:[1,"activeConversationId"],locked:[1,"locked"],newConversationIds:[1,"newConversationIds"],loadingItemId:[1,"loadingItemId"]},outputs:{conversationSelected:"conversationSelected",newChatRequested:"newChatRequested",conceptSelected:"conceptSelected"},decls:9,vars:5,consts:[[1,"search-box"],[1,"search-wrapper"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"search-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["placeholder","Pretra\u017Ei koncepte...","role","searchbox","aria-label","Pretra\u017Ei koncepte",1,"search-input",3,"input","value"],["title","Obri\u0161i pretragu",1,"search-clear"],["role","tree","aria-label","Stablo koncepata",1,"tree-container"],[2,"padding","0 12px"],["title","Obri\u0161i pretragu",1,"search-clear",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[2,"padding","6px 0"],[1,"skeleton",2,"width","50%"],[1,"skeleton",2,"width","70%","margin-left","16px"],[1,"skeleton",2,"width","80%","margin-left","32px"],[1,"search-no-results"],[1,"general-section"],[1,"empty-state"],["role","treeitem",1,"tree-node",3,"root-node","padding-left"],[1,"conversation-item",3,"active","tree-item-loading","padding-left"],["role","treeitem",1,"tree-node",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"chevron",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"status-dot",3,"completed","pending","title"],[1,"node-label","clickable",3,"click"],[1,"new-badge"],[1,"attribution",3,"title"],[1,"node-count"],["title","Pogledaj",1,"view-btn"],["title","Istra\u017Ei",1,"add-btn"],[1,"status-dot",3,"title"],["title","Pogledaj",1,"view-btn",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","14px","height","14px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],["title","Istra\u017Ei",1,"add-btn",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"conversation-item",3,"click"],[2,"display","flex","align-items","center","gap","6px"],[1,"tree-item-spinner"],[1,"conv-title",2,"flex","1"],[1,"conv-meta"],[1,"general-header",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"chevron",2,"width","12px","height","12px"],[1,"general-item",3,"active"],[1,"general-item",3,"click"],[1,"conv-title"],[1,"empty-icon"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","24px","height","24px","color","#8B8B8B"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],[2,"font-size","13px","color","#8B8B8B"],[2,"font-size","11px","color","#8B8B8B","margin-top","4px"]],template:function(e,n){e&1&&(h(0,"div",0)(1,"div",1),S(),h(2,"svg",2),A(3,"path",3),_(),W(),h(4,"input",4),M("input",function(a){return n.onSearchInput(a)}),_()(),f(5,zl,3,0,"button",5),_(),h(6,"div",6),f(7,Fl,3,1,"div",7)(8,ic,5,3),_()),e&2&&(r(4),Y("value",n.searchQuery()),r(),C(n.searchQuery()?5:-1),r(),R("locked",n.locked()),r(),C(n.isLoading$()?7:n.treeData$()?8:-1))},dependencies:[ae],styles:["[_nghost-%COMP%]{display:block;flex:1;overflow-y:auto}.search-box[_ngcontent-%COMP%]{position:sticky;top:0;z-index:2;padding:8px;background:#0d0d0d;border-bottom:1px solid #2a2a2a;display:flex;align-items:center;gap:8px}.search-wrapper[_ngcontent-%COMP%]{position:relative;flex:1}.search-icon[_ngcontent-%COMP%]{position:absolute;left:8px;top:50%;transform:translateY(-50%);width:14px;height:14px;color:#707070;pointer-events:none}.search-input[_ngcontent-%COMP%]{width:100%;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:6px 8px 6px 28px;color:#fafafa;font-size:12px;font-family:inherit}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.search-input[_ngcontent-%COMP%]::placeholder{color:#707070}.search-clear[_ngcontent-%COMP%]{background:none;border:none;padding:2px;color:#707070;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}.search-clear[_ngcontent-%COMP%]:hover{color:#fafafa}.search-clear[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.search-no-results[_ngcontent-%COMP%]{padding:24px 12px;text-align:center;font-size:12px;color:#8b8b8b}.tree-container[_ngcontent-%COMP%]{padding:4px 0;transition:opacity .2s}.tree-container.locked[_ngcontent-%COMP%]{pointer-events:none;opacity:.5}.tree-node[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:5px 8px;cursor:pointer;font-size:12px;font-weight:500;color:#a1a1a1;border-radius:4px;margin:0 4px;background:none;border:none;width:calc(100% - 8px);text-align:left}.tree-node[_ngcontent-%COMP%]:hover{background:#1a1a1a;color:#fafafa}.tree-node.root-node[_ngcontent-%COMP%]{font-size:11px;font-weight:600;color:#8b8b8b;text-transform:uppercase;letter-spacing:.5px}.chevron[_ngcontent-%COMP%]{width:10px;height:10px;transition:transform .15s;flex-shrink:0}.chevron.expanded[_ngcontent-%COMP%]{transform:rotate(90deg)}.node-label[_ngcontent-%COMP%]{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.node-count[_ngcontent-%COMP%]{margin-left:auto;font-size:10px;color:#707070;flex-shrink:0}.add-btn[_ngcontent-%COMP%], .view-btn[_ngcontent-%COMP%]{width:16px;height:16px;color:#707070;opacity:0;transition:opacity .15s;cursor:pointer;flex-shrink:0;background:none;border:none;padding:0}.tree-node[_ngcontent-%COMP%]:hover   .add-btn[_ngcontent-%COMP%], .tree-node[_ngcontent-%COMP%]:hover   .view-btn[_ngcontent-%COMP%]{opacity:1}.add-btn[_ngcontent-%COMP%]:hover{color:#3b82f6}.view-btn[_ngcontent-%COMP%]:hover{color:#10b981}.conversation-item[_ngcontent-%COMP%]{display:block;width:calc(100% - 8px);padding:6px 12px;margin:0 4px 2px;border-radius:4px;cursor:pointer;background:none;border:none;text-align:left;color:inherit}.conversation-item[_ngcontent-%COMP%]:hover{background:#1a1a1a}.conversation-item.active[_ngcontent-%COMP%]{background:#1a1a1a;border-left:2px solid #3b82f6}.conv-title[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.conversation-item.active[_ngcontent-%COMP%]   .conv-title[_ngcontent-%COMP%]{color:#fafafa}.conv-meta[_ngcontent-%COMP%]{font-size:10px;color:#707070;margin-top:2px}.general-section[_ngcontent-%COMP%]{margin-top:4px;border-top:1px solid #2a2a2a;padding-top:4px}.general-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:6px 12px;cursor:pointer;font-size:11px;font-weight:600;color:#8b8b8b;text-transform:uppercase;letter-spacing:.5px;background:none;border:none;width:100%;text-align:left}.general-header[_ngcontent-%COMP%]:hover{color:#a1a1a1}.general-item[_ngcontent-%COMP%]{display:block;width:calc(100% - 8px);padding:6px 12px 6px 24px;margin:0 4px 2px;border-radius:4px;cursor:pointer;background:none;border:none;text-align:left;color:inherit}.general-item[_ngcontent-%COMP%]:hover{background:#1a1a1a}.general-item.active[_ngcontent-%COMP%]{background:#1a1a1a;border-left:2px solid #3b82f6}.general-item.active[_ngcontent-%COMP%]   .conv-title[_ngcontent-%COMP%]{color:#fafafa}.skeleton[_ngcontent-%COMP%]{background:linear-gradient(90deg,#1a1a1a 25%,#242424,#1a1a1a 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite;height:14px;border-radius:4px;margin-bottom:6px}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:200% 0}to{background-position:-200% 0}}.new-badge[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;background:#3b82f6;flex-shrink:0}.status-dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;flex-shrink:0}.status-dot.completed[_ngcontent-%COMP%]{background:#10b981}.status-dot.pending[_ngcontent-%COMP%]{background:#f59e0b}.attribution[_ngcontent-%COMP%]{font-size:9px;color:#8b8b8b;margin-left:4px;flex-shrink:0;max-width:60px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.node-label.clickable[_ngcontent-%COMP%]{cursor:pointer}.node-label.clickable[_ngcontent-%COMP%]:hover{color:#3b82f6}.tree-item-loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.tree-item-spinner[_ngcontent-%COMP%]{display:inline-block;width:12px;height:12px;border:2px solid #2a2a2a;border-top-color:#3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_shimmer-spin .8s linear infinite;flex-shrink:0}@keyframes _ngcontent-%COMP%_shimmer-spin{to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{padding:32px 12px;text-align:center}.empty-icon[_ngcontent-%COMP%]{width:48px;height:48px;margin:0 auto 12px;background:#1a1a1a;border-radius:50%;display:flex;align-items:center;justify-content:center}"],changeDetection:0})};var jo=(o,t)=>t.id;function ac(o,t){o&1&&(h(0,"div",0),A(1,"span",11),c(2," Generisanje plana... "),_())}function rc(o,t){o&1&&(h(0,"div",0),A(1,"span",11),c(2," Agenti rade... "),_())}function sc(o,t){if(o&1&&(h(0,"div",1),S(),h(1,"svg",12),A(2,"path",13),_(),W(),h(3,"span",14),c(4),_(),h(5,"span",15),c(6),_()()),o&2){let e=l();r(4),E(e.folderName()),r(2),we("",e.notes().length," zadatak",e.notes().length!==1?"a":"")}}function lc(o,t){if(o&1){let e=P();h(0,"div",4)(1,"span"),c(2),_(),h(3,"div",16)(4,"button",17),M("click",function(){x(e);let i=l();return b(i.deselectAll())}),c(5,"Poni\u0161ti izbor"),_(),h(6,"button",18),M("click",function(){x(e);let i=l();return b(i.onRunAgents())}),c(7," Pokreni agente "),_()()()}if(o&2){let e=l();r(2),we("",e.selectedTaskIds().size," zadatak",e.selectedTaskIds().size>1?"a":""," izabrano"),r(4),Y("disabled",e.isExecuting()||e.isGeneratingPlan())}}function cc(o,t){if(o&1){let e=P();h(0,"div",4)(1,"span"),c(2),_(),h(3,"button",17),M("click",function(){x(e);let i=l();return b(i.selectAllPending())}),c(4,"Izaberi sve"),_()()}if(o&2){let e=l();r(2),we("",e.pendingTaskCount()," zadatak",e.pendingTaskCount()>1?"a":""," na \u010Dekanju")}}function dc(o,t){o&1&&(h(0,"div",6),c(1,"U\u010Ditavanje bele\u0161ki..."),_())}function pc(o,t){o&1&&(h(0,"div",7)(1,"p"),c(2,"Jo\u0161 nema bele\u0161ki"),_(),h(3,"p",19),c(4," Bele\u0161ke i zadaci \u0107e se pojaviti ovde tokom razgovora "),_()())}function uc(o,t){if(o&1){let e=P();h(0,"input",31),M("change",function(i){x(e);let a=l().$implicit;return l(2).toggleSelection(a.id),b(i.stopPropagation())})("click",function(i){return x(e),b(i.stopPropagation())}),_()}if(o&2){let e=l().$implicit,n=l(2);Y("checked",n.selectedTaskIds().has(e.id))}}function mc(o,t){if(o&1&&(h(0,"span",32),c(1),_()),o&2){let e=l().$implicit;R("score-high",e.aiScore>=80)("score-medium",e.aiScore>=50&&e.aiScore<80)("score-low",e.aiScore<50),r(),O("",e.aiScore,"/100")}}function hc(o,t){o&1&&A(0,"span",29)}function gc(o,t){o&1&&(S(),h(0,"svg",30),A(1,"path",33),_())}function _c(o,t){if(o&1&&(h(0,"div",34)(1,"span",47),A(2,"span",48),h(3,"span",49),c(4,"Kreiran"),_()(),A(5,"span",50),h(6,"span",47),A(7,"span",48),h(8,"span",51),c(9,"Izvr\u0161ava se"),_()(),A(10,"span",50),h(11,"span",47),A(12,"span",48),h(13,"span",51),c(14,"Pregled"),_()(),A(15,"span",50),h(16,"span",47),A(17,"span",48),h(18,"span",51),c(19,"Ocenjen"),_()()()),o&2){let e=l(2).$implicit,n=l(2);r(2),R("done",!0),r(3),R("done",e.status==="COMPLETED"||n.executingTaskId()===e.id),r(2),R("active",n.executingTaskId()===e.id)("done",e.status==="COMPLETED"),r(),R("active",n.executingTaskId()===e.id)("done",e.status==="COMPLETED"),r(2),R("done",e.userReport!==void 0&&e.userReport!==null),r(2),R("active",e.status==="COMPLETED"&&!e.aiScore)("done",e.aiScore!==null&&e.aiScore!==void 0),r(),R("active",e.status==="COMPLETED"&&!e.aiScore)("done",e.aiScore!==null&&e.aiScore!==void 0),r(2),R("done",e.aiScore!==null&&e.aiScore!==void 0),r(2),R("done",e.aiScore!==null&&e.aiScore!==void 0),r(),R("done",e.aiScore!==null&&e.aiScore!==void 0)}}function fc(o,t){if(o&1&&(h(0,"div",36),c(1),_()),o&2){let e=l(2).$implicit;r(),E(e.content)}}function Cc(o,t){if(o&1&&(h(0,"div",37)(1,"div",52),c(2,"O\u010Dekivani ishod"),_(),c(3),_()),o&2){let e=l(2).$implicit;r(3),O(" ",e.expectedOutcome," ")}}function xc(o,t){o&1&&(A(0,"span",54),c(1," AI radi... "))}function bc(o,t){o&1&&(S(),h(0,"svg",55),A(1,"path",56)(2,"path",57),_(),c(3," Izvr\u0161i "))}function vc(o,t){if(o&1){let e=P();h(0,"button",53),M("click",function(){x(e);let i=l(2).$implicit,a=l(2);return b(a.onExecuteTask(i.id))}),f(1,xc,2,0)(2,bc,4,0),_()}if(o&2){let e=l(2).$implicit,n=l(2);Y("disabled",n.executingTaskId()===e.id||n.isExecuting()),r(),C(n.executingTaskId()===e.id?1:2)}}function kc(o,t){if(o&1&&(h(0,"div",39)(1,"div",58),A(2,"span",59),c(3," AI radi na zadatku... "),_(),h(4,"div",60),c(5),_()()),o&2){let e=l(4);r(5),E(e.taskExecutionContent())}}function yc(o,t){o&1&&(A(0,"span",62),c(1," Ocenjujem... "))}function wc(o,t){o&1&&(S(),h(0,"svg",55),A(1,"path",63),_(),c(2," Potvrdi rezultat "))}function Sc(o,t){if(o&1){let e=P();h(0,"button",61),M("click",function(){x(e);let i=l(2).$implicit,a=l(2);return b(a.onSubmitTaskResult(i.id))}),f(1,yc,2,0)(2,wc,3,0),_()}if(o&2){let e=l(2).$implicit,n=l(2);Y("disabled",n.submittingResultId()===e.id),r(),C(n.submittingResultId()===e.id?1:2)}}function Pc(o,t){if(o&1&&(h(0,"div",41)(1,"div",64),A(2,"span",62),c(3," Optimizujem i ocenjujem... "),_(),h(4,"div",65),c(5),_()()),o&2){let e=l(4);r(5),E(e.taskResultContent())}}function Ec(o,t){if(o&1){let e=P();h(0,"button",66),M("click",function(){x(e);let i=l(2).$implicit,a=l(2);return b(a.emitViewMessage(i))}),c(1," Pogledaj u razgovoru "),_()}}function Tc(o,t){if(o&1&&(h(0,"span",69),c(1),_()),o&2){let e=l().$implicit;r(),E(e.workflowStepNumber)}}function Mc(o,t){o&1&&(S(),h(0,"svg",70),A(1,"path",73),_())}function Ic(o,t){if(o&1){let e=P();h(0,"div",75)(1,"div",76),c(2,"Va\u0161 izve\u0161taj"),_(),h(3,"textarea",77),M("input",function(i){x(e);let a=l(2).$implicit,s=l(5);return b(s.setReportText(a.id,s.asTextareaValue(i)))}),_(),h(4,"div",78)(5,"button",79),M("click",function(){x(e);let i=l(2).$implicit,a=l(5);return b(a.onGenerateReport(i.id))}),c(6),_(),h(7,"button",80),M("click",function(){x(e);let i=l(2).$implicit,a=l(5);return b(a.submitReport(i.id))}),c(8),_()()()}if(o&2){let e=l(2).$implicit,n=l(5);r(3),Y("value",n.getReportText(e.id)),r(2),Y("disabled",n.generatingReportId()===e.id),r(),O(" ",n.generatingReportId()===e.id?"AI generi\u0161e...":"AI popuni"," "),r(),Y("disabled",!n.getReportText(e.id)||n.submittingInProgress().has(e.id)),r(),O(" ",n.submittingInProgress().has(e.id)?"\u0160aljem...":"Po\u0161alji izve\u0161taj"," ")}}function Oc(o,t){if(o&1&&(h(0,"div",87),c(1),_()),o&2){let e=l(4).$implicit;r(),E(e.aiFeedback)}}function $c(o,t){if(o&1&&(h(0,"div",82)(1,"div",83)(2,"div",84),A(3,"div",85),_(),h(4,"span",86),c(5),_()(),f(6,Oc,2,1,"div",87),_()),o&2){let e=l(3).$implicit;r(3),K("width",e.aiScore,"%"),R("high",e.aiScore>=80)("medium",e.aiScore>=50&&e.aiScore<80)("low",e.aiScore<50),r(),R("high",e.aiScore>=80)("medium",e.aiScore>=50&&e.aiScore<80)("low",e.aiScore<50),r(),E(e.aiScore),r(),C(e.aiFeedback?6:-1)}}function Ac(o,t){o&1&&(A(0,"span",89),c(1," Ocenjujem... "))}function Nc(o,t){o&1&&c(0," Dobij AI ocenu ")}function Rc(o,t){if(o&1){let e=P();h(0,"div",78)(1,"button",88),M("click",function(){x(e);let i=l(3).$implicit,a=l(5);return b(a.scoreReport(i.id))}),f(2,Ac,2,0)(3,Nc,1,0),_()()}if(o&2){let e=l(3).$implicit,n=l(5);r(),Y("disabled",n.scoringInProgress().has(e.id)),r(),C(n.scoringInProgress().has(e.id)?2:3)}}function Dc(o,t){if(o&1&&(h(0,"div",75)(1,"div",76),c(2,"Va\u0161 izve\u0161taj"),_(),h(3,"div",81),c(4),_(),f(5,$c,7,16,"div",82)(6,Rc,4,2,"div",78),_()),o&2){let e=l(2).$implicit;r(4),E(e.userReport),r(),C(e.aiScore!==null&&e.aiScore!==void 0?5:6)}}function Lc(o,t){if(o&1&&(h(0,"div",74),c(1),_(),f(2,Ic,9,5,"div",75),f(3,Dc,7,2,"div",75)),o&2){let e=l().$implicit;r(),E(e.content),r(),C(e.status==="COMPLETED"&&!e.userReport?2:-1),r(),C(e.userReport?3:-1)}}function zc(o,t){if(o&1){let e=P();h(0,"div")(1,"div",68),M("click",function(){let i=x(e).$implicit,a=l(5);return b(a.toggleSubtaskExpand(i.id))}),f(2,Tc,2,1,"span",69),f(3,Mc,2,0,":svg:svg",70),h(4,"span",71),c(5),_(),S(),h(6,"svg",72),A(7,"path",27),_()(),f(8,Lc,4,3),_()}if(o&2){let e=t.$implicit,n=l(5);r(2),C(e.workflowStepNumber!==null?2:-1),r(),C(e.status==="COMPLETED"?3:-1),r(2),E(e.title),r(),R("expanded",n.expandedSubtasks().has(e.id)),r(2),C(n.expandedSubtasks().has(e.id)?8:-1)}}function Vc(o,t){if(o&1&&(h(0,"div",44)(1,"div",67),c(2),_(),U(3,zc,9,6,"div",null,jo),_()),o&2){let e=l(2).$implicit;r(2),O(" Rezultat workflow-a (",e.children.length," koraka) "),r(),G(e.children)}}function Fc(o,t){if(o&1){let e=P();h(0,"div",45)(1,"div",76),c(2,"Va\u0161 izve\u0161taj"),_(),h(3,"textarea",77),M("input",function(i){x(e);let a=l(2).$implicit,s=l(2);return b(s.setReportText(a.id,s.asTextareaValue(i)))}),_(),h(4,"div",78)(5,"button",79),M("click",function(){x(e);let i=l(2).$implicit,a=l(2);return b(a.onGenerateReport(i.id))}),c(6),_(),h(7,"button",80),M("click",function(){x(e);let i=l(2).$implicit,a=l(2);return b(a.submitReport(i.id))}),c(8),_()()()}if(o&2){let e=l(2).$implicit,n=l(2);r(3),Y("value",n.getReportText(e.id)),r(2),Y("disabled",n.generatingReportId()===e.id),r(),O(" ",n.generatingReportId()===e.id?"AI generi\u0161e...":"AI popuni"," "),r(),Y("disabled",!n.getReportText(e.id)||n.submittingInProgress().has(e.id)),r(),O(" ",n.submittingInProgress().has(e.id)?"\u0160aljem...":"Po\u0161alji izve\u0161taj"," ")}}function Bc(o,t){if(o&1&&(h(0,"div",87),c(1),_()),o&2){let e=l(4).$implicit;r(),E(e.aiFeedback)}}function Wc(o,t){if(o&1&&(h(0,"div",90)(1,"div",83)(2,"div",84),A(3,"div",85),_(),h(4,"span",86),c(5),_()(),f(6,Bc,2,1,"div",87),_()),o&2){let e=l(3).$implicit;r(3),K("width",e.aiScore,"%"),R("high",e.aiScore>=80)("medium",e.aiScore>=50&&e.aiScore<80)("low",e.aiScore<50),r(),R("high",e.aiScore>=80)("medium",e.aiScore>=50&&e.aiScore<80)("low",e.aiScore<50),r(),E(e.aiScore),r(),C(e.aiFeedback?6:-1)}}function jc(o,t){o&1&&(A(0,"span",89),c(1," Ocenjujem... "))}function Hc(o,t){o&1&&c(0," Dobij AI ocenu ")}function Uc(o,t){if(o&1){let e=P();h(0,"div",78)(1,"button",88),M("click",function(){x(e);let i=l(3).$implicit,a=l(2);return b(a.scoreReport(i.id))}),f(2,jc,2,0)(3,Hc,1,0),_()()}if(o&2){let e=l(3).$implicit,n=l(2);r(),Y("disabled",n.scoringInProgress().has(e.id)),r(),C(n.scoringInProgress().has(e.id)?2:3)}}function Gc(o,t){if(o&1&&(h(0,"div",45)(1,"div",76),c(2,"Va\u0161 izve\u0161taj"),_(),h(3,"div",81),c(4),_(),f(5,Wc,7,16,"div",90)(6,Uc,4,2,"div",78),_()),o&2){let e=l(2).$implicit;r(4),E(e.userReport),r(),C(e.aiScore!==null&&e.aiScore!==void 0?5:6)}}function qc(o,t){if(o&1&&c(0),o&2){let e=l(3).$implicit,n=l(2);O(" (",n.getCommentTotal(e.id),") ")}}function Yc(o,t){o&1&&(h(0,"div",94),c(1," U\u010Ditavanje komentara... "),_())}function Kc(o,t){if(o&1&&(h(0,"span",102),c(1),_()),o&2){let e=l().$implicit;r(),E(e.userRole)}}function Qc(o,t){o&1&&(h(0,"span",104),c(1,"(izmenjeno)"),_())}function Xc(o,t){if(o&1){let e=P();h(0,"textarea",105),M("input",function(i){x(e);let a=l(8);return b(a.editCommentText.set(a.asTextareaValue(i)))}),_(),h(1,"div",106)(2,"button",107),M("click",function(){x(e);let i=l(8);return b(i.cancelEditComment())}),c(3," Otka\u017Ei "),_(),h(4,"button",108),M("click",function(){x(e);let i=l(6).$implicit,a=l(2);return b(a.saveEditComment(i.id))}),c(5," Sa\u010Duvaj "),_()()}if(o&2){let e=l(8);Y("value",e.editCommentText()),r(4),Y("disabled",!e.editCommentText())}}function Zc(o,t){if(o&1){let e=P();h(0,"div",109),c(1),_(),h(2,"div",110)(3,"button",111),M("click",function(){x(e);let i=l().$implicit,a=l(7);return b(a.startEditComment(i))}),c(4," Izmeni "),_(),h(5,"button",112),M("click",function(){x(e);let i=l().$implicit,a=l(5).$implicit,s=l(2);return b(s.deleteComment(a.id,i.id))}),c(6," Obri\u0161i "),_()()}if(o&2){let e=l().$implicit;r(),E(e.content)}}function Jc(o,t){if(o&1&&(h(0,"div",98)(1,"div",100)(2,"span",101),c(3),_(),f(4,Kc,2,1,"span",102),h(5,"span",103),c(6),_(),f(7,Qc,2,0,"span",104),_(),f(8,Xc,6,2)(9,Zc,7,1),_()),o&2){let e=t.$implicit,n=l(7);r(3),E(e.userName),r(),C(e.userRole!=="MEMBER"?4:-1),r(2),E(n.formatDate(e.createdAt)),r(),C(e.updatedAt!==e.createdAt?7:-1),r(),C(n.editingCommentId()===e.id?8:9)}}function ed(o,t){if(o&1){let e=P();h(0,"button",113),M("click",function(){x(e);let i=l(5).$implicit,a=l(2);return b(a.loadMoreComments(i.id))}),c(1," U\u010Ditaj jo\u0161... "),_()}}function td(o,t){if(o&1&&(U(0,Jc,10,5,"div",98,jo),f(2,ed,2,0,"button",99)),o&2){let e=l(4).$implicit,n=l(2);G(n.getComments(e.id)),r(2),C(n.hasMoreComments(e.id)?2:-1)}}function nd(o,t){if(o&1){let e=P();f(0,Yc,2,0,"div",94)(1,td,3,1),h(2,"div",95)(3,"input",96),M("input",function(i){x(e);let a=l(3).$implicit,s=l(2);return b(s.setCommentInput(a.id,s.asInputValue(i)))})("keydown.enter",function(){x(e);let i=l(3).$implicit,a=l(2);return b(a.submitComment(i.id))}),_(),h(4,"button",97),M("click",function(){x(e);let i=l(3).$implicit,a=l(2);return b(a.submitComment(i.id))}),c(5," Po\u0161alji "),_()()}if(o&2){let e=l(3).$implicit,n=l(2);C(n.loadingComments().has(e.id)?0:1),r(3),Y("value",n.getCommentInput(e.id)),r(),Y("disabled",!n.getCommentInput(e.id)||n.submittingComment().has(e.id))}}function od(o,t){if(o&1){let e=P();h(0,"div",46)(1,"div",91),M("click",function(){x(e);let i=l(2).$implicit,a=l(2);return b(a.toggleComments(i.id))}),h(2,"span",92),c(3," Komentari "),f(4,qc,1,1),_(),h(5,"button",93),c(6),_()(),f(7,nd,6,3),_()}if(o&2){let e=l(2).$implicit,n=l(2);r(4),C(n.getCommentTotal(e.id)>0?4:-1),r(2),O(" ",n.commentsExpanded().has(e.id)?"Sakrij":"Prika\u017Ei"," "),r(),C(n.commentsExpanded().has(e.id)?7:-1)}}function id(o,t){if(o&1&&(f(0,_c,20,28,"div",34),h(1,"div",35),f(2,fc,2,1,"div",36),f(3,Cc,4,1,"div",37),f(4,vc,3,2,"button",38),f(5,kc,6,1,"div",39),f(6,Sc,3,2,"button",40),f(7,Pc,6,1,"div",41),h(8,"div",42)(9,"span"),c(10),_(),h(11,"span"),c(12),_(),f(13,Ec,2,0,"button",43),_(),f(14,Vc,5,1,"div",44),f(15,Fc,9,5,"div",45),f(16,Gc,7,2,"div",45),f(17,od,8,3,"div",46),_()),o&2){let e=l().$implicit,n=l(2);C(e.noteType==="TASK"?0:-1),r(2),C(e.content?2:-1),r(),C(e.expectedOutcome?3:-1),r(),C(e.noteType==="TASK"&&e.status!=="COMPLETED"?4:-1),r(),C(n.executingTaskId()===e.id&&n.taskExecutionContent()?5:-1),r(),C(e.noteType==="TASK"&&e.status==="COMPLETED"&&e.aiScore===null?6:-1),r(),C(n.submittingResultId()===e.id&&n.taskResultContent()?7:-1),r(3),E(e.source),r(2),E(n.formatDate(e.createdAt)),r(),C(e.messageId?13:-1),r(),C(e.children&&e.children.length>0?14:-1),r(),C(e.noteType==="TASK"&&e.status==="COMPLETED"&&!e.userReport?15:-1),r(),C(e.userReport?16:-1),r(),C(e.noteType==="TASK"?17:-1)}}function ad(o,t){if(o&1){let e=P();h(0,"div",20)(1,"div",21),M("click",function(){let i=x(e).$implicit,a=l(2);return b(a.toggleExpand(i.id))}),f(2,uc,1,1,"input",22),h(3,"span",23),c(4),_(),h(5,"span",24),c(6),_(),f(7,mc,2,7,"span",25),S(),h(8,"svg",26),A(9,"path",27),_(),W(),h(10,"button",28),M("click",function(i){let a=x(e).$implicit;return l(2).deleteNote(a.id),b(i.stopPropagation())}),f(11,hc,1,0,"span",29)(12,gc,2,0,":svg:svg",30),_()(),f(13,id,18,14),_()}if(o&2){let e=t.$implicit,n=l(2);r(2),C(e.noteType==="TASK"&&e.status!=="COMPLETED"?2:-1),r(),R("badge-task",e.noteType==="TASK")("badge-note",e.noteType==="NOTE")("badge-summary",e.noteType==="SUMMARY")("badge-review",e.status==="READY_FOR_REVIEW"),r(),E(e.status==="READY_FOR_REVIEW"?"REVIEW":e.noteType),r(),R("completed",e.status==="COMPLETED"),r(),O(" ",e.title," "),r(),C(e.aiScore!==null&&e.aiScore!==void 0?7:-1),r(),R("expanded",n.expandedNotes().has(e.id)),r(2),Y("disabled",n.deletingInProgress().has(e.id)),r(),C(n.deletingInProgress().has(e.id)?11:12),r(2),C(n.expandedNotes().has(e.id)?13:-1)}}function rd(o,t){if(o&1&&U(0,ad,14,19,"div",20,jo),o&2){let e=l();G(e.filteredNotes())}}function sd(o,t){if(o&1){let e=P();h(0,"div",9)(1,"input",114),M("input",function(i){x(e);let a=l();return b(a.newTitle.set(a.asInputValue(i)))}),_(),h(2,"textarea",115),M("input",function(i){x(e);let a=l();return b(a.newContent.set(a.asTextareaValue(i)))}),_(),h(3,"div",116)(4,"button",117),M("click",function(){x(e);let i=l();return b(i.showAddForm.set(!1))}),c(5,"Otka\u017Ei"),_(),h(6,"button",80),M("click",function(){x(e);let i=l();return b(i.addNote())}),c(7),_()()()}if(o&2){let e=l();r(),Y("value",e.newTitle()),r(),Y("value",e.newContent()),r(4),Y("disabled",!e.newTitle()||e.addingNote$()),r(),O(" ",e.addingNote$()?"Dodajem...":"Dodaj bele\u0161ku"," ")}}function ld(o,t){if(o&1){let e=P();h(0,"button",118),M("click",function(){x(e);let i=l();return b(i.showAddForm.set(!0))}),c(1," + Dodaj bele\u0161ku "),_()}}var Ht=class o{notesApi=ee(Ct);conversationId=z(null);conceptId=z(null);isExecuting=z(!1);folderConceptIds=z([]);folderConversationIds=z([]);folderName=z(null);autoSelectTaskIds=z([]);executingTaskId=z(null);taskExecutionContent=z("");submittingResultId=z(null);taskResultContent=z("");isGeneratingPlan=z(!1);viewMessage=Z();runAgents=Z();executeTask=Z();submitTaskResult=Z();notes=v([]);loading=v(!1);activeFilter=v("all");showAddForm=v(!1);newTitle=v("");newContent=v("");selectedTaskIds=v(new Set);pendingTaskCount=v(0);filteredNotes=v([]);expandedNotes=v(new Set);expandedSubtasks=v(new Set);reportTexts=v(new Map);scoringInProgress=v(new Set);deletingInProgress=v(new Set);submittingInProgress=v(new Set);generatingReportId=v(null);addingNote$=v(!1);togglingStatus=v(new Set);commentsExpanded=v(new Set);commentsByTask=v(new Map);commentInputs=v(new Map);loadingComments=v(new Set);submittingComment=v(new Set);editingCommentId=v(null);editCommentText=v("");isLoadingNotes=!1;pendingReload=!1;constructor(){tn(()=>{this.conversationId(),this.conceptId(),this.folderConceptIds(),this.folderConversationIds(),this.autoSelectTaskIds(),fi(()=>this.loadNotes())})}async loadNotes(){if(this.isLoadingNotes){this.pendingReload=!0;return}this.isLoadingNotes=!0;try{await this._loadNotesInternal()}finally{this.isLoadingNotes=!1,this.pendingReload&&(this.pendingReload=!1,this.loadNotes())}}async _loadNotesInternal(){let t=this.folderConceptIds(),e=this.folderConversationIds();if(t.length>0||e.length>0){this.loading.set(!0);try{let[a,s]=await Promise.all([t.length>0?this.notesApi.getByConceptIds(t):Promise.resolve([]),e.length>0?this.notesApi.getByConversationIds(e):Promise.resolve([])]),m=new Set,d=[];for(let y of[...a,...s])m.has(y.id)||(m.add(y.id),d.push(y));this.notes.set(d),this.updateFilteredNotes()}catch{this.notes.set([]),this.updateFilteredNotes()}finally{this.loading.set(!1)}return}let n=this.conversationId(),i=this.conceptId();if(!n&&!i){this.notes.set([]),this.updateFilteredNotes();return}this.loading.set(!0);try{let[a,s]=await Promise.all([n?this.notesApi.getByConversation(n):Promise.resolve([]),i?this.notesApi.getByConcept(i).catch(()=>[]):Promise.resolve([])]),m=new Set,d=[];for(let y of[...a,...s])m.has(y.id)||(m.add(y.id),d.push(y));this.notes.set(d),this.updateFilteredNotes(),this.applyAutoSelect()}catch{this.notes.set([]),this.updateFilteredNotes()}finally{this.loading.set(!1)}}applyAutoSelect(){let t=this.autoSelectTaskIds();t.length>0&&this.selectedTaskIds.set(new Set(t))}toggleExpand(t){this.expandedNotes.update(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})}toggleSubtaskExpand(t){this.expandedSubtasks.update(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})}getReportText(t){return this.reportTexts().get(t)??""}setReportText(t,e){this.reportTexts.update(n=>{let i=new Map(n);return i.set(t,e),i})}async submitReport(t){let e=this.getReportText(t);if(!(!e||this.submittingInProgress().has(t))){this.submittingInProgress.update(n=>{let i=new Set(n);return i.add(t),i});try{let n=await this.notesApi.submitReport(t,e);this.updateNoteInList(n),this.reportTexts.update(i=>{let a=new Map(i);return a.delete(t),a})}catch{}finally{this.submittingInProgress.update(n=>{let i=new Set(n);return i.delete(t),i})}}}async onGenerateReport(t){if(!this.generatingReportId()){this.generatingReportId.set(t);try{let e=await this.notesApi.generateReport(t);this.setReportText(t,e)}catch{}finally{this.generatingReportId.set(null)}}}async scoreReport(t){this.scoringInProgress.update(e=>{let n=new Set(e);return n.add(t),n});try{let e=await this.notesApi.scoreReport(t);this.updateNoteInList(e)}catch{}finally{this.scoringInProgress.update(e=>{let n=new Set(e);return n.delete(t),n})}}async toggleTaskStatus(t){if(this.togglingStatus().has(t.id))return;let e=t.status==="COMPLETED"?"PENDING":"COMPLETED";this.togglingStatus.update(n=>{let i=new Set(n);return i.add(t.id),i});try{await this.notesApi.updateStatus(t.id,e),this.notes.update(n=>n.map(i=>i.id===t.id?te(V({},i),{status:e}):i)),this.updateFilteredNotes()}catch{}finally{this.togglingStatus.update(n=>{let i=new Set(n);return i.delete(t.id),i})}}async deleteNote(t){if(!this.deletingInProgress().has(t)){this.deletingInProgress.update(e=>{let n=new Set(e);return n.add(t),n});try{await this.notesApi.deleteNote(t),this.notes.update(e=>e.filter(n=>n.id!==t)),this.updateFilteredNotes()}catch{}finally{this.deletingInProgress.update(e=>{let n=new Set(e);return n.delete(t),n})}}}async addNote(){let t=this.newTitle(),e=this.newContent();if(!(!t||this.addingNote$())){this.addingNote$.set(!0);try{let n=await this.notesApi.createNote({title:t,content:e,noteType:"NOTE",conversationId:this.conversationId()??void 0,conceptId:this.conceptId()??void 0});this.notes.update(i=>[n,...i]),this.updateFilteredNotes(),this.newTitle.set(""),this.newContent.set(""),this.showAddForm.set(!1)}catch{}finally{this.addingNote$.set(!1)}}}formatDate(t){let e=new Date(t),i=new Date().getTime()-e.getTime(),a=Math.floor(i/6e4),s=Math.floor(i/36e5),m=Math.floor(i/864e5);return a<1?"Upravo":a<60?`pre ${a} min`:s<24?`pre ${s}h`:m<7?`pre ${m}d`:e.toLocaleDateString("sr-Latn")}asInputValue(t){return t.target.value}asTextareaValue(t){return t.target.value}toggleSelection(t){this.selectedTaskIds.update(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})}selectAllPending(){let t=this.notes().filter(e=>e.noteType==="TASK"&&e.status!=="COMPLETED").map(e=>e.id);this.selectedTaskIds.set(new Set(t))}deselectAll(){this.selectedTaskIds.set(new Set)}onRunAgents(){let t=Array.from(this.selectedTaskIds());t.length>0&&(this.runAgents.emit(t),this.selectedTaskIds.set(new Set))}onExecuteTask(t){this.executeTask.emit(t)}onSubmitTaskResult(t){this.submitTaskResult.emit(t)}emitViewMessage(t){t.messageId&&t.conversationId&&this.viewMessage.emit({conversationId:t.conversationId,messageId:t.messageId})}updateFilteredNotes(){let t=this.activeFilter(),e=this.notes();t==="all"?this.filteredNotes.set(e):t==="READY_FOR_REVIEW"?this.filteredNotes.set(e.filter(n=>n.status==="READY_FOR_REVIEW")):this.filteredNotes.set(e.filter(n=>n.noteType===t)),this.pendingTaskCount.set(e.filter(n=>n.noteType==="TASK"&&n.status!=="COMPLETED").length)}updateNoteInList(t){this.notes.update(e=>e.map(n=>n.id===t.id?V(V({},n),t):n.children?te(V({},n),{children:n.children.map(i=>i.id===t.id?V(V({},i),t):i)}):n)),this.updateFilteredNotes()}toggleComments(t){let e=this.commentsExpanded(),n=new Set(e);n.has(t)?n.delete(t):(n.add(t),this.commentsByTask().has(t)||this.fetchComments(t,1)),this.commentsExpanded.set(n)}getCommentTotal(t){return this.commentsByTask().get(t)?.total??0}getComments(t){return this.commentsByTask().get(t)?.comments??[]}hasMoreComments(t){let e=this.commentsByTask().get(t);return e?e.comments.length<e.total:!1}getCommentInput(t){return this.commentInputs().get(t)??""}setCommentInput(t,e){this.commentInputs.update(n=>{let i=new Map(n);return i.set(t,e),i})}async fetchComments(t,e){this.loadingComments.update(n=>{let i=new Set(n);return i.add(t),i});try{let n=await this.notesApi.getComments(t,e,50);this.commentsByTask.update(i=>{let a=new Map(i),s=a.get(t);return s&&e>1?a.set(t,{comments:[...s.comments,...n.comments],total:n.total,page:e}):a.set(t,{comments:n.comments,total:n.total,page:e}),a})}catch{}finally{this.loadingComments.update(n=>{let i=new Set(n);return i.delete(t),i})}}loadMoreComments(t){let e=this.commentsByTask().get(t),n=e?e.page+1:1;this.fetchComments(t,n)}async submitComment(t){let e=this.getCommentInput(t);if(!(!e||this.submittingComment().has(t))){this.submittingComment.update(n=>{let i=new Set(n);return i.add(t),i});try{let n=await this.notesApi.createComment(t,e);this.commentsByTask.update(i=>{let a=new Map(i),s=a.get(t);return s?a.set(t,{comments:[...s.comments,n],total:s.total+1,page:s.page}):a.set(t,{comments:[n],total:1,page:1}),a}),this.setCommentInput(t,"")}catch{}finally{this.submittingComment.update(n=>{let i=new Set(n);return i.delete(t),i})}}}startEditComment(t){this.editingCommentId.set(t.id),this.editCommentText.set(t.content)}cancelEditComment(){this.editingCommentId.set(null),this.editCommentText.set("")}async saveEditComment(t){let e=this.editingCommentId(),n=this.editCommentText();if(!(!e||!n))try{let i=await this.notesApi.updateComment(e,n);this.commentsByTask.update(a=>{let s=new Map(a),m=s.get(t);return m&&s.set(t,te(V({},m),{comments:m.comments.map(d=>d.id===e?V(V({},d),i):d)})),s}),this.cancelEditComment()}catch{}}async deleteComment(t,e){try{await this.notesApi.deleteComment(e),this.commentsByTask.update(n=>{let i=new Map(n),a=i.get(t);return a&&i.set(t,te(V({},a),{comments:a.comments.filter(s=>s.id!==e),total:a.total-1})),i})}catch{}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=ie({type:o,selectors:[["app-conversation-notes"]],inputs:{conversationId:[1,"conversationId"],conceptId:[1,"conceptId"],isExecuting:[1,"isExecuting"],folderConceptIds:[1,"folderConceptIds"],folderConversationIds:[1,"folderConversationIds"],folderName:[1,"folderName"],autoSelectTaskIds:[1,"autoSelectTaskIds"],executingTaskId:[1,"executingTaskId"],taskExecutionContent:[1,"taskExecutionContent"],submittingResultId:[1,"submittingResultId"],taskResultContent:[1,"taskResultContent"],isGeneratingPlan:[1,"isGeneratingPlan"]},outputs:{viewMessage:"viewMessage",runAgents:"runAgents",executeTask:"executeTask",submitTaskResult:"submitTaskResult"},decls:21,vars:17,consts:[[1,"executing-bar"],[1,"folder-header"],["role","tablist","aria-label","Filter zadataka",1,"filter-bar"],["role","tab",1,"filter-btn",3,"click"],[1,"run-agents-bar"],[1,"notes-container"],[1,"loading-spinner"],[1,"empty-notes"],[1,"add-note-section"],[1,"add-note-form"],[1,"btn-secondary",2,"width","100%"],[1,"executing-spinner"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","18px","height","18px","color","#3B82F6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"],[1,"folder-title"],[1,"folder-count"],[1,"run-agents-actions"],[1,"select-link",3,"click"],[1,"run-agents-btn",3,"click","disabled"],[2,"font-size","11px","margin-top","4px"],[1,"task-card"],[1,"task-card-header",3,"click"],["type","checkbox","title","Izaberi za agente",1,"task-checkbox",3,"checked"],[1,"note-type-badge"],[1,"task-title"],[1,"score-badge",3,"score-high","score-medium","score-low"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"expand-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],["title","Obri\u0161i",1,"delete-btn",3,"click","disabled"],[1,"scoring-spinner",2,"width","12px","height","12px","border-top-color","#EF4444"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","14px","height","14px"],["type","checkbox","title","Izaberi za agente",1,"task-checkbox",3,"change","click","checked"],[1,"score-badge"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"lifecycle-stepper"],[1,"task-card-body"],[1,"task-description"],[1,"expected-outcome"],[1,"execute-btn",3,"disabled"],[1,"execution-progress"],[1,"submit-result-btn",3,"disabled"],[1,"result-progress"],[1,"task-meta"],[1,"view-in-chat-btn"],[1,"subtasks-section"],[1,"report-section"],[1,"comments-section"],[1,"step-marker"],[1,"step-dot"],[1,"step-label","done"],[1,"step-line"],[1,"step-label"],[1,"expected-outcome-label"],[1,"execute-btn",3,"click","disabled"],[1,"execute-spinner"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","12px","height","12px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"execution-progress-header"],[1,"execution-progress-spinner"],[1,"execution-progress-content"],[1,"submit-result-btn",3,"click","disabled"],[1,"submit-result-spinner"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"result-progress-header"],[1,"result-progress-content"],[1,"view-in-chat-btn",3,"click"],[1,"subtasks-label"],[1,"subtask-item",3,"click"],[1,"subtask-step-num"],["fill","currentColor","viewBox","0 0 20 20",1,"subtask-check"],[1,"subtask-title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"subtask-expand-icon"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"subtask-content"],[1,"report-section",2,"padding-left","32px"],[1,"report-label"],["placeholder","Opi\u0161ite \u0161ta ste uradili, \u0161ta ste nau\u010Dili, ostvarene rezultate...",1,"report-textarea",3,"input","value"],[1,"report-actions"],[1,"btn-ai-fill",3,"click","disabled"],[1,"btn-primary",3,"click","disabled"],[1,"existing-report"],[1,"score-section",2,"border","none","padding-top","8px"],[1,"score-bar-container"],[1,"score-bar-bg"],[1,"score-bar-fill"],[1,"score-number"],[1,"score-feedback"],[1,"btn-score",3,"click","disabled"],[1,"scoring-spinner"],[1,"score-section"],[1,"comments-header",3,"click"],[1,"comments-label"],[1,"comments-toggle"],[2,"font-size","11px","color","#8B8B8B","padding","4px 0"],[1,"comment-input-row"],["placeholder","Dodaj komentar...",1,"comment-input",3,"input","keydown.enter","value"],[1,"comment-send-btn",3,"click","disabled"],[1,"comment-item"],[1,"load-more-btn"],[1,"comment-meta"],[1,"comment-author"],[1,"comment-role"],[1,"comment-time"],[1,"comment-edited"],[1,"comment-edit-textarea",3,"input","value"],[1,"comment-edit-actions"],[1,"btn-secondary",2,"padding","3px 10px","font-size","10px",3,"click"],[1,"btn-primary",2,"padding","3px 10px","font-size","10px",3,"click","disabled"],[1,"comment-body"],[1,"comment-actions"],[1,"comment-action-btn",3,"click"],[1,"comment-action-btn","danger",3,"click"],[1,"load-more-btn",3,"click"],["placeholder","Naslov",1,"note-input",3,"input","value"],["placeholder","Sadr\u017Eaj...",1,"note-textarea",3,"input","value"],[1,"form-actions"],[1,"btn-secondary",3,"click"],[1,"btn-secondary",2,"width","100%",3,"click"]],template:function(e,n){e&1&&(f(0,ac,3,0,"div",0)(1,rc,3,0,"div",0),f(2,sc,7,3,"div",1),h(3,"div",2)(4,"button",3),M("click",function(){return n.activeFilter.set("all"),n.updateFilteredNotes()}),c(5," Sve "),_(),h(6,"button",3),M("click",function(){return n.activeFilter.set("TASK"),n.updateFilteredNotes()}),c(7," Zadaci "),_(),h(8,"button",3),M("click",function(){return n.activeFilter.set("READY_FOR_REVIEW"),n.updateFilteredNotes()}),c(9," Pregled "),_(),h(10,"button",3),M("click",function(){return n.activeFilter.set("NOTE"),n.updateFilteredNotes()}),c(11," Bele\u0161ke "),_()(),f(12,lc,8,3,"div",4)(13,cc,5,2,"div",4),h(14,"div",5),f(15,dc,2,0,"div",6)(16,pc,5,0,"div",7)(17,rd,2,0),_(),h(18,"div",8),f(19,sd,8,4,"div",9)(20,ld,2,0,"button",10),_()),e&2&&(C(n.isGeneratingPlan()?0:n.isExecuting()?1:-1),r(2),C(n.folderName()?2:-1),r(2),R("active",n.activeFilter()==="all"),_e("aria-selected",n.activeFilter()==="all"),r(2),R("active",n.activeFilter()==="TASK"),_e("aria-selected",n.activeFilter()==="TASK"),r(2),R("active",n.activeFilter()==="READY_FOR_REVIEW"),_e("aria-selected",n.activeFilter()==="READY_FOR_REVIEW"),r(2),R("active",n.activeFilter()==="NOTE"),_e("aria-selected",n.activeFilter()==="NOTE"),r(2),C(n.selectedTaskIds().size>0?12:n.pendingTaskCount()>0?13:-1),r(3),C(n.loading()?15:n.filteredNotes().length===0?16:17),r(4),C(n.showAddForm()?19:20))},dependencies:[ae,dn],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1;overflow:hidden}.notes-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:16px}.filter-bar[_ngcontent-%COMP%]{display:flex;gap:4px;padding:0 16px 12px;border-bottom:1px solid #2a2a2a}.filter-btn[_ngcontent-%COMP%]{padding:4px 12px;border-radius:12px;font-size:12px;background:none;border:1px solid #2a2a2a;color:#8b8b8b;cursor:pointer}.filter-btn[_ngcontent-%COMP%]:hover{color:#a1a1a1;border-color:#3b82f6}.filter-btn.active[_ngcontent-%COMP%]{background:#3b82f6;color:#fafafa;border-color:#3b82f6}.task-card[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:8px;margin-bottom:8px;border:1px solid #2a2a2a;overflow:hidden}.task-card[_ngcontent-%COMP%]:hover{border-color:#333}.task-card-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.task-checkbox[_ngcontent-%COMP%]{width:16px;height:16px;cursor:pointer;accent-color:#3b82f6;flex-shrink:0}.note-type-badge[_ngcontent-%COMP%]{font-size:10px;padding:2px 6px;border-radius:4px;text-transform:uppercase;font-weight:600;flex-shrink:0}.badge-task[_ngcontent-%COMP%]{background:#1e3a5f;color:#60a5fa}.badge-note[_ngcontent-%COMP%]{background:#1a2e1a;color:#86efac}.badge-summary[_ngcontent-%COMP%]{background:#2e1a2e;color:#c084fc}.badge-review[_ngcontent-%COMP%]{background:#3d2e0a;color:#f59e0b}.task-title[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:#fafafa;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.task-title.completed[_ngcontent-%COMP%]{text-decoration:line-through;color:#8b8b8b}.score-badge[_ngcontent-%COMP%]{font-size:11px;font-weight:600;padding:2px 8px;border-radius:10px;flex-shrink:0}.score-high[_ngcontent-%COMP%]{background:#22c55e26;color:#22c55e}.score-medium[_ngcontent-%COMP%]{background:#eab30826;color:#eab308}.score-low[_ngcontent-%COMP%]{background:#ef444426;color:#ef4444}.expand-icon[_ngcontent-%COMP%]{width:16px;height:16px;color:#8b8b8b;flex-shrink:0;transition:transform .2s}.expand-icon.expanded[_ngcontent-%COMP%]{transform:rotate(90deg)}.delete-btn[_ngcontent-%COMP%]{background:none;border:none;color:#707070;cursor:pointer;padding:2px;flex-shrink:0}.delete-btn[_ngcontent-%COMP%]:hover{color:#ef4444}.lifecycle-stepper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:10px 12px;border-top:1px solid #242424;font-size:10px;color:#707070}.step-marker[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.step-dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;background:#2a2a2a;flex-shrink:0}.step-dot.active[_ngcontent-%COMP%]{background:#3b82f6}.step-dot.done[_ngcontent-%COMP%]{background:#22c55e}.step-label[_ngcontent-%COMP%]{white-space:nowrap}.step-label.active[_ngcontent-%COMP%]{color:#3b82f6;font-weight:600}.step-label.done[_ngcontent-%COMP%]{color:#22c55e}.step-line[_ngcontent-%COMP%]{width:12px;height:1px;background:#2a2a2a;flex-shrink:0}.step-line.done[_ngcontent-%COMP%]{background:#22c55e}.task-card-body[_ngcontent-%COMP%]{padding:0 12px 12px}.task-description[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1;line-height:1.5;padding:10px 0;white-space:pre-wrap;word-break:break-word}.expected-outcome[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1;line-height:1.5;padding:8px;background:#0d0d0d;border-radius:6px;margin-bottom:10px}.expected-outcome-label[_ngcontent-%COMP%]{font-size:11px;font-weight:600;color:#8b8b8b;margin-bottom:4px;text-transform:uppercase}.task-meta[_ngcontent-%COMP%]{font-size:10px;color:#707070;display:flex;gap:8px;margin-bottom:10px}.subtasks-section[_ngcontent-%COMP%]{margin-top:8px}.subtasks-label[_ngcontent-%COMP%]{font-size:11px;font-weight:600;color:#8b8b8b;margin-bottom:6px;text-transform:uppercase}.subtask-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;padding:8px;background:#0d0d0d;border-radius:6px;margin-bottom:4px;cursor:pointer}.subtask-item[_ngcontent-%COMP%]:hover{background:#141414}.subtask-step-num[_ngcontent-%COMP%]{font-size:11px;font-weight:600;color:#3b82f6;background:#3b82f61a;padding:1px 6px;border-radius:4px;flex-shrink:0}.subtask-check[_ngcontent-%COMP%]{width:14px;height:14px;color:#22c55e;flex-shrink:0;margin-top:1px}.subtask-title[_ngcontent-%COMP%]{font-size:12px;color:#d4d4d4;flex:1}.subtask-expand-icon[_ngcontent-%COMP%]{width:12px;height:12px;color:#707070;flex-shrink:0;transition:transform .2s}.subtask-expand-icon.expanded[_ngcontent-%COMP%]{transform:rotate(90deg)}.subtask-content[_ngcontent-%COMP%]{font-size:11px;color:#a1a1a1;line-height:1.5;padding:8px 8px 8px 32px;white-space:pre-wrap;word-break:break-word;max-height:300px;overflow-y:auto}.report-section[_ngcontent-%COMP%]{margin-top:12px;padding-top:12px;border-top:1px solid #242424}.report-label[_ngcontent-%COMP%]{font-size:11px;font-weight:600;color:#8b8b8b;margin-bottom:6px;text-transform:uppercase}.report-textarea[_ngcontent-%COMP%]{width:100%;background:#0d0d0d;border:1px solid #2a2a2a;border-radius:6px;padding:8px 12px;color:#fafafa;font-size:12px;font-family:inherit;resize:vertical;min-height:60px;box-sizing:border-box}.report-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.report-textarea[_ngcontent-%COMP%]::placeholder{color:#707070}.report-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:8px;justify-content:flex-end}.existing-report[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1;line-height:1.5;padding:8px;background:#0d0d0d;border-radius:6px;white-space:pre-wrap}.score-section[_ngcontent-%COMP%]{margin-top:12px;padding-top:12px;border-top:1px solid #242424}.score-bar-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:8px}.score-bar-bg[_ngcontent-%COMP%]{flex:1;height:8px;background:#242424;border-radius:4px;overflow:hidden}.score-bar-fill[_ngcontent-%COMP%]{height:100%;border-radius:4px;transition:width .3s}.score-bar-fill.high[_ngcontent-%COMP%]{background:#22c55e}.score-bar-fill.medium[_ngcontent-%COMP%]{background:#eab308}.score-bar-fill.low[_ngcontent-%COMP%]{background:#ef4444}.score-number[_ngcontent-%COMP%]{font-size:18px;font-weight:700;flex-shrink:0}.score-number.high[_ngcontent-%COMP%]{color:#22c55e}.score-number.medium[_ngcontent-%COMP%]{color:#eab308}.score-number.low[_ngcontent-%COMP%]{color:#ef4444}.score-feedback[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1;line-height:1.5;padding:8px;background:#0d0d0d;border-radius:6px}.btn-primary[_ngcontent-%COMP%]{background:#3b82f6;color:#fafafa;border:none;border-radius:6px;padding:6px 16px;font-size:12px;cursor:pointer}.btn-primary[_ngcontent-%COMP%]:hover{background:#2563eb}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-ai-fill[_ngcontent-%COMP%]{background:none;color:#8b5cf6;border:1px solid #8b5cf633;border-radius:6px;padding:6px 16px;font-size:12px;cursor:pointer}.btn-ai-fill[_ngcontent-%COMP%]:hover{background:#8b5cf620;border-color:#8b5cf6}.btn-ai-fill[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background:none;color:#a1a1a1;border:1px solid #2a2a2a;border-radius:6px;padding:6px 16px;font-size:12px;cursor:pointer}.btn-secondary[_ngcontent-%COMP%]:hover{color:#fafafa;border-color:#707070}.btn-score[_ngcontent-%COMP%]{background:#eab3081a;color:#eab308;border:1px solid rgba(234,179,8,.3);border-radius:6px;padding:6px 16px;font-size:12px;cursor:pointer}.btn-score[_ngcontent-%COMP%]:hover{background:#eab30833}.btn-score[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.view-in-chat-btn[_ngcontent-%COMP%]{background:none;border:none;color:#3b82f6;cursor:pointer;font-size:10px;padding:0}.view-in-chat-btn[_ngcontent-%COMP%]:hover{text-decoration:underline}.empty-notes[_ngcontent-%COMP%]{text-align:center;padding:32px 16px}.empty-notes[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px;color:#8b8b8b}.add-note-section[_ngcontent-%COMP%]{border-top:1px solid #2a2a2a;padding:12px 16px}.add-note-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.note-input[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:8px 12px;color:#fafafa;font-size:13px;font-family:inherit}.note-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.note-input[_ngcontent-%COMP%]::placeholder{color:#707070}.note-textarea[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:8px 12px;color:#fafafa;font-size:13px;font-family:inherit;resize:vertical;min-height:60px}.note-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.note-textarea[_ngcontent-%COMP%]::placeholder{color:#707070}.form-actions[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:flex-end}.loading-spinner[_ngcontent-%COMP%]{text-align:center;padding:24px;color:#8b8b8b;font-size:13px}.run-agents-bar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;background:#1a1a1a;border-bottom:1px solid #2a2a2a}.run-agents-bar[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1}.run-agents-actions[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.run-agents-btn[_ngcontent-%COMP%]{background:#3b82f6;color:#fafafa;border:none;border-radius:6px;padding:6px 16px;font-size:12px;font-weight:500;cursor:pointer}.run-agents-btn[_ngcontent-%COMP%]:hover{background:#2563eb}.run-agents-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.select-link[_ngcontent-%COMP%]{background:none;border:none;color:#3b82f6;cursor:pointer;font-size:11px;padding:0}.select-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.executing-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 16px;background:#1a1a1a;border-bottom:1px solid #2a2a2a;font-size:12px;color:#60a5fa}.executing-spinner[_ngcontent-%COMP%]{width:14px;height:14px;border:2px solid #2a2a2a;border-top-color:#3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;flex-shrink:0}.scoring-spinner[_ngcontent-%COMP%]{display:inline-block;width:12px;height:12px;border:2px solid #2a2a2a;border-top-color:#eab308;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-right:6px;vertical-align:middle}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.comments-section[_ngcontent-%COMP%]{margin-top:12px;padding-top:12px;border-top:1px solid #242424}.comments-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;cursor:pointer;margin-bottom:8px}.comments-label[_ngcontent-%COMP%]{font-size:11px;font-weight:600;color:#8b8b8b;text-transform:uppercase}.comments-toggle[_ngcontent-%COMP%]{font-size:10px;color:#707070;background:none;border:none;cursor:pointer}.comments-toggle[_ngcontent-%COMP%]:hover{color:#a1a1a1}.comment-item[_ngcontent-%COMP%]{padding:8px;background:#0d0d0d;border-radius:6px;margin-bottom:4px}.comment-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;margin-bottom:4px}.comment-author[_ngcontent-%COMP%]{font-size:11px;font-weight:600;color:#d4d4d4}.comment-role[_ngcontent-%COMP%]{font-size:9px;padding:1px 4px;border-radius:3px;background:#3b82f61a;color:#60a5fa}.comment-time[_ngcontent-%COMP%]{font-size:10px;color:#707070;margin-left:auto}.comment-edited[_ngcontent-%COMP%]{font-size:10px;color:#707070;font-style:italic}.comment-body[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1;line-height:1.5;white-space:pre-wrap;word-break:break-word}.comment-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:4px}.comment-action-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:10px;color:#707070;cursor:pointer;padding:0}.comment-action-btn[_ngcontent-%COMP%]:hover{color:#a1a1a1}.comment-action-btn.danger[_ngcontent-%COMP%]:hover{color:#ef4444}.comment-edit-textarea[_ngcontent-%COMP%]{width:100%;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:4px;padding:6px 8px;color:#fafafa;font-size:12px;font-family:inherit;resize:vertical;min-height:40px;box-sizing:border-box}.comment-edit-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.comment-edit-actions[_ngcontent-%COMP%]{display:flex;gap:6px;margin-top:4px;justify-content:flex-end}.comment-input-row[_ngcontent-%COMP%]{display:flex;gap:6px;margin-top:8px}.comment-input[_ngcontent-%COMP%]{flex:1;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:6px;padding:6px 10px;color:#fafafa;font-size:12px;font-family:inherit}.comment-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.comment-input[_ngcontent-%COMP%]::placeholder{color:#707070}.comment-send-btn[_ngcontent-%COMP%]{background:#3b82f6;color:#fafafa;border:none;border-radius:6px;padding:6px 12px;font-size:11px;cursor:pointer;flex-shrink:0}.comment-send-btn[_ngcontent-%COMP%]:hover{background:#2563eb}.comment-send-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.load-more-btn[_ngcontent-%COMP%]{display:block;width:100%;background:none;border:none;color:#3b82f6;font-size:11px;cursor:pointer;padding:6px 0;text-align:center}.load-more-btn[_ngcontent-%COMP%]:hover{text-decoration:underline}.folder-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid #2a2a2a;background:#111}.folder-title[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:#fafafa;flex:1}.folder-count[_ngcontent-%COMP%]{font-size:12px;color:#8b8b8b}.execute-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;background:#3b82f61a;color:#60a5fa;border:1px solid rgba(59,130,246,.3);border-radius:6px;padding:5px 12px;font-size:11px;cursor:pointer;margin-top:8px}.execute-btn[_ngcontent-%COMP%]:hover{background:#3b82f633;border-color:#3b82f6}.execute-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.execute-spinner[_ngcontent-%COMP%]{display:inline-block;width:12px;height:12px;border:2px solid rgba(59,130,246,.3);border-top-color:#60a5fa;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.execution-progress[_ngcontent-%COMP%]{margin-top:10px;padding:10px 12px;background:#111;border:1px solid rgba(34,197,94,.2);border-radius:6px}.execution-progress-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:11px;font-weight:600;color:#4ade80;margin-bottom:8px}.execution-progress-spinner[_ngcontent-%COMP%]{display:inline-block;width:10px;height:10px;border:2px solid rgba(34,197,94,.3);border-top-color:#4ade80;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.execution-progress-content[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto;font-size:12px;color:#d1d5db;line-height:1.5;white-space:pre-wrap;word-break:break-word;padding:6px 8px;background:#0d0d0d;border-radius:4px}.execution-complete-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;background:#22c55e1a;border:1px solid rgba(34,197,94,.3);border-radius:4px;font-size:11px;color:#4ade80;margin-top:8px}.submit-result-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;background:#eab3081a;color:#eab308;border:1px solid rgba(234,179,8,.3);border-radius:6px;padding:5px 12px;font-size:11px;cursor:pointer;margin-top:8px}.submit-result-btn[_ngcontent-%COMP%]:hover{background:#eab30833;border-color:#eab308}.submit-result-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.submit-result-spinner[_ngcontent-%COMP%]{display:inline-block;width:12px;height:12px;border:2px solid rgba(234,179,8,.3);border-top-color:#eab308;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.result-progress[_ngcontent-%COMP%]{margin-top:10px;padding:10px 12px;background:#111;border:1px solid rgba(234,179,8,.2);border-radius:6px}.result-progress-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:11px;font-weight:600;color:#eab308;margin-bottom:8px}.result-progress-content[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto;font-size:12px;color:#d1d5db;line-height:1.5;white-space:pre-wrap;word-break:break-word;padding:6px 8px;background:#0d0d0d;border-radius:4px}"],changeDetection:0})};var cd=(o,t)=>t.id;function dd(o,t){o&1&&(h(0,"div",9),c(1,"U\u010Ditavanje tema..."),_())}function pd(o,t){if(o&1&&c(0),o&2){let e=l(2);O(' Nema rezultata za "',e.searchQuery(),'" ')}}function ud(o,t){o&1&&c(0," Ukucajte da pretra\u017Eite teme ")}function md(o,t){if(o&1&&(h(0,"div",10),f(1,pd,1,1)(2,ud,1,0),_()),o&2){let e=l();r(),C(e.searchQuery()?1:2)}}function hd(o,t){if(o&1&&(h(0,"div",17),c(1),_()),o&2){let e=l().$implicit,n=l(2);r(),E(n.getParentPath(e))}}function gd(o,t){if(o&1){let e=P();h(0,"button",15),M("click",function(){let i=x(e).$implicit,a=l(2);return b(a.selectTopic(i))}),h(1,"div",16),c(2),_(),f(3,hd,2,1,"div",17),_()}if(o&2){let e=t.$implicit,n=l(2);r(2),E(e.label),r(),C(n.getParentPath(e)?3:-1)}}function _d(o,t){if(o&1&&U(0,gd,4,2,"button",14,cd),o&2){let e=l();G(e.results())}}var Wn=class o{http=ee(Ee);apiUrl=`${Ye.apiUrl}/api/v1/knowledge/curriculum`;topicSelected=Z();cancelled=Z();searchQuery=v("");results=v([]);isLoading=v(!1);allNodes=[];searchTimeout=null;ngOnInit(){this.loadTopLevelNodes()}onSearchInput(t){let e=t.target.value;this.searchQuery.set(e),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.search(e)},200)}selectTopic(t){this.topicSelected.emit(t)}onOverlayClick(t){t.target.classList.contains("overlay")&&this.cancelled.emit()}getParentPath(t){if(!t.parentId)return"";let e=this.allNodes.find(i=>i.id===t.parentId);if(!e)return"";let n=e.parentId?this.allNodes.find(i=>i.id===e.parentId):null;return n?`${n.label} > ${e.label}`:e.label}async loadTopLevelNodes(){this.isLoading.set(!0);try{let t=await H(this.http.get(this.apiUrl));this.allNodes=t.data;let e=await H(this.http.get(`${this.apiUrl}/search`));this.results.set(e.data)}catch{this.results.set([])}finally{this.isLoading.set(!1)}}async search(t){if(!t){let e=this.allNodes.filter(n=>!n.parentId);this.results.set(e);return}try{let e=await H(this.http.get(`${this.apiUrl}/search?q=${encodeURIComponent(t)}`));this.results.set(e.data)}catch{this.results.set([])}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=ie({type:o,selectors:[["app-topic-picker"]],outputs:{topicSelected:"topicSelected",cancelled:"cancelled"},decls:18,vars:2,consts:[["role","dialog","aria-modal","true","aria-label","Izbor teme",1,"overlay",3,"click"],[1,"picker-panel",3,"click"],[1,"picker-header"],[1,"picker-title"],[1,"search-wrapper"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"search-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["placeholder","Pretra\u017Ei teme...","autofocus","","role","searchbox","aria-label","Pretra\u017Ei teme",1,"search-input",3,"input","value"],[1,"results-list"],[1,"loading-text"],[1,"empty-results"],[1,"picker-footer"],[1,"cancel-btn",3,"click"],[1,"skip-btn",3,"click"],[1,"result-item"],[1,"result-item",3,"click"],[1,"result-label"],[1,"result-path"]],template:function(e,n){e&1&&(h(0,"div",0),M("click",function(a){return n.onOverlayClick(a)}),h(1,"div",1),M("click",function(a){return a.stopPropagation()}),h(2,"div",2)(3,"div",3),c(4,"Izaberite temu za va\u0161u konverzaciju"),_(),h(5,"div",4),S(),h(6,"svg",5),A(7,"path",6),_(),W(),h(8,"input",7),M("input",function(a){return n.onSearchInput(a)}),_()()(),h(9,"div",8),f(10,dd,2,0,"div",9)(11,md,3,1,"div",10)(12,_d,2,0),_(),h(13,"div",11)(14,"button",12),M("click",function(){return n.cancelled.emit()}),c(15,"Otka\u017Ei"),_(),h(16,"button",13),M("click",function(){return n.topicSelected.emit(null)}),c(17," Presko\u010Di \u2014 Op\u0161ti razgovor "),_()()()()),e&2&&(r(8),Y("value",n.searchQuery()),r(2),C(n.isLoading()?10:n.results().length===0?11:12))},dependencies:[ae],styles:["[_nghost-%COMP%]{display:block}.overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:100;background:#0009;display:flex;align-items:center;justify-content:center}.picker-panel[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;width:480px;max-height:520px;display:flex;flex-direction:column;box-shadow:0 8px 32px #0006}.picker-header[_ngcontent-%COMP%]{padding:16px 20px 12px;border-bottom:1px solid #2a2a2a}.picker-title[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:#fafafa;margin-bottom:12px}.search-input[_ngcontent-%COMP%]{width:100%;background:#0d0d0d;border:1px solid #2a2a2a;border-radius:8px;padding:10px 12px 10px 36px;color:#fafafa;font-size:13px;font-family:inherit}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.search-input[_ngcontent-%COMP%]::placeholder{color:#707070}.search-wrapper[_ngcontent-%COMP%]{position:relative}.search-icon[_ngcontent-%COMP%]{position:absolute;left:10px;top:50%;transform:translateY(-50%);width:16px;height:16px;color:#707070}.results-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:8px}.result-item[_ngcontent-%COMP%]{display:block;width:100%;text-align:left;padding:10px 12px;border-radius:6px;background:none;border:none;color:inherit;cursor:pointer}.result-item[_ngcontent-%COMP%]:hover{background:#242424}.result-label[_ngcontent-%COMP%]{font-size:13px;color:#fafafa}.result-path[_ngcontent-%COMP%]{font-size:11px;color:#707070;margin-top:2px}.picker-footer[_ngcontent-%COMP%]{padding:12px 20px;border-top:1px solid #2a2a2a;display:flex;justify-content:space-between;align-items:center}.skip-btn[_ngcontent-%COMP%]{background:none;border:1px solid #2a2a2a;border-radius:6px;padding:8px 16px;color:#a1a1a1;font-size:13px;cursor:pointer}.skip-btn[_ngcontent-%COMP%]:hover{color:#fafafa;border-color:#707070}.cancel-btn[_ngcontent-%COMP%]{background:none;border:none;color:#8b8b8b;font-size:13px;cursor:pointer}.cancel-btn[_ngcontent-%COMP%]:hover{color:#fafafa}.empty-results[_ngcontent-%COMP%], .loading-text[_ngcontent-%COMP%]{text-align:center;padding:24px;color:#8b8b8b;font-size:13px}"],changeDetection:0})};var fd=["yoloLogContainer"],Cd=["messagesContainer"],jn=(o,t)=>t.id,xd=(o,t)=>t.stepId,bd=(o,t)=>t.planId,vd=(o,t)=>t.conceptName;function kd(o,t){if(o&1){let e=P();u(0,"div",21),S(),u(1,"svg",22),T(2,"path",23),p(),W(),u(3,"span",24),c(4),p(),u(5,"button",25),L("click",function(){let i=x(e).$implicit,a=l();return b(a.dismissErrorById(i.id))}),S(),u(6,"svg",26),T(7,"path",27),p()()()}if(o&2){let e=t.$implicit,n=t.$index;K("top",16+n*64,"px"),r(4),E(e.message)}}function yd(o,t){if(o&1){let e=P();u(0,"div",28),S(),u(1,"svg",29),T(2,"path",30),p(),W(),u(3,"span",24),c(4),p(),u(5,"button",31),L("click",function(){let i=x(e).$implicit,a=l();return b(a.dismissInfoById(i.id))}),S(),u(6,"svg",26),T(7,"path",27),p()()()}if(o&2){let e=t.$implicit,n=t.$index,i=l();K("top",16+(i.errorMessages$().length+n)*64,"px"),r(4),E(e.message)}}function wd(o,t){if(o&1){let e=P();u(0,"app-topic-picker",32),L("topicSelected",function(i){x(e);let a=l();return b(a.onTopicSelected(i))})("cancelled",function(){x(e);let i=l();return b(i.onTopicPickerCancelled())}),p()}}function Sd(o,t){if(o&1&&(S(),u(0,"svg",38),T(1,"path",39),p(),W(),u(2,"h2"),c(3),p()),o&2){let e=l(2);r(3),E(e.folderName$())}}function Pd(o,t){if(o&1&&T(0,"app-persona-badge",40),o&2){let e=l(3);q("personaType",e.currentPersonaType$())}}function Ed(o,t){if(o&1&&(u(0,"h2"),c(1),p(),f(2,Pd,1,1,"app-persona-badge",40)),o&2){let e,n=l(2);r(),E(((e=n.activeConversation$())==null?null:e.title)||"New Conversation"),r(),C(n.currentPersonaType$()?2:-1)}}function Td(o,t){if(o&1){let e=P();u(0,"div",36)(1,"div",41)(2,"button",42),L("click",function(){x(e);let i=l(2);return b(i.activeTab$.set("chat"))}),c(3," Chat "),p(),u(4,"button",42),L("click",function(){x(e);let i=l(2);return b(i.activeTab$.set("notes"))}),c(5," Tasks "),p()(),u(6,"button",43),L("click",function(){x(e);let i=l(2);return b(i.togglePersonaSelector())}),S(),u(7,"svg",9),T(8,"path",44),p(),c(9),p(),W(),u(10,"div",45)(11,"span",46),c(12,"Auto AI"),p(),u(13,"button",47),L("click",function(){x(e);let i=l(2);return b(i.toggleAutoAiPopuni())}),T(14,"span",48),p()()()}if(o&2){let e=l(2);r(2),R("active",e.activeTab$()==="chat"),r(2),R("active",e.activeTab$()==="notes"),r(2),q("disabled",e.isCurrentConversationExecuting$()),r(3),O(" ",e.showPersonaSelector$()?"Hide Personas":"Switch Persona"," "),r(4),R("active",e.autoAiPopuni$()),q("disabled",e.isTogglingAutoPopuni$())}}function Md(o,t){if(o&1){let e=P();u(0,"div",49),c(1),u(2,"button",50),L("click",function(){x(e);let i=l(2);return b(i.disconnectToast$.set(null))}),c(3,"\xD7"),p()()}if(o&2){let e=l(2);R("error",e.connectionState$()==="disconnected")("warning",e.connectionState$()==="reconnecting")("success",e.connectionState$()==="connected"),r(),O(" ",e.disconnectToast$()," ")}}function Id(o,t){if(o&1){let e=P();u(0,"div",54)(1,"p",67),c(2," Select a department persona for specialized AI responses: "),p(),u(3,"app-persona-selector",68),L("personaSelected",function(i){x(e);let a=l(4);return b(a.onPersonaSelected(i))}),p()()}if(o&2){let e=l(4);r(3),q("selectedType",e.currentPersonaType$())("allowNone",!1)}}function Od(o,t){if(o&1){let e=P();u(0,"button",77),L("click",function(i){return x(e),l(6).cancelExecution(),b(i.stopPropagation())}),c(1,"Prekini"),p()}}function $d(o,t){if(o&1){let e=P();u(0,"button",77),L("click",function(i){return x(e),l(6).rejectPlan(),b(i.stopPropagation())}),c(1,"Otka\u017Ei"),p(),u(2,"button",78),L("click",function(i){return x(e),l(6).approvePlan(),b(i.stopPropagation())}),c(3,"Pokreni"),p()}}function Ad(o,t){if(o&1&&f(0,Od,2,0,"button",76)(1,$d,4,0),o&2){let e=l(5);C(e.isExecutingWorkflow$()?0:1)}}function Nd(o,t){o&1&&(S(),u(0,"svg",80),T(1,"path",87),p())}function Rd(o,t){o&1&&(S(),u(0,"svg",81),T(1,"path",88),p())}function Dd(o,t){o&1&&(S(),u(0,"svg",81),T(1,"path",27),p())}function Ld(o,t){if(o&1&&c(0),o&2){let e=l().$implicit;O(" ",e.workflowStepNumber," ")}}function zd(o,t){if(o&1&&(u(0,"span",86),c(1),p()),o&2){let e=l().$implicit;r(),E(e.departmentTag)}}function Vd(o,t){if(o&1&&(u(0,"div",75)(1,"div",79),f(2,Nd,2,0,":svg:svg",80)(3,Rd,2,0,":svg:svg",81)(4,Dd,2,0,":svg:svg",81)(5,Ld,1,1),p(),u(6,"div",82)(7,"div",83),c(8),p(),u(9,"div",84),c(10),p(),u(11,"div",85)(12,"span",86),c(13),p(),f(14,zd,2,1,"span",86),u(15,"span",86),c(16),p()()()()),o&2){let e=t.$implicit,n=l(5);r(),R("step-pending",n.getStepStatus(e.stepId)==="pending")("step-in-progress",n.getStepStatus(e.stepId)==="in_progress")("step-completed",n.getStepStatus(e.stepId)==="completed")("step-failed",n.getStepStatus(e.stepId)==="failed"),r(),C(n.getStepStatus(e.stepId)==="in_progress"?2:n.getStepStatus(e.stepId)==="completed"?3:n.getStepStatus(e.stepId)==="failed"?4:5),r(6),E(e.title),r(2),E(e.description),r(3),E(e.conceptName),r(),C(e.departmentTag?14:-1),r(2),O("~",e.estimatedMinutes,"m")}}function Fd(o,t){if(o&1){let e=P();u(0,"div",69)(1,"div",70),L("click",function(){x(e);let i=l(4);return b(i.togglePlanCollapse())}),S(),u(2,"svg",71),T(3,"path",72),p(),W(),u(4,"h3"),c(5),p(),u(6,"div",73)(7,"span"),c(8),p(),u(9,"span"),c(10),p()(),f(11,Ad,2,1),p(),u(12,"div",74),U(13,Vd,17,14,"div",75,xd),p()()}if(o&2){let e=l(4);R("collapsed",e.planCollapsed$()),r(2),R("expanded",!e.planCollapsed$()),r(3),E(e.isExecutingWorkflow$()?"Izvr\u0161avanje plana...":"Plan izvr\u0161avanja"),r(3),O("",e.currentPlan$().steps.length," koraka"),r(2),O("~",e.currentPlan$().totalEstimatedMinutes," min"),r(),C(e.planCollapsed$()?-1:11),r(2),G(e.currentPlan$().steps)}}function Bd(o,t){if(o&1&&(u(0,"span",95),c(1),p()),o&2){let e=l(6);r(),we("",e.yoloProgress$().currentTasks.length," aktivn",e.yoloProgress$().currentTasks.length>1?"a":"o")}}function Wd(o,t){if(o&1&&(u(0,"span",96),c(1),p()),o&2){let e=l(6);r(),O("",e.yoloProgress$().failed," neuspe\u0161no")}}function jd(o,t){if(o&1&&(u(0,"span",97),c(1),p()),o&2){let e=l(6);r(),O("+",e.yoloProgress$().discoveredCount)}}function Hd(o,t){if(o&1&&(u(0,"div",89)(1,"span",91),c(2,"YOLO"),p(),u(3,"div",92),T(4,"div",93),p(),u(5,"span",94),c(6),p(),f(7,Bd,2,2,"span",95),f(8,Wd,2,1,"span",96),f(9,jd,2,1,"span",97),p()),o&2){let e=l(5);r(4),K("width",(e.yoloProgress$().executionBudget??e.yoloProgress$().total)>0?e.yoloProgress$().completed/(e.yoloProgress$().executionBudget??e.yoloProgress$().total)*100:0,"%"),r(2),we("",e.yoloProgress$().completed,"/",e.yoloProgress$().executionBudget??e.yoloProgress$().total),r(),C(e.yoloProgress$().currentTasks.length>0?7:-1),r(),C(e.yoloProgress$().failed>0?8:-1),r(),C(e.yoloProgress$().discoveredCount>0?9:-1)}}function Ud(o,t){if(o&1&&(u(0,"span",95),c(1),p()),o&2){let e=l().$implicit;r(),E(e.currentStepTitle)}}function Gd(o,t){o&1&&(u(0,"span",101),c(1,"Zavr\u0161eno"),p())}function qd(o,t){o&1&&(u(0,"span",96),c(1,"Gre\u0161ka"),p())}function Yd(o,t){o&1&&(u(0,"span",96),c(1,"Otkazano"),p())}function Kd(o,t){if(o&1&&(u(0,"div",98)(1,"span",91),c(2),p(),u(3,"div",99)(4,"div",92),T(5,"div",100),p(),u(6,"span",94),c(7),p()(),f(8,Ud,2,1,"span",95),f(9,Gd,2,0,"span",101),f(10,qd,2,0,"span",96),f(11,Yd,2,0,"span",96),p()),o&2){let e=t.$implicit;R("wse-executing",e.status==="executing")("wse-completed",e.status==="completed")("wse-failed",e.status==="failed")("wse-cancelled",e.status==="cancelled"),r(2),E(e.title),r(3),K("width",e.totalSteps>0?e.completedSteps/e.totalSteps*100:0,"%"),r(2),we("",e.completedSteps,"/",e.totalSteps),r(),C(e.status==="executing"&&e.currentStepTitle?8:-1),r(),C(e.status==="completed"?9:-1),r(),C(e.status==="failed"?10:-1),r(),C(e.status==="cancelled"?11:-1)}}function Qd(o,t){if(o&1&&(u(0,"div",56),f(1,Hd,10,7,"div",89),U(2,Kd,12,17,"div",90,bd),p()),o&2){let e=l(4);r(),C(e.isYoloMode$()&&e.yoloProgress$()?1:-1),r(),G(e.workflowHistory$())}}function Xd(o,t){if(o&1){let e=P();u(0,"app-chat-message",102),L("citationClick",function(i){x(e);let a=l(4);return b(a.onCitationClick(i))})("actionClick",function(i){x(e);let a=l(4);return b(a.onSuggestedAction(i))}),p()}if(o&2){let e=t.$implicit,n=l(4);q("message",e)("personaType",e.role==="ASSISTANT"?n.currentPersonaType$():null)}}function Zd(o,t){if(o&1&&c(0),o&2){let e=l(5);sn(" Korak ",e.currentStepIndex$()+1,"/",e.totalStepsCount$(),": ",e.currentStepTitle$()," ")}}function Jd(o,t){o&1&&c(0," Pripremam izvr\u0161avanje... ")}function ep(o,t){if(o&1&&(u(0,"div",60),S(),u(1,"svg",103),T(2,"path",87),p(),f(3,Zd,1,3)(4,Jd,1,0),p()),o&2){let e=l(4);r(3),C(e.currentStepTitle$()?3:4)}}function tp(o,t){if(o&1&&c(0),o&2){let e=l(5);we(" Processing ",e.yoloProgress$().currentTasks.length," concept",e.yoloProgress$().currentTasks.length>1?"s":""," ")}}function np(o,t){o&1&&c(0," YOLO Mode \u2014 Autonomous Execution ")}function op(o,t){if(o&1&&(c(0," | Failed: "),u(1,"span",110),c(2),p()),o&2){let e=l(5);r(2),E(e.yoloProgress$().failed)}}function ip(o,t){if(o&1&&(c(0," | "),u(1,"span",111),c(2),p()),o&2){let e=l(5);r(2),O("",e.yoloProgress$().createdOnlyCount," queued for next run")}}function ap(o,t){if(o&1&&(c(0," | "),u(1,"span",112),c(2),p()),o&2){let e=l(5);r(2),O("Discovered: ",e.yoloProgress$().discoveredCount)}}function rp(o,t){if(o&1&&(u(0,"span",116),c(1),p()),o&2){let e=l().$implicit;r(),sn(" Step ",(e.currentStepIndex??0)+1,"/",e.totalSteps??"?",": ",e.currentStep," ")}}function sp(o,t){if(o&1&&(u(0,"div",113),T(1,"span",114),u(2,"span",115),c(3),p(),f(4,rp,2,3,"span",116),p()),o&2){let e=t.$implicit;r(3),E(e.conceptName),r(),C(e.currentStep?4:-1)}}function lp(o,t){if(o&1&&(u(0,"div",109),U(1,sp,5,2,"div",113,vd),p()),o&2){let e=l(5);r(),G(e.yoloProgress$().currentTasks)}}function cp(o,t){if(o&1&&(u(0,"div",121),c(1),p()),o&2){let e=t.$implicit;r(),E(e)}}function dp(o,t){if(o&1&&(u(0,"div",120,1),U(2,cp,2,1,"div",121,qe),p()),o&2){let e=l(6);r(2),G(e.yoloProgress$().recentLogs)}}function pp(o,t){if(o&1){let e=P();u(0,"button",117),L("click",function(){x(e);let i=l(5);return b(i.toggleYoloActivityLog())}),S(),u(1,"svg",118),T(2,"path",119),p(),c(3),p(),f(4,dp,4,0,"div",120)}if(o&2){let e=l(5);r(),R("expanded",e.showYoloActivityLog$()),r(2),we(" ",e.showYoloActivityLog$()?"Hide":"Show"," Activity Log (",e.yoloProgress$().recentLogs.length,") "),r(),C(e.showYoloActivityLog$()?4:-1)}}function up(o,t){if(o&1&&(u(0,"div",61)(1,"div",104),T(2,"span",105),f(3,tp,1,2)(4,np,1,0),p(),u(5,"div",106),c(6," Executing: "),u(7,"span"),c(8),p(),f(9,op,3,1),f(10,ip,3,1),f(11,ap,3,1),p(),u(12,"div",107),T(13,"div",108),p(),f(14,lp,3,0,"div",109),f(15,pp,5,5),p()),o&2){let e=l(4);r(3),C(e.yoloProgress$().currentTasks.length>0?3:4),r(5),we("",e.yoloProgress$().completed,"/",e.yoloProgress$().executionBudget??e.yoloProgress$().total),r(),C(e.yoloProgress$().failed>0?9:-1),r(),C((e.yoloProgress$().createdOnlyCount??0)>0?10:-1),r(),C(e.yoloProgress$().discoveredCount>0?11:-1),r(2),K("width",(e.yoloProgress$().executionBudget??e.yoloProgress$().total)>0?e.yoloProgress$().completed/(e.yoloProgress$().executionBudget??e.yoloProgress$().total)*100:0,"%"),r(),C(e.yoloProgress$().currentTasks.length>0?14:-1),r(),C(e.yoloProgress$().recentLogs&&e.yoloProgress$().recentLogs.length>0?15:-1)}}function mp(o,t){if(o&1&&(u(0,"span",131),S(),u(1,"svg",132),T(2,"path",133),p(),c(3),p()),o&2){let e=l().$implicit;r(3),O(" ",e.conceptName," ")}}function hp(o,t){o&1&&(u(0,"span",131),S(),u(1,"svg",132),T(2,"path",119),p(),c(3," Otvori "),p())}function gp(o,t){if(o&1){let e=P();u(0,"button",129),L("click",function(){let i=x(e).$implicit,a=l(5);return b(a.navigateToCreatedTask(i))}),u(1,"span",130),c(2),p(),f(3,mp,4,1,"span",131)(4,hp,4,0,"span",131),p()}if(o&2){let e=t.$implicit;R("cross-concept",e.isCrossConversation),r(2),E(e.title),r(),C(e.isCrossConversation&&e.conceptName?3:4)}}function _p(o,t){if(o&1){let e=P();u(0,"div",62)(1,"div",122),S(),u(2,"svg",123),T(3,"path",124),p(),c(4," Kreirani zadaci "),W(),u(5,"button",125),L("click",function(){x(e);let i=l(4);return b(i.createdTaskNotifications$.set([]))}),S(),u(6,"svg",126),T(7,"path",127),p()()(),U(8,gp,5,4,"button",128,jn),p()}if(o&2){let e=l(4);r(8),G(e.createdTaskNotifications$())}}function fp(o,t){if(o&1&&T(0,"app-chat-message",63),o&2){let e=l(4);q("message",e.streamingMessage$())("isStreaming",!0)("personaType",e.currentPersonaType$())}}function Cp(o,t){if(o&1&&T(0,"app-typing-indicator",64),o&2){let e=l(4);q("personaType",e.currentPersonaType$())("phase",e.researchPhase$())}}function xp(o,t){o&1&&(u(0,"div",60),S(),u(1,"svg",103),T(2,"path",87),p(),c(3," Generi\u0161em plan izvr\u0161avanja... "),p())}function bp(o,t){o&1&&(T(0,"span",145),c(1," Obra\u0111ujem... "))}function vp(o,t){o&1&&(c(0," Nastavi "),S(),u(1,"svg",146),T(2,"line",147)(3,"polyline",148),p())}function kp(o,t){if(o&1){let e=P();u(0,"div",141)(1,"button",143),L("click",function(){x(e);let i=l(5);return b(i.continueWorkflowStep())}),f(2,bp,2,0)(3,vp,4,0),p(),u(4,"button",144),L("click",function(){x(e);let i=l(5);return b(i.cancelExecution())}),c(5," Otka\u017Ei "),p()()}if(o&2){let e=l(5);r(),q("disabled",e.isProcessingStep$()),r(),C(e.isProcessingStep$()?2:3),r(2),q("disabled",e.isProcessingStep$())}}function yp(o,t){o&1&&(u(0,"div",142),S(),u(1,"svg",149),T(2,"path",150),p(),W(),u(3,"span"),c(4,"Unesite odgovor u polje za poruke ispod"),p()())}function wp(o,t){if(o&1&&(u(0,"div",65)(1,"div",134),S(),u(2,"svg",135),T(3,"circle",136)(4,"polyline",137),p(),W(),u(5,"span",138),c(6),p()(),u(7,"p",139),c(8),p(),u(9,"p",140),c(10),p(),f(11,kp,6,3,"div",141)(12,yp,5,0,"div",142),p()),o&2){let e=t;r(6),sn("Korak ",e.stepIndex+1,"/",e.totalSteps,": ",e.conceptName),r(2),E(e.stepTitle),r(2),E(e.stepDescription),r(),C(e.inputType==="confirmation"?11:12)}}function Sp(o,t){if(o&1){let e=P();u(0,"div",66)(1,"button",151),L("click",function(){x(e);let i=l(4);return b(i.returnToPreviousConversation())}),S(),u(2,"svg",146),T(3,"line",152)(4,"polyline",153),p(),c(5," Vrati se na prethodnu konverzaciju "),p()()}}function Pp(o,t){o&1&&(T(0,"span",145),c(1," Obra\u0111ujem... "))}function Ep(o,t){if(o&1&&(c(0),S(),u(1,"svg",146),T(2,"line",147)(3,"polyline",148),p()),o&2){let e=l(5);O(" ",e.userStepInput$()?"Izvr\u0161i sa odgovorom":"Presko\u010Di i izvr\u0161i"," ")}}function Tp(o,t){if(o&1){let e=P();u(0,"div",65)(1,"div",134),S(),u(2,"svg",135),T(3,"circle",136)(4,"polyline",137),p(),W(),u(5,"span",138),c(6),p()(),u(7,"p",139),c(8),p(),u(9,"p",140),c(10),p(),u(11,"div",142),S(),u(12,"svg",149),T(13,"path",150),p(),W(),u(14,"span"),c(15,"Imate li dodatne informacije ili odgovore za ovaj korak?"),p()(),u(16,"textarea",154),L("input",function(i){x(e);let a=l(4);return b(a.userStepInput$.set(i.target.value))}),p(),u(17,"div",141)(18,"button",143),L("click",function(){x(e);let i=l(4);return b(i.continueWorkflow())}),f(19,Pp,2,0)(20,Ep,4,1),p(),u(21,"button",144),L("click",function(){x(e);let i=l(4);return b(i.cancelExecution())}),c(22," Otka\u017Ei "),p()()()}if(o&2){let e=l(4);r(6),we("Korak ",e.nextStepInfo$().stepIndex+1,"/",e.nextStepInfo$().totalSteps,":"),r(2),E(e.nextStepInfo$().title),r(2),E(e.nextStepInfo$().description),r(6),q("value",e.userStepInput$()),r(2),q("disabled",e.isProcessingStep$()),r(),C(e.isProcessingStep$()?19:20),r(2),q("disabled",e.isProcessingStep$())}}function Mp(o,t){if(o&1&&(f(0,Id,4,2,"div",54),f(1,Fd,15,8,"div",55),f(2,Qd,4,1,"div",56),u(3,"div",57,0)(5,"div",58),U(6,Xd,1,2,"app-chat-message",59,jn),f(8,ep,5,1,"div",60),f(9,up,16,10,"div",61),f(10,_p,10,0,"div",62),f(11,fp,1,3,"app-chat-message",63),f(12,Cp,1,2,"app-typing-indicator",64),f(13,xp,4,0,"div",60),f(14,wp,13,6,"div",65),f(15,Sp,6,0,"div",66),f(16,Tp,23,8,"div",65),p()()),o&2){let e,n=l(3);C(n.showPersonaSelector$()?0:-1),r(),C(n.showPlanOverlay$()&&n.currentPlan$()?1:-1),r(),C(n.sortedWorkflowHistory$().length>0||n.isYoloMode$()&&n.yoloProgress$()?2:-1),r(4),G(n.messages$()),r(2),C(n.isCurrentConversationExecuting$()&&!n.showPlanOverlay$()?8:-1),r(),C(n.isYoloMode$()&&n.yoloProgress$()?9:-1),r(),C(n.createdTaskNotifications$().length>0?10:-1),r(),C(n.isStreaming$()?11:-1),r(),C(n.isLoading$()&&!n.isStreaming$()?12:-1),r(),C(n.isGeneratingPlan$()?13:-1),r(),C((e=n.currentWorkflowStepInput$())?14:-1,e),r(),C(n.previousConversationId$()?15:-1),r(),C(n.awaitingConfirmation$()&&n.nextStepInfo$()&&!n.currentWorkflowStepInput$()?16:-1)}}function Ip(o,t){if(o&1&&(u(0,"span",162)(1,"strong"),c(2),p(),c(3," na \u010Dekanju"),p()),o&2){let e=l(5);r(2),E(e.brainStats$().pendingTasks)}}function Op(o,t){if(o&1){let e=P();u(0,"div",45)(1,"span",46),c(2,"Auto AI"),p(),u(3,"button",47),L("click",function(){x(e);let i=l(5);return b(i.toggleAutoAiPopuni())}),T(4,"span",48),p()()}if(o&2){let e=l(5);r(3),R("active",e.autoAiPopuni$()),q("disabled",e.isTogglingAutoPopuni$())}}function $p(o,t){if(o&1&&(u(0,"div",155)(1,"span",158),c(2,"Mozak"),p(),u(3,"div",159),T(4,"div",160),p(),u(5,"span",161)(6,"strong"),c(7),p(),c(8," domena"),p(),f(9,Ip,4,1,"span",162),f(10,Op,5,3,"div",45),p()),o&2){let e=l(4);r(4),K("width",e.brainStats$().progressPercent,"%"),r(3),we("",e.brainStats$().completedDomains,"/",e.brainStats$().totalDomains),r(2),C(e.brainStats$().pendingTasks>0?9:-1),r(),C(e.isPlatformOwner$()?10:-1)}}function Ap(o,t){if(o&1){let e=P();f(0,$p,11,6,"div",155),u(1,"div",156)(2,"app-conversation-notes",157),L("viewMessage",function(i){x(e);let a=l(3);return b(a.onViewMessage(i))})("runAgents",function(i){x(e);let a=l(3);return b(a.onRunAgents(i))})("executeTask",function(i){x(e);let a=l(3);return b(a.onExecuteSingleTask(i))})("submitTaskResult",function(i){x(e);let a=l(3);return b(a.onSubmitTaskResult(i))}),p()()}if(o&2){let e,n=l(3);C(n.brainStats$().totalDomains>0?0:-1),r(2),q("conversationId",n.activeConversationId$())("conceptId",((e=n.activeConversation$())==null?null:e.conceptId)??null)("autoSelectTaskIds",n.autoSelectTaskIds$())("isExecuting",n.isCurrentConversationExecuting$())("executingTaskId",n.executingTaskId$())("taskExecutionContent",n.taskExecutionStreamContent$())("submittingResultId",n.submittingResultId$())("taskResultContent",n.taskResultStreamContent$())("isGeneratingPlan",n.isGeneratingPlan$())}}function Np(o,t){if(o&1){let e=P();u(0,"button",170),L("click",function(){x(e);let i=l(4);return i.activeTab$.set("notes"),b(i.dismissNextStep())}),c(1),p()}if(o&2){let e=l(4);r(),O(" ",e.nextStepSuggestion$().secondaryLabel," ")}}function Rp(o,t){if(o&1){let e=P();u(0,"div",51),S(),u(1,"svg",163),T(2,"path",164),p(),W(),u(3,"span",165),c(4),p(),u(5,"div",166)(6,"button",167),L("click",function(){x(e);let i=l(3);return b(i.onNextStepAction())}),c(7),p(),f(8,Np,2,1,"button",168),p(),u(9,"button",169),L("click",function(){x(e);let i=l(3);return b(i.dismissNextStep())}),c(10,"\xD7"),p()()}if(o&2){let e=l(3);r(4),E(e.nextStepSuggestion$().message),r(3),O(" ",e.nextStepSuggestion$().actionLabel," "),r(),C(e.nextStepSuggestion$().secondaryLabel?8:-1)}}function Dp(o,t){if(o&1){let e=P();f(0,Mp,17,12)(1,Ap,3,10),f(2,Rp,11,3,"div",51),u(3,"div",52)(4,"app-chat-input",53),L("messageSent",function(i){x(e);let a=l(2);return b(a.sendMessage(i))}),p()()}if(o&2){let e=l(2);C(e.activeTab$()==="chat"?0:1),r(2),C(e.nextStepSuggestion$()?2:-1),r(2),q("disabled",e.isLoading$()&&!e.allowWorkflowInput$())}}function Lp(o,t){if(o&1&&(u(0,"span",162)(1,"strong"),c(2),p(),c(3," na \u010Dekanju"),p()),o&2){let e=l(4);r(2),E(e.brainStats$().pendingTasks)}}function zp(o,t){if(o&1){let e=P();u(0,"div",155)(1,"span",158),c(2,"Mozak"),p(),u(3,"div",159),T(4,"div",160),p(),u(5,"span",161)(6,"strong"),c(7),p(),c(8," domena"),p(),f(9,Lp,4,1,"span",162),u(10,"div",45)(11,"span",46),c(12,"Auto AI"),p(),u(13,"button",47),L("click",function(){x(e);let i=l(3);return b(i.toggleAutoAiPopuni())}),T(14,"span",48),p()()()}if(o&2){let e=l(3);r(4),K("width",e.brainStats$().progressPercent,"%"),r(3),we("",e.brainStats$().completedDomains,"/",e.brainStats$().totalDomains),r(2),C(e.brainStats$().pendingTasks>0?9:-1),r(4),R("active",e.autoAiPopuni$()),q("disabled",e.isTogglingAutoPopuni$())}}function Vp(o,t){if(o&1){let e=P();u(0,"div",171)(1,"div",172)(2,"div",173)(3,"div",174),c(4,"Zavr\u0161eno"),p(),u(5,"div",175),c(6),p()(),u(7,"div",173)(8,"div",174),c(9,"Na \u010Dekanju"),p(),u(10,"div",176),c(11),p()(),u(12,"div",173)(13,"div",174),c(14,"Ukupno"),p(),u(15,"div",177),c(16),p()()(),u(17,"div",178)(18,"button",179),L("click",function(){x(e);let i=l(2);return b(i.onRunBrain())}),S(),u(19,"svg",9),T(20,"path",180),p(),c(21," Pokreni Brain "),p(),W(),u(22,"button",181),L("click",function(){x(e);let i=l(2);return b(i.onRunBrainYolo())}),S(),u(23,"svg",9),T(24,"path",180),p()(),W(),u(25,"button",182),L("click",function(){x(e);let i=l(2);return b(i.showTopicPicker$.set(!0))}),S(),u(26,"svg",9),T(27,"path",183),p(),c(28," Istra\u017Ei koncept "),p()()(),f(29,zp,15,8,"div",155),W(),u(30,"div",184)(31,"app-conversation-notes",185),L("viewMessage",function(i){x(e);let a=l(2);return b(a.onViewMessage(i))})("runAgents",function(i){x(e);let a=l(2);return b(a.onRunAgents(i))})("executeTask",function(i){x(e);let a=l(2);return b(a.onExecuteSingleTask(i))})("submitTaskResult",function(i){x(e);let a=l(2);return b(a.onSubmitTaskResult(i))}),p()()}if(o&2){let e=l(2);r(6),E(e.domainCompletedCount$()),r(5),E(e.domainPendingCount$()),r(5),O(" ",e.domainCompletedCount$()+e.domainPendingCount$()," "),r(2),q("disabled",e.isCurrentConversationExecuting$()||e.isYoloMode$()||e.domainPendingCount$()===0),r(4),q("disabled",e.isCurrentConversationExecuting$()||e.isYoloMode$()||e.domainPendingCount$()===0),r(7),C(e.brainStats$().totalDomains>0?29:-1),r(2),q("conversationId",null)("conceptId",null)("folderConceptIds",e.folderConceptIds$())("folderConversationIds",e.folderConversationIds$())("folderName",e.folderName$())("autoSelectTaskIds",e.autoSelectTaskIds$())("isExecuting",e.isCurrentConversationExecuting$())("executingTaskId",e.executingTaskId$())("taskExecutionContent",e.taskExecutionStreamContent$())("submittingResultId",e.submittingResultId$())("taskResultContent",e.taskResultStreamContent$())("isGeneratingPlan",e.isGeneratingPlan$())}}function Fp(o,t){if(o&1&&(u(0,"header",33)(1,"div",34),T(2,"span",35),f(3,Sd,4,1)(4,Ed,3,2),p(),f(5,Td,15,9,"div",36),p(),f(6,Md,4,7,"div",37),f(7,Dp,5,3)(8,Vp,32,18)),o&2){let e=l();r(2),R("connected",e.connectionState$()==="connected")("disconnected",e.connectionState$()==="disconnected")("reconnecting",e.connectionState$()==="reconnecting"),q("title",e.connectionState$()==="connected"?"Povezano":e.connectionState$()==="reconnecting"?"Ponovno povezivanje...":"Veza prekinuta"),r(),C(e.folderName$()&&!e.activeConversation$()?3:4),r(2),C(e.activeConversation$()?5:-1),r(),C(e.disconnectToast$()?6:-1),r(),C(e.activeConversation$()?7:e.folderName$()?8:-1)}}function Bp(o,t){if(o&1){let e=P();u(0,"div",19)(1,"div",186)(2,"div",187),S(),u(3,"svg",188),T(4,"path",189),p()(),W(),u(5,"h2",190),c(6,"Welcome to Mentor AI"),p(),u(7,"p",191),c(8," Your AI-powered business partner with expertise in Finance, Marketing, Technology, Operations, Legal, and Creative. "),p(),u(9,"button",192),L("click",function(){x(e);let i=l();return b(i.createNewConversation())}),S(),u(10,"svg",193),T(11,"path",10),p(),c(12," Start New Conversation "),p(),W(),u(13,"div",194)(14,"span",195),c(15,"CFO"),p(),u(16,"span",196),c(17,"CMO"),p(),u(18,"span",197),c(19,"CTO"),p(),u(20,"span",198),c(21,"Operations"),p(),u(22,"span",199),c(23,"Legal"),p(),u(24,"span",200),c(25,"Creative"),p()()()()}}function Wp(o,t){if(o&1){let e=P();u(0,"aside",20)(1,"div",201),c(2,"Izvor"),p(),u(3,"app-concept-panel",202),L("close",function(){x(e);let i=l();return b(i.closeConceptPanel())})("conceptClick",function(i){x(e);let a=l();return b(a.onRelatedConceptClick(i))}),p()()}if(o&2){let e=l();r(3),q("conceptId",e.selectedConceptId$())("isOpen",!0)}}var La=class o{conversationService=ee(ut);chatWsService=ee(vn);http=ee(Ee);route=ee(wi);router=ee(Si);destroyRef=ee(_i);authService=ee(ln);notesApi=ee(Ct);conceptTree;conversationNotes;yoloLogContainer;messagesContainer;activeConversation$=v(null);activeConversationId$=re(()=>this.activeConversation$()?.id??null);messages$=re(()=>this.activeConversation$()?.messages??[]);isLoading$=v(!1);isStreaming$=v(!1);streamingContent$=v("");streamingMessage$=re(()=>({id:"streaming",conversationId:this.activeConversationId$()??"",role:"ASSISTANT",content:this.streamingContent$(),confidenceScore:null,confidenceFactors:null,createdAt:""}));showPersonaSelector$=v(!1);currentPersonaType$=re(()=>this.activeConversation$()?.personaType??null);errorMessages$=v([]);infoMessages$=v([]);isApprovingPlan$=v(!1);isProcessingStep$=v(!1);selectedConceptId$=v(null);activeTab$=v("chat");showTopicPicker$=v(!1);connectionState$=re(()=>this.chatWsService.connectionState$());disconnectToast$=v(null);showPlanOverlay$=v(!1);planCollapsed$=v(!1);currentPlan$=v(null);executionProgress$=v(new Map);executingWorkflowConversationIds$=v(new Set);isExecutingWorkflow$=re(()=>this.executingWorkflowConversationIds$().size>0);isCurrentConversationExecuting$=re(()=>{let t=this.activeConversationId$();return t!==null&&this.executingWorkflowConversationIds$().has(t)});createdConceptConversations$=v([]);newConversationIds$=v(new Set);folderConceptIds$=v([]);folderConversationIds$=v([]);folderName$=v(null);autoSelectTaskIds$=v([]);createdTaskNotifications$=v([]);domainCompletedCount$=v(0);domainPendingCount$=v(0);currentStepTitle$=v(null);currentStepIndex$=v(0);totalStepsCount$=v(0);completedStepsCount$=v(0);progressPercent$=re(()=>{let t=this.totalStepsCount$();return t===0?0:Math.round(this.completedStepsCount$()/t*100)});activePlanId$=v(null);awaitingConfirmation$=v(!1);nextStepInfo$=v(null);userStepInput$=v("");isGeneratingPlan$=v(!1);allowWorkflowInput$=v(!1);currentWorkflowStepInput$=v(null);previousConversationId$=v(null);executingTaskId$=v(null);taskExecutionStreamContent$=v("");submittingResultId$=v(null);taskResultStreamContent$=v("");loadingConversationId$=v(null);isCreatingConversation$=re(()=>this.conversationService.isCreating$());isYoloMode$=v(!1);yoloProgress$=v(null);showYoloActivityLog$=v(!1);yoloPending=!1;pendingPlanId=null;streamBuffer="";streamRafId=null;workflowHistory$=v([]);workflowPlans$=v(new Map);workflowProgressMaps$=v(new Map);selectedWorkflowPlanId$=v(null);sortedWorkflowHistory$=re(()=>{let t={executing:0,completed:1,failed:2,cancelled:3};return[...this.workflowHistory$()].sort((e,n)=>(t[e.status]??9)-(t[n.status]??9))});researchPhase$=v("thinking");autoAiPopuni$=v(!1);isTogglingAutoPopuni$=v(!1);autoPopuniTaskIds$=v([]);isPlatformOwner$=re(()=>this.authService.currentUser()?.role==="PLATFORM_OWNER");viewInit$=v(!1);brainStats$=re(()=>{this.viewInit$();let t=this.conceptTree?.treeData$()?.tree??[];if(t.length===0)return{totalDomains:0,completedDomains:0,pendingTasks:0,progressPercent:0};let e=0,n=0,i=0,a=m=>{let d=0,y=0,k=0;for(let D of m)if(D.children.length>0){let $=a(D.children);d+=$.completed,y+=$.pending,k+=$.total}else D.status&&(k++,D.status==="completed"&&d++,D.status==="pending"&&y++);return{completed:d,pending:y,total:k}};for(let m of t){e++;let d=a(m.children);i+=d.pending,d.total>0&&d.completed===d.total&&n++}let s=e>0?Math.round(n/e*100):0;return{totalDomains:e,completedDomains:n,pendingTasks:i,progressPercent:s}});nextStepSuggestion$=v(null);nextStepDismissTimer=null;keyboardHandler=t=>this.handleKeyboardShortcut(t);ngOnInit(){document.addEventListener("keydown",this.keyboardHandler),this.setupWebSocket(),this.loadBrainConfig(),hi([this.route.params,this.route.queryParams]).pipe(ro(this.destroyRef),gi(1)).subscribe(([t,e])=>{e.yolo==="true"&&!this.isYoloMode$()&&(this.isYoloMode$.set(!0),this.yoloPending=!0),e.planId&&!this.yoloPending&&(this.pendingPlanId=e.planId),t.conversationId&&this.loadConversation(t.conversationId)}),this.route.params.pipe(ro(this.destroyRef)).subscribe(t=>{t.conversationId&&this.activeConversationId$()!==t.conversationId&&this.loadConversation(t.conversationId)})}ngAfterViewInit(){this.viewInit$.set(!0)}ngOnDestroy(){document.removeEventListener("keydown",this.keyboardHandler),this.chatWsService.disconnect()}handleKeyboardShortcut(t){t.ctrlKey&&t.key==="n"&&(t.preventDefault(),this.createNewConversation()),t.key==="Escape"&&(this.showPlanOverlay$()&&this.rejectPlan(),this.errorMessages$.set([])),t.ctrlKey&&t.shiftKey&&t.key==="T"&&(t.preventDefault(),this.activeTab$.set("notes")),t.ctrlKey&&t.shiftKey&&t.key==="C"&&(t.preventDefault(),this.activeTab$.set("chat"))}async loadConversation(t){try{!this.executingWorkflowConversationIds$().has(t)&&!this.selectedWorkflowPlanId$()&&this.closePlanOverlay();let e=await this.conversationService.getConversation(t);if(this.activeConversation$.set(e),this.activeTab$.set("chat"),this.isLoading$.set(!1),this.isStreaming$.set(!1),this.streamingContent$.set(""),this.createdTaskNotifications$.set([]),this.yoloPending){this.yoloPending=!1;try{await this.chatWsService.waitForConnection(),this.chatWsService.emitStartYolo(t)}catch{this.showError("WebSocket konekcija neuspe\u0161na \u2014 YOLO mod nije mogao da se pokrene")}}if(this.pendingPlanId){let n=this.pendingPlanId;this.pendingPlanId=null;try{await this.chatWsService.waitForConnection(),this.chatWsService.emitGetPlan(n,t)}catch{this.showError("WebSocket konekcija neuspe\u0161na \u2014 plan nije mogao da se u\u010Dita")}}}catch{this.activeConversation$.set(null),this.showError("Gre\u0161ka pri u\u010Ditavanju konverzacije")}}async createNewConversation(t){try{let e=t?`${t} \u2014 Nova konverzacija`:void 0,n=await this.conversationService.createConversation(e);await this.loadConversation(n.id),this.router.navigate(["/chat",n.id]),this.conceptTree?.loadTree()}catch{this.showError("Gre\u0161ka pri kreiranju konverzacije")}}async onTopicSelected(t){this.showTopicPicker$.set(!1);try{let e=await this.conversationService.createConversation(void 0,void 0,void 0,t?.id);await this.loadConversation(e.id),this.router.navigate(["/chat",e.id]),this.conceptTree?.loadTree()}catch{this.showError("Gre\u0161ka pri kreiranju konverzacije")}}onTopicPickerCancelled(){this.showTopicPicker$.set(!1)}async createConversationUnderConcept(t){this.loadingConversationId$.set(t.conceptId);try{let e=this.formatConversationTitle(t.conceptName),n=await this.conversationService.createConversation(e,void 0,void 0,t.conceptId);this.newConversationIds$.update(i=>{let a=new Set(i);return a.add(n.id),a}),await this.loadConversation(n.id),this.router.navigate(["/chat",n.id]),this.conceptTree?.loadTree()}catch{this.showError("Gre\u0161ka pri kreiranju konverzacije")}finally{this.loadingConversationId$.set(null)}}selectConversation(t){this.folderConceptIds$.set([]),this.folderConversationIds$.set([]),this.folderName$.set(null),this.activeTab$.set("chat"),this.autoSelectTaskIds$.set([]),this.newConversationIds$.update(e=>{let n=new Set(e);return n.delete(t),n}),this.router.navigate(["/chat",t])}navigateToCreatedTask(t){this.createdTaskNotifications$.update(e=>e.filter(n=>n.id!==t.id)),this.autoSelectTaskIds$.set([t.id]),this.activeTab$.set("notes"),t.isCrossConversation&&this.router.navigate(["/chat",t.conversationId]),this.conversationNotes?.loadNotes()}togglePersonaSelector(){this.showPersonaSelector$.update(t=>!t)}showError(t){let e=crypto.randomUUID();this.errorMessages$.update(n=>[...n,{id:e,message:t}]),setTimeout(()=>this.dismissErrorById(e),8e3)}dismissErrorById(t){this.errorMessages$.update(e=>e.filter(n=>n.id!==t))}loadBrainConfig(){this.http.get("/api/admin/brain-config").subscribe({next:t=>this.autoAiPopuni$.set(t.data.autoAiPopuni),error:()=>{}})}toggleAutoAiPopuni(){if(this.isTogglingAutoPopuni$())return;this.isTogglingAutoPopuni$.set(!0);let t=!this.autoAiPopuni$();this.http.patch("/api/admin/brain-config",{autoAiPopuni:t}).subscribe({next:e=>{this.autoAiPopuni$.set(e.data.autoAiPopuni),this.isTogglingAutoPopuni$.set(!1)},error:()=>{this.isTogglingAutoPopuni$.set(!1),this.showError("Gre\u0161ka pri promeni Auto AI pode\u0161avanja")}})}showInfo(t){let e=crypto.randomUUID();this.infoMessages$.update(n=>[...n,{id:e,message:t}]),setTimeout(()=>this.dismissInfoById(e),1e4)}dismissInfoById(t){this.infoMessages$.update(e=>e.filter(n=>n.id!==t))}manualReconnect(){this.chatWsService.disconnect(),setTimeout(()=>this.chatWsService.connect(),500)}onSuggestedAction(t){switch(t.type){case"create_tasks":this.sendMessage("Kreiraj zadatke na osnovu prethodne analize."),this.activeTab$.set("notes");break;case"view_tasks":this.activeTab$.set("notes");break;case"deep_dive":case"explore_concept":this.sendMessage("Istra\u017Ei ovu temu dublje. Daj detaljniju analizu.");break;case"next_domain":t.payload?.conceptId&&this.selectedConceptId$.set(t.payload.conceptId);break;case"save_note":this.activeTab$.set("notes");break;case"web_search":this.sendMessage("Pretra\u017Ei web za vi\u0161e informacija o ovoj temi.");break;case"run_workflow":this.activeTab$.set("notes");break;case"score_task":this.activeTab$.set("notes");break}}onCitationClick(t){if(typeof t=="string"){this.lookupConceptByName(t);return}if(this.isCurrentConversationExecuting$()){this.selectedConceptId$.set(t.conceptId);return}let n=this.createdConceptConversations$().find(i=>i.conceptId===t.conceptId);if(n){this.router.navigate(["/chat",n.conversationId]);return}this.selectedConceptId$.set(t.conceptId)}async lookupConceptByName(t){try{let e=await H(this.http.get(`/api/v1/knowledge/concepts/by-name/${encodeURIComponent(t)}`));e?.data?.id&&this.selectedConceptId$.set(e.data.id)}catch{}}closeConceptPanel(){this.selectedConceptId$.set(null)}onRelatedConceptClick(t){this.selectedConceptId$.set(t)}onViewMessage(t){this.activeTab$.set("chat"),setTimeout(()=>{let e=document.getElementById(`msg-${t.messageId}`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("highlight-flash"),setTimeout(()=>e.classList.remove("highlight-flash"),2e3))},100)}async onPersonaSelected(t){let e=this.activeConversationId$();if(e){if(t)try{let n=await this.conversationService.updatePersona(e,t.type);this.activeConversation$.update(i=>i&&te(V({},i),{personaType:n.personaType}))}catch{this.showError("Gre\u0161ka pri a\u017Euriranju persone")}this.showPersonaSelector$.set(!1)}}async onConceptSelected(t){if(t.isFolder){this.folderConceptIds$.set(t.descendantConceptIds),this.folderConversationIds$.set(t.descendantConversationIds),this.folderName$.set(t.conceptName),this.activeConversation$.set(null),this.activeTab$.set("notes");let e=Math.min(t.descendantConversationIds.length,t.descendantConceptIds.length);this.domainCompletedCount$.set(e),this.domainPendingCount$.set(Math.max(0,t.descendantConceptIds.length-e));return}this.folderConceptIds$.set([]),this.folderConversationIds$.set([]),this.folderName$.set(null);try{let e=this.conceptTree?.treeData$(),n=this.findNodeByCurriculumId(e?.tree??[],t.curriculumId);if(n&&n.conversations.length>0){let i=n.conversations[0];await this.loadConversation(i.id),this.router.navigate(["/chat",i.id]),this.activeTab$.set("chat")}else{let i=this.formatConversationTitle(t.conceptName),a=await this.conversationService.createConversation(i,void 0,void 0,t.curriculumId);this.newConversationIds$.update(s=>{let m=new Set(s);return m.add(a.id),m}),await this.loadConversation(a.id),this.router.navigate(["/chat",a.id]),this.conceptTree?.loadTree(),this.activeTab$.set("chat")}}catch{this.showError("Gre\u0161ka pri u\u010Ditavanju koncepta")}}findNodeByCurriculumId(t,e){for(let n of t){if(n.curriculumId===e)return n;let i=this.findNodeByCurriculumId(n.children,e);if(i)return i}return null}formatConversationTitle(t){let e=new Date,n=e.toISOString().slice(0,10),i=e.toTimeString().slice(0,5).replace(":","-");return`${t}_${n}_${i}`}planGenerationTimeout=null;async onRunAgents(t){if(t.length===0)return;let e=this.activeConversationId$();if(!e){let n=this.conversationNotes?.notes()?.find(i=>t.includes(i.id));if(n?.conversationId)e=n.conversationId,await this.loadConversation(e),this.router.navigate(["/chat",e]);else try{let i=n?.conceptId??void 0,a=n?.title?`${n.title}`:"Izvr\u0161avanje zadatka";e=(await this.conversationService.createConversation(a,void 0,i)).id,await this.loadConversation(e),this.router.navigate(["/chat",e]),this.conceptTree?.loadTree()}catch{this.showError("Gre\u0161ka pri kreiranju konverzacije za zadatak.");return}}this.isGeneratingPlan$.set(!0),this.chatWsService.emitRunAgents(t,e),this.planGenerationTimeout&&clearTimeout(this.planGenerationTimeout),this.planGenerationTimeout=setTimeout(()=>{this.isGeneratingPlan$()&&(this.isGeneratingPlan$.set(!1),this.showError("Generisanje plana je trajalo predugo \u2014 poku\u0161ajte ponovo."))},9e4),setTimeout(()=>{let n=this.messagesContainer?.nativeElement;n&&(n.scrollTop=n.scrollHeight)})}onExecuteSingleTask(t){this.activeTab$.set("chat"),this.onRunAgents([t])}resultSubmissionTimeout=null;onSubmitTaskResult(t){this.submittingResultId$.set(t),this.taskResultStreamContent$.set(""),this.chatWsService.emitSubmitTaskResult(t),this.resultSubmissionTimeout&&clearTimeout(this.resultSubmissionTimeout),this.resultSubmissionTimeout=setTimeout(()=>{this.submittingResultId$()===t&&(this.submittingResultId$.set(null),this.taskResultStreamContent$.set(""),this.showError("Ocenjivanje rezultata je isteklo. Poku\u0161ajte ponovo."))},6e4)}async onRunBrain(){let t=this.folderName$(),e=this.folderConceptIds$();if(!(!t||e.length===0))try{let n=`Brain: ${t}`,i=await this.conversationService.createConversation(n);await this.loadConversation(i.id);let s=(await this.notesApi.getByConceptIds(e)).filter(m=>m.noteType==="TASK"&&m.status==="PENDING").map(m=>m.id);if(s.length===0){this.showError("Nema zadataka na \u010Dekanju u ovom domenu.");return}this.onRunAgents(s)}catch{this.showError("Pokretanje Brain-a nije uspelo. Poku\u0161ajte ponovo.")}}async onRunBrainYolo(){let t=this.folderName$();if(t)try{let e=`Brain: ${t}`,n=await this.conversationService.createConversation(e);await this.loadConversation(n.id),this.isYoloMode$.set(!0),this.chatWsService.emitStartDomainYolo(n.id,t)}catch{this.showError("Pokretanje YOLO re\u017Eima nije uspelo.")}}navigateToWorkflow(t){if(this.selectedWorkflowPlanId$()===t.planId&&this.showPlanOverlay$()){this.showPlanOverlay$.set(!1),this.selectedWorkflowPlanId$.set(null);return}t.conversationId!==this.activeConversationId$()&&(this.folderConceptIds$.set([]),this.folderConversationIds$.set([]),this.folderName$.set(null),this.router.navigate(["/chat",t.conversationId]));let n=this.workflowPlans$().get(t.planId);n&&(this.currentPlan$.set(n),this.executionProgress$.set(this.workflowProgressMaps$().get(t.planId)??new Map),this.activePlanId$.set(t.planId),this.selectedWorkflowPlanId$.set(t.planId),this.showPlanOverlay$.set(!0),this.planCollapsed$.set(!1)),this.activeTab$.set("notes"),this.autoSelectTaskIds$.set(t.taskIds.length>0?t.taskIds:[])}getStepStatus(t){return this.executionProgress$().get(t)??"pending"}approvePlan(){let t=this.currentPlan$(),e=this.activeConversationId$();if(!t||!e)return;this.executingWorkflowConversationIds$.update(i=>new Set([...i,e])),this.planCollapsed$.set(!0),this.chatWsService.emitWorkflowApproval(t.planId,!0,e);let n=t.steps[0]?.conceptName??"Workflow";this.workflowHistory$.update(i=>[...i,{planId:t.planId,conversationId:e,taskIds:t.steps.map(a=>a.taskId).filter(Boolean),title:t.conceptOrder.length>1?`${n} (+${t.conceptOrder.length-1})`:n,totalSteps:t.steps.length,completedSteps:0,currentStepTitle:null,status:"executing"}])}rejectPlan(){let t=this.currentPlan$(),e=this.activeConversationId$();!t||!e||(this.chatWsService.emitWorkflowApproval(t.planId,!1,e),this.isApprovingPlan$.set(!1),this.closePlanOverlay())}cancelExecution(){let t=this.activePlanId$()??this.currentPlan$()?.planId,e=this.activeConversationId$();!t||!e||this.chatWsService.emitWorkflowCancel(t,e)}togglePlanCollapse(){this.planCollapsed$.update(t=>!t)}closePlanOverlay(){this.showPlanOverlay$.set(!1),this.currentPlan$.set(null),this.activePlanId$.set(null),this.executionProgress$.set(new Map),this.selectedWorkflowPlanId$.set(null),this.isApprovingPlan$.set(!1),this.currentStepTitle$.set(null),this.currentStepIndex$.set(0),this.totalStepsCount$.set(0),this.completedStepsCount$.set(0),this.createdConceptConversations$.set([]),this.awaitingConfirmation$.set(!1),this.nextStepInfo$.set(null),this.userStepInput$.set(""),this.isGeneratingPlan$.set(!1),this.allowWorkflowInput$.set(!1),this.currentWorkflowStepInput$.set(null),this.previousConversationId$.set(null)}async sendMessage(t){let e=this.activeConversationId$();if(!e||!t.trim())return;this.activeTab$()!=="chat"&&this.activeTab$.set("chat");let n=this.currentWorkflowStepInput$();if(n&&n.inputType==="text"){let s={id:`wf_user_${Date.now()}`,conversationId:e,role:"USER",content:t,confidenceScore:null,confidenceFactors:null,createdAt:new Date().toISOString()};this.activeConversation$.update(m=>m&&te(V({},m),{messages:[...m.messages,s]})),this.chatWsService.emitStepContinue(n.planId,e,t),this.currentWorkflowStepInput$.set(null),this.allowWorkflowInput$.set(!1),this.isLoading$.set(!0);return}this.isLoading$.set(!0),this.streamingContent$.set("");let i={id:`temp_${Date.now()}`,conversationId:e,role:"USER",content:t,confidenceScore:null,confidenceFactors:null,createdAt:new Date().toISOString()};this.activeConversation$.update(s=>s&&te(V({},s),{messages:[...s.messages,i]})),this.chatWsService.sendMessage(e,t)||(this.isLoading$.set(!1),this.showError("Konekcija sa serverom nije uspostavljena. Osve\u017Eite stranicu."))}setupWebSocket(){this.chatWsService.connect();let t=!1,e=setInterval(()=>{let n=this.chatWsService.connectionState$();n==="disconnected"&&t?this.disconnectToast$.set("Veza prekinuta. Poku\u0161avam ponovo..."):n==="reconnecting"?this.disconnectToast$.set("Ponovno povezivanje..."):n==="connected"&&!t&&this.disconnectToast$()&&(this.chatWsService.wasWorkflowActive$()?(this.disconnectToast$.set("Veza obnovljena. Workflow je mo\u017Eda nastavljen u pozadini."),this.chatWsService.wasWorkflowActive$.set(!1)):this.disconnectToast$.set("Veza obnovljena."),setTimeout(()=>{this.connectionState$()==="connected"&&this.disconnectToast$.set(null)},3e3)),t=n==="connected",this.chatWsService.setWorkflowRunning(this.isExecutingWorkflow$()||this.isYoloMode$());let i=this.chatWsService.lastEmitError$();i&&(this.disconnectToast$.set(i),this.chatWsService.lastEmitError$.set(null),setTimeout(()=>this.disconnectToast$.set(null),5e3));let a=this.notesApi.lastError$();a&&(this.disconnectToast$.set(a),this.notesApi.lastError$.set(null),setTimeout(()=>this.disconnectToast$.set(null),5e3))},500);this.destroyRef.onDestroy(()=>clearInterval(e)),this.chatWsService.onMessageReceived(n=>{this.activeConversation$.update(i=>{if(!i)return i;let a=i.messages.map((s,m,d)=>s.role==="USER"&&s.id.startsWith("temp_")&&!d.slice(m+1).some(k=>k.role==="USER"&&k.id.startsWith("temp_"))?te(V({},s),{id:n.messageId}):s);return te(V({},i),{messages:a})}),this.isStreaming$.set(!0)}),this.chatWsService.onMessageChunk(n=>{this.streamBuffer+=n.content,this.streamRafId||(this.streamRafId=requestAnimationFrame(()=>{this.streamingContent$.update(i=>i+this.streamBuffer),this.streamBuffer="",this.streamRafId=null}))}),this.chatWsService.onResearchPhase(n=>{this.researchPhase$.set(n.phase==="researching"?"researching":"thinking")}),this.chatWsService.onComplete(n=>{let i=n.metadata?.confidence,a=n.metadata?.citations??[],s=n.metadata?.memoryAttributions??[],m=n.metadata?.webSearchSources??[],d=n.metadata?.suggestedActions??[],y={id:n.messageId,conversationId:this.activeConversationId$()??"",role:"ASSISTANT",content:n.fullContent,confidenceScore:i?.score??null,confidenceFactors:i?.factors??null,citations:a.length>0?a:void 0,memoryAttributions:s.length>0?s:void 0,webSearchSources:m.length>0?m:void 0,suggestedActions:d.length>0?d:void 0,createdAt:new Date().toISOString()};this.activeConversation$.update(k=>k&&te(V({},k),{messages:[...k.messages,y]})),this.isLoading$.set(!1),this.isStreaming$.set(!1),this.streamingContent$.set(""),this.researchPhase$.set("thinking")}),this.chatWsService.onError(n=>{this.isLoading$.set(!1),this.isStreaming$.set(!1),this.researchPhase$.set("thinking");let i=n.type?`[${n.type}] `:"";this.showError(i+(n.message||"Poruka nije poslata. Poku\u0161ajte ponovo."))}),this.chatWsService.onNotesUpdated(()=>{this.conversationNotes?.loadNotes()}),this.chatWsService.onTasksCreatedForExecution(n=>{if(n.conversationId!==this.activeConversationId$())return;n.taskIds.length>0&&this.autoSelectTaskIds$.set(n.taskIds),this.conversationNotes?.loadNotes(),this.conceptTree?.loadTree();let i=n.taskCount??n.taskIds.length,a=`**Kreirano ${i} ${i===1?"zadatak":"zadataka"}!**`;a+=" Kliknite na dugme ispod da biste pre\u0161li na zadatak.";let s={id:`tasks_created_${Date.now()}`,conversationId:n.conversationId,role:"ASSISTANT",content:a,confidenceScore:null,confidenceFactors:null,createdAt:new Date().toISOString()};this.activeConversation$.update(m=>m&&te(V({},m),{messages:[...m.messages,s]})),this.autoAiPopuni$()&&n.taskIds.length>0&&setTimeout(()=>{let m=n.conversationId;for(let d of n.taskIds)this.chatWsService.emitExecuteTaskAi(d,m)},1500)}),this.chatWsService.onConceptDetected(n=>{this.conceptTree?.loadTree(),n.conversationId===this.activeConversationId$()&&this.activeConversation$.update(i=>i&&te(V({},i),{conceptId:n.conceptId}))}),this.chatWsService.onPlanReady(n=>{n.conversationId===this.activeConversationId$()&&(this.planGenerationTimeout&&(clearTimeout(this.planGenerationTimeout),this.planGenerationTimeout=null),this.isGeneratingPlan$.set(!1),this.executingTaskId$.set(null),this.currentPlan$.set(n.plan),this.activePlanId$.set(n.plan.planId),this.executionProgress$.set(new Map),this.showPlanOverlay$.set(!0))}),this.chatWsService.onConversationsCreated(n=>{n.originalConversationId===this.activeConversationId$()&&(this.createdConceptConversations$.set(n.conversations),this.newConversationIds$.update(i=>{let a=new Set(i);return n.conversations.forEach(s=>a.add(s.conversationId)),a}),this.conceptTree?.loadTree())}),this.chatWsService.onStepProgress(n=>{if(n.conversationId===this.activeConversationId$()){if(this.executingWorkflowConversationIds$.update(i=>new Set([...i,n.conversationId])),!this.activePlanId$()&&n.planId&&this.activePlanId$.set(n.planId),this.executionProgress$.update(i=>{let a=new Map(i);return a.set(n.stepId,n.status),a}),n.planId&&this.workflowHistory$.update(i=>i.map(a=>a.planId===n.planId?te(V({},a),{currentStepTitle:n.status==="in_progress"?n.stepTitle??a.currentStepTitle:a.currentStepTitle,completedSteps:n.status==="completed"||n.status==="failed"?a.completedSteps+1:a.completedSteps}):a)),n.totalSteps!=null&&this.totalStepsCount$.set(n.totalSteps),n.status==="in_progress"){this.currentStepTitle$.set(n.stepTitle??"Izvr\u0161avanje..."),n.stepIndex!=null&&this.currentStepIndex$.set(n.stepIndex);let i=n.stepTitle??"Korak",a=(n.stepIndex??0)+1,s=n.totalSteps??0,m={id:`wf_status_${n.stepId}`,conversationId:this.activeConversationId$()??"",role:"ASSISTANT",content:`**Izvr\u0161avam korak ${a}/${s}:** ${i}`,confidenceScore:null,confidenceFactors:null,createdAt:new Date().toISOString()};this.activeConversation$.update(d=>d&&te(V({},d),{messages:[...d.messages,m]}))}if(n.status==="completed"&&n.content){this.completedStepsCount$.update(s=>s+1),this.conceptTree?.loadTree(),this.conversationNotes?.loadNotes();let i=this.completedStepsCount$(),a=this.totalStepsCount$();i<a&&this.currentStepTitle$.set("Pripremam slede\u0107i korak...")}if(n.status==="completed"&&!n.content){this.completedStepsCount$.update(s=>s+1),this.conceptTree?.loadTree(),this.conversationNotes?.loadNotes();let i=this.completedStepsCount$(),a=this.totalStepsCount$();i<a&&this.currentStepTitle$.set("Pripremam slede\u0107i korak...")}n.status==="failed"&&(this.completedStepsCount$.update(i=>i+1),this.conceptTree?.loadTree(),this.conversationNotes?.loadNotes())}}),this.chatWsService.onWorkflowComplete(n=>{if(n.conversationId!==this.activeConversationId$())return;let i=n.status==="completed"?"Zavr\u0161eno":n.status==="cancelled"?"Otkazano":"Gre\u0161ka",a=this.createdConceptConversations$(),s=`**${i}!** Izvr\u0161eno ${n.completedSteps}/${n.totalSteps} koraka.`;a.length>0&&(s+=`

**Rezultati po konceptima:**`,a.forEach((d,y)=>{s+=`
${y+1}. [[${d.conceptName}]]`}),s+=`

Kliknite na koncept ili odaberite konverzaciju u drvetu sa leve strane da pregledate rezultate.`);let m={id:`wf_summary_${n.planId}`,conversationId:this.activeConversationId$()??"",role:"ASSISTANT",content:s,confidenceScore:null,confidenceFactors:null,createdAt:new Date().toISOString()};if(this.activeConversation$.update(d=>d&&te(V({},d),{messages:[...d.messages,m]})),this.currentStepTitle$.set(null),this.currentStepIndex$.set(0),this.totalStepsCount$.set(0),this.completedStepsCount$.set(0),this.executingWorkflowConversationIds$.update(d=>{let y=new Set(d);return y.delete(n.conversationId),y}),this.closePlanOverlay(),this.conversationNotes?.loadNotes(),this.conceptTree?.loadTree(),n.planId){let d=n.status==="completed"?"completed":n.status==="cancelled"?"cancelled":"failed";this.workflowHistory$.update(y=>y.map(k=>k.planId===n.planId?te(V({},k),{status:d,completedSteps:n.completedSteps}):k)),setTimeout(()=>{this.workflowHistory$.update(y=>y.filter(k=>k.planId!==n.planId))},3e4)}n.status==="completed"&&setTimeout(()=>this.suggestNextStep(),1500)}),this.chatWsService.onWorkflowError(n=>{this.executingWorkflowConversationIds$.update(i=>{let a=new Set(i);return a.delete(n.conversationId),a}),n.conversationId===this.activeConversationId$()&&(this.closePlanOverlay(),this.isYoloMode$.set(!1),this.yoloProgress$.set(null),this.showError(n.message??"Izvr\u0161avanje workflow-a neuspe\u0161no"))}),this.chatWsService.onTaskAiStart(n=>{n.conversationId&&n.conversationId!==this.activeConversationId$()||(this.isGeneratingPlan$()&&(this.isGeneratingPlan$.set(!1),this.planGenerationTimeout&&(clearTimeout(this.planGenerationTimeout),this.planGenerationTimeout=null)),this.executingTaskId$.set(n.taskId),this.taskExecutionStreamContent$.set(""),this.isStreaming$.set(!0),this.streamingContent$.set(""))}),this.chatWsService.onTaskAiChunk(n=>{n.conversationId&&n.conversationId!==this.activeConversationId$()||(this.streamBuffer+=n.content,this.streamRafId||(this.streamRafId=requestAnimationFrame(()=>{this.streamingContent$.update(i=>i+this.streamBuffer),this.taskExecutionStreamContent$.update(i=>i+this.streamBuffer),this.streamBuffer="",this.streamRafId=null})))}),this.chatWsService.onTaskAiComplete(n=>{if(n.conversationId!==this.activeConversationId$())return;this.isStreaming$.set(!1),this.streamingContent$.set(""),this.taskExecutionStreamContent$.set(""),this.executingTaskId$.set(null),this.conversationNotes?.loadNotes();let i=this.activeConversationId$();i&&this.loadConversation(i)}),this.chatWsService.onTaskAiError(n=>{n.conversationId&&n.conversationId!==this.activeConversationId$()||(this.isStreaming$.set(!1),this.streamingContent$.set(""),this.taskExecutionStreamContent$.set(""),this.executingTaskId$.set(null),this.showError(n.message??"Izvr\u0161avanje zadatka neuspe\u0161no"))}),this.chatWsService.onTaskResultChunk(n=>{n.conversationId&&n.conversationId!==this.activeConversationId$()||this.taskResultStreamContent$.update(i=>i+n.content)}),this.chatWsService.onTaskResultComplete(n=>{n.conversationId&&n.conversationId!==this.activeConversationId$()||(this.resultSubmissionTimeout&&(clearTimeout(this.resultSubmissionTimeout),this.resultSubmissionTimeout=null),this.submittingResultId$.set(null),this.taskResultStreamContent$.set(""),this.conversationNotes?.loadNotes())}),this.chatWsService.onTaskResultError(n=>{n.conversationId&&n.conversationId!==this.activeConversationId$()||(this.resultSubmissionTimeout&&(clearTimeout(this.resultSubmissionTimeout),this.resultSubmissionTimeout=null),this.submittingResultId$.set(null),this.taskResultStreamContent$.set(""),this.showError(n.message??"Slanje rezultata neuspe\u0161no"))}),this.chatWsService.onAutoPopuniStart(n=>{this.autoPopuniTaskIds$.set(n.taskIds)}),this.chatWsService.onAutoPopuniComplete(()=>{this.autoPopuniTaskIds$.set([]),this.conversationNotes?.loadNotes(),this.conceptTree?.loadTree()}),this.chatWsService.onAutoPopuniTaskError(()=>{}),this.chatWsService.onExecutionActiveState(n=>{let i=!1,a=!1;for(let m of n.active){if((m.type==="yolo"||m.type==="domain-yolo")&&!i){i=!0,this.isYoloMode$.set(!0),m.conversationId&&this.executingWorkflowConversationIds$.update(D=>{let $=new Set(D);return $.add(m.conversationId),$});let d=m.checkpoint,y=d.completed??d.completedCount??0,k=d.failed??d.failedCount??0;this.yoloProgress$.set({planId:d.planId??m.planId??"resume",running:d.running??0,maxConcurrency:d.maxConcurrency??3,completed:y,failed:k,total:d.total??0,discoveredCount:d.discoveredCount??0,currentTasks:d.currentTasks??[],conversationId:d.conversationId??m.conversationId??""}),this.chatWsService.replayEvents(m.id,m.createdAt)}if(m.type==="workflow"&&!a){a=!0,m.conversationId&&this.executingWorkflowConversationIds$.update(y=>{let k=new Set(y);return k.add(m.conversationId),k}),m.planId&&(this.activePlanId$.set(m.planId),this.showPlanOverlay$.set(!0));let d=m.checkpoint;d.lastCompletedStepIndex!=null&&(this.completedStepsCount$.set(d.lastCompletedStepIndex+1),this.currentStepIndex$.set(d.lastCompletedStepIndex+1)),d.totalSteps!=null&&this.totalStepsCount$.set(d.totalSteps),d.currentStepTitle&&this.currentStepTitle$.set(d.currentStepTitle),this.chatWsService.replayEvents(m.id,m.createdAt)}if(m.type==="auto-popuni"){let d=m.metadata;Array.isArray(d?.taskIds)&&this.autoPopuniTaskIds$.set(d.taskIds)}}let s=!1;for(let m of n.recentlyCompleted){let d=m.type==="yolo"||m.type==="domain-yolo"?"YOLO":m.type==="workflow"?"Workflow":"Auto AI";this.showError(`Brain je radio dok ste bili odsutni: ${d} zavr\u0161en`),s=!0}s&&(this.conceptTree?.loadTree(),this.conversationNotes?.loadNotes())}),this.chatWsService.onStepAwaitingConfirmation(n=>{n.conversationId===this.activeConversationId$()&&(this.activePlanId$.set(n.planId),!this.isCurrentConversationExecuting$()&&(this.awaitingConfirmation$.set(!0),this.nextStepInfo$.set(n.nextStep),this.userStepInput$.set("")))}),this.chatWsService.onStepAwaitingInput(n=>{n.conversationId===this.activeConversationId$()&&n.inputType!=="confirmation"&&(this.currentWorkflowStepInput$.set(n),this.allowWorkflowInput$.set(n.inputType==="text"),this.isLoading$.set(!1))}),this.chatWsService.onStepMessage(n=>{if(n.conversationId!==this.activeConversationId$())return;let i={id:n.messageId,conversationId:n.conversationId,role:"ASSISTANT",content:n.content,confidenceScore:null,confidenceFactors:null,createdAt:new Date().toISOString()};this.activeConversation$.update(a=>a&&te(V({},a),{messages:[...a.messages,i]}))}),this.chatWsService.onNavigateToConversation(n=>{}),this.chatWsService.onYoloProgress(n=>{this.executingWorkflowConversationIds$.update(i=>new Set([...i,n.conversationId])),n.conversationId===this.activeConversationId$()&&(this.yoloProgress$.set(n),this.showYoloActivityLog$()&&this.yoloLogContainer?.nativeElement&&setTimeout(()=>{let i=this.yoloLogContainer?.nativeElement;i&&(i.scrollTop=i.scrollHeight)}))}),this.chatWsService.onYoloComplete(n=>{this.executingWorkflowConversationIds$.update(i=>{let a=new Set(i);return a.delete(n.conversationId),a}),n.conversationId===this.activeConversationId$()&&(this.yoloProgress$.set(null),this.isYoloMode$.set(!1),this.conversationNotes?.loadNotes(),this.conceptTree?.loadTree(),setTimeout(()=>this.suggestNextStep(),1500))}),this.chatWsService.onTasksDiscovered(()=>{this.conceptTree?.loadTree()}),this.chatWsService.onAutoPopuniStart(n=>{this.autoPopuniTaskIds$.set(n.taskIds)}),this.chatWsService.onAutoPopuniComplete(n=>{this.autoPopuniTaskIds$.set([]),this.conversationNotes?.loadNotes(),this.conceptTree?.loadTree(),n.completedTasks<n.totalTasks&&this.showError(`Auto AI: ${n.completedTasks}/${n.totalTasks} zadataka uspe\u0161no popunjeno`)}),this.chatWsService.onAutoPopuniTaskError(()=>{}),this.chatWsService.onExecutionActiveState(n=>{let i=!1,a=!1;for(let m of n.active){if((m.type==="yolo"||m.type==="domain-yolo")&&!i){i=!0,this.isYoloMode$.set(!0),m.conversationId&&this.executingWorkflowConversationIds$.update(D=>{let $=new Set(D);return $.add(m.conversationId),$});let d=m.checkpoint,y=d.completed??d.completedCount??0,k=d.failed??d.failedCount??0;this.yoloProgress$.set({planId:d.planId??m.planId??"resume",running:d.running??0,maxConcurrency:d.maxConcurrency??3,completed:y,failed:k,total:d.total??0,discoveredCount:d.discoveredCount??0,currentTasks:d.currentTasks??[],conversationId:d.conversationId??m.conversationId??""}),this.chatWsService.replayEvents(m.id,m.createdAt)}if(m.type==="workflow"&&!a){a=!0,m.conversationId&&this.executingWorkflowConversationIds$.update(y=>{let k=new Set(y);return k.add(m.conversationId),k}),m.planId&&(this.activePlanId$.set(m.planId),this.showPlanOverlay$.set(!0));let d=m.checkpoint;d.lastCompletedStepIndex!=null&&(this.completedStepsCount$.set(d.lastCompletedStepIndex+1),this.currentStepIndex$.set(d.lastCompletedStepIndex+1)),d.totalSteps!=null&&this.totalStepsCount$.set(d.totalSteps),d.currentStepTitle&&this.currentStepTitle$.set(d.currentStepTitle),this.chatWsService.replayEvents(m.id,m.createdAt)}if(m.type==="auto-popuni"){let d=m.metadata;Array.isArray(d?.taskIds)&&this.autoPopuniTaskIds$.set(d.taskIds)}}let s=!1;for(let m of n.recentlyCompleted){let d=m.type==="yolo"||m.type==="domain-yolo"?"YOLO":m.type==="workflow"?"Workflow":"Auto AI";this.showInfo(`Brain je radio dok ste bili odsutni: ${d} zavr\u0161en`),s=!0}s&&(this.conceptTree?.loadTree(),this.conversationNotes?.loadNotes())})}continueWorkflow(){let t=this.activePlanId$(),e=this.activeConversationId$();if(!t||!e||this.isProcessingStep$())return;this.isProcessingStep$.set(!0);let n=this.userStepInput$().trim()||void 0;this.chatWsService.emitStepContinue(t,e,n),this.awaitingConfirmation$.set(!1),this.nextStepInfo$.set(null),this.userStepInput$.set(""),setTimeout(()=>this.isProcessingStep$.set(!1),1e3)}continueWorkflowStep(){let t=this.currentWorkflowStepInput$(),e=this.activeConversationId$();!t||!e||this.isProcessingStep$()||(this.isProcessingStep$.set(!0),this.chatWsService.emitStepContinue(t.planId,e),this.currentWorkflowStepInput$.set(null),this.allowWorkflowInput$.set(!1),setTimeout(()=>this.isProcessingStep$.set(!1),1e3))}returnToPreviousConversation(){let t=this.previousConversationId$();t&&(this.previousConversationId$.set(null),this.router.navigate(["/chat",t]))}toggleYoloActivityLog(){this.showYoloActivityLog$.update(t=>!t)}suggestNextStep(){let t=this.conceptTree?.treeData$()?.tree??[];if(t.length!==0){for(let e of t)if(this.domainHasPending(e)){this.nextStepSuggestion$.set({message:`Preporu\u010Dujem: ${e.label} \u2014 ima zadatke na \u010Dekanju.`,actionLabel:`Otvori ${e.label} \u2192`,actionCurriculumId:e.curriculumId,secondaryLabel:"Poka\u017Ei sve domene"}),this.nextStepDismissTimer&&clearTimeout(this.nextStepDismissTimer),this.nextStepDismissTimer=setTimeout(()=>this.nextStepSuggestion$.set(null),6e4);return}this.nextStepSuggestion$.set({message:"Svi zadaci su zavr\u0161eni. Pregledajte rezultate ili zapo\u010Dnite novi koncept.",actionLabel:"Pogledaj zadatke"}),this.nextStepDismissTimer&&clearTimeout(this.nextStepDismissTimer),this.nextStepDismissTimer=setTimeout(()=>this.nextStepSuggestion$.set(null),6e4)}}domainHasPending(t){return t.status==="pending"?!0:t.children.some(e=>this.domainHasPending(e))}dismissNextStep(){this.nextStepSuggestion$.set(null),this.nextStepDismissTimer&&(clearTimeout(this.nextStepDismissTimer),this.nextStepDismissTimer=null)}onNextStepAction(){let t=this.nextStepSuggestion$();if(t){if(t.actionCurriculumId){let n=(this.conceptTree?.treeData$()?.tree??[]).find(i=>i.curriculumId===t.actionCurriculumId);if(n){let i=this.collectAllConceptIds(n),a=this.collectAllConversationIds(n);this.onConceptSelected({conceptId:null,curriculumId:n.curriculumId,conceptName:n.label,isFolder:!0,descendantConceptIds:i,descendantConversationIds:a})}}else this.activeTab$.set("notes");this.dismissNextStep()}}collectAllConceptIds(t){let e=[];t.conceptId&&e.push(t.conceptId);for(let n of t.children)e.push(...this.collectAllConceptIds(n));return e}collectAllConversationIds(t){let e=[];for(let n of t.conversations)e.push(n.id);for(let n of t.children)e.push(...this.collectAllConversationIds(n));return e}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=ie({type:o,selectors:[["app-chat"]],viewQuery:function(e,n){if(e&1&&an(jt,5)(Ht,5)(fd,5)(Cd,5),e&2){let i;Je(i=et())&&(n.conceptTree=i.first),Je(i=et())&&(n.conversationNotes=i.first),Je(i=et())&&(n.yoloLogContainer=i.first),Je(i=et())&&(n.messagesContainer=i.first)}},decls:30,vars:8,consts:[["messagesContainer",""],["yoloLogContainer",""],["role","alert",1,"error-toast",3,"top"],["role","status",1,"info-toast",3,"top"],[1,"layout"],[1,"sidebar"],[1,"sidebar-header"],[1,"sidebar-actions"],[1,"new-chat-btn",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","16px","height","16px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[3,"conversationSelected","newChatRequested","conceptSelected","activeConversationId","locked","newConversationIds","loadingItemId"],[1,"sidebar-footer"],["routerLink","/admin/llm-config"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["routerLink","/dashboard"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"],[1,"chat-main"],[1,"empty-state"],[1,"right-panel"],["role","alert",1,"error-toast"],["fill","currentColor","viewBox","0 0 20 20",2,"width","20px","height","20px","color","#EF4444","flex-shrink","0"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[2,"font-size","13px","color","#FAFAFA"],["aria-label","Dismiss",2,"background","none","border","none","color","#a1a1a1","cursor","pointer","margin-left","auto",3,"click"],["fill","currentColor","viewBox","0 0 20 20",2,"width","16px","height","16px"],["fill-rule","evenodd","d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule","evenodd"],["role","status",1,"info-toast"],["fill","currentColor","viewBox","0 0 20 20",2,"width","20px","height","20px","color","#3B82F6","flex-shrink","0"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],["aria-label","Zatvori",2,"background","none","border","none","color","#a1a1a1","cursor","pointer","margin-left","auto",3,"click"],[3,"topicSelected","cancelled"],[1,"chat-header"],[1,"chat-header-left"],[1,"connection-dot",3,"title"],[1,"header-actions"],[1,"disconnect-toast",3,"error","warning","success"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","18px","height","18px","color","#3B82F6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"],[3,"personaType"],[1,"tab-bar",2,"border-bottom","none"],[1,"tab",3,"click"],[1,"switch-btn",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"],[1,"auto-ai-toggle"],[1,"auto-ai-label"],[1,"toggle-track",3,"click","disabled"],[1,"toggle-thumb"],[1,"disconnect-toast"],[1,"disconnect-toast-close",3,"click"],[1,"next-step-banner"],[2,"flex-shrink","0"],[3,"messageSent","disabled"],[1,"persona-selector-panel"],[1,"plan-inline-panel",3,"collapsed"],[1,"workflow-status-bar"],[1,"chat-messages"],[1,"messages-container"],[2,"display","block","margin-bottom","16px",3,"message","personaType"],[1,"step-status-msg"],[1,"yolo-progress"],[1,"task-nav-card"],[3,"message","isStreaming","personaType"],[3,"personaType","phase"],[1,"step-confirmation"],[1,"return-link-container"],[1,"persona-selector-label"],[3,"personaSelected","selectedType","allowNone"],[1,"plan-inline-panel"],[1,"plan-header",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"plan-collapse-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"plan-meta"],[1,"plan-steps"],[1,"plan-step"],[1,"plan-btn-cancel"],[1,"plan-btn-cancel",3,"click"],[1,"plan-btn-approve",3,"click"],[1,"step-indicator"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"spinner",2,"width","16px","height","16px"],["fill","currentColor","viewBox","0 0 20 20",2,"width","14px","height","14px"],[1,"step-info"],[1,"step-title"],[1,"step-desc"],[1,"step-tags"],[1,"step-tag"],["stroke-linecap","round","stroke-width","2","d","M4 12a8 8 0 018-8"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"],[1,"workflow-status-entry","wse-executing",2,"border-left-color","#F59E0B"],[1,"workflow-status-entry",3,"wse-executing","wse-completed","wse-failed","wse-cancelled"],[1,"ws-title"],[1,"ws-progress-bar"],[1,"ws-progress-fill",2,"background","#F59E0B"],[1,"ws-count"],[1,"ws-current"],[1,"ws-badge-fail"],[2,"color","#10B981","font-size","11px","font-weight","600"],[1,"workflow-status-entry"],[1,"ws-detail-row"],[1,"ws-progress-fill"],[1,"ws-badge-done"],[2,"display","block","margin-bottom","16px",3,"citationClick","actionClick","message","personaType"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"step-icon","spinner"],[1,"yolo-progress-title"],[1,"yolo-spinner"],[1,"yolo-progress-stats"],[1,"yolo-progress-bar"],[1,"yolo-progress-fill"],[1,"yolo-workers"],[1,"yolo-failed"],[1,"yolo-deferred"],[1,"yolo-discovered"],[1,"yolo-worker-item"],[1,"yolo-worker-spinner"],[1,"yolo-worker-concept"],[1,"yolo-worker-step"],[1,"yolo-activity-toggle",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"yolo-toggle-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"yolo-activity-log"],[1,"yolo-log-entry"],[1,"task-nav-header"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"task-nav-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"],[1,"task-nav-dismiss",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","14px","height","14px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"task-nav-btn",3,"cross-concept"],[1,"task-nav-btn",3,"click"],[1,"task-nav-title"],[1,"task-nav-concept"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","12px","height","12px"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 7l5 5m0 0l-5 5m5-5H6"],[1,"confirmation-header"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","#3B82F6","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","10"],["points","12 6 12 12 16 14"],[1,"confirmation-label"],[1,"confirmation-title"],[1,"confirmation-desc"],[1,"confirmation-actions"],[1,"input-prompt"],[1,"confirm-btn","primary",3,"click","disabled"],[1,"confirm-btn","cancel",3,"click","disabled"],[1,"btn-spinner"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","5","y1","12","x2","19","y2","12"],["points","12 5 19 12 12 19"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","#F59E0B","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"],[1,"return-link",3,"click"],["x1","19","y1","12","x2","5","y2","12"],["points","12 19 5 12 12 5"],["placeholder","Unesite va\u0161e odgovore, podatke o kompaniji, specifi\u010Dne zahteve...","rows","4",1,"confirmation-input",3,"input","value"],[1,"brain-status-bar"],[1,"notes-view",2,"flex","1","overflow-y","auto"],[3,"viewMessage","runAgents","executeTask","submitTaskResult","conversationId","conceptId","autoSelectTaskIds","isExecuting","executingTaskId","taskExecutionContent","submittingResultId","taskResultContent","isGeneratingPlan"],[1,"brain-status-label"],[1,"brain-progress-bar"],[1,"brain-progress-fill"],[1,"brain-stat"],[1,"brain-stat",2,"color","#F59E0B"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"next-step-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"],[1,"next-step-text"],[1,"next-step-actions"],[1,"next-step-btn","primary",3,"click"],[1,"next-step-btn","secondary"],[1,"next-step-close",3,"click"],[1,"next-step-btn","secondary",3,"click"],[1,"domain-dashboard"],[1,"domain-stats"],[1,"stat-card"],[1,"stat-label"],[1,"stat-value","completed"],[1,"stat-value","pending"],[1,"stat-value"],[1,"domain-actions"],[1,"run-brain-btn",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 10V3L4 14h7v7l9-11h-7z"],["title","YOLO re\u017Eim (bez pregleda plana)",1,"yolo-btn",3,"click","disabled"],[1,"add-investigation-btn",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"notes-view"],[3,"viewMessage","runAgents","executeTask","submitTaskResult","conversationId","conceptId","folderConceptIds","folderConversationIds","folderName","autoSelectTaskIds","isExecuting","executingTaskId","taskExecutionContent","submittingResultId","taskResultContent","isGeneratingPlan"],[1,"empty-content"],[1,"empty-icon"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","40px","height","40px","color","#3B82F6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"],[1,"empty-title"],[1,"empty-desc"],[1,"start-btn",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",2,"width","20px","height","20px"],[1,"persona-pills"],[1,"persona-pill",2,"color","#3B82F6"],[1,"persona-pill",2,"color","#8B5CF6"],[1,"persona-pill",2,"color","#10B981"],[1,"persona-pill",2,"color","#F59E0B"],[1,"persona-pill",2,"color","#EF4444"],[1,"persona-pill",2,"color","#EC4899"],[1,"source-header"],[3,"close","conceptClick","conceptId","isOpen"]],template:function(e,n){e&1&&(U(0,kd,8,3,"div",2,jn),U(2,yd,8,3,"div",3,jn),f(4,wd,1,0,"app-topic-picker"),u(5,"div",4)(6,"aside",5)(7,"div",6)(8,"h1"),c(9,"Mentor AI"),p()(),u(10,"div",7)(11,"button",8),L("click",function(){return n.createNewConversation()}),S(),u(12,"svg",9),T(13,"path",10),p(),c(14," New Conversation "),p()(),W(),u(15,"app-concept-tree",11),L("conversationSelected",function(a){return n.selectConversation(a)})("newChatRequested",function(a){return n.createConversationUnderConcept(a)})("conceptSelected",function(a){return n.onConceptSelected(a)}),p(),u(16,"div",12)(17,"a",13),S(),u(18,"svg",9),T(19,"path",14)(20,"path",15),p(),c(21," AI Configuration "),p(),W(),u(22,"a",16),S(),u(23,"svg",9),T(24,"path",17),p(),c(25," Dashboard "),p()()(),W(),u(26,"main",18),f(27,Fp,9,11)(28,Bp,26,0,"div",19),p(),f(29,Wp,4,2,"aside",20),p()),e&2&&(G(n.errorMessages$()),r(2),G(n.infoMessages$()),r(2),C(n.showTopicPicker$()?4:-1),r(7),q("disabled",n.isLoading$()||n.isCurrentConversationExecuting$()),r(4),q("activeConversationId",n.activeConversationId$())("locked",n.isCurrentConversationExecuting$())("newConversationIds",n.newConversationIds$())("loadingItemId",n.loadingConversationId$()),r(12),C(n.activeConversation$()||n.folderName$()?27:28),r(2),C(n.selectedConceptId$()?29:-1))},dependencies:[ae,Pi,Nn,Dn,Ln,Vn,Fn,Bn,jt,Ht,Wn],styles:["[_nghost-%COMP%]{display:block;height:100vh}*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box}.layout[_ngcontent-%COMP%]{display:flex;height:100vh;background:#0d0d0d;color:#fafafa;font-family:Inter,system-ui,sans-serif}.sidebar[_ngcontent-%COMP%]{width:280px;min-width:280px;background:#0d0d0d;border-right:1px solid #2a2a2a;display:flex;flex-direction:column}.sidebar-header[_ngcontent-%COMP%]{height:48px;display:flex;align-items:center;padding:0 16px;border-bottom:1px solid #2a2a2a}.sidebar-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:15px;font-weight:600}.sidebar-actions[_ngcontent-%COMP%]{padding:12px}.new-chat-btn[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;gap:8px;background:#3b82f6;color:#fff;border:none;padding:10px 16px;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer}.new-chat-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb}.new-chat-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.sidebar-footer[_ngcontent-%COMP%]{padding:12px;border-top:1px solid #2a2a2a;display:flex;flex-direction:column;gap:4px}.sidebar-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:13px;color:#8b8b8b;text-decoration:none;padding:6px 4px;border-radius:4px}.sidebar-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#fafafa;background:#1a1a1a}.chat-main[_ngcontent-%COMP%]{flex:1;min-width:480px;display:flex;flex-direction:column;background:#0d0d0d}.chat-header[_ngcontent-%COMP%]{height:48px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;border-bottom:1px solid #2a2a2a}.chat-header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.chat-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:15px;font-weight:500}.switch-btn[_ngcontent-%COMP%]{background:none;border:none;color:#8b8b8b;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:6px}.switch-btn[_ngcontent-%COMP%]:hover:not(:disabled){color:#fafafa}.switch-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.connection-dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;flex-shrink:0}.connection-label[_ngcontent-%COMP%]{font-size:11px;color:#707070;transition:color .2s}.connection-label.connected[_ngcontent-%COMP%]{color:#22c55e}.connection-label.disconnected[_ngcontent-%COMP%]{color:#ef4444}.connection-label.reconnecting[_ngcontent-%COMP%]{color:#f59e0b}.connection-dot.connected[_ngcontent-%COMP%]{background:#22c55e}.connection-dot.disconnected[_ngcontent-%COMP%]{background:#ef4444}.connection-dot.reconnecting[_ngcontent-%COMP%]{background:#f59e0b;animation:_ngcontent-%COMP%_pulse-dot 1s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse-dot{0%,to{opacity:1}50%{opacity:.3}}.disconnect-toast[_ngcontent-%COMP%]{padding:8px 16px;background:#1a1a1a;border-bottom:1px solid #2A2A2A;display:flex;align-items:center;gap:8px;font-size:12px;flex-shrink:0}.disconnect-toast.error[_ngcontent-%COMP%]{border-left:3px solid #EF4444;color:#fca5a5}.disconnect-toast.warning[_ngcontent-%COMP%]{border-left:3px solid #F59E0B;color:#fde68a}.disconnect-toast.success[_ngcontent-%COMP%]{border-left:3px solid #22C55E;color:#86efac}.disconnect-toast-close[_ngcontent-%COMP%]{background:none;border:none;color:#707070;cursor:pointer;margin-left:auto;font-size:14px;padding:0 4px}.disconnect-toast-close[_ngcontent-%COMP%]:hover{color:#fafafa}.chat-messages[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:24px;scroll-behavior:smooth}.messages-container[_ngcontent-%COMP%]{max-width:768px;margin:0 auto}.empty-state[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center}.empty-content[_ngcontent-%COMP%]{text-align:center;max-width:400px;padding:24px}.empty-icon[_ngcontent-%COMP%]{width:80px;height:80px;margin:0 auto 24px;background:#1a1a1a;border-radius:16px;display:flex;align-items:center;justify-content:center}.empty-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;margin-bottom:8px}.empty-desc[_ngcontent-%COMP%]{font-size:15px;color:#a1a1a1;margin-bottom:24px;line-height:1.5}.start-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;background:#3b82f6;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:15px;font-weight:500;cursor:pointer}.start-btn[_ngcontent-%COMP%]:hover{background:#2563eb}.persona-pills[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin-top:24px}.domain-pill[_ngcontent-%COMP%]{padding:8px 16px;background:#1a1a1a;border:1px solid #2A2A2A;border-radius:20px;font-size:13px;font-weight:500;color:#a1a1a1;cursor:pointer;font-family:inherit;transition:all .15s}.domain-pill[_ngcontent-%COMP%]:hover{background:#242424;border-color:#3b82f6;color:#fafafa}.empty-or[_ngcontent-%COMP%]{font-size:12px;color:#707070;margin-top:16px;margin-bottom:0}.persona-selector-panel[_ngcontent-%COMP%]{padding:12px 16px;border-bottom:1px solid #2a2a2a;background:#1a1a1a;animation:_ngcontent-%COMP%_panelSlideDown .2s ease}@keyframes _ngcontent-%COMP%_panelSlideDown{0%{opacity:0;max-height:0;padding-top:0;padding-bottom:0}to{opacity:1;max-height:200px;padding-top:12px;padding-bottom:12px}}.persona-selector-label[_ngcontent-%COMP%]{font-size:13px;color:#a1a1a1;margin-bottom:12px}.error-toast[_ngcontent-%COMP%]{position:fixed;top:16px;right:16px;z-index:9999;background:#1a1a1a;border:1px solid #ef4444;padding:12px 16px;border-radius:8px;display:flex;align-items:center;gap:12px;max-width:400px;box-shadow:0 4px 12px #0000004d}.right-panel[_ngcontent-%COMP%]{width:360px;min-width:360px;background:#0d0d0d;border-left:1px solid #2a2a2a;display:flex;flex-direction:column}.source-header[_ngcontent-%COMP%]{padding:12px 16px;border-bottom:1px solid #2a2a2a;font-size:11px;font-weight:600;color:#8b8b8b;text-transform:uppercase;letter-spacing:.5px;flex-shrink:0}.tab-bar[_ngcontent-%COMP%]{display:flex;gap:0;border-bottom:1px solid #2a2a2a}.tab[_ngcontent-%COMP%]{padding:8px 20px;background:none;border:none;border-bottom:2px solid transparent;color:#8b8b8b;font-size:13px;cursor:pointer}.tab[_ngcontent-%COMP%]:hover{color:#d4d4d4}.tab.active[_ngcontent-%COMP%]{color:#fafafa;border-bottom-color:#3b82f6;font-weight:600}.notes-view[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden}.brain-status-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px 16px;background:#1a1a1a;border-bottom:1px solid #2A2A2A;font-size:11px;flex-shrink:0}.brain-status-label[_ngcontent-%COMP%]{color:#707070;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.brain-progress-bar[_ngcontent-%COMP%]{flex:1;height:4px;background:#242424;border-radius:2px;overflow:hidden;min-width:60px}.brain-progress-fill[_ngcontent-%COMP%]{height:100%;background:#3b82f6;border-radius:2px;transition:width .5s}.brain-stat[_ngcontent-%COMP%]{color:#8b8b8b;white-space:nowrap}.brain-stat[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#fafafa}.auto-ai-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-left:auto}.auto-ai-label[_ngcontent-%COMP%]{color:#707070;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.toggle-track[_ngcontent-%COMP%]{width:36px;height:20px;border-radius:10px;background:#2a2a2a;cursor:pointer;position:relative;transition:background .2s;border:none;padding:0}.toggle-track.active[_ngcontent-%COMP%]{background:#3b82f6}.toggle-track[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.toggle-thumb[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:50%;background:#fafafa;position:absolute;top:2px;left:2px;transition:transform .2s}.toggle-track.active[_ngcontent-%COMP%]   .toggle-thumb[_ngcontent-%COMP%]{transform:translate(16px)}.next-step-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:10px 16px;background:linear-gradient(135deg,#3b82f614,#3b82f608);border:1px solid rgba(59,130,246,.2);border-radius:8px;margin:8px 16px;font-size:13px;animation:_ngcontent-%COMP%_fadeSlideIn .3s ease}.next-step-icon[_ngcontent-%COMP%]{width:20px;height:20px;color:#3b82f6;flex-shrink:0}.next-step-text[_ngcontent-%COMP%]{flex:1;color:#bfbfbf}.next-step-actions[_ngcontent-%COMP%]{display:flex;gap:8px;flex-shrink:0}.next-step-btn[_ngcontent-%COMP%]{padding:4px 12px;border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;border:none;transition:all .15s ease}.next-step-btn.primary[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.next-step-btn.primary[_ngcontent-%COMP%]:hover{background:#2563eb}.next-step-btn.secondary[_ngcontent-%COMP%]{background:transparent;color:#8b8b8b;border:1px solid #2A2A2A}.next-step-btn.secondary[_ngcontent-%COMP%]:hover{color:#fafafa;border-color:#525252}.next-step-close[_ngcontent-%COMP%]{background:none;border:none;color:#525252;font-size:16px;cursor:pointer;padding:0 4px;line-height:1}.next-step-close[_ngcontent-%COMP%]:hover{color:#fafafa}@keyframes _ngcontent-%COMP%_fadeSlideIn{0%{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}.domain-dashboard[_ngcontent-%COMP%]{padding:20px 24px;border-bottom:1px solid #2a2a2a}.domain-stats[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:16px}.stat-card[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:8px;padding:12px 16px;flex:1}.stat-label[_ngcontent-%COMP%]{font-size:11px;color:#8b8b8b;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}.stat-value[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#fafafa}.stat-value.completed[_ngcontent-%COMP%]{color:#10b981}.stat-value.pending[_ngcontent-%COMP%]{color:#f59e0b}.domain-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.run-brain-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 18px;background:#3b82f6;color:#fff;border:none;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer}.run-brain-btn[_ngcontent-%COMP%]:hover{background:#2563eb}.run-brain-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.add-investigation-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 18px;background:#242424;color:#fafafa;border:1px solid #2a2a2a;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer}.add-investigation-btn[_ngcontent-%COMP%]:hover{background:#2a2a2a}.yolo-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:8px 10px;border-radius:8px;border:1px solid #2A2A2A;background:none;color:#8b8b8b;cursor:pointer}.yolo-btn[_ngcontent-%COMP%]:hover{color:#eab308;border-color:#eab308}.yolo-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.plan-inline-panel[_ngcontent-%COMP%]{background:#1a1a1a;border-bottom:1px solid #2a2a2a;display:flex;flex-direction:column;flex-shrink:0}.plan-inline-panel.collapsed[_ngcontent-%COMP%]   .plan-steps[_ngcontent-%COMP%], .plan-inline-panel.collapsed[_ngcontent-%COMP%]   .plan-footer[_ngcontent-%COMP%]{display:none}.plan-header[_ngcontent-%COMP%]{padding:10px 16px;border-bottom:1px solid #2a2a2a;display:flex;align-items:center;gap:12px;cursor:pointer}.plan-header[_ngcontent-%COMP%]:hover{background:#242424}.plan-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#fafafa;flex:1}.plan-collapse-icon[_ngcontent-%COMP%]{width:16px;height:16px;color:#8b8b8b;transition:transform .2s;flex-shrink:0}.plan-collapse-icon.expanded[_ngcontent-%COMP%]{transform:rotate(180deg)}.plan-meta[_ngcontent-%COMP%]{display:flex;gap:16px;font-size:12px;color:#a1a1a1}.plan-summary[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1;padding:8px 0 0}.plan-steps[_ngcontent-%COMP%]{max-height:40vh;overflow-y:auto;padding:8px 16px;transition:max-height .3s ease,opacity .3s ease,padding .3s ease}.plan-step[_ngcontent-%COMP%]{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid #242424}.plan-step[_ngcontent-%COMP%]:last-child{border-bottom:none}.step-indicator[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600}.step-pending[_ngcontent-%COMP%]{background:#242424;color:#8b8b8b}.step-in-progress[_ngcontent-%COMP%]{background:#1e3a5f;color:#60a5fa}.step-completed[_ngcontent-%COMP%]{background:#1a2e1a;color:#86efac}.step-failed[_ngcontent-%COMP%]{background:#3b1a1a;color:#fca5a5}.step-info[_ngcontent-%COMP%]{flex:1}.step-title[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:#fafafa}.step-desc[_ngcontent-%COMP%]{font-size:12px;color:#a1a1a1;margin-top:2px}.step-tags[_ngcontent-%COMP%]{display:flex;gap:6px;margin-top:4px}.step-tag[_ngcontent-%COMP%]{font-size:10px;padding:1px 6px;border-radius:4px;background:#242424;color:#8b8b8b}.plan-btn-cancel[_ngcontent-%COMP%]{background:none;border:1px solid #2a2a2a;color:#a1a1a1;border-radius:6px;padding:4px 12px;font-size:12px;cursor:pointer;font-family:inherit;flex-shrink:0}.plan-btn-cancel[_ngcontent-%COMP%]:hover{color:#fafafa;border-color:#4a4a4a}.plan-btn-approve[_ngcontent-%COMP%]{background:#3b82f6;color:#fafafa;border:none;border-radius:6px;padding:4px 12px;font-size:12px;font-weight:500;font-family:inherit;flex-shrink:0;cursor:pointer}.plan-btn-approve[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb}.plan-btn-approve[_ngcontent-%COMP%]:disabled, .plan-btn-cancel[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.btn-spinner[_ngcontent-%COMP%]{display:inline-block;width:12px;height:12px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;vertical-align:middle}.workflow-status-bar[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;padding:10px 16px;background:#1a1a1a;border-bottom:1px solid #2A2A2A;flex-shrink:0}.workflow-status-entry[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:8px;font-size:12px;padding:8px 12px;border-radius:6px;background:#0d0d0d}.ws-detail-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex:1;min-width:0}.wse-executing[_ngcontent-%COMP%]{border-left:3px solid #3B82F6}.wse-completed[_ngcontent-%COMP%]{border-left:3px solid #22C55E;animation:_ngcontent-%COMP%_fadeOutEntry 1.5s ease 3s forwards}.wse-failed[_ngcontent-%COMP%]{border-left:3px solid #EF4444;animation:_ngcontent-%COMP%_fadeOutEntry 1.5s ease 3s forwards}.wse-cancelled[_ngcontent-%COMP%]{border-left:3px solid #F59E0B;animation:_ngcontent-%COMP%_fadeOutEntry 1.5s ease 3s forwards}@keyframes _ngcontent-%COMP%_fadeOutEntry{0%{opacity:1;max-height:60px}to{opacity:0;max-height:0;padding:0;margin:0;overflow:hidden}}.ws-title[_ngcontent-%COMP%]{color:#fafafa;font-weight:600;font-size:13px;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%}.ws-progress-bar[_ngcontent-%COMP%]{flex:1;height:4px;background:#242424;border-radius:2px;overflow:hidden;min-width:60px}.ws-progress-fill[_ngcontent-%COMP%]{height:100%;background:#3b82f6;border-radius:2px;transition:width .3s}.ws-count[_ngcontent-%COMP%]{color:#8b8b8b;flex-shrink:0}.ws-current[_ngcontent-%COMP%]{color:#60a5fa;font-size:11px;width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ws-badge-done[_ngcontent-%COMP%]{color:#22c55e;font-weight:600}.ws-badge-fail[_ngcontent-%COMP%]{color:#ef4444;font-weight:600}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}.step-status-msg[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 14px;margin:8px 0;max-width:768px;background:#1a1a1a;border-left:3px solid #3b82f6;border-radius:0 6px 6px 0;font-size:12px;color:#a1a1a1}.step-status-msg[_ngcontent-%COMP%]   .step-icon[_ngcontent-%COMP%]{width:14px;height:14px;flex-shrink:0}.task-nav-card[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:10px;margin-bottom:16px;overflow:hidden;animation:_ngcontent-%COMP%_cardFadeIn .25s ease}.task-nav-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 14px;font-size:12px;font-weight:600;color:#a1a1a1;border-bottom:1px solid #242424}.task-nav-icon[_ngcontent-%COMP%]{width:16px;height:16px;color:#3b82f6;flex-shrink:0}.task-nav-dismiss[_ngcontent-%COMP%]{margin-left:auto;background:none;border:none;color:#707070;cursor:pointer;padding:2px;display:flex;align-items:center}.task-nav-dismiss[_ngcontent-%COMP%]:hover{color:#a1a1a1}.task-nav-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:10px 14px;background:none;border:none;border-bottom:1px solid #1e1e1e;color:#fafafa;font-size:13px;cursor:pointer;text-align:left;transition:background .15s;gap:12px;font-family:inherit}.task-nav-btn[_ngcontent-%COMP%]:last-child{border-bottom:none}.task-nav-btn[_ngcontent-%COMP%]:hover{background:#242424}.task-nav-btn.cross-concept[_ngcontent-%COMP%]{border-left:3px solid #3b82f6}.task-nav-title[_ngcontent-%COMP%]{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.task-nav-concept[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:11px;color:#3b82f6;flex-shrink:0;white-space:nowrap}@keyframes _ngcontent-%COMP%_cardFadeIn{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_highlightFlash{0%{outline:2px solid #3b82f6;outline-offset:4px}to{outline:2px solid transparent;outline-offset:4px}}[_nghost-%COMP%]     .highlight-flash{animation:_ngcontent-%COMP%_highlightFlash 2s ease-out}.step-confirmation[_ngcontent-%COMP%]{margin:16px 0;padding:16px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;border-left:3px solid #3b82f6}.confirmation-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px}.confirmation-label[_ngcontent-%COMP%]{font-size:.8rem;font-weight:600;color:#3b82f6;text-transform:uppercase;letter-spacing:.05em}.confirmation-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#fafafa;margin:0 0 4px}.confirmation-desc[_ngcontent-%COMP%]{font-size:.875rem;color:#a3a3a3;margin:0 0 12px;line-height:1.5}.input-prompt[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;margin-bottom:8px;background:#f59e0b14;border:1px solid rgba(245,158,11,.2);border-radius:8px;font-size:.85rem;color:#f59e0b;font-weight:500}.input-prompt[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}.confirmation-input[_ngcontent-%COMP%]{width:100%;padding:10px 12px;background:#0d0d0d;border:1px solid #2a2a2a;border-radius:8px;color:#fafafa;font-size:.875rem;font-family:inherit;resize:vertical;min-height:60px;margin-bottom:12px;transition:border-color .15s ease;box-sizing:border-box}.confirmation-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.confirmation-input[_ngcontent-%COMP%]::placeholder{color:#525252}.confirmation-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.confirm-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:6px;padding:8px 16px;font-size:.875rem;font-weight:500;border-radius:8px;cursor:pointer;transition:all .15s ease;border:1px solid transparent}.confirm-btn.primary[_ngcontent-%COMP%]{background:#3b82f6;color:#fff;border-color:#3b82f6}.confirm-btn.primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb;border-color:#2563eb}.confirm-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.confirm-btn.cancel[_ngcontent-%COMP%]{background:transparent;color:#a3a3a3;border-color:#2a2a2a}.confirm-btn.cancel[_ngcontent-%COMP%]:hover{background:#1a1a1a;color:#ef4444;border-color:#ef4444}.return-link-container[_ngcontent-%COMP%]{margin:12px 0;text-align:center}.return-link[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;background:none;border:1px solid #2a2a2a;color:#60a5fa;padding:8px 16px;border-radius:8px;font-size:13px;cursor:pointer;transition:all .15s ease}.return-link[_ngcontent-%COMP%]:hover{background:#1a1a1a;border-color:#3b82f6;color:#93c5fd}.return-link[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}"]})};export{La as ChatComponent};
