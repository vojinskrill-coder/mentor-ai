import{c as F,d as b,e as R,f as E,h as N,i as z,j as D,o as L,p as I,q as U,s as X}from"./chunk-BJPJ353G.js";import{b as S}from"./chunk-X5FYGGBF.js";import{a as _}from"./chunk-QLHVQZLH.js";import{$a as O,A as u,C as x,D as v,E as C,Ea as a,F as h,Fa as k,Ga as P,H as w,K as l,V as i,Z as M,fa as d,ga as s,kb as T,la as p,ma as n,na as r,oa as m,sa as V,ua as y,wa as f}from"./chunk-GC2SN3QZ.js";function G(t,c){if(t&1&&(n(0,"div",5),a(1),r()),t&2){let e=f();i(),k(e.error())}}function j(t,c){t&1&&(n(0,"div",6)(1,"p"),a(2,"Account Temporarily Locked"),r(),n(3,"p",13),a(4,"Too many failed attempts. Please try again later or use a recovery code."),r()())}function q(t,c){if(t&1&&(n(0,"p",9),a(1),r()),t&2){let e=f();i(),P("",e.attemptsRemaining()," attempts remaining")}}function B(t,c){t&1&&(m(0,"span",14),a(1," Verifying... "))}function $(t,c){t&1&&a(0," Verify ")}function H(t,c){t&1&&(m(0,"span",14),a(1," Verifying... "))}function Z(t,c){t&1&&a(0," Use Recovery Code ")}function J(t,c){if(t&1){let e=V();n(0,"div",12)(1,"h3"),a(2,"Enter Recovery Code"),r(),n(3,"form",7),y("ngSubmit",function(){x(e);let g=f();return v(g.verifyRecovery())}),m(4,"input",15),n(5,"button",10),d(6,H,2,0)(7,Z,1,0),r()(),n(8,"button",16),y("click",function(){x(e);let g=f();return v(g.showRecovery.set(!1))}),a(9," Cancel "),r()()}if(t&2){let e=f();i(3),p("formGroup",e.recoveryForm),i(2),p("disabled",e.isVerifying()||e.recoveryForm.invalid),i(),s(e.isVerifying()?6:7)}}var A=class t{authService=u(S);router=u(T);fb=u(U);destroyRef=u(w);isVerifying=l(!1);error=l(null);isLocked=l(!1);attemptsRemaining=l(null);showRecovery=l(!1);form=this.fb.group({code:["",[b.required,b.pattern(/^\d{6}$/)]]});recoveryForm=this.fb.group({recoveryCode:["",[b.required,b.pattern(/^[A-Z0-9]{10}$/)]]});verify(){if(this.form.invalid||this.isLocked())return;this.isVerifying.set(!0),this.error.set(null);let c=this.form.value.code;this.authService.verifyLoginTotp(c).pipe(_(this.destroyRef)).subscribe({next:()=>{this.isVerifying.set(!1);let e=sessionStorage.getItem("returnUrl")||"/dashboard";sessionStorage.removeItem("returnUrl"),this.router.navigate([e])},error:e=>{this.isVerifying.set(!1),this.error.set(e?.error?.detail||"Invalid verification code"),e?.error?.locked&&this.isLocked.set(!0),e?.error?.attemptsRemaining!==void 0&&this.attemptsRemaining.set(e.error.attemptsRemaining),this.form.reset()}})}verifyRecovery(){if(this.recoveryForm.invalid)return;this.isVerifying.set(!0),this.error.set(null);let c=this.recoveryForm.value.recoveryCode.toUpperCase();this.authService.verifyRecoveryCode(c).pipe(_(this.destroyRef)).subscribe({next:()=>{this.isVerifying.set(!1);let e=sessionStorage.getItem("returnUrl")||"/dashboard";sessionStorage.removeItem("returnUrl"),this.router.navigate([e])},error:e=>{this.isVerifying.set(!1),this.error.set(e?.error?.detail||"Invalid recovery code"),this.recoveryForm.reset()}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-two-factor-verify"]],decls:20,vars:8,consts:[[1,"page"],[1,"container"],[1,"header"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"header-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"],[1,"error-box"],[1,"locked-box"],[3,"ngSubmit","formGroup"],["type","text","formControlName","code","maxlength","6","placeholder","------","inputmode","numeric","pattern","[0-9]*","autocomplete","one-time-code",1,"code-input",3,"disabled"],[1,"attempts-warn"],["type","submit",1,"submit-btn",3,"disabled"],["type","button",1,"recovery-link",3,"click"],[1,"recovery-card"],[1,"sub"],[1,"btn-spinner"],["type","text","formControlName","recoveryCode","maxlength","10","placeholder","XXXXXXXXXX",1,"recovery-input"],["type","button",1,"cancel-btn",3,"click"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),C(),n(3,"svg",3),m(4,"path",4),r(),h(),n(5,"h1"),a(6,"Two-Factor Authentication"),r(),n(7,"p"),a(8,"Enter the 6-digit code from your authenticator app"),r()(),d(9,G,2,1,"div",5),d(10,j,5,0,"div",6),n(11,"form",7),y("ngSubmit",function(){return o.verify()}),m(12,"input",8),d(13,q,2,1,"p",9),n(14,"button",10),d(15,B,2,0)(16,$,1,0),r()(),n(17,"button",11),y("click",function(){return o.showRecovery.set(!0)}),a(18," Use a recovery code instead "),r(),d(19,J,10,3,"div",12),r()()),e&2&&(i(9),s(o.error()?9:-1),i(),s(o.isLocked()?10:-1),i(),p("formGroup",o.form),i(),p("disabled",o.isLocked()),i(),s(o.attemptsRemaining()!==null&&o.attemptsRemaining()<5?13:-1),i(),p("disabled",o.isVerifying()||o.form.invalid||o.isLocked()),i(),s(o.isVerifying()?15:16),i(4),s(o.showRecovery()?19:-1))},dependencies:[O,X,N,F,R,E,L,I,D,z],styles:["[_nghost-%COMP%]{display:block}.page[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:#0d0d0d;padding:16px;font-family:Inter,system-ui,sans-serif;color:#fafafa}.container[_ngcontent-%COMP%]{width:100%;max-width:440px}.header[_ngcontent-%COMP%]{text-align:center;margin-bottom:32px}.header-icon[_ngcontent-%COMP%]{width:48px;height:48px;margin:0 auto 16px;color:#3b82f6}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px;font-weight:700;margin-bottom:8px}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:15px;color:#a1a1a1}.error-box[_ngcontent-%COMP%]{background:#ef44441a;border:1px solid rgba(239,68,68,.2);border-radius:8px;padding:12px 16px;margin-bottom:16px;font-size:13px;color:#ef4444}.locked-box[_ngcontent-%COMP%]{background:#f59e0b1a;border:1px solid rgba(245,158,11,.2);border-radius:8px;padding:12px 16px;margin-bottom:16px}.locked-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#f59e0b}.locked-box[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{font-size:12px;color:#fbbf24;margin-top:4px}.code-input[_ngcontent-%COMP%]{width:100%;border-radius:8px;border:1px solid #2a2a2a;background:#1a1a1a;padding:14px;text-align:center;font-size:28px;letter-spacing:.5em;font-family:monospace;color:#fafafa;outline:none;transition:border-color .2s}.code-input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}.code-input[_ngcontent-%COMP%]:disabled{opacity:.5}.attempts-warn[_ngcontent-%COMP%]{font-size:13px;color:#f59e0b;margin-top:8px;text-align:center}.submit-btn[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;gap:8px;margin-top:24px;padding:12px;background:#3b82f6;color:#fff;border:none;border-radius:8px;font-size:15px;font-weight:500;cursor:pointer;font-family:inherit}.submit-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb}.submit-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.btn-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.recovery-link[_ngcontent-%COMP%]{display:block;text-align:center;margin-top:16px;font-size:13px;color:#3b82f6;background:none;border:none;cursor:pointer;font-family:inherit}.recovery-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.recovery-card[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;margin-top:16px}.recovery-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:15px;font-weight:500;margin-bottom:16px}.recovery-input[_ngcontent-%COMP%]{width:100%;border-radius:8px;border:1px solid #2a2a2a;background:#0d0d0d;padding:10px;text-align:center;font-family:monospace;text-transform:uppercase;color:#fafafa;font-size:15px;outline:none}.recovery-input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}.cancel-btn[_ngcontent-%COMP%]{width:100%;margin-top:12px;background:none;border:none;color:#9e9e9e;font-size:13px;cursor:pointer;font-family:inherit;padding:8px}.cancel-btn[_ngcontent-%COMP%]:hover{color:#fafafa}"]})};export{A as TwoFactorVerifyComponent};
