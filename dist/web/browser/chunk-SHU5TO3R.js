import{c as k,d as g,e as E,f as N,h as D,i as L,j as I,n as M,o as U,p as X,r as A}from"./chunk-NTA47MF3.js";import{b as R}from"./chunk-4Z5LMYYC.js";import{a as G,b as B,c as j,q as P,t as q}from"./chunk-TYYRIEAZ.js";import{a as _}from"./chunk-IZGLU5CJ.js";import{A as y,Ba as a,C as b,D as x,Da as h,H as C,Ja as S,K as s,T as o,X as V,Xa as T,ca as m,da as l,gb as F,ia as c,ja as i,ka as n,la as u,pa as w,ra as v,ta as f}from"./chunk-G6XBTM5S.js";function Z(t,d){if(t&1&&(i(0,"div",6),a(1),n()),t&2){let e=f();o(),h(" ",e.error()," ")}}function z(t,d){t&1&&(i(0,"div",7)(1,"p",14),a(2,"Account Temporarily Locked"),n(),i(3,"p",15),a(4," Too many failed attempts. Please try again later or use a recovery code. "),n()())}function H(t,d){if(t&1&&(i(0,"p",10),a(1),n()),t&2){let e=f();o(),h(" ",e.attemptsRemaining()," attempts remaining ")}}function J(t,d){t&1&&(u(0,"ng-icon",16),a(1," Verifying... "))}function K(t,d){t&1&&a(0," Verify ")}function O(t,d){t&1&&(u(0,"ng-icon",16),a(1," Verifying... "))}function Q(t,d){t&1&&a(0," Use Recovery Code ")}function W(t,d){if(t&1){let e=w();i(0,"div",13)(1,"h3",17),a(2,"Enter Recovery Code"),n(),i(3,"form",18),v("ngSubmit",function(){b(e);let p=f();return x(p.verifyRecovery())}),u(4,"input",19),i(5,"button",20),m(6,O,2,0)(7,Q,1,0),n()(),i(8,"button",21),v("click",function(){b(e);let p=f();return x(p.showRecovery.set(!1))}),a(9," Cancel "),n()()}if(t&2){let e=f();o(3),c("formGroup",e.recoveryForm),o(2),c("disabled",e.isVerifying()||e.recoveryForm.invalid),o(),l(e.isVerifying()?6:7)}}var $=class t{authService=y(R);router=y(F);fb=y(X);destroyRef=y(C);isVerifying=s(!1);error=s(null);isLocked=s(!1);attemptsRemaining=s(null);showRecovery=s(!1);form=this.fb.group({code:["",[g.required,g.pattern(/^\d{6}$/)]]});recoveryForm=this.fb.group({recoveryCode:["",[g.required,g.pattern(/^[A-Z0-9]{10}$/)]]});verify(){if(this.form.invalid||this.isLocked())return;this.isVerifying.set(!0),this.error.set(null);let d=this.form.value.code;this.authService.verifyLoginTotp(d).pipe(_(this.destroyRef)).subscribe({next:()=>{this.isVerifying.set(!1);let e=sessionStorage.getItem("returnUrl")||"/dashboard";sessionStorage.removeItem("returnUrl"),this.router.navigate([e])},error:e=>{this.isVerifying.set(!1),this.error.set(e?.error?.detail||"Invalid verification code"),e?.error?.locked&&this.isLocked.set(!0),e?.error?.attemptsRemaining!==void 0&&this.attemptsRemaining.set(e.error.attemptsRemaining),this.form.reset()}})}verifyRecovery(){if(this.recoveryForm.invalid)return;this.isVerifying.set(!0),this.error.set(null);let d=this.recoveryForm.value.recoveryCode.toUpperCase();this.authService.verifyRecoveryCode(d).pipe(_(this.destroyRef)).subscribe({next:()=>{this.isVerifying.set(!1);let e=sessionStorage.getItem("returnUrl")||"/dashboard";sessionStorage.removeItem("returnUrl"),this.router.navigate([e])},error:e=>{this.isVerifying.set(!1),this.error.set(e?.error?.detail||"Invalid recovery code"),this.recoveryForm.reset()}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=V({type:t,selectors:[["app-two-factor-verify"]],features:[S([B({lucideLoader2:P,lucideShieldAlert:q})])],decls:21,vars:8,consts:[[1,"min-h-screen","flex","items-center","justify-center","bg-background","p-4"],[1,"w-full","max-w-md","space-y-8"],[1,"text-center"],["name","lucideShieldAlert",1,"h-12","w-12","text-primary","mx-auto"],[1,"mt-4","text-2xl","font-bold","text-foreground"],[1,"mt-2","text-muted-foreground"],[1,"rounded-md","bg-destructive/10","p-4","text-destructive","text-sm"],[1,"rounded-md","bg-amber-50","border","border-amber-200","p-4"],[1,"space-y-6",3,"ngSubmit","formGroup"],["type","text","formControlName","code","maxlength","6","placeholder","------","inputmode","numeric","pattern","[0-9]*","autocomplete","one-time-code",1,"w-full","rounded-md","border","border-input","bg-background","px-3","py-4","text-center","text-3xl","tracking-[0.5em]","font-mono","focus:outline-none","focus:ring-2","focus:ring-ring","disabled:opacity-50",3,"disabled"],[1,"text-sm","text-amber-600","mt-2","text-center"],["brnButton","","type","submit",1,"w-full","inline-flex","items-center","justify-center","rounded-md","bg-primary","px-4","py-3","text-sm","font-medium","text-primary-foreground","hover:bg-primary/90","disabled:opacity-50",3,"disabled"],["type","button",1,"text-sm","text-primary","hover:underline",3,"click"],[1,"rounded-lg","border","p-6","bg-card","space-y-4"],[1,"text-amber-800","font-medium"],[1,"text-sm","text-amber-700","mt-1"],["name","lucideLoader2",1,"mr-2","h-4","w-4","animate-spin"],[1,"font-medium"],[1,"space-y-4",3,"ngSubmit","formGroup"],["type","text","formControlName","recoveryCode","maxlength","10","placeholder","XXXXXXXXXX",1,"w-full","rounded-md","border","border-input","bg-background","px-3","py-2","text-center","font-mono","uppercase","focus:outline-none","focus:ring-2","focus:ring-ring"],["brnButton","","type","submit",1,"w-full","inline-flex","items-center","justify-center","rounded-md","bg-primary","px-4","py-2","text-sm","font-medium","text-primary-foreground","hover:bg-primary/90","disabled:opacity-50",3,"disabled"],["type","button",1,"w-full","text-sm","text-muted-foreground","hover:text-foreground",3,"click"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),u(3,"ng-icon",3),i(4,"h1",4),a(5,"Two-Factor Authentication"),n(),i(6,"p",5),a(7," Enter the 6-digit code from your authenticator app "),n()(),m(8,Z,2,1,"div",6),m(9,z,5,0,"div",7),i(10,"form",8),v("ngSubmit",function(){return r.verify()}),i(11,"div"),u(12,"input",9),m(13,H,2,1,"p",10),n(),i(14,"button",11),m(15,J,2,0)(16,K,1,0),n()(),i(17,"div",2)(18,"button",12),v("click",function(){return r.showRecovery.set(!0)}),a(19," Use a recovery code instead "),n()(),m(20,W,10,3,"div",13),n()()),e&2&&(o(8),l(r.error()?8:-1),o(),l(r.isLocked()?9:-1),o(),c("formGroup",r.form),o(2),c("disabled",r.isLocked()),o(),l(r.attemptsRemaining()!==null&&r.attemptsRemaining()<5?13:-1),o(),c("disabled",r.isVerifying()||r.form.invalid||r.isLocked()),o(),l(r.isVerifying()?15:16),o(5),l(r.showRecovery()?20:-1))},dependencies:[T,A,D,k,E,N,M,U,I,L,G,j],encapsulation:2})};export{$ as TwoFactorVerifyComponent};
