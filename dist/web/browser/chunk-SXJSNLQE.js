import{A as Y,a as q,b as $,c as F,d as B,e as J,g as V,j as z,l as G,m as K,n as W,o as H,q as Q,u as X}from"./chunk-TYYRIEAZ.js";import{a as D}from"./chunk-IZGLU5CJ.js";import{$a as L,A as g,Ba as a,C as I,Ca as S,D as R,Da as y,H as O,Ja as C,K as m,S as U,T as s,X as v,Xa as b,ca as x,da as u,ga as _,ha as E,hb as j,ia as d,ja as n,ka as r,la as l,n as k,pa as M,r as A,ra as h,t as N,ta as c,x as P}from"./chunk-G6XBTM5S.js";var T=class t{http=g(L);baseUrl="/api/v1/data-export";requestExport(e){return this.http.post(this.baseUrl,e)}getExportStatus(){return this.http.get(`${this.baseUrl}/status`)}getDownloadUrl(e){return`${this.baseUrl}/${e}/download`}static \u0275fac=function(i){return new(i||t)};static \u0275prov=P({token:t,factory:t.\u0275fac,providedIn:"root"})};var ee=(t,e)=>e.value,ne=(t,e)=>e.exportId;function oe(t,e){if(t&1){let i=M();n(0,"label",8)(1,"input",13),h("change",function(){let p=I(i).$implicit,f=c();return R(f.selectedFormat$.set(p.value))}),r(),l(2,"ng-icon",14),n(3,"span",15),a(4),r()()}if(t&2){let i=e.$implicit,o=c();s(),d("value",i.value)("checked",o.selectedFormat$()===i.value),s(),d("name",i.icon),s(2),S(i.label)}}function re(t,e){if(t&1){let i=M();n(0,"label",8)(1,"input",16),h("change",function(){let p=I(i).$implicit,f=c();return R(f.toggleDataType(p.value))}),r(),n(2,"span",15),a(3),r()()}if(t&2){let i=e.$implicit,o=c();s(),d("checked",o.isDataTypeSelected(i.value)),s(2),S(i.label)}}function ae(t,e){t&1&&(l(0,"ng-icon",17),a(1," Exporting... "))}function se(t,e){t&1&&(l(0,"ng-icon",18),a(1," Export My Data "))}function le(t,e){if(t&1&&(n(0,"div",11),a(1),r()),t&2){let i=c();s(),y(" ",i.errorMessage$()," ")}}function pe(t,e){if(t&1&&a(0),t&2){let i=c().$implicit,o=c(2);y(" \xB7 ",o.formatSize(i.fileSize)," ")}}function ce(t,e){if(t&1&&(n(0,"span",30),l(1,"ng-icon",31),a(2," Ready "),r(),n(3,"a",32),a(4," Download "),r()),t&2){let i=c().$implicit;s(3),d("href",i.downloadUrl,U)}}function de(t,e){t&1&&(n(0,"span",27),l(1,"ng-icon",33),a(2," Queued "),r())}function me(t,e){t&1&&(n(0,"span",28),l(1,"ng-icon",34),a(2," Processing "),r())}function xe(t,e){t&1&&(n(0,"span",29),l(1,"ng-icon",35),a(2," Failed "),r())}function ue(t,e){t&1&&(n(0,"span",25),a(1,"Expired"),r())}function fe(t,e){if(t&1&&(n(0,"div",21)(1,"div",22),l(2,"ng-icon",23),n(3,"div")(4,"p",24),a(5),r(),n(6,"p",25),a(7),x(8,pe,1,1),r()()(),n(9,"div",26),x(10,ce,5,1)(11,de,3,0,"span",27)(12,me,3,0,"span",28)(13,xe,3,0,"span",29)(14,ue,2,0,"span",25),r()()),t&2){let i,o=e.$implicit,p=c(2);s(2),d("name",p.getFormatIcon(o.format)),s(3),S(o.format),s(2),y(" ",p.formatDate(o.requestedAt)," "),s(),u(o.fileSize?8:-1),s(2),u((i=o.status)==="COMPLETED"?10:i==="PENDING"?11:i==="PROCESSING"?12:i==="FAILED"?13:i==="EXPIRED"?14:-1)}}function ge(t,e){if(t&1&&(n(0,"div",12)(1,"h3",19),a(2,"Export History"),r(),n(3,"div",20),_(4,fe,15,5,"div",21,ne),r()()),t&2){let i=c();s(4),E(i.exports$())}}var w=class t{exportService=g(T);destroyRef=g(O);selectedFormat$=m("JSON");selectedDataTypes$=m(["all"]);isExporting$=m(!1);exports$=m([]);errorMessage$=m("");pollingActive=!1;formats=[{value:"JSON",label:"JSON",icon:"lucideFileJson"},{value:"MARKDOWN",label:"Markdown",icon:"lucideFileText"},{value:"PDF",label:"PDF",icon:"lucideFile"}];dataTypeOptions=[{value:"all",label:"All Data"},{value:"profile",label:"Profile"},{value:"invitations",label:"Invitations"}];ngOnInit(){this.loadExports()}ngOnDestroy(){this.pollingActive=!1}isDataTypeSelected(e){return this.selectedDataTypes$().includes(e)}toggleDataType(e){let i=this.selectedDataTypes$();if(e==="all"){this.selectedDataTypes$.set(["all"]);return}let o=i.filter(p=>p!=="all");if(o.includes(e)){let p=o.filter(f=>f!==e);this.selectedDataTypes$.set(p.length>0?p:["all"])}else this.selectedDataTypes$.set([...o,e])}onExport(){this.isExporting$.set(!0),this.errorMessage$.set("");let e={format:this.selectedFormat$(),dataTypes:this.selectedDataTypes$()};this.exportService.requestExport(e).pipe(D(this.destroyRef)).subscribe({next:()=>{this.isExporting$.set(!1),this.loadExports(),this.startPolling()},error:i=>{this.errorMessage$.set(i.message),this.isExporting$.set(!1)}})}loadExports(){this.exportService.getExportStatus().pipe(D(this.destroyRef)).subscribe({next:e=>{this.exports$.set(e.data)},error:e=>{this.errorMessage$.set(e.message)}})}startPolling(){this.pollingActive||(this.pollingActive=!0,k(5e3,5e3).pipe(D(this.destroyRef),N(()=>this.pollingActive),A(()=>this.exportService.getExportStatus())).subscribe({next:e=>{this.exports$.set(e.data),e.data.some(o=>o.status==="PENDING"||o.status==="PROCESSING")||(this.pollingActive=!1)}}))}getFormatIcon(e){switch(e){case"JSON":return"lucideFileJson";case"MARKDOWN":return"lucideFileText";case"PDF":return"lucideFile";default:return"lucideFile"}}formatDate(e){return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}formatSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=v({type:t,selectors:[["app-export-section"]],features:[C([$({lucideDownload:G,lucideLoader2:Q,lucideFileJson:K,lucideFileText:W,lucideFile:H,lucideAlertTriangle:B,lucideCheckCircle:V,lucideClock:z,lucideShieldCheck:X})])],decls:24,vars:4,consts:[[1,"rounded-lg","border","bg-card","p-6"],[1,"flex","items-center","gap-2","mb-4"],["name","lucideShieldCheck",1,"h-5","w-5","text-primary"],[1,"text-lg","font-semibold","text-foreground"],[1,"text-sm","text-muted-foreground","mb-6"],[1,"mb-4"],[1,"text-sm","font-medium","text-foreground","mb-2","block"],[1,"flex","gap-4"],[1,"flex","items-center","gap-2","cursor-pointer"],[1,"mb-6"],["brnButton","",1,"inline-flex","items-center","justify-center","gap-2","rounded-md","bg-primary","px-4","py-2","text-sm","font-medium","text-primary-foreground","hover:bg-primary/90","disabled:opacity-50",3,"click","disabled"],[1,"mt-4","rounded-md","bg-destructive/10","border","border-destructive/20","p-3","text-sm","text-destructive"],[1,"mt-6"],["type","radio","name","format",1,"accent-primary",3,"change","value","checked"],[1,"h-4","w-4","text-muted-foreground",3,"name"],[1,"text-sm","text-foreground"],["type","checkbox",1,"accent-primary",3,"change","checked"],["name","lucideLoader2",1,"h-4","w-4","animate-spin"],["name","lucideDownload",1,"h-4","w-4"],[1,"text-sm","font-medium","text-foreground","mb-3"],[1,"space-y-2"],[1,"flex","items-center","justify-between","rounded-md","border","p-3"],[1,"flex","items-center","gap-3"],[1,"h-5","w-5","text-muted-foreground",3,"name"],[1,"text-sm","font-medium","text-foreground"],[1,"text-xs","text-muted-foreground"],[1,"flex","items-center","gap-2"],[1,"inline-flex","items-center","gap-1","text-xs","text-amber-600"],[1,"inline-flex","items-center","gap-1","text-xs","text-blue-600"],[1,"inline-flex","items-center","gap-1","text-xs","text-destructive"],[1,"inline-flex","items-center","gap-1","text-xs","text-green-600"],["name","lucideCheckCircle",1,"h-3.5","w-3.5"],[1,"inline-flex","items-center","justify-center","rounded-md","bg-primary","px-3","py-1.5","text-sm","font-medium","text-primary-foreground","hover:bg-primary/90",3,"href"],["name","lucideClock",1,"h-3.5","w-3.5"],["name","lucideLoader2",1,"h-3.5","w-3.5","animate-spin"],["name","lucideAlertTriangle",1,"h-3.5","w-3.5"]],template:function(i,o){i&1&&(n(0,"section",0)(1,"div",1),l(2,"ng-icon",2),n(3,"h2",3),a(4,"Export My Data"),r()(),n(5,"p",4),a(6," Download a copy of your data for compliance or migration. Export files are encrypted at rest and available for 24 hours. "),r(),n(7,"div",5)(8,"label",6),a(9,"Format"),r(),n(10,"div",7),_(11,oe,5,4,"label",8,ee),r()(),n(13,"div",9)(14,"label",6),a(15,"Data to include"),r(),n(16,"div",7),_(17,re,4,2,"label",8,ee),r()(),n(19,"button",10),h("click",function(){return o.onExport()}),x(20,ae,2,0)(21,se,2,0),r(),x(22,le,2,1,"div",11),x(23,ge,6,0,"div",12),r()),i&2&&(s(11),E(o.formats),s(6),E(o.dataTypeOptions),s(2),d("disabled",o.isExporting$()),s(),u(o.isExporting$()?20:21),s(2),u(o.errorMessage$()?22:-1),s(),u(o.exports$().length>0?23:-1))},dependencies:[b,q,F],encapsulation:2})};var te=class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=v({type:t,selectors:[["app-profile-settings"]],features:[C([$({lucideUser:Y,lucideArrowLeft:J})])],decls:10,vars:0,consts:[[1,"min-h-screen","bg-background"],[1,"border-b","border-border","bg-card"],[1,"container","mx-auto","px-4","py-4","flex","items-center","gap-3"],["routerLink","/dashboard",1,"text-muted-foreground","hover:text-foreground"],["name","lucideArrowLeft",1,"h-5","w-5"],["name","lucideUser",1,"h-6","w-6","text-primary"],[1,"text-xl","font-semibold","text-foreground"],[1,"container","mx-auto","px-4","py-8","max-w-2xl","space-y-8"]],template:function(i,o){i&1&&(n(0,"div",0)(1,"header",1)(2,"div",2)(3,"a",3),l(4,"ng-icon",4),r(),l(5,"ng-icon",5),n(6,"h1",6),a(7,"Profile Settings"),r()()(),n(8,"main",7),l(9,"app-export-section"),r()())},dependencies:[b,j,F,w],encapsulation:2})};export{te as ProfileSettingsComponent};
