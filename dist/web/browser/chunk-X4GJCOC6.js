import{c as I,d as S,e as N,f as L,h as j,i as A,j as B,n as U,o as O,p as G,r as q}from"./chunk-ATNIHN2O.js";import{b as R}from"./chunk-BTP5US75.js";import{a as P,b as $,c as Q,h as z,k as H,l as J,q as K}from"./chunk-IDIHJMUC.js";import{a as h}from"./chunk-HXP2IP54.js";import{A as x,Aa as C,B as y,Ba as _,F as w,Ha as k,I as l,R as a,V as F,Va as D,aa as u,ba as p,da as T,ea as E,eb as M,fa as V,ga as v,ha as i,ia as n,ja as s,na as b,pa as g,ra as m,y as f,za as r}from"./chunk-4VSIGE6D.js";function X(t,o){if(t&1&&(i(0,"div",5),r(1),n()),t&2){let e=m();a(),_(" ",e.error()," ")}}function Y(t,o){t&1&&(i(0,"div",6),s(1,"ng-icon",9),i(2,"p",4),r(3,"Loading 2FA setup..."),n()())}function Z(t,o){t&1&&(i(0,"p",22),r(1," Please enter a valid 6-digit code "),n())}function ee(t,o){t&1&&(s(0,"ng-icon",24),r(1," Verifying... "))}function te(t,o){t&1&&r(0," Verify and Enable 2FA ")}function ie(t,o){if(t&1){let e=b();i(0,"div",7)(1,"div",10)(2,"h2",11),r(3,"Step 1: Scan QR Code"),n(),i(4,"p",12),r(5," Open your authenticator app (Google Authenticator, Authy, etc.) and scan this QR code: "),n(),i(6,"div",13)(7,"div",14)(8,"div")(9,"p",15),r(10),n(),i(11,"p",16),r(12,"Scan with authenticator app"),n()()()(),i(13,"p",17),r(14," Manual entry code: "),i(15,"code",18),r(16),n()()(),i(17,"div",10)(18,"h2",11),r(19,"Step 2: Enter Verification Code"),n(),i(20,"form",19),g("ngSubmit",function(){x(e);let c=m();return y(c.verifyCode())}),i(21,"div")(22,"label",20),r(23,"6-digit code"),n(),s(24,"input",21),u(25,Z,2,0,"p",22),n(),i(26,"button",23),u(27,ee,2,0)(28,te,1,0),n()()()()}if(t&2){let e=m();a(10),C(e.secret()),a(6),C(e.secret()),a(4),v("formGroup",e.verifyForm),a(5),p(e.verifyForm.controls.code.touched&&e.verifyForm.controls.code.errors?25:-1),a(),v("disabled",e.isVerifying()||e.verifyForm.invalid),a(),p(e.isVerifying()?27:28)}}function oe(t,o){if(t&1&&(i(0,"div",32),r(1),n()),t&2){let e=o.$implicit;a(),_(" ",e," ")}}function ne(t,o){t&1&&(s(0,"ng-icon",37),r(1," Copied! "))}function re(t,o){t&1&&(s(0,"ng-icon",38),r(1," Copy Codes "))}function ae(t,o){if(t&1){let e=b();i(0,"div",8)(1,"div",25),s(2,"ng-icon",26),i(3,"h2",27),r(4,"2FA Enabled Successfully!"),n()(),i(5,"div",28)(6,"p",29),r(7," Save your recovery codes "),n(),i(8,"p",30),r(9," If you lose access to your authenticator app, you can use these codes to access your account. Each code can only be used once. "),n()(),i(10,"div",31),E(11,oe,2,1,"div",32,T),n(),i(13,"div",33)(14,"button",34),g("click",function(){x(e);let c=m();return y(c.copyRecoveryCodes())}),u(15,ne,2,0)(16,re,2,0),n(),i(17,"button",34),g("click",function(){x(e);let c=m();return y(c.downloadRecoveryCodes())}),s(18,"ng-icon",35),r(19," Download "),n()(),i(20,"button",36),g("click",function(){x(e);let c=m();return y(c.complete())}),r(21," Continue to Dashboard "),n()()}if(t&2){let e=m();a(11),V(e.recoveryCodes()),a(4),p(e.copied()?15:16)}}var W=class t{authService=f(R);router=f(M);fb=f(G);destroyRef=f(w);isLoading=l(!0);isVerifying=l(!1);error=l(null);step=l("qr");secret=l("");recoveryCodes=l([]);copied=l(!1);verifyForm=this.fb.group({code:["",[S.required,S.pattern(/^\d{6}$/)]]});ngOnInit(){this.enrollMfa()}enrollMfa(){this.isLoading.set(!0),this.error.set(null),this.authService.enrollMfa().pipe(h(this.destroyRef)).subscribe({next:o=>{this.secret.set(o.secret),this.recoveryCodes.set(o.recoveryCodes),this.isLoading.set(!1)},error:o=>{this.error.set(o?.error?.detail||"Failed to initialize 2FA setup"),this.isLoading.set(!1)}})}verifyCode(){if(this.verifyForm.invalid)return;this.isVerifying.set(!0),this.error.set(null);let o=this.verifyForm.value.code;this.authService.verifyMfaEnrollment(o).pipe(h(this.destroyRef)).subscribe({next:()=>{this.isVerifying.set(!1),this.step.set("recovery")},error:e=>{this.error.set(e?.error?.detail||"Invalid verification code"),this.isVerifying.set(!1)}})}copyRecoveryCodes(){let o=this.recoveryCodes().join(`
`);navigator.clipboard.writeText(o).then(()=>{this.copied.set(!0),setTimeout(()=>this.copied.set(!1),2e3)})}downloadRecoveryCodes(){let o=this.recoveryCodes().join(`
`),e=new Blob([`Mentor AI Recovery Codes

${o}

Store these codes safely. Each code can only be used once.`],{type:"text/plain"}),d=URL.createObjectURL(e),c=document.createElement("a");c.href=d,c.download="mentor-ai-recovery-codes.txt",c.click(),URL.revokeObjectURL(d)}complete(){let o=sessionStorage.getItem("returnUrl")||"/dashboard";sessionStorage.removeItem("returnUrl"),this.router.navigate([o])}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=F({type:t,selectors:[["app-two-factor-setup"]],features:[k([$({lucideLoader2:K,lucideCopy:H,lucideDownload:J,lucideCheck:z})])],decls:11,vars:2,consts:[[1,"min-h-screen","flex","items-center","justify-center","bg-background","p-4"],[1,"w-full","max-w-lg","space-y-8"],[1,"text-center"],[1,"text-2xl","font-bold","text-foreground"],[1,"mt-2","text-muted-foreground"],[1,"rounded-md","bg-destructive/10","p-4","text-destructive","text-sm"],[1,"text-center","py-8"],[1,"space-y-6"],[1,"rounded-lg","border","p-6","bg-card","space-y-6"],["name","lucideLoader2",1,"h-8","w-8","animate-spin","text-primary","mx-auto"],[1,"rounded-lg","border","p-6","bg-card"],[1,"font-semibold","text-lg","mb-4"],[1,"text-sm","text-muted-foreground","mb-4"],[1,"flex","justify-center","p-4","bg-white","rounded-lg"],[1,"w-48","h-48","border-2","border-dashed","border-gray-300","flex","items-center","justify-center","text-center","text-sm","text-gray-500"],[1,"font-mono","text-xs","break-all"],[1,"mt-2"],[1,"text-xs","text-muted-foreground","mt-4","text-center"],[1,"bg-muted","px-2","py-1","rounded"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"text-sm","font-medium","text-foreground"],["type","text","formControlName","code","maxlength","6","placeholder","000000","inputmode","numeric","pattern","[0-9]*",1,"mt-1","w-full","rounded-md","border","border-input","bg-background","px-3","py-2","text-sm","text-center","text-2xl","tracking-widest","font-mono","focus:outline-none","focus:ring-2","focus:ring-ring"],[1,"text-sm","text-destructive","mt-1"],["brnButton","","type","submit",1,"w-full","inline-flex","items-center","justify-center","rounded-md","bg-primary","px-4","py-2","text-sm","font-medium","text-primary-foreground","hover:bg-primary/90","disabled:opacity-50",3,"disabled"],["name","lucideLoader2",1,"mr-2","h-4","w-4","animate-spin"],[1,"flex","items-center","gap-2","text-green-600"],["name","lucideCheck",1,"h-5","w-5"],[1,"font-semibold","text-lg"],[1,"bg-amber-50","border","border-amber-200","rounded-lg","p-4"],[1,"text-sm","text-amber-800","font-medium","mb-2"],[1,"text-xs","text-amber-700"],[1,"grid","grid-cols-2","gap-2"],[1,"font-mono","text-sm","bg-muted","px-3","py-2","rounded","text-center"],[1,"flex","gap-2"],["brnButton","","type","button",1,"flex-1","inline-flex","items-center","justify-center","gap-2","rounded-md","border","border-input","bg-background","px-4","py-2","text-sm","font-medium","hover:bg-accent",3,"click"],["name","lucideDownload",1,"h-4","w-4"],["brnButton","","type","button",1,"w-full","inline-flex","items-center","justify-center","rounded-md","bg-primary","px-4","py-2","text-sm","font-medium","text-primary-foreground","hover:bg-primary/90",3,"click"],["name","lucideCheck",1,"h-4","w-4","text-green-600"],["name","lucideCopy",1,"h-4","w-4"]],template:function(e,d){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),r(4,"Set up Two-Factor Authentication"),n(),i(5,"p",4),r(6," Secure your account with an authenticator app "),n()(),u(7,X,2,1,"div",5),u(8,Y,4,0,"div",6)(9,ie,29,6,"div",7)(10,ae,22,1,"div",8),n()()),e&2&&(a(7),p(d.error()?7:-1),a(),p(d.isLoading()?8:d.step()==="qr"?9:d.step()==="recovery"?10:-1))},dependencies:[D,q,j,I,N,L,U,O,B,A,P,Q],encapsulation:2})};export{W as TwoFactorSetupComponent};
